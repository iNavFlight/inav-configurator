import{T as P,G as u,m as O,_ as $,i as S,k as w,$ as t,F as m,M as k,d as L,l as i}from"./index--BqaKNiR.js";P.ports={};P.ports.initialize=function(c){var v=["data","logging","sensors","telemetry","rx","peripherals"];u.active_tab!="ports"&&(u.active_tab="ports"),O.loadSerialPorts(function(){$(async()=>{const{default:e}=await import("./ports-BnXMIsld.js");return{default:e}},[],import.meta.url).then(({default:e})=>u.load(e,M))});function y(){t(".tab-ports").addClass("supported");var e,a;for(a=t("select.sensors_baudrate"),e=0;e<i.getBauds("SENSOR").length;e++)a.append('<option value="'+i.getBauds("SENSOR")[e]+'">'+i.getBauds("SENSOR")[e]+"</option>");for(a=t("select.msp_baudrate"),e=0;e<i.getBauds("MSP").length;e++)a.append('<option value="'+i.getBauds("MSP")[e]+'">'+i.getBauds("MSP")[e]+"</option>");for(a=t("select.telemetry_baudrate"),e=0;e<i.getBauds("TELEMETRY").length;e++)a.append('<option value="'+i.getBauds("TELEMETRY")[e]+'">'+i.getBauds("TELEMETRY")[e]+"</option>");for(a=t("select.peripherals_baudrate"),e=0;e<i.getBauds("PERIPHERAL").length;e++)a.append('<option value="'+i.getBauds("PERIPHERAL")[e]+'">'+i.getBauds("PERIPHERAL")[e]+"</option>");for(var f=t(".tab-ports .ports"),l=t("#tab-ports-templates .portConfiguration"),d=0;d<m.SERIAL_CONFIG.ports.length;d++){var n=l.clone(),r=m.SERIAL_CONFIG.ports[d];if(n.data("serialPort",r),r.identifier!=20){n.find("select.msp_baudrate").val(r.msp_baudrate),n.find("select.telemetry_baudrate").val(r.telemetry_baudrate),n.find("select.sensors_baudrate").val(r.sensors_baudrate),n.find("select.peripherals_baudrate").val(r.peripherals_baudrate),n.find(".identifier").text(i.getPortName(r.identifier)),r.identifier>=30?n.find(".softSerialWarning").css("display","inline"):n.find(".softSerialWarning").css("display","none"),n.data("index",d),n.data("port",r);for(var o=0;o<v.length;o++){var s=v[o],p=t(n).find(".functionsCell-"+s);let T="portFunc-"+s+"-"+d;for(p.attr("id",T),e=0;e<i.getRules().length;e++){var R=i.getRules()[e],b=R.name;if(R.groups.indexOf(s)!=-1){var h;if(s!=="telemetry"&&s!=="peripherals"&&s!=="sensors"){var B="functionCheckbox-"+d+"-"+o+"-"+e;if(p.prepend('<span class="function"><input type="checkbox" class="togglemedium" id="'+B+'" value="'+b+'" /><label for="'+B+'"> '+R.displayName+"</label></span>"),r.functions.indexOf(b)>=0){var A=p.find("#"+B);A.prop("checked",!0)}}else{var _="function-"+s,C="select[name="+_+"]";if(h=p.find(C),h.length==0){p.prepend('<span class="function"><select id="'+_+'" name="'+_+'" class="function-select '+_+'" /></span>'),p.find("#"+_).on("change",()=>{x(T,s)}),h=p.find(C);var F=S.getMessage("portsTelemetryDisabled");h.append('<option value="">'+F+"</option>")}h.append('<option value="'+b+'">'+R.displayName+"</option>"),r.functions.indexOf(b)>=0&&h.val(b)}}}}f.find("tbody").append(n)}}t("table.ports tbody").on("change","select",E),t("table.ports tbody").on("change","input",E)}function E(e){let a=t(e.currentTarget),f=a.val(),l=i.getRuleByName(a.val());a.is('input[type="checkbox"]')&&!a.is(":checked")||a.is("select")&&!f||(a.is('input[type="checkbox"]')&&a.val()==="MSP"&&a.is(":checked")&&checkMSPPortCount(a)>=2&&showMSPWarning(),l&&l.isUnique&&(a.closest("tr").find(".function-select").each(function(r,o){let s=t(o);s.val()!=f&&s.val("")}),a.closest("tr").find('input[type="checkbox"]').each(function(r,o){let s=t(o);s.val()!=f&&(s.prop("checked",!1),s.trigger("change"))})))}function M(){S.localize(),y(),new w("Modal",{width:480,height:200,closeButton:"title",animation:!1,title:S.getMessage("portsMspWarningTitle")||"MSP Port Warning",content:t("#mspWarningContent")}),checkMSPPortCount()>2&&showMSPWarning(),t("a.save").on("click",g),u.content_ready(c)}function g(){m.SERIAL_CONFIG.ports=m.SERIAL_CONFIG.ports.filter(l=>l.identifier==20),t(".tab-ports .portConfiguration").each(function(){var l=this,d=t(this).data("serialPort");if(d.identifier!=20){var n=t(l).find("input:checkbox:checked").map(function(){return this.value}).get(),r=t(l).find("select[name=function-telemetry]").val();r&&n.push(r);var o=t(l).find("select[name=function-peripherals]").val();o&&n.push(o);var s=t(l).find("select[name=function-sensors]").val();s&&n.push(s);var p={functions:n,msp_baudrate:t(l).find(".msp_baudrate").val(),telemetry_baudrate:t(l).find(".telemetry_baudrate").val(),sensors_baudrate:t(l).find(".sensors_baudrate").val(),peripherals_baudrate:t(l).find(".peripherals_baudrate").val(),identifier:d.identifier};m.SERIAL_CONFIG.ports.push(p)}}),O.saveSerialPorts(e);function e(){k.send_message(L.MSP_EEPROM_WRITE,!1,!1,a)}function a(){u.log(S.getMessage("configurationEepromSaved")),u.tab_switch_cleanup(function(){k.send_message(L.MSP_SET_REBOOT,!1,!1,f)})}function f(){u.log(S.getMessage("deviceRebooting")),u.handleReconnect(t(".tab_ports a"))}}};function x(c,v){let y=t("#"+c),E=y.find(".function-"+v).val(),M=v==="telemetry"?"AUTO":115200,g=i.getRuleByName(E);g&&typeof g.defaultBaud<"u"&&(M=g.defaultBaud),y.find("."+v+"_baudrate").children("[value="+M+"]").prop("selected",!0)}P.ports.cleanup=function(c){t(".jBox-wrapper").remove(),c&&c()};
