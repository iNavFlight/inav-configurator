import{F as l,T as H,G as T,M as G,d as D,_ as ee,$ as e,i as y,m as ae,c as w,b as ne}from"./index--BqaKNiR.js";import{w as te}from"./wNumb-DZfnXen2.js";import{n as re}from"./nouislider-B_G20eMg.js";function ie(h){for(var r=0;r<l.SERIAL_CONFIG.ports.length;r++){var M=l.SERIAL_CONFIG.ports[r];if(M.functions.indexOf(h)>=0)return!0}return!1}function le(h,r){if(ie("RUNCAM_DEVICE_CONTROL"))switch(h){case 39:return"CAMERA WI-FI";case 40:return"CAMERA POWER";case 41:return"CAMERA CHANGE MODE"}return h===11&&l.isAirplane()?"NAV LOITER":r}var F=[];H.auxiliary={};H.auxiliary.initialize=function(h){T.active_tab_ref=this,T.active_tab="auxiliary";let r=[],M=[],U=null;G.send_message(D.MSP_MODE_RANGES,!1,!1,X);function X(){G.send_message(D.MSP_BOXIDS,!1,!1,function(){l.generateAuxConfig(),r=Array.from(l.AUX_CONFIG),M=Array.from(l.AUX_CONFIG_IDS),W()})}function W(){G.send_message(D.MSP_RC,!1,!1,k)}function k(){q(),ee(async()=>{const{default:t}=await import("./auxiliary-fii5PAup.js");return{default:t}},[],import.meta.url).then(({default:t})=>T.load(t,Z))}const d={};d.Arming=["ARM","PREARM"],d["Flight Modes"]=["ANGLE","HORIZON","MANUAL","ANGLE HOLD"],d["Navigation Modes"]=["NAV COURSE HOLD","NAV CRUISE","NAV POSHOLD","NAV RTH","NAV WP","GCS NAV"],d["Flight Mode Modifiers"]=["NAV ALTHOLD","HEADING HOLD","AIR MODE","SOARING","SURFACE","TURN ASSIST"],d["Fixed Wing"]=["AUTO TUNE","SERVO AUTOTRIM","AUTO LEVEL TRIM","NAV LAUNCH","LOITER CHANGE","FLAPERON"],d["Multi-rotor"]=["FPV ANGLE MIX","TURTLE","MC BRAKING","HEADFREE","HEADADJ"],d["OSD Modes"]=["OSD OFF","OSD ALT 1","OSD ALT 2","OSD ALT 3"],d["FPV Camera Modes"]=["CAMSTAB","CAMERA CONTROL 1","CAMERA CONTROL 2","CAMERA CONTROL 3"],d.VTOL=["MIXER PROFILE 2","MIXER TRANSITION"],d.Beeper=["BEEPER","BEEPER MUTE"],d.Gimbal=["GIMBAL LEVEL TILT","GIMBAL LEVEL ROLL","GIMBAL LEVEL PAN","GIMBAL HEADTRACKER","GIMBAL CENTER"],d["Misc Modes"]=["LEDS OFF","LIGHTS","HOME RESET","WP PLANNER","MISSION CHANGE","BLACKBOX","FAILSAFE","KILLSWITCH","TELEMETRY","MSP RC OVERRIDE","USER1","USER2","USER3","USER4"];function q(){var t=[],u=[],i=!1,n=0;for(let a=0;a<r.length;a++)t[a]=r[a],u[a]=M[a];r=[],M=[];for(let a in d){let f=d[a];for(let R=0;R<f.length;R++)for(let s=0;s<t.length;s++)if(f[R]===t[s]){r[n]=t[s],M[n]=u[s],F[n++]=s;break}}if(t.length>r.length)for(let a=0;a<t.length;a++){i=!1;for(let f=0;f<r.length;f++)if(t[a]===r[f]){i=!0;break}i||(r[n]=t[a],M[n]=u[a],F[n++]=a)}}function K(t){var u=e("#tab-auxiliary-templates .modeSection"),i=u.clone();return e(i).attr("id","section-"+t),e(i).find(".modeSectionName").text(t),i}function j(t,u){var i=e("#tab-auxiliary-templates .mode"),n=i.clone(),a=r[t];return a=le(u,a),e(n).attr("id","mode-"+t),e(n).find(".name").text(a),e(n).data("index",t),e(n).data("id",u),e(n).data("origId",F[t]),e(n).data("modeName",r[t]),e(n).find(".name").data("modeElement",n),e(n).find("a.addRange").data("modeElement",n),n}function z(t){var u=e("#tab-auxiliary-templates .range"),i=e(u).find(".channel"),n=e(i).find("option");n.remove();let a=n.clone();a.text(y.getMessage("auxiliaryAutoChannelSelect")),a.val(-1),i.append(a);for(var f=0;f<t;f++)a=n.clone(),a.text("CH "+(f+5)),a.val(f),i.append(a);i.val(0)}function P(t,u,i){var n=e(t).data("index"),a={min:[900],max:[2100]},f=[1300,1700];i!=null&&(f=[i.start,i.end]);var R=e(t).find(".range").length,s=e("#tab-auxiliary-templates .range").clone();s.attr("id","mode-"+n+"-range-"+R),t.find(".ranges").append(s);var N=e(s).find(".channel-slider")[0];re.create(N,{start:f,behaviour:"snap-drag",margin:50,step:25,connect:!0,range:a,format:te({decimals:0}),pips:{mode:"values",values:[900,1e3,1200,1400,1500,1600,1800,2e3,2100],density:4,stepped:!0}}),N.noUiSlider.on("update",S=>{var p="#mode-"+n+"-range-"+R;e(p+" .lowerLimitValue").text(S[0]),e(p+" .upperLimitValue").text(S[1])}),e(s).find(".deleteRange").data("rangeElement",s),e(s).find("a.deleteRange").on("click",function(){var S=e(this).data("rangeElement");t.removeClass("inRange"),S.remove()}),e(s).find(".channel").val(u)}function Z(){var t=l.RC.active_channels-4;z(t);var u=e(".tab-auxiliary .modes tbody");let i="",n="";for(var a=0;a<r.length;a++){for(n in d)if(d[n].indexOf(r[a])!=-1)break;if(n!=i){i=n;var f=K(n);u.append(f)}var R=M[a],s=j(a,R);u.append(s);for(var N=0;N<l.MODE_RANGES.length;N++){var S=l.MODE_RANGES[N];if(S.id==R){var p=S.range;p.start<p.end&&P(s,S.auxChannelIndex,p)}}}e("a.addRange").on("click",function(){var A=e(this).data("modeElement");P(A,-1)}),y.localize(),e("a.save").on("click",function(){var A=l.MODE_RANGES.length;l.MODE_RANGES=[];var E=[];e(".tab-auxiliary .modes .mode").each(function(){var o=e(this),O=o.data("id");e(o).find(".range").each(function(){var m=e(this).find(".channel-slider")[0].noUiSlider.get(!0),v={id:O,auxChannelIndex:parseInt(e(this).find(".channel").val()),range:{start:m[0],end:m[1]}};E.push(o.find(".name").text()),l.MODE_RANGES.push(v)})});for(var C=l.MODE_RANGES.length;C<A;C++){var _={id:0,auxChannelIndex:0,range:{start:900,end:900}};l.MODE_RANGES.push(_)}ae.sendModeRanges(c);function c(){G.send_message(D.MSP_EEPROM_WRITE,!1,!1,function(){T.log(y.getMessage("auxiliaryEepromSaved"))})}});function J(A,E){E<900?E=900:E>2100&&(E=2100);var C=(E-900)/1200*100;e(".modes .ranges .range").each(function(){var _=e(this).find(".channel").val();_==A&&e(this).find(".marker").css("left",C+"%")})}function Y(){G.send_message(D.MSP_RC,!1,!1,V)}function V(){let A=!1,E=!0,C=["ANGLE","HORIZON","MANUAL","ANGLE HOLD","NAV RTH","NAV POSHOLD","NAV CRUISE","NAV COURSE HOLD","NAV WP","GCS NAV"];for(var _=l.RC.active_channels-4,c=0;c<_;c++)J(c,l.RC.channels[c+4]);for(var c=0;c<r.length;c++){var o=e("#mode-"+c);let L=!1;if(o.find(" .range").length==0){o.removeClass("off").removeClass("on");continue}if(l.isModeBitSet(o.data("origId")))e(".mode .name").eq(o.data("index")).data("modeElement").addClass("on").removeClass("inRange").removeClass("off"),e.inArray(o.data("modeName"),C)!==-1&&(E=!1);else{var O=o.find(" .range");for(let I=0;I<O.length;I++){var m=e(O[I]).find(".lowerLimitValue").html(),v=e(O[I]).find(".upperLimitValue").html(),g=e(O[I]).find(".marker")[0].style.left;g=g.substring(0,g.length-1),m=(m-900)/1200*100,v=(v-900)/1200*100,g>=m&&g<=v&&(L=!0)}L?(e(".mode .name").eq(o.data("index")).data("modeElement").removeClass("on").addClass("inRange").removeClass("off"),e.inArray(o.data("modeName"),C)!==-1&&(E=!1)):e(".mode .name").eq(o.data("index")).data("modeElement").removeClass("on").removeClass("inRange").addClass("off")}A=!0}E?e(".acroEnabled").addClass("on").removeClass("off"):e(".acroEnabled").removeClass("on").addClass("off");let B=x&&A;for(let b=0;b<r.length;b++){let L=e("#mode-"+b);L.find(" .range").length==0&&L.toggle(!B)}$(l.RC.channels,l.RC.active_channels,l.MISC.rssi_channel),e(".modeSection").each(function(){e(this).toggle(!B)})}function $(A,E,C){const _=e('.tab-auxiliary select.channel option[value="-1"]:selected');if(_.length===0){U=null;return}const c=function(){U=A.slice(0)};if(!U||A.length===0)return c();let o=A.map(function(v,g){return Math.abs(U[g]-v)});o=o.slice(0,E);const O=o.reduce(function(v,g){return v>g?v:g},0);if(O<100)return c();const m=o.indexOf(O);return m>=4&&m!=C-1&&_.parent().val(m-4),c()}let x=!1,Q=w.storeGet("hideUnusedModes",!1);e("input#switch-toggle-unused").on("change",function(){x=e(this).prop("checked"),w.storeSet("hideUnusedModes",x),V()}).prop("checked",!!Q).trigger("change"),V(),ne.add("aux_data_pull",Y,50),e(".tab-auxiliary .acroEnabled").width(e("#mode-0 .info").width()),T.content_ready(h)}};H.auxiliary.cleanup=function(h){h&&h()};e(window).on("resize",function(){e(".tab-auxiliary .acroEnabled").width(e("#mode-0 .info").width())});
