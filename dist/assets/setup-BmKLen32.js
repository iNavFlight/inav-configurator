import{$ as a,o as z,_ as r,T,G as h,p as X,m as D,i as o,F as e,B as G,M as P,d as L,b as R,O as Z,q as Y,r as J,L as K,v as Q,A as $,D as tt,w as et,S as it}from"./index--BqaKNiR.js";import{W as at,G as st}from"./GLTFLoader-CfIe5j7H.js";import{d as rt}from"./dialog-CY10jn-b.js";const nt=["altitude_pressure","altitude_ticks","fi_box","fi_circle","fi_needle_small","fi_tc_airplane","heading_mechanics","heading_yaw","horizon_back","horizon_ball","horizon_circle","horizon_mechanics","turn_coordinator","vertical_mechanics"];(function(s){function m(n,l,_,i){var v=this,c=s.extend({size:200,roll:0,pitch:0,turn:0,heading:0,vario:0,airspeed:0,altitude:0,pressure:1e3,showBox:!0,img_directory:"img/"},_),u={pitch_bound:30,vario_bound:1.95,airspeed_bound_l:0,airspeed_bound_h:160};n.each(function(){switch(l){case"heading":s(this).html('<div class="instrument heading"><img src="'+i.fi_box+'" class="background box" alt="" /><div class="heading box"><img src="'+i.heading_yaw+'" class="box" alt="" /></div><div class="mechanics box"><img src="'+i.heading_mechanics+'" class="box" alt="" /><img src="'+i.fi_circle+'" class="box" alt="" /></div></div>'),b(c.heading);break;case"variometer":s(this).html('<div class="instrument vario"><img src="'+i.fi_box+'" class="background box" alt="" /><img src="'+i.vertical_mechanics+'" class="box" alt="" /><div class="vario box"><img src="'+i.fi_needle+'" class="box" alt="" /></div><div class="mechanics box"><img src="'+i.fi_circle+'" class="box" alt="" /></div></div>'),A(c.vario);break;case"turn_coordinator":s(this).html('<div class="instrument turn_coordinator"><img src="'+i.fi_box+'" class="background box" alt="" /><img src="'+i.turn_coordinator+'" class="box" alt="" /><div class="turn box"><img src="'+i.fi_tc_airplane+'" class="box" alt="" /></div><div class="mechanics box"><img src="'+i.fi_circle+'" class="box" alt="" /></div></div>'),x(c.turn);break;case"airspeed":s(this).html('<div class="instrument airspeed"><img src="'+i.fi_box+'" class="background box" alt="" /><img src="'+i.speed_mechanics+'" class="box" alt="" /><div class="speed box"><img src="'+i.fi_needle+'" class="box" alt="" /></div><div class="mechanics box"><img src="'+i.fi_circle+'" class="box" alt="" /></div></div>'),E(c.airspeed);break;case"altimeter":s(this).html('<div class="instrument altimeter"><img src="'+i.fi_box+'" class="background box" alt="" /><div class="pressure box"><img src="'+i.altitude_pressure+'" class="box" alt="" /></div><img src="'+i.altitude_ticks+'" class="box" alt="" /><div class="needleSmall box"><img src="'+i.fi_needle_small+'" class="box" alt="" /></div><div class="needle box"><img src="'+i.fi_needle+'" class="box" alt="" /></div><div class="mechanics box"><img src="'+i.fi_circle+'" class="box" alt="" /></div></div>'),w(c.altitude),O(c.pressure);break;default:s(this).html('<div class="instrument attitude"><img src="'+i.fi_box+'" class="background box" alt="" /><div class="roll box"><img src="'+i.horizon_back+'" class="box" alt="" /><div class="pitch box"><img src="'+i.horizon_ball+'" class="box" alt="" /></div><img src="'+i.horizon_circle+'" class="box" alt="" /></div><div class="mechanics box"><img src="'+i.horizon_mechanics+'" class="box" alt="" /><img src="'+i.fi_circle+'" class="box" alt="" /></div></div>'),d(c.roll),g(c.pitch)}s(this).find("div.instrument").css({height:c.size,width:c.size}),s(this).find("div.instrument img.box.background").toggle(c.showBox)});function d(t){t*=-1,n.each(function(){s(this).find("div.instrument.attitude div.roll").css("transform","rotate("+t+"deg)")})}function g(t){t>u.pitch_bound?t=u.pitch_bound:t<-30&&(t=-30),n.each(function(){s(this).find("div.instrument.attitude div.roll div.pitch").css("top",-t*.7+"%")})}function b(t){n.each(function(){s(this).find("div.instrument.heading div.heading").css("transform","rotate("+-t+"deg)")})}function x(t){n.each(function(){s(this).find("div.instrument.turn_coordinator div.turn").css("transform","rotate("+t+"deg)")})}function A(t){t>u.vario_bound?t=u.vario_bound:t<-1.95&&(t=-1.95),t=t*90,n.each(function(){s(this).find("div.instrument.vario div.vario").css("transform","rotate("+t+"deg)")})}function E(t){t>u.airspeed_bound_h?t=u.airspeed_bound_h:t<u.airspeed_bound_l&&(t=u.airspeed_bound_l),t=90+t*2,n.each(function(){s(this).find("div.instrument.airspeed div.speed").css("transform","rotate("+t+"deg)")})}function w(t){var V=90+t%1e3*360/1e3,k=t/1e4*360;n.each(function(){s(this).find("div.instrument.altimeter div.needle").css("transform","rotate("+V+"deg)"),s(this).find("div.instrument.altimeter div.needleSmall").css("transform","rotate("+k+"deg)")})}function O(t){t=2*t-1980,n.each(function(){s(this).find("div.instrument.altimeter div.pressure").css("transform","rotate("+t+"deg)")})}function I(t){n.each(function(){s(this).find("div.instrument").css({height:t,width:t})})}function y(){n.each(function(){s(this).find("img.box.background").show()})}function M(){n.each(function(){s(this).find("img.box.background").hide()})}return this.setRoll=function(t){d(t)},this.setPitch=function(t){g(t)},this.setHeading=function(t){b(t)},this.setTurn=function(t){x(t)},this.setVario=function(t){A(t)},this.setAirSpeed=function(t){E(t)},this.setAltitude=function(t){w(t)},this.setPressure=function(t){O(t)},this.resize=function(t){I(t)},this.showBox=function(){y()},this.hideBox=function(){M()},v}async function p(){var n={};for(const l of nt){const _=(await z(Object.assign({"../../images/flightindicators/fi_altitude_pressure.svg":()=>r(()=>import("./fi_altitude_pressure-DUxCAYs7.js"),[],import.meta.url),"../../images/flightindicators/fi_altitude_ticks.svg":()=>r(()=>import("./fi_altitude_ticks-D7iVnUBS.js"),[],import.meta.url),"../../images/flightindicators/fi_fi_box.svg":()=>r(()=>import("./fi_fi_box-CPqm-iMQ.js"),[],import.meta.url),"../../images/flightindicators/fi_fi_circle.svg":()=>r(()=>import("./fi_fi_circle-8RqATVOa.js"),[],import.meta.url),"../../images/flightindicators/fi_fi_needle.svg":()=>r(()=>import("./fi_fi_needle-DtL5F3rz.js"),[],import.meta.url),"../../images/flightindicators/fi_fi_needle_small.svg":()=>r(()=>import("./fi_fi_needle_small-Dh7MgNrQ.js"),[],import.meta.url),"../../images/flightindicators/fi_fi_tc_airplane.svg":()=>r(()=>import("./fi_fi_tc_airplane-XJGnz0On.js"),[],import.meta.url),"../../images/flightindicators/fi_heading_mechanics.svg":()=>r(()=>import("./fi_heading_mechanics-frEXpSRj.js"),[],import.meta.url),"../../images/flightindicators/fi_heading_yaw.svg":()=>r(()=>import("./fi_heading_yaw-QYRAUtfb.js"),[],import.meta.url),"../../images/flightindicators/fi_horizon_back.svg":()=>r(()=>import("./fi_horizon_back-E-LWB05r.js"),[],import.meta.url),"../../images/flightindicators/fi_horizon_ball.svg":()=>r(()=>import("./fi_horizon_ball-8p13J5ym.js"),[],import.meta.url),"../../images/flightindicators/fi_horizon_circle.svg":()=>r(()=>import("./fi_horizon_circle-CoAHUtXN.js"),[],import.meta.url),"../../images/flightindicators/fi_horizon_mechanics.svg":()=>r(()=>import("./fi_horizon_mechanics--oTi2aNa.js"),[],import.meta.url),"../../images/flightindicators/fi_speed_mechanics.svg":()=>r(()=>import("./fi_speed_mechanics-C6FGDgyh.js"),[],import.meta.url),"../../images/flightindicators/fi_turn_coordinator.svg":()=>r(()=>import("./fi_turn_coordinator-B1gjibFi.js"),[],import.meta.url),"../../images/flightindicators/fi_vertical_mechanics.svg":()=>r(()=>import("./fi_vertical_mechanics-BQVktAJb.js"),[],import.meta.url)}),`../../images/flightindicators/fi_${l}.svg`,5)).default,i=l.split(".")[0];n[i]=_}return n}s.flightIndicator=async function(n,l,_){var i=await p(),v=new m(s(n),l,_,i);return v},s.fn.flightIndicator=function(n,l,_){return this.each(function(){s.flightIndicator(this,l,_)})}})(a);T.setup={yaw_fix:0};T.setup.initialize=function(s){var m=this;h.active_tab!="setup"&&(h.active_tab="setup");var p=new X,n=[D.loadFeatures,D.loadMixerConfig,D.loadMiscV2,D.loadSerialPorts];p.setChain(n),p.setExitPoint(i),p.execute();let l,_;function i(){r(async()=>{const{default:d}=await import("./setup-ChqjgBJt.js");return{default:d}},[],import.meta.url).then(({default:d})=>h.load(d,u))}function v(){_&&l&&(l.setRoll(e.SENSOR_DATA.kinematics[0]),l.setPitch(e.SENSOR_DATA.kinematics[1]),_.setHeading(e.SENSOR_DATA.kinematics[2]))}async function c(){var d={size:90,showBox:!1,img_directory:"./../../images/flightindicators/"};l=await a.flightIndicator("#attitude","attitude",d),_=await a.flightIndicator("#heading","heading",d)}function u(){o.localize(),e.isMotorOutputEnabled()||h.log("<span style='color: red; font-weight: bolder'><strong>"+o.getMessage("logPwmOutputDisabled")+"</strong></span>"),m.initialize3D(),a("span.roll").text(o.getMessage("initialSetupAttitude",[0])),a("span.pitch").text(o.getMessage("initialSetupAttitude",[0])),a("span.heading").text(o.getMessage("initialSetupAttitude",[0])),G.bit_check(e.CONFIG.activeSensors,2)||(a("a.calibrateMag").addClass("disabled"),a("default_btn").addClass("disabled")),c(),a("a.resetSettings").on("click",function(){rt.confirm(o.getMessage("confirm_reset_settings"))&&P.send_message(L.MSP_RESET_CONF,!1,!1,function(){h.log(o.getMessage("initialSetupSettingsRestored")),h.tab_switch_cleanup(function(){P.send_message(L.MSP_SET_REBOOT,!1,!1,function(){h.log(o.getMessage("deviceRebooting")),h.handleReconnect()})})})}),a("div#interactive_block > a.reset").text(o.getMessage("initialSetupButtonResetZaxisValue",[m.yaw_fix])),a("div#interactive_block > a.reset").on("click",function(){m.yaw_fix=e.SENSOR_DATA.kinematics[2]*-1,a(this).text(o.getMessage("initialSetupButtonResetZaxisValue",[m.yaw_fix])),console.log("YAW reset to 0 deg, fix: "+m.yaw_fix+" deg")});var d=a(".bat-voltage"),g=a(".bat-percent"),b=a(".bat-remain-cap"),x=a(".bat-cells"),A=a(".bat-thresh"),E=a(".bat-full"),w=a(".bat-mah-drawn"),O=a(".bat-mwh-drawn"),I=a(".bat-current-draw"),y=a(".bat-power-draw"),M=a(".rssi"),t=a(".gpsFixType"),V=a(".gpsSats"),k=a(".gpsLat"),C=a(".gpsLon"),F=a("dd.roll"),B=a("dd.pitch"),W=a("dd.heading");function H(){it.have_sensor(e.CONFIG.activeSensors,"gps")&&P.send_message(L.MSP_RAW_GPS,!1,!1,function(){var f=o.getMessage("gpsFixNone");e.GPS_DATA.fix>=2?f=o.getMessage("gpsFix3D"):e.GPS_DATA.fix>=1&&(f=o.getMessage("gpsFix2D")),t.html(f),V.text(e.GPS_DATA.numSat),k.text((e.GPS_DATA.lat/1e7).toFixed(4)+" deg"),C.text((e.GPS_DATA.lon/1e7).toFixed(4)+" deg")})}function j(){P.send_message(L.MSP_ATTITUDE,!1,!1,function(){F.text(o.getMessage("initialSetupAttitude",[e.SENSOR_DATA.kinematics[0]])),B.text(o.getMessage("initialSetupAttitude",[e.SENSOR_DATA.kinematics[1]])),W.text(o.getMessage("initialSetupAttitude",[e.SENSOR_DATA.kinematics[2]])),m.render3D(),v()})}R.add("setup_data_pull_fast",j,50),R.add("setup_data_pull_slow",H,250),R.add("gui_analog_update",function(){x.text(o.getMessage("initialSetupBatteryDetectedCellsValue",[e.ANALOG.cell_count])),d.text(o.getMessage("initialSetupBatteryVoltageValue",[e.ANALOG.voltage]));let f=e.ANALOG.battery_remaining_capacity.toString().length<5?3:7-e.ANALOG.battery_remaining_capacity.toString().length,S=e.MISC.battery_capacity_unit=="mAh"?e.ANALOG.battery_remaining_capacity:(e.ANALOG.battery_remaining_capacity/1e3).toFixed(f<0?0:f),U=e.MISC.battery_capacity_unit=="mAh"?"mAh":"Wh";b.text(o.getMessage("initialSetupBatteryRemainingCapacityValue",e.MISC.battery_capacity>0&&e.ANALOG.battery_full_when_plugged_in?[S,U]:["NA",""])),g.text(o.getMessage("initialSetupBatteryPercentageValue",[e.ANALOG.battery_percentage])),E.text(o.getMessage("initialSetupBatteryFullValue",[e.ANALOG.battery_full_when_plugged_in])),A.text(o.getMessage("initialSetupBatteryThresholdsValue",[e.ANALOG.use_capacity_thresholds])),w.text(o.getMessage("initialSetupBatteryMahValue",[e.ANALOG.mAhdrawn]));let N=e.ANALOG.mWhdrawn.toString().length<5?3:7-e.ANALOG.mWhdrawn.toString().length;O.text(o.getMessage("initialSetup_Wh_drawnValue",[(e.ANALOG.mWhdrawn/1e3).toFixed(N<0?0:N)])),I.text(o.getMessage("initialSetupCurrentDrawValue",[e.ANALOG.amperage.toFixed(2)])),y.text(o.getMessage("initialSetupPowerDrawValue",[e.ANALOG.power.toFixed(2)])),M.text(o.getMessage("initialSetupRSSIValue",[(e.ANALOG.rssi/1023*100).toFixed(0)]))},100,!0);function q(){var f=e.getArmingFlags();for(var S in f)f.hasOwnProperty(S)&&(G.bit_check(e.CONFIG.armingFlags,S)?a("#reason-"+f[S]).html(o.getMessage("armingCheckFail")):a("#reason-"+f[S]).html(o.getMessage("armingCheckPass")))}R.add("updateArminFailure",q,500,!0),h.content_ready(s)}};T.setup.initialize3D=function(){var s=this,m,p,n,l,_,i,v,c,u,d,g,b=!1;p=a(".model-and-info #canvas"),n=a(".model-and-info #canvas_wrapper");var x=document.createElement("canvas");window.WebGLRenderingContext&&(x.getContext("webgl")||x.getContext("experimental-webgl"))&&(l=new at({canvas:p.get(0),alpha:!0,antialias:!0}),b=!0),l.setSize(n.width()*2,n.height()*2),u=new Z,b?e.MIXER_CONFIG.appliedMixerPreset===-1?(g="custom",h.log("<span style='color: red; font-weight: bolder'><strong>"+o.getMessage("mixerNotConfigured")+"</strong></span>")):g=Y.getById(e.MIXER_CONFIG.appliedMixerPreset).model:g="fallback",g=="custom"&&(g="fallback"),i=new J;const A=new K;m=new st(A),z(Object.assign({"../resources/models/model_fallback.gltf":()=>r(()=>import("./model_fallback-Buo24Ave.js"),[],import.meta.url),"../resources/models/model_fc.gltf":()=>r(()=>import("./model_fc-BZHlFnIM.js"),[],import.meta.url),"../resources/models/model_flying_wing.gltf":()=>r(()=>import("./model_flying_wing-nlC5V8TX.js"),[],import.meta.url),"../resources/models/model_hex_plus.gltf":()=>r(()=>import("./model_hex_plus-CMoS-qsw.js"),[],import.meta.url),"../resources/models/model_hex_x.gltf":()=>r(()=>import("./model_hex_x-DJ58birx.js"),[],import.meta.url),"../resources/models/model_quad_atail.gltf":()=>r(()=>import("./model_quad_atail-B0di6AnD.js"),[],import.meta.url),"../resources/models/model_quad_vtail.gltf":()=>r(()=>import("./model_quad_vtail-GrYRl8-C.js"),[],import.meta.url),"../resources/models/model_quad_x.gltf":()=>r(()=>import("./model_quad_x-BPQ1oIp-.js"),[],import.meta.url),"../resources/models/model_rudderless_plane.gltf":()=>r(()=>import("./model_rudderless_plane-PUVqZKxB.js"),[],import.meta.url),"../resources/models/model_tricopter.gltf":()=>r(()=>import("./model_tricopter-CTLnuO8S.js"),[],import.meta.url),"../resources/models/model_twin_plane.gltf":()=>r(()=>import("./model_twin_plane-DHSaIHxS.js"),[],import.meta.url),"../resources/models/model_vtail_plane.gltf":()=>r(()=>import("./model_vtail_plane-gEpSGkrw.js"),[],import.meta.url),"../resources/models/model_vtail_single_servo_plane.gltf":()=>r(()=>import("./model_vtail_single_servo_plane-qrc8l347.js"),[],import.meta.url),"../resources/models/model_xyz.gltf":()=>r(()=>import("./model_xyz-iSakRC1L.js"),[],import.meta.url),"../resources/models/model_y4.gltf":()=>r(()=>import("./model_y4-DRAfLpH_.js"),[],import.meta.url),"../resources/models/model_y6.gltf":()=>r(()=>import("./model_y6-CGjnlvSx.js"),[],import.meta.url)}),`../resources/models/model_${g}.gltf`,4).then(({default:E})=>{m.load(E,w=>{d=w.scene,d.scale.set(15,15,15),u.add(d)})}),_=new Q(50,n.width()/n.height(),1,1e4),v=new $(4210752),c=new tt(new et(1,1,1),1.5),c.position.set(0,1,0),_.position.z=125,i.add(v),i.add(c),i.add(_),i.add(u),this.render3D=function(){d&&(d.rotation.x=e.SENSOR_DATA.kinematics[1]*-1*.017453292519943295,u.rotation.y=(e.SENSOR_DATA.kinematics[2]*-1-s.yaw_fix)*.017453292519943295,d.rotation.z=e.SENSOR_DATA.kinematics[0]*-1*.017453292519943295,l.render(i,_))},this.resize3D=function(){l.setSize(n.width()*2,n.height()*2),_.aspect=n.width()/n.height(),_.updateProjectionMatrix(),s.render3D()},a(window).on("resize",this.resize3D)};T.setup.cleanup=function(s){a(window).off("resize",this.resize3D),s&&s()};
