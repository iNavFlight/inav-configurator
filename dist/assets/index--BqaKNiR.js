const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./firmware_flasher-DpJR31Vt.js","./dialog-CY10jn-b.js","./sitl-B0iKDKwy.js","./sitl-BUwZdc8L.css","./auxiliary-D5bZf6Sm.js","./wNumb-DZfnXen2.js","./nouislider-B_G20eMg.js","./adjustments-C_IpigJL.js","./setup-BmKLen32.js","./GLTFLoader-CfIe5j7H.js","./pid_tuning-4BX57_Ar.js","./tabs-DhSV9wpC.js","./gps-fNy5jIKg.js","./TileWMS-Ojl1fCoy.js","./magnetometer-CB5SfWPU.js","./mission_control-BRxfrk6N.js","./osd-CknEX7tZ.js","./logging-qU-GVW9R.js","./programming-BhXGSUCc.js","./cli-BfhwZP_O.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();const scriptRel="modulepreload",assetsURL=function(n,e){return new URL(n,e).href},seen={},__vitePreload=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let c=function(d){return Promise.all(d.map(f=>Promise.resolve(f).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),h=a?.nonce||a?.getAttribute("nonce");s=c(t.map(d=>{if(d=assetsURL(d,i),d in seen)return;seen[d]=!0;const f=d.endsWith(".css"),_=f?'[rel="stylesheet"]':"";if(!!i)for(let v=o.length-1;v>=0;v--){const I=o[v];if(I.href===d&&(!f||I.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${_}`))return;const S=document.createElement("link");if(S.rel=f?"stylesheet":scriptRel,f||(S.as="script"),S.crossOrigin="",S.href=d,h&&S.setAttribute("nonce",h),document.head.appendChild(S),f)return new Promise((v,I)=>{S.addEventListener("load",v),S.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${d}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return e().catch(r)})};function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function getAugmentedNamespace(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function i(){var s=!1;try{s=this instanceof i}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return n[i]}})}),t}var jquery$1={exports:{}};/*!
 * jQuery JavaScript Library v3.7.1
 * https://jquery.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2023-08-28T13:37Z
 */var jquery=jquery$1.exports,hasRequiredJquery;function requireJquery(){return hasRequiredJquery||(hasRequiredJquery=1,(function(n){(function(e,t){n.exports=e.document?t(e,!0):function(i){if(!i.document)throw new Error("jQuery requires a window with a document");return t(i)}})(typeof window<"u"?window:jquery,function(e,t){var i=[],s=Object.getPrototypeOf,r=i.slice,o=i.flat?function(m){return i.flat.call(m)}:function(m){return i.concat.apply([],m)},a=i.push,h=i.indexOf,c={},d=c.toString,f=c.hasOwnProperty,_=f.toString,y=_.call(Object),S={},v=function(x){return typeof x=="function"&&typeof x.nodeType!="number"&&typeof x.item!="function"},I=function(x){return x!=null&&x===x.window},A=e.document,B={type:!0,src:!0,nonce:!0,noModule:!0};function G(m,x,M){M=M||A;var w,N,F=M.createElement("script");if(F.text=m,x)for(w in B)N=x[w]||x.getAttribute&&x.getAttribute(w),N&&F.setAttribute(w,N);M.head.appendChild(F).parentNode.removeChild(F)}function k(m){return m==null?m+"":typeof m=="object"||typeof m=="function"?c[d.call(m)]||"object":typeof m}var z="3.7.1",q=/HTML$/i,T=function(m,x){return new T.fn.init(m,x)};T.fn=T.prototype={jquery:z,constructor:T,length:0,toArray:function(){return r.call(this)},get:function(m){return m==null?r.call(this):m<0?this[m+this.length]:this[m]},pushStack:function(m){var x=T.merge(this.constructor(),m);return x.prevObject=this,x},each:function(m){return T.each(this,m)},map:function(m){return this.pushStack(T.map(this,function(x,M){return m.call(x,M,x)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(T.grep(this,function(m,x){return(x+1)%2}))},odd:function(){return this.pushStack(T.grep(this,function(m,x){return x%2}))},eq:function(m){var x=this.length,M=+m+(m<0?x:0);return this.pushStack(M>=0&&M<x?[this[M]]:[])},end:function(){return this.prevObject||this.constructor()},push:a,sort:i.sort,splice:i.splice},T.extend=T.fn.extend=function(){var m,x,M,w,N,F,D=arguments[0]||{},X=1,W=arguments.length,Q=!1;for(typeof D=="boolean"&&(Q=D,D=arguments[X]||{},X++),typeof D!="object"&&!v(D)&&(D={}),X===W&&(D=this,X--);X<W;X++)if((m=arguments[X])!=null)for(x in m)w=m[x],!(x==="__proto__"||D===w)&&(Q&&w&&(T.isPlainObject(w)||(N=Array.isArray(w)))?(M=D[x],N&&!Array.isArray(M)?F=[]:!N&&!T.isPlainObject(M)?F={}:F=M,N=!1,D[x]=T.extend(Q,F,w)):w!==void 0&&(D[x]=w));return D},T.extend({expando:"jQuery"+(z+Math.random()).replace(/\D/g,""),isReady:!0,error:function(m){throw new Error(m)},noop:function(){},isPlainObject:function(m){var x,M;return!m||d.call(m)!=="[object Object]"?!1:(x=s(m),x?(M=f.call(x,"constructor")&&x.constructor,typeof M=="function"&&_.call(M)===y):!0)},isEmptyObject:function(m){var x;for(x in m)return!1;return!0},globalEval:function(m,x,M){G(m,{nonce:x&&x.nonce},M)},each:function(m,x){var M,w=0;if(j(m))for(M=m.length;w<M&&x.call(m[w],w,m[w])!==!1;w++);else for(w in m)if(x.call(m[w],w,m[w])===!1)break;return m},text:function(m){var x,M="",w=0,N=m.nodeType;if(!N)for(;x=m[w++];)M+=T.text(x);return N===1||N===11?m.textContent:N===9?m.documentElement.textContent:N===3||N===4?m.nodeValue:M},makeArray:function(m,x){var M=x||[];return m!=null&&(j(Object(m))?T.merge(M,typeof m=="string"?[m]:m):a.call(M,m)),M},inArray:function(m,x,M){return x==null?-1:h.call(x,m,M)},isXMLDoc:function(m){var x=m&&m.namespaceURI,M=m&&(m.ownerDocument||m).documentElement;return!q.test(x||M&&M.nodeName||"HTML")},merge:function(m,x){for(var M=+x.length,w=0,N=m.length;w<M;w++)m[N++]=x[w];return m.length=N,m},grep:function(m,x,M){for(var w,N=[],F=0,D=m.length,X=!M;F<D;F++)w=!x(m[F],F),w!==X&&N.push(m[F]);return N},map:function(m,x,M){var w,N,F=0,D=[];if(j(m))for(w=m.length;F<w;F++)N=x(m[F],F,M),N!=null&&D.push(N);else for(F in m)N=x(m[F],F,M),N!=null&&D.push(N);return o(D)},guid:1,support:S}),typeof Symbol=="function"&&(T.fn[Symbol.iterator]=i[Symbol.iterator]),T.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(m,x){c["[object "+x+"]"]=x.toLowerCase()});function j(m){var x=!!m&&"length"in m&&m.length,M=k(m);return v(m)||I(m)?!1:M==="array"||x===0||typeof x=="number"&&x>0&&x-1 in m}function te(m,x){return m.nodeName&&m.nodeName.toLowerCase()===x.toLowerCase()}var Se=i.pop,be=i.sort,Te=i.splice,pe="[\\x20\\t\\r\\n\\f]",ie=new RegExp("^"+pe+"+|((?:^|[^\\\\])(?:\\\\.)*)"+pe+"+$","g");T.contains=function(m,x){var M=x&&x.parentNode;return m===M||!!(M&&M.nodeType===1&&(m.contains?m.contains(M):m.compareDocumentPosition&&m.compareDocumentPosition(M)&16))};var he=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function ge(m,x){return x?m==="\0"?"ï¿½":m.slice(0,-1)+"\\"+m.charCodeAt(m.length-1).toString(16)+" ":"\\"+m}T.escapeSelector=function(m){return(m+"").replace(he,ge)};var ue=A,de=a;(function(){var m,x,M,w,N,F=de,D,X,W,Q,fe,_e=T.expando,oe=0,xe=0,ke=ai(),Ye=ai(),We=ai(),yt=ai(),ft=function(V,K){return V===K&&(N=!0),0},Pt="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",Ot="(?:\\\\[\\da-fA-F]{1,6}"+pe+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",Xe="\\["+pe+"*("+Ot+")(?:"+pe+"*([*^$|!~]?=)"+pe+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+Ot+"))|)"+pe+"*\\]",$t=":("+Ot+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+Xe+")*)|.*)\\)|)",Ze=new RegExp(pe+"+","g"),ht=new RegExp("^"+pe+"*,"+pe+"*"),ti=new RegExp("^"+pe+"*([>+~]|"+pe+")"+pe+"*"),Ti=new RegExp(pe+"|>"),Nt=new RegExp($t),ii=new RegExp("^"+Ot+"$"),Ft={ID:new RegExp("^#("+Ot+")"),CLASS:new RegExp("^\\.("+Ot+")"),TAG:new RegExp("^("+Ot+"|[*])"),ATTR:new RegExp("^"+Xe),PSEUDO:new RegExp("^"+$t),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+pe+"*(even|odd|(([+-]|)(\\d*)n|)"+pe+"*(?:([+-]|)"+pe+"*(\\d+)|))"+pe+"*\\)|)","i"),bool:new RegExp("^(?:"+Pt+")$","i"),needsContext:new RegExp("^"+pe+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+pe+"*((?:-\\d)?\\d*)"+pe+"*\\)|)(?=[^-]|$)","i")},zt=/^(?:input|select|textarea|button)$/i,Gt=/^h\d$/i,It=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Ei=/[+~]/,Dt=new RegExp("\\\\[\\da-fA-F]{1,6}"+pe+"?|\\\\([^\\r\\n\\f])","g"),Bt=function(V,K){var ne="0x"+V.slice(1)-65536;return K||(ne<0?String.fromCharCode(ne+65536):String.fromCharCode(ne>>10|55296,ne&1023|56320))},Hn=function(){Ut()},Wn=hi(function(V){return V.disabled===!0&&te(V,"fieldset")},{dir:"parentNode",next:"legend"});function $n(){try{return D.activeElement}catch{}}try{F.apply(i=r.call(ue.childNodes),ue.childNodes),i[ue.childNodes.length].nodeType}catch{F={apply:function(K,ne){de.apply(K,r.call(ne))},call:function(K){de.apply(K,r.call(arguments,1))}}}function et(V,K,ne,le){var me,Me,Ie,Pe,we,qe,Be,Ge=K&&K.ownerDocument,je=K?K.nodeType:9;if(ne=ne||[],typeof V!="string"||!V||je!==1&&je!==9&&je!==11)return ne;if(!le&&(Ut(K),K=K||D,W)){if(je!==11&&(we=It.exec(V)))if(me=we[1]){if(je===9)if(Ie=K.getElementById(me)){if(Ie.id===me)return F.call(ne,Ie),ne}else return ne;else if(Ge&&(Ie=Ge.getElementById(me))&&et.contains(K,Ie)&&Ie.id===me)return F.call(ne,Ie),ne}else{if(we[2])return F.apply(ne,K.getElementsByTagName(V)),ne;if((me=we[3])&&K.getElementsByClassName)return F.apply(ne,K.getElementsByClassName(me)),ne}if(!yt[V+" "]&&(!Q||!Q.test(V))){if(Be=V,Ge=K,je===1&&(Ti.test(V)||ti.test(V))){for(Ge=Ei.test(V)&&Mi(K.parentNode)||K,(Ge!=K||!S.scope)&&((Pe=K.getAttribute("id"))?Pe=T.escapeSelector(Pe):K.setAttribute("id",Pe=_e)),qe=ni(V),Me=qe.length;Me--;)qe[Me]=(Pe?"#"+Pe:":scope")+" "+li(qe[Me]);Be=qe.join(",")}try{return F.apply(ne,Ge.querySelectorAll(Be)),ne}catch{yt(V,!0)}finally{Pe===_e&&K.removeAttribute("id")}}}return sn(V.replace(ie,"$1"),K,ne,le)}function ai(){var V=[];function K(ne,le){return V.push(ne+" ")>x.cacheLength&&delete K[V.shift()],K[ne+" "]=le}return K}function Rt(V){return V[_e]=!0,V}function Yt(V){var K=D.createElement("fieldset");try{return!!V(K)}catch{return!1}finally{K.parentNode&&K.parentNode.removeChild(K),K=null}}function qn(V){return function(K){return te(K,"input")&&K.type===V}}function jn(V){return function(K){return(te(K,"input")||te(K,"button"))&&K.type===V}}function tn(V){return function(K){return"form"in K?K.parentNode&&K.disabled===!1?"label"in K?"label"in K.parentNode?K.parentNode.disabled===V:K.disabled===V:K.isDisabled===V||K.isDisabled!==!V&&Wn(K)===V:K.disabled===V:"label"in K?K.disabled===V:!1}}function qt(V){return Rt(function(K){return K=+K,Rt(function(ne,le){for(var me,Me=V([],ne.length,K),Ie=Me.length;Ie--;)ne[me=Me[Ie]]&&(ne[me]=!(le[me]=ne[me]))})})}function Mi(V){return V&&typeof V.getElementsByTagName<"u"&&V}function Ut(V){var K,ne=V?V.ownerDocument||V:ue;return ne==D||ne.nodeType!==9||!ne.documentElement||(D=ne,X=D.documentElement,W=!T.isXMLDoc(D),fe=X.matches||X.webkitMatchesSelector||X.msMatchesSelector,X.msMatchesSelector&&ue!=D&&(K=D.defaultView)&&K.top!==K&&K.addEventListener("unload",Hn),S.getById=Yt(function(le){return X.appendChild(le).id=T.expando,!D.getElementsByName||!D.getElementsByName(T.expando).length}),S.disconnectedMatch=Yt(function(le){return fe.call(le,"*")}),S.scope=Yt(function(){return D.querySelectorAll(":scope")}),S.cssHas=Yt(function(){try{return D.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),S.getById?(x.filter.ID=function(le){var me=le.replace(Dt,Bt);return function(Me){return Me.getAttribute("id")===me}},x.find.ID=function(le,me){if(typeof me.getElementById<"u"&&W){var Me=me.getElementById(le);return Me?[Me]:[]}}):(x.filter.ID=function(le){var me=le.replace(Dt,Bt);return function(Me){var Ie=typeof Me.getAttributeNode<"u"&&Me.getAttributeNode("id");return Ie&&Ie.value===me}},x.find.ID=function(le,me){if(typeof me.getElementById<"u"&&W){var Me,Ie,Pe,we=me.getElementById(le);if(we){if(Me=we.getAttributeNode("id"),Me&&Me.value===le)return[we];for(Pe=me.getElementsByName(le),Ie=0;we=Pe[Ie++];)if(Me=we.getAttributeNode("id"),Me&&Me.value===le)return[we]}return[]}}),x.find.TAG=function(le,me){return typeof me.getElementsByTagName<"u"?me.getElementsByTagName(le):me.querySelectorAll(le)},x.find.CLASS=function(le,me){if(typeof me.getElementsByClassName<"u"&&W)return me.getElementsByClassName(le)},Q=[],Yt(function(le){var me;X.appendChild(le).innerHTML="<a id='"+_e+"' href='' disabled='disabled'></a><select id='"+_e+"-\r\\' disabled='disabled'><option selected=''></option></select>",le.querySelectorAll("[selected]").length||Q.push("\\["+pe+"*(?:value|"+Pt+")"),le.querySelectorAll("[id~="+_e+"-]").length||Q.push("~="),le.querySelectorAll("a#"+_e+"+*").length||Q.push(".#.+[+~]"),le.querySelectorAll(":checked").length||Q.push(":checked"),me=D.createElement("input"),me.setAttribute("type","hidden"),le.appendChild(me).setAttribute("name","D"),X.appendChild(le).disabled=!0,le.querySelectorAll(":disabled").length!==2&&Q.push(":enabled",":disabled"),me=D.createElement("input"),me.setAttribute("name",""),le.appendChild(me),le.querySelectorAll("[name='']").length||Q.push("\\["+pe+"*name"+pe+"*="+pe+`*(?:''|"")`)}),S.cssHas||Q.push(":has"),Q=Q.length&&new RegExp(Q.join("|")),ft=function(le,me){if(le===me)return N=!0,0;var Me=!le.compareDocumentPosition-!me.compareDocumentPosition;return Me||(Me=(le.ownerDocument||le)==(me.ownerDocument||me)?le.compareDocumentPosition(me):1,Me&1||!S.sortDetached&&me.compareDocumentPosition(le)===Me?le===D||le.ownerDocument==ue&&et.contains(ue,le)?-1:me===D||me.ownerDocument==ue&&et.contains(ue,me)?1:w?h.call(w,le)-h.call(w,me):0:Me&4?-1:1)}),D}et.matches=function(V,K){return et(V,null,null,K)},et.matchesSelector=function(V,K){if(Ut(V),W&&!yt[K+" "]&&(!Q||!Q.test(K)))try{var ne=fe.call(V,K);if(ne||S.disconnectedMatch||V.document&&V.document.nodeType!==11)return ne}catch{yt(K,!0)}return et(K,D,null,[V]).length>0},et.contains=function(V,K){return(V.ownerDocument||V)!=D&&Ut(V),T.contains(V,K)},et.attr=function(V,K){(V.ownerDocument||V)!=D&&Ut(V);var ne=x.attrHandle[K.toLowerCase()],le=ne&&f.call(x.attrHandle,K.toLowerCase())?ne(V,K,!W):void 0;return le!==void 0?le:V.getAttribute(K)},et.error=function(V){throw new Error("Syntax error, unrecognized expression: "+V)},T.uniqueSort=function(V){var K,ne=[],le=0,me=0;if(N=!S.sortStable,w=!S.sortStable&&r.call(V,0),be.call(V,ft),N){for(;K=V[me++];)K===V[me]&&(le=ne.push(me));for(;le--;)Te.call(V,ne[le],1)}return w=null,V},T.fn.uniqueSort=function(){return this.pushStack(T.uniqueSort(r.apply(this)))},x=T.expr={cacheLength:50,createPseudo:Rt,match:Ft,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(V){return V[1]=V[1].replace(Dt,Bt),V[3]=(V[3]||V[4]||V[5]||"").replace(Dt,Bt),V[2]==="~="&&(V[3]=" "+V[3]+" "),V.slice(0,4)},CHILD:function(V){return V[1]=V[1].toLowerCase(),V[1].slice(0,3)==="nth"?(V[3]||et.error(V[0]),V[4]=+(V[4]?V[5]+(V[6]||1):2*(V[3]==="even"||V[3]==="odd")),V[5]=+(V[7]+V[8]||V[3]==="odd")):V[3]&&et.error(V[0]),V},PSEUDO:function(V){var K,ne=!V[6]&&V[2];return Ft.CHILD.test(V[0])?null:(V[3]?V[2]=V[4]||V[5]||"":ne&&Nt.test(ne)&&(K=ni(ne,!0))&&(K=ne.indexOf(")",ne.length-K)-ne.length)&&(V[0]=V[0].slice(0,K),V[2]=ne.slice(0,K)),V.slice(0,3))}},filter:{TAG:function(V){var K=V.replace(Dt,Bt).toLowerCase();return V==="*"?function(){return!0}:function(ne){return te(ne,K)}},CLASS:function(V){var K=ke[V+" "];return K||(K=new RegExp("(^|"+pe+")"+V+"("+pe+"|$)"))&&ke(V,function(ne){return K.test(typeof ne.className=="string"&&ne.className||typeof ne.getAttribute<"u"&&ne.getAttribute("class")||"")})},ATTR:function(V,K,ne){return function(le){var me=et.attr(le,V);return me==null?K==="!=":K?(me+="",K==="="?me===ne:K==="!="?me!==ne:K==="^="?ne&&me.indexOf(ne)===0:K==="*="?ne&&me.indexOf(ne)>-1:K==="$="?ne&&me.slice(-ne.length)===ne:K==="~="?(" "+me.replace(Ze," ")+" ").indexOf(ne)>-1:K==="|="?me===ne||me.slice(0,ne.length+1)===ne+"-":!1):!0}},CHILD:function(V,K,ne,le,me){var Me=V.slice(0,3)!=="nth",Ie=V.slice(-4)!=="last",Pe=K==="of-type";return le===1&&me===0?function(we){return!!we.parentNode}:function(we,qe,Be){var Ge,je,Le,nt,Mt,xt=Me!==Ie?"nextSibling":"previousSibling",wt=we.parentNode,Lt=Pe&&we.nodeName.toLowerCase(),Kt=!Be&&!Pe,Tt=!1;if(wt){if(Me){for(;xt;){for(Le=we;Le=Le[xt];)if(Pe?te(Le,Lt):Le.nodeType===1)return!1;Mt=xt=V==="only"&&!Mt&&"nextSibling"}return!0}if(Mt=[Ie?wt.firstChild:wt.lastChild],Ie&&Kt){for(je=wt[_e]||(wt[_e]={}),Ge=je[V]||[],nt=Ge[0]===oe&&Ge[1],Tt=nt&&Ge[2],Le=nt&&wt.childNodes[nt];Le=++nt&&Le&&Le[xt]||(Tt=nt=0)||Mt.pop();)if(Le.nodeType===1&&++Tt&&Le===we){je[V]=[oe,nt,Tt];break}}else if(Kt&&(je=we[_e]||(we[_e]={}),Ge=je[V]||[],nt=Ge[0]===oe&&Ge[1],Tt=nt),Tt===!1)for(;(Le=++nt&&Le&&Le[xt]||(Tt=nt=0)||Mt.pop())&&!((Pe?te(Le,Lt):Le.nodeType===1)&&++Tt&&(Kt&&(je=Le[_e]||(Le[_e]={}),je[V]=[oe,Tt]),Le===we)););return Tt-=me,Tt===le||Tt%le===0&&Tt/le>=0}}},PSEUDO:function(V,K){var ne,le=x.pseudos[V]||x.setFilters[V.toLowerCase()]||et.error("unsupported pseudo: "+V);return le[_e]?le(K):le.length>1?(ne=[V,V,"",K],x.setFilters.hasOwnProperty(V.toLowerCase())?Rt(function(me,Me){for(var Ie,Pe=le(me,K),we=Pe.length;we--;)Ie=h.call(me,Pe[we]),me[Ie]=!(Me[Ie]=Pe[we])}):function(me){return le(me,0,ne)}):le}},pseudos:{not:Rt(function(V){var K=[],ne=[],le=Ri(V.replace(ie,"$1"));return le[_e]?Rt(function(me,Me,Ie,Pe){for(var we,qe=le(me,null,Pe,[]),Be=me.length;Be--;)(we=qe[Be])&&(me[Be]=!(Me[Be]=we))}):function(me,Me,Ie){return K[0]=me,le(K,null,Ie,ne),K[0]=null,!ne.pop()}}),has:Rt(function(V){return function(K){return et(V,K).length>0}}),contains:Rt(function(V){return V=V.replace(Dt,Bt),function(K){return(K.textContent||T.text(K)).indexOf(V)>-1}}),lang:Rt(function(V){return ii.test(V||"")||et.error("unsupported lang: "+V),V=V.replace(Dt,Bt).toLowerCase(),function(K){var ne;do if(ne=W?K.lang:K.getAttribute("xml:lang")||K.getAttribute("lang"))return ne=ne.toLowerCase(),ne===V||ne.indexOf(V+"-")===0;while((K=K.parentNode)&&K.nodeType===1);return!1}}),target:function(V){var K=e.location&&e.location.hash;return K&&K.slice(1)===V.id},root:function(V){return V===X},focus:function(V){return V===$n()&&D.hasFocus()&&!!(V.type||V.href||~V.tabIndex)},enabled:tn(!1),disabled:tn(!0),checked:function(V){return te(V,"input")&&!!V.checked||te(V,"option")&&!!V.selected},selected:function(V){return V.parentNode&&V.parentNode.selectedIndex,V.selected===!0},empty:function(V){for(V=V.firstChild;V;V=V.nextSibling)if(V.nodeType<6)return!1;return!0},parent:function(V){return!x.pseudos.empty(V)},header:function(V){return Gt.test(V.nodeName)},input:function(V){return zt.test(V.nodeName)},button:function(V){return te(V,"input")&&V.type==="button"||te(V,"button")},text:function(V){var K;return te(V,"input")&&V.type==="text"&&((K=V.getAttribute("type"))==null||K.toLowerCase()==="text")},first:qt(function(){return[0]}),last:qt(function(V,K){return[K-1]}),eq:qt(function(V,K,ne){return[ne<0?ne+K:ne]}),even:qt(function(V,K){for(var ne=0;ne<K;ne+=2)V.push(ne);return V}),odd:qt(function(V,K){for(var ne=1;ne<K;ne+=2)V.push(ne);return V}),lt:qt(function(V,K,ne){var le;for(ne<0?le=ne+K:ne>K?le=K:le=ne;--le>=0;)V.push(le);return V}),gt:qt(function(V,K,ne){for(var le=ne<0?ne+K:ne;++le<K;)V.push(le);return V})}},x.pseudos.nth=x.pseudos.eq;for(m in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})x.pseudos[m]=qn(m);for(m in{submit:!0,reset:!0})x.pseudos[m]=jn(m);function nn(){}nn.prototype=x.filters=x.pseudos,x.setFilters=new nn;function ni(V,K){var ne,le,me,Me,Ie,Pe,we,qe=Ye[V+" "];if(qe)return K?0:qe.slice(0);for(Ie=V,Pe=[],we=x.preFilter;Ie;){(!ne||(le=ht.exec(Ie)))&&(le&&(Ie=Ie.slice(le[0].length)||Ie),Pe.push(me=[])),ne=!1,(le=ti.exec(Ie))&&(ne=le.shift(),me.push({value:ne,type:le[0].replace(ie," ")}),Ie=Ie.slice(ne.length));for(Me in x.filter)(le=Ft[Me].exec(Ie))&&(!we[Me]||(le=we[Me](le)))&&(ne=le.shift(),me.push({value:ne,type:Me,matches:le}),Ie=Ie.slice(ne.length));if(!ne)break}return K?Ie.length:Ie?et.error(V):Ye(V,Pe).slice(0)}function li(V){for(var K=0,ne=V.length,le="";K<ne;K++)le+=V[K].value;return le}function hi(V,K,ne){var le=K.dir,me=K.next,Me=me||le,Ie=ne&&Me==="parentNode",Pe=xe++;return K.first?function(we,qe,Be){for(;we=we[le];)if(we.nodeType===1||Ie)return V(we,qe,Be);return!1}:function(we,qe,Be){var Ge,je,Le=[oe,Pe];if(Be){for(;we=we[le];)if((we.nodeType===1||Ie)&&V(we,qe,Be))return!0}else for(;we=we[le];)if(we.nodeType===1||Ie)if(je=we[_e]||(we[_e]={}),me&&te(we,me))we=we[le]||we;else{if((Ge=je[Me])&&Ge[0]===oe&&Ge[1]===Pe)return Le[2]=Ge[2];if(je[Me]=Le,Le[2]=V(we,qe,Be))return!0}return!1}}function Ii(V){return V.length>1?function(K,ne,le){for(var me=V.length;me--;)if(!V[me](K,ne,le))return!1;return!0}:V[0]}function Xn(V,K,ne){for(var le=0,me=K.length;le<me;le++)et(V,K[le],ne);return ne}function ci(V,K,ne,le,me){for(var Me,Ie=[],Pe=0,we=V.length,qe=K!=null;Pe<we;Pe++)(Me=V[Pe])&&(!ne||ne(Me,le,me))&&(Ie.push(Me),qe&&K.push(Pe));return Ie}function wi(V,K,ne,le,me,Me){return le&&!le[_e]&&(le=wi(le)),me&&!me[_e]&&(me=wi(me,Me)),Rt(function(Ie,Pe,we,qe){var Be,Ge,je,Le,nt=[],Mt=[],xt=Pe.length,wt=Ie||Xn(K||"*",we.nodeType?[we]:we,[]),Lt=V&&(Ie||!K)?ci(wt,nt,V,we,qe):wt;if(ne?(Le=me||(Ie?V:xt||le)?[]:Pe,ne(Lt,Le,we,qe)):Le=Lt,le)for(Be=ci(Le,Mt),le(Be,[],we,qe),Ge=Be.length;Ge--;)(je=Be[Ge])&&(Le[Mt[Ge]]=!(Lt[Mt[Ge]]=je));if(Ie){if(me||V){if(me){for(Be=[],Ge=Le.length;Ge--;)(je=Le[Ge])&&Be.push(Lt[Ge]=je);me(null,Le=[],Be,qe)}for(Ge=Le.length;Ge--;)(je=Le[Ge])&&(Be=me?h.call(Ie,je):nt[Ge])>-1&&(Ie[Be]=!(Pe[Be]=je))}}else Le=ci(Le===Pe?Le.splice(xt,Le.length):Le),me?me(null,Pe,Le,qe):F.apply(Pe,Le)})}function Ai(V){for(var K,ne,le,me=V.length,Me=x.relative[V[0].type],Ie=Me||x.relative[" "],Pe=Me?1:0,we=hi(function(Ge){return Ge===K},Ie,!0),qe=hi(function(Ge){return h.call(K,Ge)>-1},Ie,!0),Be=[function(Ge,je,Le){var nt=!Me&&(Le||je!=M)||((K=je).nodeType?we(Ge,je,Le):qe(Ge,je,Le));return K=null,nt}];Pe<me;Pe++)if(ne=x.relative[V[Pe].type])Be=[hi(Ii(Be),ne)];else{if(ne=x.filter[V[Pe].type].apply(null,V[Pe].matches),ne[_e]){for(le=++Pe;le<me&&!x.relative[V[le].type];le++);return wi(Pe>1&&Ii(Be),Pe>1&&li(V.slice(0,Pe-1).concat({value:V[Pe-2].type===" "?"*":""})).replace(ie,"$1"),ne,Pe<le&&Ai(V.slice(Pe,le)),le<me&&Ai(V=V.slice(le)),le<me&&li(V))}Be.push(ne)}return Ii(Be)}function Yn(V,K){var ne=K.length>0,le=V.length>0,me=function(Me,Ie,Pe,we,qe){var Be,Ge,je,Le=0,nt="0",Mt=Me&&[],xt=[],wt=M,Lt=Me||le&&x.find.TAG("*",qe),Kt=oe+=wt==null?1:Math.random()||.1,Tt=Lt.length;for(qe&&(M=Ie==D||Ie||qe);nt!==Tt&&(Be=Lt[nt])!=null;nt++){if(le&&Be){for(Ge=0,!Ie&&Be.ownerDocument!=D&&(Ut(Be),Pe=!W);je=V[Ge++];)if(je(Be,Ie||D,Pe)){F.call(we,Be);break}qe&&(oe=Kt)}ne&&((Be=!je&&Be)&&Le--,Me&&Mt.push(Be))}if(Le+=nt,ne&&nt!==Le){for(Ge=0;je=K[Ge++];)je(Mt,xt,Ie,Pe);if(Me){if(Le>0)for(;nt--;)Mt[nt]||xt[nt]||(xt[nt]=Se.call(we));xt=ci(xt)}F.apply(we,xt),qe&&!Me&&xt.length>0&&Le+K.length>1&&T.uniqueSort(we)}return qe&&(oe=Kt,M=wt),Mt};return ne?Rt(me):me}function Ri(V,K){var ne,le=[],me=[],Me=We[V+" "];if(!Me){for(K||(K=ni(V)),ne=K.length;ne--;)Me=Ai(K[ne]),Me[_e]?le.push(Me):me.push(Me);Me=We(V,Yn(me,le)),Me.selector=V}return Me}function sn(V,K,ne,le){var me,Me,Ie,Pe,we,qe=typeof V=="function"&&V,Be=!le&&ni(V=qe.selector||V);if(ne=ne||[],Be.length===1){if(Me=Be[0]=Be[0].slice(0),Me.length>2&&(Ie=Me[0]).type==="ID"&&K.nodeType===9&&W&&x.relative[Me[1].type]){if(K=(x.find.ID(Ie.matches[0].replace(Dt,Bt),K)||[])[0],K)qe&&(K=K.parentNode);else return ne;V=V.slice(Me.shift().value.length)}for(me=Ft.needsContext.test(V)?0:Me.length;me--&&(Ie=Me[me],!x.relative[Pe=Ie.type]);)if((we=x.find[Pe])&&(le=we(Ie.matches[0].replace(Dt,Bt),Ei.test(Me[0].type)&&Mi(K.parentNode)||K))){if(Me.splice(me,1),V=le.length&&li(Me),!V)return F.apply(ne,le),ne;break}}return(qe||Ri(V,Be))(le,K,!W,ne,!K||Ei.test(V)&&Mi(K.parentNode)||K),ne}S.sortStable=_e.split("").sort(ft).join("")===_e,Ut(),S.sortDetached=Yt(function(V){return V.compareDocumentPosition(D.createElement("fieldset"))&1}),T.find=et,T.expr[":"]=T.expr.pseudos,T.unique=T.uniqueSort,et.compile=Ri,et.select=sn,et.setDocument=Ut,et.tokenize=ni,et.escape=T.escapeSelector,et.getText=T.text,et.isXML=T.isXMLDoc,et.selectors=T.expr,et.support=T.support,et.uniqueSort=T.uniqueSort})();var se=function(m,x,M){for(var w=[],N=M!==void 0;(m=m[x])&&m.nodeType!==9;)if(m.nodeType===1){if(N&&T(m).is(M))break;w.push(m)}return w},l=function(m,x){for(var M=[];m;m=m.nextSibling)m.nodeType===1&&m!==x&&M.push(m);return M},u=T.expr.match.needsContext,p=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function g(m,x,M){return v(x)?T.grep(m,function(w,N){return!!x.call(w,N,w)!==M}):x.nodeType?T.grep(m,function(w){return w===x!==M}):typeof x!="string"?T.grep(m,function(w){return h.call(x,w)>-1!==M}):T.filter(x,m,M)}T.filter=function(m,x,M){var w=x[0];return M&&(m=":not("+m+")"),x.length===1&&w.nodeType===1?T.find.matchesSelector(w,m)?[w]:[]:T.find.matches(m,T.grep(x,function(N){return N.nodeType===1}))},T.fn.extend({find:function(m){var x,M,w=this.length,N=this;if(typeof m!="string")return this.pushStack(T(m).filter(function(){for(x=0;x<w;x++)if(T.contains(N[x],this))return!0}));for(M=this.pushStack([]),x=0;x<w;x++)T.find(m,N[x],M);return w>1?T.uniqueSort(M):M},filter:function(m){return this.pushStack(g(this,m||[],!1))},not:function(m){return this.pushStack(g(this,m||[],!0))},is:function(m){return!!g(this,typeof m=="string"&&u.test(m)?T(m):m||[],!1).length}});var C,b=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,P=T.fn.init=function(m,x,M){var w,N;if(!m)return this;if(M=M||C,typeof m=="string")if(m[0]==="<"&&m[m.length-1]===">"&&m.length>=3?w=[null,m,null]:w=b.exec(m),w&&(w[1]||!x))if(w[1]){if(x=x instanceof T?x[0]:x,T.merge(this,T.parseHTML(w[1],x&&x.nodeType?x.ownerDocument||x:A,!0)),p.test(w[1])&&T.isPlainObject(x))for(w in x)v(this[w])?this[w](x[w]):this.attr(w,x[w]);return this}else return N=A.getElementById(w[2]),N&&(this[0]=N,this.length=1),this;else return!x||x.jquery?(x||M).find(m):this.constructor(x).find(m);else{if(m.nodeType)return this[0]=m,this.length=1,this;if(v(m))return M.ready!==void 0?M.ready(m):m(T)}return T.makeArray(m,this)};P.prototype=T.fn,C=T(A);var O=/^(?:parents|prev(?:Until|All))/,L={children:!0,contents:!0,next:!0,prev:!0};T.fn.extend({has:function(m){var x=T(m,this),M=x.length;return this.filter(function(){for(var w=0;w<M;w++)if(T.contains(this,x[w]))return!0})},closest:function(m,x){var M,w=0,N=this.length,F=[],D=typeof m!="string"&&T(m);if(!u.test(m)){for(;w<N;w++)for(M=this[w];M&&M!==x;M=M.parentNode)if(M.nodeType<11&&(D?D.index(M)>-1:M.nodeType===1&&T.find.matchesSelector(M,m))){F.push(M);break}}return this.pushStack(F.length>1?T.uniqueSort(F):F)},index:function(m){return m?typeof m=="string"?h.call(T(m),this[0]):h.call(this,m.jquery?m[0]:m):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(m,x){return this.pushStack(T.uniqueSort(T.merge(this.get(),T(m,x))))},addBack:function(m){return this.add(m==null?this.prevObject:this.prevObject.filter(m))}});function U(m,x){for(;(m=m[x])&&m.nodeType!==1;);return m}T.each({parent:function(m){var x=m.parentNode;return x&&x.nodeType!==11?x:null},parents:function(m){return se(m,"parentNode")},parentsUntil:function(m,x,M){return se(m,"parentNode",M)},next:function(m){return U(m,"nextSibling")},prev:function(m){return U(m,"previousSibling")},nextAll:function(m){return se(m,"nextSibling")},prevAll:function(m){return se(m,"previousSibling")},nextUntil:function(m,x,M){return se(m,"nextSibling",M)},prevUntil:function(m,x,M){return se(m,"previousSibling",M)},siblings:function(m){return l((m.parentNode||{}).firstChild,m)},children:function(m){return l(m.firstChild)},contents:function(m){return m.contentDocument!=null&&s(m.contentDocument)?m.contentDocument:(te(m,"template")&&(m=m.content||m),T.merge([],m.childNodes))}},function(m,x){T.fn[m]=function(M,w){var N=T.map(this,x,M);return m.slice(-5)!=="Until"&&(w=M),w&&typeof w=="string"&&(N=T.filter(w,N)),this.length>1&&(L[m]||T.uniqueSort(N),O.test(m)&&N.reverse()),this.pushStack(N)}});var H=/[^\x20\t\r\n\f]+/g;function ee(m){var x={};return T.each(m.match(H)||[],function(M,w){x[w]=!0}),x}T.Callbacks=function(m){m=typeof m=="string"?ee(m):T.extend({},m);var x,M,w,N,F=[],D=[],X=-1,W=function(){for(N=N||m.once,w=x=!0;D.length;X=-1)for(M=D.shift();++X<F.length;)F[X].apply(M[0],M[1])===!1&&m.stopOnFalse&&(X=F.length,M=!1);m.memory||(M=!1),x=!1,N&&(M?F=[]:F="")},Q={add:function(){return F&&(M&&!x&&(X=F.length-1,D.push(M)),(function fe(_e){T.each(_e,function(oe,xe){v(xe)?(!m.unique||!Q.has(xe))&&F.push(xe):xe&&xe.length&&k(xe)!=="string"&&fe(xe)})})(arguments),M&&!x&&W()),this},remove:function(){return T.each(arguments,function(fe,_e){for(var oe;(oe=T.inArray(_e,F,oe))>-1;)F.splice(oe,1),oe<=X&&X--}),this},has:function(fe){return fe?T.inArray(fe,F)>-1:F.length>0},empty:function(){return F&&(F=[]),this},disable:function(){return N=D=[],F=M="",this},disabled:function(){return!F},lock:function(){return N=D=[],!M&&!x&&(F=M=""),this},locked:function(){return!!N},fireWith:function(fe,_e){return N||(_e=_e||[],_e=[fe,_e.slice?_e.slice():_e],D.push(_e),x||W()),this},fire:function(){return Q.fireWith(this,arguments),this},fired:function(){return!!w}};return Q};function ae(m){return m}function Y(m){throw m}function Z(m,x,M,w){var N;try{m&&v(N=m.promise)?N.call(m).done(x).fail(M):m&&v(N=m.then)?N.call(m,x,M):x.apply(void 0,[m].slice(w))}catch(F){M.apply(void 0,[F])}}T.extend({Deferred:function(m){var x=[["notify","progress",T.Callbacks("memory"),T.Callbacks("memory"),2],["resolve","done",T.Callbacks("once memory"),T.Callbacks("once memory"),0,"resolved"],["reject","fail",T.Callbacks("once memory"),T.Callbacks("once memory"),1,"rejected"]],M="pending",w={state:function(){return M},always:function(){return N.done(arguments).fail(arguments),this},catch:function(F){return w.then(null,F)},pipe:function(){var F=arguments;return T.Deferred(function(D){T.each(x,function(X,W){var Q=v(F[W[4]])&&F[W[4]];N[W[1]](function(){var fe=Q&&Q.apply(this,arguments);fe&&v(fe.promise)?fe.promise().progress(D.notify).done(D.resolve).fail(D.reject):D[W[0]+"With"](this,Q?[fe]:arguments)})}),F=null}).promise()},then:function(F,D,X){var W=0;function Q(fe,_e,oe,xe){return function(){var ke=this,Ye=arguments,We=function(){var ft,Pt;if(!(fe<W)){if(ft=oe.apply(ke,Ye),ft===_e.promise())throw new TypeError("Thenable self-resolution");Pt=ft&&(typeof ft=="object"||typeof ft=="function")&&ft.then,v(Pt)?xe?Pt.call(ft,Q(W,_e,ae,xe),Q(W,_e,Y,xe)):(W++,Pt.call(ft,Q(W,_e,ae,xe),Q(W,_e,Y,xe),Q(W,_e,ae,_e.notifyWith))):(oe!==ae&&(ke=void 0,Ye=[ft]),(xe||_e.resolveWith)(ke,Ye))}},yt=xe?We:function(){try{We()}catch(ft){T.Deferred.exceptionHook&&T.Deferred.exceptionHook(ft,yt.error),fe+1>=W&&(oe!==Y&&(ke=void 0,Ye=[ft]),_e.rejectWith(ke,Ye))}};fe?yt():(T.Deferred.getErrorHook?yt.error=T.Deferred.getErrorHook():T.Deferred.getStackHook&&(yt.error=T.Deferred.getStackHook()),e.setTimeout(yt))}}return T.Deferred(function(fe){x[0][3].add(Q(0,fe,v(X)?X:ae,fe.notifyWith)),x[1][3].add(Q(0,fe,v(F)?F:ae)),x[2][3].add(Q(0,fe,v(D)?D:Y))}).promise()},promise:function(F){return F!=null?T.extend(F,w):w}},N={};return T.each(x,function(F,D){var X=D[2],W=D[5];w[D[1]]=X.add,W&&X.add(function(){M=W},x[3-F][2].disable,x[3-F][3].disable,x[0][2].lock,x[0][3].lock),X.add(D[3].fire),N[D[0]]=function(){return N[D[0]+"With"](this===N?void 0:this,arguments),this},N[D[0]+"With"]=X.fireWith}),w.promise(N),m&&m.call(N,N),N},when:function(m){var x=arguments.length,M=x,w=Array(M),N=r.call(arguments),F=T.Deferred(),D=function(X){return function(W){w[X]=this,N[X]=arguments.length>1?r.call(arguments):W,--x||F.resolveWith(w,N)}};if(x<=1&&(Z(m,F.done(D(M)).resolve,F.reject,!x),F.state()==="pending"||v(N[M]&&N[M].then)))return F.then();for(;M--;)Z(N[M],D(M),F.reject);return F.promise()}});var ce=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;T.Deferred.exceptionHook=function(m,x){e.console&&e.console.warn&&m&&ce.test(m.name)&&e.console.warn("jQuery.Deferred exception: "+m.message,m.stack,x)},T.readyException=function(m){e.setTimeout(function(){throw m})};var ye=T.Deferred();T.fn.ready=function(m){return ye.then(m).catch(function(x){T.readyException(x)}),this},T.extend({isReady:!1,readyWait:1,ready:function(m){(m===!0?--T.readyWait:T.isReady)||(T.isReady=!0,!(m!==!0&&--T.readyWait>0)&&ye.resolveWith(A,[T]))}}),T.ready.then=ye.then;function ve(){A.removeEventListener("DOMContentLoaded",ve),e.removeEventListener("load",ve),T.ready()}A.readyState==="complete"||A.readyState!=="loading"&&!A.documentElement.doScroll?e.setTimeout(T.ready):(A.addEventListener("DOMContentLoaded",ve),e.addEventListener("load",ve));var Ee=function(m,x,M,w,N,F,D){var X=0,W=m.length,Q=M==null;if(k(M)==="object"){N=!0;for(X in M)Ee(m,x,X,M[X],!0,F,D)}else if(w!==void 0&&(N=!0,v(w)||(D=!0),Q&&(D?(x.call(m,w),x=null):(Q=x,x=function(fe,_e,oe){return Q.call(T(fe),oe)})),x))for(;X<W;X++)x(m[X],M,D?w:w.call(m[X],X,x(m[X],M)));return N?m:Q?x.call(m):W?x(m[0],M):F},Re=/^-ms-/,Ne=/-([a-z])/g;function Fe(m,x){return x.toUpperCase()}function De(m){return m.replace(Re,"ms-").replace(Ne,Fe)}var Ae=function(m){return m.nodeType===1||m.nodeType===9||!+m.nodeType};function Ue(){this.expando=T.expando+Ue.uid++}Ue.uid=1,Ue.prototype={cache:function(m){var x=m[this.expando];return x||(x={},Ae(m)&&(m.nodeType?m[this.expando]=x:Object.defineProperty(m,this.expando,{value:x,configurable:!0}))),x},set:function(m,x,M){var w,N=this.cache(m);if(typeof x=="string")N[De(x)]=M;else for(w in x)N[De(w)]=x[w];return N},get:function(m,x){return x===void 0?this.cache(m):m[this.expando]&&m[this.expando][De(x)]},access:function(m,x,M){return x===void 0||x&&typeof x=="string"&&M===void 0?this.get(m,x):(this.set(m,x,M),M!==void 0?M:x)},remove:function(m,x){var M,w=m[this.expando];if(w!==void 0){if(x!==void 0)for(Array.isArray(x)?x=x.map(De):(x=De(x),x=x in w?[x]:x.match(H)||[]),M=x.length;M--;)delete w[x[M]];(x===void 0||T.isEmptyObject(w))&&(m.nodeType?m[this.expando]=void 0:delete m[this.expando])}},hasData:function(m){var x=m[this.expando];return x!==void 0&&!T.isEmptyObject(x)}};var Ce=new Ue,Oe=new Ue,Ve=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,tt=/[A-Z]/g;function it(m){return m==="true"?!0:m==="false"?!1:m==="null"?null:m===+m+""?+m:Ve.test(m)?JSON.parse(m):m}function ct(m,x,M){var w;if(M===void 0&&m.nodeType===1)if(w="data-"+x.replace(tt,"-$&").toLowerCase(),M=m.getAttribute(w),typeof M=="string"){try{M=it(M)}catch{}Oe.set(m,x,M)}else M=void 0;return M}T.extend({hasData:function(m){return Oe.hasData(m)||Ce.hasData(m)},data:function(m,x,M){return Oe.access(m,x,M)},removeData:function(m,x){Oe.remove(m,x)},_data:function(m,x,M){return Ce.access(m,x,M)},_removeData:function(m,x){Ce.remove(m,x)}}),T.fn.extend({data:function(m,x){var M,w,N,F=this[0],D=F&&F.attributes;if(m===void 0){if(this.length&&(N=Oe.get(F),F.nodeType===1&&!Ce.get(F,"hasDataAttrs"))){for(M=D.length;M--;)D[M]&&(w=D[M].name,w.indexOf("data-")===0&&(w=De(w.slice(5)),ct(F,w,N[w])));Ce.set(F,"hasDataAttrs",!0)}return N}return typeof m=="object"?this.each(function(){Oe.set(this,m)}):Ee(this,function(X){var W;if(F&&X===void 0)return W=Oe.get(F,m),W!==void 0||(W=ct(F,m),W!==void 0)?W:void 0;this.each(function(){Oe.set(this,m,X)})},null,x,arguments.length>1,null,!0)},removeData:function(m){return this.each(function(){Oe.remove(this,m)})}}),T.extend({queue:function(m,x,M){var w;if(m)return x=(x||"fx")+"queue",w=Ce.get(m,x),M&&(!w||Array.isArray(M)?w=Ce.access(m,x,T.makeArray(M)):w.push(M)),w||[]},dequeue:function(m,x){x=x||"fx";var M=T.queue(m,x),w=M.length,N=M.shift(),F=T._queueHooks(m,x),D=function(){T.dequeue(m,x)};N==="inprogress"&&(N=M.shift(),w--),N&&(x==="fx"&&M.unshift("inprogress"),delete F.stop,N.call(m,D,F)),!w&&F&&F.empty.fire()},_queueHooks:function(m,x){var M=x+"queueHooks";return Ce.get(m,M)||Ce.access(m,M,{empty:T.Callbacks("once memory").add(function(){Ce.remove(m,[x+"queue",M])})})}}),T.fn.extend({queue:function(m,x){var M=2;return typeof m!="string"&&(x=m,m="fx",M--),arguments.length<M?T.queue(this[0],m):x===void 0?this:this.each(function(){var w=T.queue(this,m,x);T._queueHooks(this,m),m==="fx"&&w[0]!=="inprogress"&&T.dequeue(this,m)})},dequeue:function(m){return this.each(function(){T.dequeue(this,m)})},clearQueue:function(m){return this.queue(m||"fx",[])},promise:function(m,x){var M,w=1,N=T.Deferred(),F=this,D=this.length,X=function(){--w||N.resolveWith(F,[F])};for(typeof m!="string"&&(x=m,m=void 0),m=m||"fx";D--;)M=Ce.get(F[D],m+"queueHooks"),M&&M.empty&&(w++,M.empty.add(X));return X(),N.promise(x)}});var mt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,st=new RegExp("^(?:([+-])=|)("+mt+")([a-z%]*)$","i"),ut=["Top","Right","Bottom","Left"],J=A.documentElement,ze=function(m){return T.contains(m.ownerDocument,m)},pt={composed:!0};J.getRootNode&&(ze=function(m){return T.contains(m.ownerDocument,m)||m.getRootNode(pt)===m.ownerDocument});var ot=function(m,x){return m=x||m,m.style.display==="none"||m.style.display===""&&ze(m)&&T.css(m,"display")==="none"};function Ct(m,x,M,w){var N,F,D=20,X=w?function(){return w.cur()}:function(){return T.css(m,x,"")},W=X(),Q=M&&M[3]||(T.cssNumber[x]?"":"px"),fe=m.nodeType&&(T.cssNumber[x]||Q!=="px"&&+W)&&st.exec(T.css(m,x));if(fe&&fe[3]!==Q){for(W=W/2,Q=Q||fe[3],fe=+W||1;D--;)T.style(m,x,fe+Q),(1-F)*(1-(F=X()/W||.5))<=0&&(D=0),fe=fe/F;fe=fe*2,T.style(m,x,fe+Q),M=M||[]}return M&&(fe=+fe||+W||0,N=M[1]?fe+(M[1]+1)*M[2]:+M[2],w&&(w.unit=Q,w.start=fe,w.end=N)),N}var St={};function vt(m){var x,M=m.ownerDocument,w=m.nodeName,N=St[w];return N||(x=M.body.appendChild(M.createElement(w)),N=T.css(x,"display"),x.parentNode.removeChild(x),N==="none"&&(N="block"),St[w]=N,N)}function at(m,x){for(var M,w,N=[],F=0,D=m.length;F<D;F++)w=m[F],w.style&&(M=w.style.display,x?(M==="none"&&(N[F]=Ce.get(w,"display")||null,N[F]||(w.style.display="")),w.style.display===""&&ot(w)&&(N[F]=vt(w))):M!=="none"&&(N[F]="none",Ce.set(w,"display",M)));for(F=0;F<D;F++)N[F]!=null&&(m[F].style.display=N[F]);return m}T.fn.extend({show:function(){return at(this,!0)},hide:function(){return at(this)},toggle:function(m){return typeof m=="boolean"?m?this.show():this.hide():this.each(function(){ot(this)?T(this).show():T(this).hide()})}});var lt=/^(?:checkbox|radio)$/i,Vt=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,kt=/^$|^module$|\/(?:java|ecma)script/i;(function(){var m=A.createDocumentFragment(),x=m.appendChild(A.createElement("div")),M=A.createElement("input");M.setAttribute("type","radio"),M.setAttribute("checked","checked"),M.setAttribute("name","t"),x.appendChild(M),S.checkClone=x.cloneNode(!0).cloneNode(!0).lastChild.checked,x.innerHTML="<textarea>x</textarea>",S.noCloneChecked=!!x.cloneNode(!0).lastChild.defaultValue,x.innerHTML="<option></option>",S.option=!!x.lastChild})();var Qe={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Qe.tbody=Qe.tfoot=Qe.colgroup=Qe.caption=Qe.thead,Qe.th=Qe.td,S.option||(Qe.optgroup=Qe.option=[1,"<select multiple='multiple'>","</select>"]);function Ke(m,x){var M;return typeof m.getElementsByTagName<"u"?M=m.getElementsByTagName(x||"*"):typeof m.querySelectorAll<"u"?M=m.querySelectorAll(x||"*"):M=[],x===void 0||x&&te(m,x)?T.merge([m],M):M}function gt(m,x){for(var M=0,w=m.length;M<w;M++)Ce.set(m[M],"globalEval",!x||Ce.get(x[M],"globalEval"))}var bt=/<|&#?\w+;/;function dt(m,x,M,w,N){for(var F,D,X,W,Q,fe,_e=x.createDocumentFragment(),oe=[],xe=0,ke=m.length;xe<ke;xe++)if(F=m[xe],F||F===0)if(k(F)==="object")T.merge(oe,F.nodeType?[F]:F);else if(!bt.test(F))oe.push(x.createTextNode(F));else{for(D=D||_e.appendChild(x.createElement("div")),X=(Vt.exec(F)||["",""])[1].toLowerCase(),W=Qe[X]||Qe._default,D.innerHTML=W[1]+T.htmlPrefilter(F)+W[2],fe=W[0];fe--;)D=D.lastChild;T.merge(oe,D.childNodes),D=_e.firstChild,D.textContent=""}for(_e.textContent="",xe=0;F=oe[xe++];){if(w&&T.inArray(F,w)>-1){N&&N.push(F);continue}if(Q=ze(F),D=Ke(_e.appendChild(F),"script"),Q&&gt(D),M)for(fe=0;F=D[fe++];)kt.test(F.type||"")&&M.push(F)}return _e}var _t=/^([^.]*)(?:\.(.+)|)/;function rt(){return!0}function $e(){return!1}function He(m,x,M,w,N,F){var D,X;if(typeof x=="object"){typeof M!="string"&&(w=w||M,M=void 0);for(X in x)He(m,X,M,w,x[X],F);return m}if(w==null&&N==null?(N=M,w=M=void 0):N==null&&(typeof M=="string"?(N=w,w=void 0):(N=w,w=M,M=void 0)),N===!1)N=$e;else if(!N)return m;return F===1&&(D=N,N=function(W){return T().off(W),D.apply(this,arguments)},N.guid=D.guid||(D.guid=T.guid++)),m.each(function(){T.event.add(this,x,N,w,M)})}T.event={global:{},add:function(m,x,M,w,N){var F,D,X,W,Q,fe,_e,oe,xe,ke,Ye,We=Ce.get(m);if(Ae(m))for(M.handler&&(F=M,M=F.handler,N=F.selector),N&&T.find.matchesSelector(J,N),M.guid||(M.guid=T.guid++),(W=We.events)||(W=We.events=Object.create(null)),(D=We.handle)||(D=We.handle=function(yt){return typeof T<"u"&&T.event.triggered!==yt.type?T.event.dispatch.apply(m,arguments):void 0}),x=(x||"").match(H)||[""],Q=x.length;Q--;)X=_t.exec(x[Q])||[],xe=Ye=X[1],ke=(X[2]||"").split(".").sort(),xe&&(_e=T.event.special[xe]||{},xe=(N?_e.delegateType:_e.bindType)||xe,_e=T.event.special[xe]||{},fe=T.extend({type:xe,origType:Ye,data:w,handler:M,guid:M.guid,selector:N,needsContext:N&&T.expr.match.needsContext.test(N),namespace:ke.join(".")},F),(oe=W[xe])||(oe=W[xe]=[],oe.delegateCount=0,(!_e.setup||_e.setup.call(m,w,ke,D)===!1)&&m.addEventListener&&m.addEventListener(xe,D)),_e.add&&(_e.add.call(m,fe),fe.handler.guid||(fe.handler.guid=M.guid)),N?oe.splice(oe.delegateCount++,0,fe):oe.push(fe),T.event.global[xe]=!0)},remove:function(m,x,M,w,N){var F,D,X,W,Q,fe,_e,oe,xe,ke,Ye,We=Ce.hasData(m)&&Ce.get(m);if(!(!We||!(W=We.events))){for(x=(x||"").match(H)||[""],Q=x.length;Q--;){if(X=_t.exec(x[Q])||[],xe=Ye=X[1],ke=(X[2]||"").split(".").sort(),!xe){for(xe in W)T.event.remove(m,xe+x[Q],M,w,!0);continue}for(_e=T.event.special[xe]||{},xe=(w?_e.delegateType:_e.bindType)||xe,oe=W[xe]||[],X=X[2]&&new RegExp("(^|\\.)"+ke.join("\\.(?:.*\\.|)")+"(\\.|$)"),D=F=oe.length;F--;)fe=oe[F],(N||Ye===fe.origType)&&(!M||M.guid===fe.guid)&&(!X||X.test(fe.namespace))&&(!w||w===fe.selector||w==="**"&&fe.selector)&&(oe.splice(F,1),fe.selector&&oe.delegateCount--,_e.remove&&_e.remove.call(m,fe));D&&!oe.length&&((!_e.teardown||_e.teardown.call(m,ke,We.handle)===!1)&&T.removeEvent(m,xe,We.handle),delete W[xe])}T.isEmptyObject(W)&&Ce.remove(m,"handle events")}},dispatch:function(m){var x,M,w,N,F,D,X=new Array(arguments.length),W=T.event.fix(m),Q=(Ce.get(this,"events")||Object.create(null))[W.type]||[],fe=T.event.special[W.type]||{};for(X[0]=W,x=1;x<arguments.length;x++)X[x]=arguments[x];if(W.delegateTarget=this,!(fe.preDispatch&&fe.preDispatch.call(this,W)===!1)){for(D=T.event.handlers.call(this,W,Q),x=0;(N=D[x++])&&!W.isPropagationStopped();)for(W.currentTarget=N.elem,M=0;(F=N.handlers[M++])&&!W.isImmediatePropagationStopped();)(!W.rnamespace||F.namespace===!1||W.rnamespace.test(F.namespace))&&(W.handleObj=F,W.data=F.data,w=((T.event.special[F.origType]||{}).handle||F.handler).apply(N.elem,X),w!==void 0&&(W.result=w)===!1&&(W.preventDefault(),W.stopPropagation()));return fe.postDispatch&&fe.postDispatch.call(this,W),W.result}},handlers:function(m,x){var M,w,N,F,D,X=[],W=x.delegateCount,Q=m.target;if(W&&Q.nodeType&&!(m.type==="click"&&m.button>=1)){for(;Q!==this;Q=Q.parentNode||this)if(Q.nodeType===1&&!(m.type==="click"&&Q.disabled===!0)){for(F=[],D={},M=0;M<W;M++)w=x[M],N=w.selector+" ",D[N]===void 0&&(D[N]=w.needsContext?T(N,this).index(Q)>-1:T.find(N,this,null,[Q]).length),D[N]&&F.push(w);F.length&&X.push({elem:Q,handlers:F})}}return Q=this,W<x.length&&X.push({elem:Q,handlers:x.slice(W)}),X},addProp:function(m,x){Object.defineProperty(T.Event.prototype,m,{enumerable:!0,configurable:!0,get:v(x)?function(){if(this.originalEvent)return x(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[m]},set:function(M){Object.defineProperty(this,m,{enumerable:!0,configurable:!0,writable:!0,value:M})}})},fix:function(m){return m[T.expando]?m:new T.Event(m)},special:{load:{noBubble:!0},click:{setup:function(m){var x=this||m;return lt.test(x.type)&&x.click&&te(x,"input")&&Je(x,"click",!0),!1},trigger:function(m){var x=this||m;return lt.test(x.type)&&x.click&&te(x,"input")&&Je(x,"click"),!0},_default:function(m){var x=m.target;return lt.test(x.type)&&x.click&&te(x,"input")&&Ce.get(x,"click")||te(x,"a")}},beforeunload:{postDispatch:function(m){m.result!==void 0&&m.originalEvent&&(m.originalEvent.returnValue=m.result)}}}};function Je(m,x,M){if(!M){Ce.get(m,x)===void 0&&T.event.add(m,x,rt);return}Ce.set(m,x,!1),T.event.add(m,x,{namespace:!1,handler:function(w){var N,F=Ce.get(this,x);if(w.isTrigger&1&&this[x]){if(F)(T.event.special[x]||{}).delegateType&&w.stopPropagation();else if(F=r.call(arguments),Ce.set(this,x,F),this[x](),N=Ce.get(this,x),Ce.set(this,x,!1),F!==N)return w.stopImmediatePropagation(),w.preventDefault(),N}else F&&(Ce.set(this,x,T.event.trigger(F[0],F.slice(1),this)),w.stopPropagation(),w.isImmediatePropagationStopped=rt)}})}T.removeEvent=function(m,x,M){m.removeEventListener&&m.removeEventListener(x,M)},T.Event=function(m,x){if(!(this instanceof T.Event))return new T.Event(m,x);m&&m.type?(this.originalEvent=m,this.type=m.type,this.isDefaultPrevented=m.defaultPrevented||m.defaultPrevented===void 0&&m.returnValue===!1?rt:$e,this.target=m.target&&m.target.nodeType===3?m.target.parentNode:m.target,this.currentTarget=m.currentTarget,this.relatedTarget=m.relatedTarget):this.type=m,x&&T.extend(this,x),this.timeStamp=m&&m.timeStamp||Date.now(),this[T.expando]=!0},T.Event.prototype={constructor:T.Event,isDefaultPrevented:$e,isPropagationStopped:$e,isImmediatePropagationStopped:$e,isSimulated:!1,preventDefault:function(){var m=this.originalEvent;this.isDefaultPrevented=rt,m&&!this.isSimulated&&m.preventDefault()},stopPropagation:function(){var m=this.originalEvent;this.isPropagationStopped=rt,m&&!this.isSimulated&&m.stopPropagation()},stopImmediatePropagation:function(){var m=this.originalEvent;this.isImmediatePropagationStopped=rt,m&&!this.isSimulated&&m.stopImmediatePropagation(),this.stopPropagation()}},T.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},T.event.addProp),T.each({focus:"focusin",blur:"focusout"},function(m,x){function M(w){if(A.documentMode){var N=Ce.get(this,"handle"),F=T.event.fix(w);F.type=w.type==="focusin"?"focus":"blur",F.isSimulated=!0,N(w),F.target===F.currentTarget&&N(F)}else T.event.simulate(x,w.target,T.event.fix(w))}T.event.special[m]={setup:function(){var w;if(Je(this,m,!0),A.documentMode)w=Ce.get(this,x),w||this.addEventListener(x,M),Ce.set(this,x,(w||0)+1);else return!1},trigger:function(){return Je(this,m),!0},teardown:function(){var w;if(A.documentMode)w=Ce.get(this,x)-1,w?Ce.set(this,x,w):(this.removeEventListener(x,M),Ce.remove(this,x));else return!1},_default:function(w){return Ce.get(w.target,m)},delegateType:x},T.event.special[x]={setup:function(){var w=this.ownerDocument||this.document||this,N=A.documentMode?this:w,F=Ce.get(N,x);F||(A.documentMode?this.addEventListener(x,M):w.addEventListener(m,M,!0)),Ce.set(N,x,(F||0)+1)},teardown:function(){var w=this.ownerDocument||this.document||this,N=A.documentMode?this:w,F=Ce.get(N,x)-1;F?Ce.set(N,x,F):(A.documentMode?this.removeEventListener(x,M):w.removeEventListener(m,M,!0),Ce.remove(N,x))}}}),T.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(m,x){T.event.special[m]={delegateType:x,bindType:x,handle:function(M){var w,N=this,F=M.relatedTarget,D=M.handleObj;return(!F||F!==N&&!T.contains(N,F))&&(M.type=D.origType,w=D.handler.apply(this,arguments),M.type=x),w}}}),T.fn.extend({on:function(m,x,M,w){return He(this,m,x,M,w)},one:function(m,x,M,w){return He(this,m,x,M,w,1)},off:function(m,x,M){var w,N;if(m&&m.preventDefault&&m.handleObj)return w=m.handleObj,T(m.delegateTarget).off(w.namespace?w.origType+"."+w.namespace:w.origType,w.selector,w.handler),this;if(typeof m=="object"){for(N in m)this.off(N,x,m[N]);return this}return(x===!1||typeof x=="function")&&(M=x,x=void 0),M===!1&&(M=$e),this.each(function(){T.event.remove(this,m,M,x)})}});var ui=/<script|<style|<link/i,cn=/checked\s*(?:[^=]|=\s*.checked.)/i,un=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Oi(m,x){return te(m,"table")&&te(x.nodeType!==11?x:x.firstChild,"tr")&&T(m).children("tbody")[0]||m}function dn(m){return m.type=(m.getAttribute("type")!==null)+"/"+m.type,m}function fn(m){return(m.type||"").slice(0,5)==="true/"?m.type=m.type.slice(5):m.removeAttribute("type"),m}function Ni(m,x){var M,w,N,F,D,X,W;if(x.nodeType===1){if(Ce.hasData(m)&&(F=Ce.get(m),W=F.events,W)){Ce.remove(x,"handle events");for(N in W)for(M=0,w=W[N].length;M<w;M++)T.event.add(x,N,W[N][M])}Oe.hasData(m)&&(D=Oe.access(m),X=T.extend({},D),Oe.set(x,X))}}function pn(m,x){var M=x.nodeName.toLowerCase();M==="input"&&lt.test(m.type)?x.checked=m.checked:(M==="input"||M==="textarea")&&(x.defaultValue=m.defaultValue)}function jt(m,x,M,w){x=o(x);var N,F,D,X,W,Q,fe=0,_e=m.length,oe=_e-1,xe=x[0],ke=v(xe);if(ke||_e>1&&typeof xe=="string"&&!S.checkClone&&cn.test(xe))return m.each(function(Ye){var We=m.eq(Ye);ke&&(x[0]=xe.call(this,Ye,We.html())),jt(We,x,M,w)});if(_e&&(N=dt(x,m[0].ownerDocument,!1,m,w),F=N.firstChild,N.childNodes.length===1&&(N=F),F||w)){for(D=T.map(Ke(N,"script"),dn),X=D.length;fe<_e;fe++)W=N,fe!==oe&&(W=T.clone(W,!0,!0),X&&T.merge(D,Ke(W,"script"))),M.call(m[fe],W,fe);if(X)for(Q=D[D.length-1].ownerDocument,T.map(D,fn),fe=0;fe<X;fe++)W=D[fe],kt.test(W.type||"")&&!Ce.access(W,"globalEval")&&T.contains(Q,W)&&(W.src&&(W.type||"").toLowerCase()!=="module"?T._evalUrl&&!W.noModule&&T._evalUrl(W.src,{nonce:W.nonce||W.getAttribute("nonce")},Q):G(W.textContent.replace(un,""),W,Q))}return m}function Fi(m,x,M){for(var w,N=x?T.filter(x,m):m,F=0;(w=N[F])!=null;F++)!M&&w.nodeType===1&&T.cleanData(Ke(w)),w.parentNode&&(M&&ze(w)&&gt(Ke(w,"script")),w.parentNode.removeChild(w));return m}T.extend({htmlPrefilter:function(m){return m},clone:function(m,x,M){var w,N,F,D,X=m.cloneNode(!0),W=ze(m);if(!S.noCloneChecked&&(m.nodeType===1||m.nodeType===11)&&!T.isXMLDoc(m))for(D=Ke(X),F=Ke(m),w=0,N=F.length;w<N;w++)pn(F[w],D[w]);if(x)if(M)for(F=F||Ke(m),D=D||Ke(X),w=0,N=F.length;w<N;w++)Ni(F[w],D[w]);else Ni(m,X);return D=Ke(X,"script"),D.length>0&&gt(D,!W&&Ke(m,"script")),X},cleanData:function(m){for(var x,M,w,N=T.event.special,F=0;(M=m[F])!==void 0;F++)if(Ae(M)){if(x=M[Ce.expando]){if(x.events)for(w in x.events)N[w]?T.event.remove(M,w):T.removeEvent(M,w,x.handle);M[Ce.expando]=void 0}M[Oe.expando]&&(M[Oe.expando]=void 0)}}}),T.fn.extend({detach:function(m){return Fi(this,m,!0)},remove:function(m){return Fi(this,m)},text:function(m){return Ee(this,function(x){return x===void 0?T.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=x)})},null,m,arguments.length)},append:function(){return jt(this,arguments,function(m){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var x=Oi(this,m);x.appendChild(m)}})},prepend:function(){return jt(this,arguments,function(m){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var x=Oi(this,m);x.insertBefore(m,x.firstChild)}})},before:function(){return jt(this,arguments,function(m){this.parentNode&&this.parentNode.insertBefore(m,this)})},after:function(){return jt(this,arguments,function(m){this.parentNode&&this.parentNode.insertBefore(m,this.nextSibling)})},empty:function(){for(var m,x=0;(m=this[x])!=null;x++)m.nodeType===1&&(T.cleanData(Ke(m,!1)),m.textContent="");return this},clone:function(m,x){return m=m??!1,x=x??m,this.map(function(){return T.clone(this,m,x)})},html:function(m){return Ee(this,function(x){var M=this[0]||{},w=0,N=this.length;if(x===void 0&&M.nodeType===1)return M.innerHTML;if(typeof x=="string"&&!ui.test(x)&&!Qe[(Vt.exec(x)||["",""])[1].toLowerCase()]){x=T.htmlPrefilter(x);try{for(;w<N;w++)M=this[w]||{},M.nodeType===1&&(T.cleanData(Ke(M,!1)),M.innerHTML=x);M=0}catch{}}M&&this.empty().append(x)},null,m,arguments.length)},replaceWith:function(){var m=[];return jt(this,arguments,function(x){var M=this.parentNode;T.inArray(this,m)<0&&(T.cleanData(Ke(this)),M&&M.replaceChild(x,this))},m)}}),T.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(m,x){T.fn[m]=function(M){for(var w,N=[],F=T(M),D=F.length-1,X=0;X<=D;X++)w=X===D?this:this.clone(!0),T(F[X])[x](w),a.apply(N,w.get());return this.pushStack(N)}});var di=new RegExp("^("+mt+")(?!px)[a-z%]+$","i"),fi=/^--/,si=function(m){var x=m.ownerDocument.defaultView;return(!x||!x.opener)&&(x=e),x.getComputedStyle(m)},Li=function(m,x,M){var w,N,F={};for(N in x)F[N]=m.style[N],m.style[N]=x[N];w=M.call(m);for(N in x)m.style[N]=F[N];return w},gn=new RegExp(ut.join("|"),"i");(function(){function m(){if(Q){W.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",Q.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",J.appendChild(W).appendChild(Q);var fe=e.getComputedStyle(Q);M=fe.top!=="1%",X=x(fe.marginLeft)===12,Q.style.right="60%",F=x(fe.right)===36,w=x(fe.width)===36,Q.style.position="absolute",N=x(Q.offsetWidth/3)===12,J.removeChild(W),Q=null}}function x(fe){return Math.round(parseFloat(fe))}var M,w,N,F,D,X,W=A.createElement("div"),Q=A.createElement("div");Q.style&&(Q.style.backgroundClip="content-box",Q.cloneNode(!0).style.backgroundClip="",S.clearCloneStyle=Q.style.backgroundClip==="content-box",T.extend(S,{boxSizingReliable:function(){return m(),w},pixelBoxStyles:function(){return m(),F},pixelPosition:function(){return m(),M},reliableMarginLeft:function(){return m(),X},scrollboxSize:function(){return m(),N},reliableTrDimensions:function(){var fe,_e,oe,xe;return D==null&&(fe=A.createElement("table"),_e=A.createElement("tr"),oe=A.createElement("div"),fe.style.cssText="position:absolute;left:-11111px;border-collapse:separate",_e.style.cssText="box-sizing:content-box;border:1px solid",_e.style.height="1px",oe.style.height="9px",oe.style.display="block",J.appendChild(fe).appendChild(_e).appendChild(oe),xe=e.getComputedStyle(_e),D=parseInt(xe.height,10)+parseInt(xe.borderTopWidth,10)+parseInt(xe.borderBottomWidth,10)===_e.offsetHeight,J.removeChild(fe)),D}}))})();function Zt(m,x,M){var w,N,F,D,X=fi.test(x),W=m.style;return M=M||si(m),M&&(D=M.getPropertyValue(x)||M[x],X&&D&&(D=D.replace(ie,"$1")||void 0),D===""&&!ze(m)&&(D=T.style(m,x)),!S.pixelBoxStyles()&&di.test(D)&&gn.test(x)&&(w=W.width,N=W.minWidth,F=W.maxWidth,W.minWidth=W.maxWidth=W.width=D,D=M.width,W.width=w,W.minWidth=N,W.maxWidth=F)),D!==void 0?D+"":D}function Di(m,x){return{get:function(){if(m()){delete this.get;return}return(this.get=x).apply(this,arguments)}}}var Bi=["Webkit","Moz","ms"],ki=A.createElement("div").style,zi={};function mn(m){for(var x=m[0].toUpperCase()+m.slice(1),M=Bi.length;M--;)if(m=Bi[M]+x,m in ki)return m}function pi(m){var x=T.cssProps[m]||zi[m];return x||(m in ki?m:zi[m]=mn(m)||m)}var _n=/^(none|table(?!-c[ea]).+)/,yn={position:"absolute",visibility:"hidden",display:"block"},Gi={letterSpacing:"0",fontWeight:"400"};function Ui(m,x,M){var w=st.exec(x);return w?Math.max(0,w[2]-(M||0))+(w[3]||"px"):x}function gi(m,x,M,w,N,F){var D=x==="width"?1:0,X=0,W=0,Q=0;if(M===(w?"border":"content"))return 0;for(;D<4;D+=2)M==="margin"&&(Q+=T.css(m,M+ut[D],!0,N)),w?(M==="content"&&(W-=T.css(m,"padding"+ut[D],!0,N)),M!=="margin"&&(W-=T.css(m,"border"+ut[D]+"Width",!0,N))):(W+=T.css(m,"padding"+ut[D],!0,N),M!=="padding"?W+=T.css(m,"border"+ut[D]+"Width",!0,N):X+=T.css(m,"border"+ut[D]+"Width",!0,N));return!w&&F>=0&&(W+=Math.max(0,Math.ceil(m["offset"+x[0].toUpperCase()+x.slice(1)]-F-W-X-.5))||0),W+Q}function Vi(m,x,M){var w=si(m),N=!S.boxSizingReliable()||M,F=N&&T.css(m,"boxSizing",!1,w)==="border-box",D=F,X=Zt(m,x,w),W="offset"+x[0].toUpperCase()+x.slice(1);if(di.test(X)){if(!M)return X;X="auto"}return(!S.boxSizingReliable()&&F||!S.reliableTrDimensions()&&te(m,"tr")||X==="auto"||!parseFloat(X)&&T.css(m,"display",!1,w)==="inline")&&m.getClientRects().length&&(F=T.css(m,"boxSizing",!1,w)==="border-box",D=W in m,D&&(X=m[W])),X=parseFloat(X)||0,X+gi(m,x,M||(F?"border":"content"),D,w,X)+"px"}T.extend({cssHooks:{opacity:{get:function(m,x){if(x){var M=Zt(m,"opacity");return M===""?"1":M}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(m,x,M,w){if(!(!m||m.nodeType===3||m.nodeType===8||!m.style)){var N,F,D,X=De(x),W=fi.test(x),Q=m.style;if(W||(x=pi(X)),D=T.cssHooks[x]||T.cssHooks[X],M!==void 0){if(F=typeof M,F==="string"&&(N=st.exec(M))&&N[1]&&(M=Ct(m,x,N),F="number"),M==null||M!==M)return;F==="number"&&!W&&(M+=N&&N[3]||(T.cssNumber[X]?"":"px")),!S.clearCloneStyle&&M===""&&x.indexOf("background")===0&&(Q[x]="inherit"),(!D||!("set"in D)||(M=D.set(m,M,w))!==void 0)&&(W?Q.setProperty(x,M):Q[x]=M)}else return D&&"get"in D&&(N=D.get(m,!1,w))!==void 0?N:Q[x]}},css:function(m,x,M,w){var N,F,D,X=De(x),W=fi.test(x);return W||(x=pi(X)),D=T.cssHooks[x]||T.cssHooks[X],D&&"get"in D&&(N=D.get(m,!0,M)),N===void 0&&(N=Zt(m,x,w)),N==="normal"&&x in Gi&&(N=Gi[x]),M===""||M?(F=parseFloat(N),M===!0||isFinite(F)?F||0:N):N}}),T.each(["height","width"],function(m,x){T.cssHooks[x]={get:function(M,w,N){if(w)return _n.test(T.css(M,"display"))&&(!M.getClientRects().length||!M.getBoundingClientRect().width)?Li(M,yn,function(){return Vi(M,x,N)}):Vi(M,x,N)},set:function(M,w,N){var F,D=si(M),X=!S.scrollboxSize()&&D.position==="absolute",W=X||N,Q=W&&T.css(M,"boxSizing",!1,D)==="border-box",fe=N?gi(M,x,N,Q,D):0;return Q&&X&&(fe-=Math.ceil(M["offset"+x[0].toUpperCase()+x.slice(1)]-parseFloat(D[x])-gi(M,x,"border",!1,D)-.5)),fe&&(F=st.exec(w))&&(F[3]||"px")!=="px"&&(M.style[x]=w,w=T.css(M,x)),Ui(M,w,fe)}}}),T.cssHooks.marginLeft=Di(S.reliableMarginLeft,function(m,x){if(x)return(parseFloat(Zt(m,"marginLeft"))||m.getBoundingClientRect().left-Li(m,{marginLeft:0},function(){return m.getBoundingClientRect().left}))+"px"}),T.each({margin:"",padding:"",border:"Width"},function(m,x){T.cssHooks[m+x]={expand:function(M){for(var w=0,N={},F=typeof M=="string"?M.split(" "):[M];w<4;w++)N[m+ut[w]+x]=F[w]||F[w-2]||F[0];return N}},m!=="margin"&&(T.cssHooks[m+x].set=Ui)}),T.fn.extend({css:function(m,x){return Ee(this,function(M,w,N){var F,D,X={},W=0;if(Array.isArray(w)){for(F=si(M),D=w.length;W<D;W++)X[w[W]]=T.css(M,w[W],!1,F);return X}return N!==void 0?T.style(M,w,N):T.css(M,w)},m,x,arguments.length>1)}});function Et(m,x,M,w,N){return new Et.prototype.init(m,x,M,w,N)}T.Tween=Et,Et.prototype={constructor:Et,init:function(m,x,M,w,N,F){this.elem=m,this.prop=M,this.easing=N||T.easing._default,this.options=x,this.start=this.now=this.cur(),this.end=w,this.unit=F||(T.cssNumber[M]?"":"px")},cur:function(){var m=Et.propHooks[this.prop];return m&&m.get?m.get(this):Et.propHooks._default.get(this)},run:function(m){var x,M=Et.propHooks[this.prop];return this.options.duration?this.pos=x=T.easing[this.easing](m,this.options.duration*m,0,1,this.options.duration):this.pos=x=m,this.now=(this.end-this.start)*x+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),M&&M.set?M.set(this):Et.propHooks._default.set(this),this}},Et.prototype.init.prototype=Et.prototype,Et.propHooks={_default:{get:function(m){var x;return m.elem.nodeType!==1||m.elem[m.prop]!=null&&m.elem.style[m.prop]==null?m.elem[m.prop]:(x=T.css(m.elem,m.prop,""),!x||x==="auto"?0:x)},set:function(m){T.fx.step[m.prop]?T.fx.step[m.prop](m):m.elem.nodeType===1&&(T.cssHooks[m.prop]||m.elem.style[pi(m.prop)]!=null)?T.style(m.elem,m.prop,m.now+m.unit):m.elem[m.prop]=m.now}}},Et.propHooks.scrollTop=Et.propHooks.scrollLeft={set:function(m){m.elem.nodeType&&m.elem.parentNode&&(m.elem[m.prop]=m.now)}},T.easing={linear:function(m){return m},swing:function(m){return .5-Math.cos(m*Math.PI)/2},_default:"swing"},T.fx=Et.prototype.init,T.fx.step={};var Xt,ri,Cn=/^(?:toggle|show|hide)$/,Sn=/queueHooks$/;function mi(){ri&&(A.hidden===!1&&e.requestAnimationFrame?e.requestAnimationFrame(mi):e.setTimeout(mi,T.fx.interval),T.fx.tick())}function Hi(){return e.setTimeout(function(){Xt=void 0}),Xt=Date.now()}function oi(m,x){var M,w=0,N={height:m};for(x=x?1:0;w<4;w+=2-x)M=ut[w],N["margin"+M]=N["padding"+M]=m;return x&&(N.opacity=N.width=m),N}function Wi(m,x,M){for(var w,N=(At.tweeners[x]||[]).concat(At.tweeners["*"]),F=0,D=N.length;F<D;F++)if(w=N[F].call(M,x,m))return w}function xn(m,x,M){var w,N,F,D,X,W,Q,fe,_e="width"in x||"height"in x,oe=this,xe={},ke=m.style,Ye=m.nodeType&&ot(m),We=Ce.get(m,"fxshow");M.queue||(D=T._queueHooks(m,"fx"),D.unqueued==null&&(D.unqueued=0,X=D.empty.fire,D.empty.fire=function(){D.unqueued||X()}),D.unqueued++,oe.always(function(){oe.always(function(){D.unqueued--,T.queue(m,"fx").length||D.empty.fire()})}));for(w in x)if(N=x[w],Cn.test(N)){if(delete x[w],F=F||N==="toggle",N===(Ye?"hide":"show"))if(N==="show"&&We&&We[w]!==void 0)Ye=!0;else continue;xe[w]=We&&We[w]||T.style(m,w)}if(W=!T.isEmptyObject(x),!(!W&&T.isEmptyObject(xe))){_e&&m.nodeType===1&&(M.overflow=[ke.overflow,ke.overflowX,ke.overflowY],Q=We&&We.display,Q==null&&(Q=Ce.get(m,"display")),fe=T.css(m,"display"),fe==="none"&&(Q?fe=Q:(at([m],!0),Q=m.style.display||Q,fe=T.css(m,"display"),at([m]))),(fe==="inline"||fe==="inline-block"&&Q!=null)&&T.css(m,"float")==="none"&&(W||(oe.done(function(){ke.display=Q}),Q==null&&(fe=ke.display,Q=fe==="none"?"":fe)),ke.display="inline-block")),M.overflow&&(ke.overflow="hidden",oe.always(function(){ke.overflow=M.overflow[0],ke.overflowX=M.overflow[1],ke.overflowY=M.overflow[2]})),W=!1;for(w in xe)W||(We?"hidden"in We&&(Ye=We.hidden):We=Ce.access(m,"fxshow",{display:Q}),F&&(We.hidden=!Ye),Ye&&at([m],!0),oe.done(function(){Ye||at([m]),Ce.remove(m,"fxshow");for(w in xe)T.style(m,w,xe[w])})),W=Wi(Ye?We[w]:0,w,oe),w in We||(We[w]=W.start,Ye&&(W.end=W.start,W.start=0))}}function vn(m,x){var M,w,N,F,D;for(M in m)if(w=De(M),N=x[w],F=m[M],Array.isArray(F)&&(N=F[1],F=m[M]=F[0]),M!==w&&(m[w]=F,delete m[M]),D=T.cssHooks[w],D&&"expand"in D){F=D.expand(F),delete m[w];for(M in F)M in m||(m[M]=F[M],x[M]=N)}else x[w]=N}function At(m,x,M){var w,N,F=0,D=At.prefilters.length,X=T.Deferred().always(function(){delete W.elem}),W=function(){if(N)return!1;for(var _e=Xt||Hi(),oe=Math.max(0,Q.startTime+Q.duration-_e),xe=oe/Q.duration||0,ke=1-xe,Ye=0,We=Q.tweens.length;Ye<We;Ye++)Q.tweens[Ye].run(ke);return X.notifyWith(m,[Q,ke,oe]),ke<1&&We?oe:(We||X.notifyWith(m,[Q,1,0]),X.resolveWith(m,[Q]),!1)},Q=X.promise({elem:m,props:T.extend({},x),opts:T.extend(!0,{specialEasing:{},easing:T.easing._default},M),originalProperties:x,originalOptions:M,startTime:Xt||Hi(),duration:M.duration,tweens:[],createTween:function(_e,oe){var xe=T.Tween(m,Q.opts,_e,oe,Q.opts.specialEasing[_e]||Q.opts.easing);return Q.tweens.push(xe),xe},stop:function(_e){var oe=0,xe=_e?Q.tweens.length:0;if(N)return this;for(N=!0;oe<xe;oe++)Q.tweens[oe].run(1);return _e?(X.notifyWith(m,[Q,1,0]),X.resolveWith(m,[Q,_e])):X.rejectWith(m,[Q,_e]),this}}),fe=Q.props;for(vn(fe,Q.opts.specialEasing);F<D;F++)if(w=At.prefilters[F].call(Q,m,fe,Q.opts),w)return v(w.stop)&&(T._queueHooks(Q.elem,Q.opts.queue).stop=w.stop.bind(w)),w;return T.map(fe,Wi,Q),v(Q.opts.start)&&Q.opts.start.call(m,Q),Q.progress(Q.opts.progress).done(Q.opts.done,Q.opts.complete).fail(Q.opts.fail).always(Q.opts.always),T.fx.timer(T.extend(W,{elem:m,anim:Q,queue:Q.opts.queue})),Q}T.Animation=T.extend(At,{tweeners:{"*":[function(m,x){var M=this.createTween(m,x);return Ct(M.elem,m,st.exec(x),M),M}]},tweener:function(m,x){v(m)?(x=m,m=["*"]):m=m.match(H);for(var M,w=0,N=m.length;w<N;w++)M=m[w],At.tweeners[M]=At.tweeners[M]||[],At.tweeners[M].unshift(x)},prefilters:[xn],prefilter:function(m,x){x?At.prefilters.unshift(m):At.prefilters.push(m)}}),T.speed=function(m,x,M){var w=m&&typeof m=="object"?T.extend({},m):{complete:M||!M&&x||v(m)&&m,duration:m,easing:M&&x||x&&!v(x)&&x};return T.fx.off?w.duration=0:typeof w.duration!="number"&&(w.duration in T.fx.speeds?w.duration=T.fx.speeds[w.duration]:w.duration=T.fx.speeds._default),(w.queue==null||w.queue===!0)&&(w.queue="fx"),w.old=w.complete,w.complete=function(){v(w.old)&&w.old.call(this),w.queue&&T.dequeue(this,w.queue)},w},T.fn.extend({fadeTo:function(m,x,M,w){return this.filter(ot).css("opacity",0).show().end().animate({opacity:x},m,M,w)},animate:function(m,x,M,w){var N=T.isEmptyObject(m),F=T.speed(x,M,w),D=function(){var X=At(this,T.extend({},m),F);(N||Ce.get(this,"finish"))&&X.stop(!0)};return D.finish=D,N||F.queue===!1?this.each(D):this.queue(F.queue,D)},stop:function(m,x,M){var w=function(N){var F=N.stop;delete N.stop,F(M)};return typeof m!="string"&&(M=x,x=m,m=void 0),x&&this.queue(m||"fx",[]),this.each(function(){var N=!0,F=m!=null&&m+"queueHooks",D=T.timers,X=Ce.get(this);if(F)X[F]&&X[F].stop&&w(X[F]);else for(F in X)X[F]&&X[F].stop&&Sn.test(F)&&w(X[F]);for(F=D.length;F--;)D[F].elem===this&&(m==null||D[F].queue===m)&&(D[F].anim.stop(M),N=!1,D.splice(F,1));(N||!M)&&T.dequeue(this,m)})},finish:function(m){return m!==!1&&(m=m||"fx"),this.each(function(){var x,M=Ce.get(this),w=M[m+"queue"],N=M[m+"queueHooks"],F=T.timers,D=w?w.length:0;for(M.finish=!0,T.queue(this,m,[]),N&&N.stop&&N.stop.call(this,!0),x=F.length;x--;)F[x].elem===this&&F[x].queue===m&&(F[x].anim.stop(!0),F.splice(x,1));for(x=0;x<D;x++)w[x]&&w[x].finish&&w[x].finish.call(this);delete M.finish})}}),T.each(["toggle","show","hide"],function(m,x){var M=T.fn[x];T.fn[x]=function(w,N,F){return w==null||typeof w=="boolean"?M.apply(this,arguments):this.animate(oi(x,!0),w,N,F)}}),T.each({slideDown:oi("show"),slideUp:oi("hide"),slideToggle:oi("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(m,x){T.fn[m]=function(M,w,N){return this.animate(x,M,w,N)}}),T.timers=[],T.fx.tick=function(){var m,x=0,M=T.timers;for(Xt=Date.now();x<M.length;x++)m=M[x],!m()&&M[x]===m&&M.splice(x--,1);M.length||T.fx.stop(),Xt=void 0},T.fx.timer=function(m){T.timers.push(m),T.fx.start()},T.fx.interval=13,T.fx.start=function(){ri||(ri=!0,mi())},T.fx.stop=function(){ri=null},T.fx.speeds={slow:600,fast:200,_default:400},T.fn.delay=function(m,x){return m=T.fx&&T.fx.speeds[m]||m,x=x||"fx",this.queue(x,function(M,w){var N=e.setTimeout(M,m);w.stop=function(){e.clearTimeout(N)}})},(function(){var m=A.createElement("input"),x=A.createElement("select"),M=x.appendChild(A.createElement("option"));m.type="checkbox",S.checkOn=m.value!=="",S.optSelected=M.selected,m=A.createElement("input"),m.value="t",m.type="radio",S.radioValue=m.value==="t"})();var $i,Jt=T.expr.attrHandle;T.fn.extend({attr:function(m,x){return Ee(this,T.attr,m,x,arguments.length>1)},removeAttr:function(m){return this.each(function(){T.removeAttr(this,m)})}}),T.extend({attr:function(m,x,M){var w,N,F=m.nodeType;if(!(F===3||F===8||F===2)){if(typeof m.getAttribute>"u")return T.prop(m,x,M);if((F!==1||!T.isXMLDoc(m))&&(N=T.attrHooks[x.toLowerCase()]||(T.expr.match.bool.test(x)?$i:void 0)),M!==void 0){if(M===null){T.removeAttr(m,x);return}return N&&"set"in N&&(w=N.set(m,M,x))!==void 0?w:(m.setAttribute(x,M+""),M)}return N&&"get"in N&&(w=N.get(m,x))!==null?w:(w=T.find.attr(m,x),w??void 0)}},attrHooks:{type:{set:function(m,x){if(!S.radioValue&&x==="radio"&&te(m,"input")){var M=m.value;return m.setAttribute("type",x),M&&(m.value=M),x}}}},removeAttr:function(m,x){var M,w=0,N=x&&x.match(H);if(N&&m.nodeType===1)for(;M=N[w++];)m.removeAttribute(M)}}),$i={set:function(m,x,M){return x===!1?T.removeAttr(m,M):m.setAttribute(M,M),M}},T.each(T.expr.match.bool.source.match(/\w+/g),function(m,x){var M=Jt[x]||T.find.attr;Jt[x]=function(w,N,F){var D,X,W=N.toLowerCase();return F||(X=Jt[W],Jt[W]=D,D=M(w,N,F)!=null?W:null,Jt[W]=X),D}});var bn=/^(?:input|select|textarea|button)$/i,Tn=/^(?:a|area)$/i;T.fn.extend({prop:function(m,x){return Ee(this,T.prop,m,x,arguments.length>1)},removeProp:function(m){return this.each(function(){delete this[T.propFix[m]||m]})}}),T.extend({prop:function(m,x,M){var w,N,F=m.nodeType;if(!(F===3||F===8||F===2))return(F!==1||!T.isXMLDoc(m))&&(x=T.propFix[x]||x,N=T.propHooks[x]),M!==void 0?N&&"set"in N&&(w=N.set(m,M,x))!==void 0?w:m[x]=M:N&&"get"in N&&(w=N.get(m,x))!==null?w:m[x]},propHooks:{tabIndex:{get:function(m){var x=T.find.attr(m,"tabindex");return x?parseInt(x,10):bn.test(m.nodeName)||Tn.test(m.nodeName)&&m.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),S.optSelected||(T.propHooks.selected={get:function(m){var x=m.parentNode;return x&&x.parentNode&&x.parentNode.selectedIndex,null},set:function(m){var x=m.parentNode;x&&(x.selectedIndex,x.parentNode&&x.parentNode.selectedIndex)}}),T.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){T.propFix[this.toLowerCase()]=this});function Ht(m){var x=m.match(H)||[];return x.join(" ")}function Wt(m){return m.getAttribute&&m.getAttribute("class")||""}function _i(m){return Array.isArray(m)?m:typeof m=="string"?m.match(H)||[]:[]}T.fn.extend({addClass:function(m){var x,M,w,N,F,D;return v(m)?this.each(function(X){T(this).addClass(m.call(this,X,Wt(this)))}):(x=_i(m),x.length?this.each(function(){if(w=Wt(this),M=this.nodeType===1&&" "+Ht(w)+" ",M){for(F=0;F<x.length;F++)N=x[F],M.indexOf(" "+N+" ")<0&&(M+=N+" ");D=Ht(M),w!==D&&this.setAttribute("class",D)}}):this)},removeClass:function(m){var x,M,w,N,F,D;return v(m)?this.each(function(X){T(this).removeClass(m.call(this,X,Wt(this)))}):arguments.length?(x=_i(m),x.length?this.each(function(){if(w=Wt(this),M=this.nodeType===1&&" "+Ht(w)+" ",M){for(F=0;F<x.length;F++)for(N=x[F];M.indexOf(" "+N+" ")>-1;)M=M.replace(" "+N+" "," ");D=Ht(M),w!==D&&this.setAttribute("class",D)}}):this):this.attr("class","")},toggleClass:function(m,x){var M,w,N,F,D=typeof m,X=D==="string"||Array.isArray(m);return v(m)?this.each(function(W){T(this).toggleClass(m.call(this,W,Wt(this),x),x)}):typeof x=="boolean"&&X?x?this.addClass(m):this.removeClass(m):(M=_i(m),this.each(function(){if(X)for(F=T(this),N=0;N<M.length;N++)w=M[N],F.hasClass(w)?F.removeClass(w):F.addClass(w);else(m===void 0||D==="boolean")&&(w=Wt(this),w&&Ce.set(this,"__className__",w),this.setAttribute&&this.setAttribute("class",w||m===!1?"":Ce.get(this,"__className__")||""))}))},hasClass:function(m){var x,M,w=0;for(x=" "+m+" ";M=this[w++];)if(M.nodeType===1&&(" "+Ht(Wt(M))+" ").indexOf(x)>-1)return!0;return!1}});var En=/\r/g;T.fn.extend({val:function(m){var x,M,w,N=this[0];return arguments.length?(w=v(m),this.each(function(F){var D;this.nodeType===1&&(w?D=m.call(this,F,T(this).val()):D=m,D==null?D="":typeof D=="number"?D+="":Array.isArray(D)&&(D=T.map(D,function(X){return X==null?"":X+""})),x=T.valHooks[this.type]||T.valHooks[this.nodeName.toLowerCase()],(!x||!("set"in x)||x.set(this,D,"value")===void 0)&&(this.value=D))})):N?(x=T.valHooks[N.type]||T.valHooks[N.nodeName.toLowerCase()],x&&"get"in x&&(M=x.get(N,"value"))!==void 0?M:(M=N.value,typeof M=="string"?M.replace(En,""):M??"")):void 0}}),T.extend({valHooks:{option:{get:function(m){var x=T.find.attr(m,"value");return x??Ht(T.text(m))}},select:{get:function(m){var x,M,w,N=m.options,F=m.selectedIndex,D=m.type==="select-one",X=D?null:[],W=D?F+1:N.length;for(F<0?w=W:w=D?F:0;w<W;w++)if(M=N[w],(M.selected||w===F)&&!M.disabled&&(!M.parentNode.disabled||!te(M.parentNode,"optgroup"))){if(x=T(M).val(),D)return x;X.push(x)}return X},set:function(m,x){for(var M,w,N=m.options,F=T.makeArray(x),D=N.length;D--;)w=N[D],(w.selected=T.inArray(T.valHooks.option.get(w),F)>-1)&&(M=!0);return M||(m.selectedIndex=-1),F}}}}),T.each(["radio","checkbox"],function(){T.valHooks[this]={set:function(m,x){if(Array.isArray(x))return m.checked=T.inArray(T(m).val(),x)>-1}},S.checkOn||(T.valHooks[this].get=function(m){return m.getAttribute("value")===null?"on":m.value})});var Qt=e.location,qi={guid:Date.now()},yi=/\?/;T.parseXML=function(m){var x,M;if(!m||typeof m!="string")return null;try{x=new e.DOMParser().parseFromString(m,"text/xml")}catch{}return M=x&&x.getElementsByTagName("parsererror")[0],(!x||M)&&T.error("Invalid XML: "+(M?T.map(M.childNodes,function(w){return w.textContent}).join(`
`):m)),x};var ji=/^(?:focusinfocus|focusoutblur)$/,Xi=function(m){m.stopPropagation()};T.extend(T.event,{trigger:function(m,x,M,w){var N,F,D,X,W,Q,fe,_e,oe=[M||A],xe=f.call(m,"type")?m.type:m,ke=f.call(m,"namespace")?m.namespace.split("."):[];if(F=_e=D=M=M||A,!(M.nodeType===3||M.nodeType===8)&&!ji.test(xe+T.event.triggered)&&(xe.indexOf(".")>-1&&(ke=xe.split("."),xe=ke.shift(),ke.sort()),W=xe.indexOf(":")<0&&"on"+xe,m=m[T.expando]?m:new T.Event(xe,typeof m=="object"&&m),m.isTrigger=w?2:3,m.namespace=ke.join("."),m.rnamespace=m.namespace?new RegExp("(^|\\.)"+ke.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,m.result=void 0,m.target||(m.target=M),x=x==null?[m]:T.makeArray(x,[m]),fe=T.event.special[xe]||{},!(!w&&fe.trigger&&fe.trigger.apply(M,x)===!1))){if(!w&&!fe.noBubble&&!I(M)){for(X=fe.delegateType||xe,ji.test(X+xe)||(F=F.parentNode);F;F=F.parentNode)oe.push(F),D=F;D===(M.ownerDocument||A)&&oe.push(D.defaultView||D.parentWindow||e)}for(N=0;(F=oe[N++])&&!m.isPropagationStopped();)_e=F,m.type=N>1?X:fe.bindType||xe,Q=(Ce.get(F,"events")||Object.create(null))[m.type]&&Ce.get(F,"handle"),Q&&Q.apply(F,x),Q=W&&F[W],Q&&Q.apply&&Ae(F)&&(m.result=Q.apply(F,x),m.result===!1&&m.preventDefault());return m.type=xe,!w&&!m.isDefaultPrevented()&&(!fe._default||fe._default.apply(oe.pop(),x)===!1)&&Ae(M)&&W&&v(M[xe])&&!I(M)&&(D=M[W],D&&(M[W]=null),T.event.triggered=xe,m.isPropagationStopped()&&_e.addEventListener(xe,Xi),M[xe](),m.isPropagationStopped()&&_e.removeEventListener(xe,Xi),T.event.triggered=void 0,D&&(M[W]=D)),m.result}},simulate:function(m,x,M){var w=T.extend(new T.Event,M,{type:m,isSimulated:!0});T.event.trigger(w,null,x)}}),T.fn.extend({trigger:function(m,x){return this.each(function(){T.event.trigger(m,x,this)})},triggerHandler:function(m,x){var M=this[0];if(M)return T.event.trigger(m,x,M,!0)}});var Mn=/\[\]$/,Yi=/\r?\n/g,In=/^(?:submit|button|image|reset|file)$/i,wn=/^(?:input|select|textarea|keygen)/i;function Ci(m,x,M,w){var N;if(Array.isArray(x))T.each(x,function(F,D){M||Mn.test(m)?w(m,D):Ci(m+"["+(typeof D=="object"&&D!=null?F:"")+"]",D,M,w)});else if(!M&&k(x)==="object")for(N in x)Ci(m+"["+N+"]",x[N],M,w);else w(m,x)}T.param=function(m,x){var M,w=[],N=function(F,D){var X=v(D)?D():D;w[w.length]=encodeURIComponent(F)+"="+encodeURIComponent(X??"")};if(m==null)return"";if(Array.isArray(m)||m.jquery&&!T.isPlainObject(m))T.each(m,function(){N(this.name,this.value)});else for(M in m)Ci(M,m[M],x,N);return w.join("&")},T.fn.extend({serialize:function(){return T.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var m=T.prop(this,"elements");return m?T.makeArray(m):this}).filter(function(){var m=this.type;return this.name&&!T(this).is(":disabled")&&wn.test(this.nodeName)&&!In.test(m)&&(this.checked||!lt.test(m))}).map(function(m,x){var M=T(this).val();return M==null?null:Array.isArray(M)?T.map(M,function(w){return{name:x.name,value:w.replace(Yi,`\r
`)}}):{name:x.name,value:M.replace(Yi,`\r
`)}}).get()}});var An=/%20/g,Rn=/#.*$/,Pn=/([?&])_=[^&]*/,On=/^(.*?):[ \t]*([^\r\n]*)$/mg,Nn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ln=/^(?:GET|HEAD)$/,Dn=/^\/\//,Ki={},Si={},Zi="*/".concat("*"),xi=A.createElement("a");xi.href=Qt.href;function Ji(m){return function(x,M){typeof x!="string"&&(M=x,x="*");var w,N=0,F=x.toLowerCase().match(H)||[];if(v(M))for(;w=F[N++];)w[0]==="+"?(w=w.slice(1)||"*",(m[w]=m[w]||[]).unshift(M)):(m[w]=m[w]||[]).push(M)}}function Qi(m,x,M,w){var N={},F=m===Si;function D(X){var W;return N[X]=!0,T.each(m[X]||[],function(Q,fe){var _e=fe(x,M,w);if(typeof _e=="string"&&!F&&!N[_e])return x.dataTypes.unshift(_e),D(_e),!1;if(F)return!(W=_e)}),W}return D(x.dataTypes[0])||!N["*"]&&D("*")}function vi(m,x){var M,w,N=T.ajaxSettings.flatOptions||{};for(M in x)x[M]!==void 0&&((N[M]?m:w||(w={}))[M]=x[M]);return w&&T.extend(!0,m,w),m}function Bn(m,x,M){for(var w,N,F,D,X=m.contents,W=m.dataTypes;W[0]==="*";)W.shift(),w===void 0&&(w=m.mimeType||x.getResponseHeader("Content-Type"));if(w){for(N in X)if(X[N]&&X[N].test(w)){W.unshift(N);break}}if(W[0]in M)F=W[0];else{for(N in M){if(!W[0]||m.converters[N+" "+W[0]]){F=N;break}D||(D=N)}F=F||D}if(F)return F!==W[0]&&W.unshift(F),M[F]}function kn(m,x,M,w){var N,F,D,X,W,Q={},fe=m.dataTypes.slice();if(fe[1])for(D in m.converters)Q[D.toLowerCase()]=m.converters[D];for(F=fe.shift();F;)if(m.responseFields[F]&&(M[m.responseFields[F]]=x),!W&&w&&m.dataFilter&&(x=m.dataFilter(x,m.dataType)),W=F,F=fe.shift(),F){if(F==="*")F=W;else if(W!=="*"&&W!==F){if(D=Q[W+" "+F]||Q["* "+F],!D){for(N in Q)if(X=N.split(" "),X[1]===F&&(D=Q[W+" "+X[0]]||Q["* "+X[0]],D)){D===!0?D=Q[N]:Q[N]!==!0&&(F=X[0],fe.unshift(X[1]));break}}if(D!==!0)if(D&&m.throws)x=D(x);else try{x=D(x)}catch(_e){return{state:"parsererror",error:D?_e:"No conversion from "+W+" to "+F}}}}return{state:"success",data:x}}T.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Qt.href,type:"GET",isLocal:Nn.test(Qt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Zi,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":T.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(m,x){return x?vi(vi(m,T.ajaxSettings),x):vi(T.ajaxSettings,m)},ajaxPrefilter:Ji(Ki),ajaxTransport:Ji(Si),ajax:function(m,x){typeof m=="object"&&(x=m,m=void 0),x=x||{};var M,w,N,F,D,X,W,Q,fe,_e,oe=T.ajaxSetup({},x),xe=oe.context||oe,ke=oe.context&&(xe.nodeType||xe.jquery)?T(xe):T.event,Ye=T.Deferred(),We=T.Callbacks("once memory"),yt=oe.statusCode||{},ft={},Pt={},Ot="canceled",Xe={readyState:0,getResponseHeader:function(Ze){var ht;if(W){if(!F)for(F={};ht=On.exec(N);)F[ht[1].toLowerCase()+" "]=(F[ht[1].toLowerCase()+" "]||[]).concat(ht[2]);ht=F[Ze.toLowerCase()+" "]}return ht==null?null:ht.join(", ")},getAllResponseHeaders:function(){return W?N:null},setRequestHeader:function(Ze,ht){return W==null&&(Ze=Pt[Ze.toLowerCase()]=Pt[Ze.toLowerCase()]||Ze,ft[Ze]=ht),this},overrideMimeType:function(Ze){return W==null&&(oe.mimeType=Ze),this},statusCode:function(Ze){var ht;if(Ze)if(W)Xe.always(Ze[Xe.status]);else for(ht in Ze)yt[ht]=[yt[ht],Ze[ht]];return this},abort:function(Ze){var ht=Ze||Ot;return M&&M.abort(ht),$t(0,ht),this}};if(Ye.promise(Xe),oe.url=((m||oe.url||Qt.href)+"").replace(Dn,Qt.protocol+"//"),oe.type=x.method||x.type||oe.method||oe.type,oe.dataTypes=(oe.dataType||"*").toLowerCase().match(H)||[""],oe.crossDomain==null){X=A.createElement("a");try{X.href=oe.url,X.href=X.href,oe.crossDomain=xi.protocol+"//"+xi.host!=X.protocol+"//"+X.host}catch{oe.crossDomain=!0}}if(oe.data&&oe.processData&&typeof oe.data!="string"&&(oe.data=T.param(oe.data,oe.traditional)),Qi(Ki,oe,x,Xe),W)return Xe;Q=T.event&&oe.global,Q&&T.active++===0&&T.event.trigger("ajaxStart"),oe.type=oe.type.toUpperCase(),oe.hasContent=!Ln.test(oe.type),w=oe.url.replace(Rn,""),oe.hasContent?oe.data&&oe.processData&&(oe.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(oe.data=oe.data.replace(An,"+")):(_e=oe.url.slice(w.length),oe.data&&(oe.processData||typeof oe.data=="string")&&(w+=(yi.test(w)?"&":"?")+oe.data,delete oe.data),oe.cache===!1&&(w=w.replace(Pn,"$1"),_e=(yi.test(w)?"&":"?")+"_="+qi.guid+++_e),oe.url=w+_e),oe.ifModified&&(T.lastModified[w]&&Xe.setRequestHeader("If-Modified-Since",T.lastModified[w]),T.etag[w]&&Xe.setRequestHeader("If-None-Match",T.etag[w])),(oe.data&&oe.hasContent&&oe.contentType!==!1||x.contentType)&&Xe.setRequestHeader("Content-Type",oe.contentType),Xe.setRequestHeader("Accept",oe.dataTypes[0]&&oe.accepts[oe.dataTypes[0]]?oe.accepts[oe.dataTypes[0]]+(oe.dataTypes[0]!=="*"?", "+Zi+"; q=0.01":""):oe.accepts["*"]);for(fe in oe.headers)Xe.setRequestHeader(fe,oe.headers[fe]);if(oe.beforeSend&&(oe.beforeSend.call(xe,Xe,oe)===!1||W))return Xe.abort();if(Ot="abort",We.add(oe.complete),Xe.done(oe.success),Xe.fail(oe.error),M=Qi(Si,oe,x,Xe),!M)$t(-1,"No Transport");else{if(Xe.readyState=1,Q&&ke.trigger("ajaxSend",[Xe,oe]),W)return Xe;oe.async&&oe.timeout>0&&(D=e.setTimeout(function(){Xe.abort("timeout")},oe.timeout));try{W=!1,M.send(ft,$t)}catch(Ze){if(W)throw Ze;$t(-1,Ze)}}function $t(Ze,ht,ti,Ti){var Nt,ii,Ft,zt,Gt,It=ht;W||(W=!0,D&&e.clearTimeout(D),M=void 0,N=Ti||"",Xe.readyState=Ze>0?4:0,Nt=Ze>=200&&Ze<300||Ze===304,ti&&(zt=Bn(oe,Xe,ti)),!Nt&&T.inArray("script",oe.dataTypes)>-1&&T.inArray("json",oe.dataTypes)<0&&(oe.converters["text script"]=function(){}),zt=kn(oe,zt,Xe,Nt),Nt?(oe.ifModified&&(Gt=Xe.getResponseHeader("Last-Modified"),Gt&&(T.lastModified[w]=Gt),Gt=Xe.getResponseHeader("etag"),Gt&&(T.etag[w]=Gt)),Ze===204||oe.type==="HEAD"?It="nocontent":Ze===304?It="notmodified":(It=zt.state,ii=zt.data,Ft=zt.error,Nt=!Ft)):(Ft=It,(Ze||!It)&&(It="error",Ze<0&&(Ze=0))),Xe.status=Ze,Xe.statusText=(ht||It)+"",Nt?Ye.resolveWith(xe,[ii,It,Xe]):Ye.rejectWith(xe,[Xe,It,Ft]),Xe.statusCode(yt),yt=void 0,Q&&ke.trigger(Nt?"ajaxSuccess":"ajaxError",[Xe,oe,Nt?ii:Ft]),We.fireWith(xe,[Xe,It]),Q&&(ke.trigger("ajaxComplete",[Xe,oe]),--T.active||T.event.trigger("ajaxStop")))}return Xe},getJSON:function(m,x,M){return T.get(m,x,M,"json")},getScript:function(m,x){return T.get(m,void 0,x,"script")}}),T.each(["get","post"],function(m,x){T[x]=function(M,w,N,F){return v(w)&&(F=F||N,N=w,w=void 0),T.ajax(T.extend({url:M,type:x,dataType:F,data:w,success:N},T.isPlainObject(M)&&M))}}),T.ajaxPrefilter(function(m){var x;for(x in m.headers)x.toLowerCase()==="content-type"&&(m.contentType=m.headers[x]||"")}),T._evalUrl=function(m,x,M){return T.ajax({url:m,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(w){T.globalEval(w,x,M)}})},T.fn.extend({wrapAll:function(m){var x;return this[0]&&(v(m)&&(m=m.call(this[0])),x=T(m,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&x.insertBefore(this[0]),x.map(function(){for(var M=this;M.firstElementChild;)M=M.firstElementChild;return M}).append(this)),this},wrapInner:function(m){return v(m)?this.each(function(x){T(this).wrapInner(m.call(this,x))}):this.each(function(){var x=T(this),M=x.contents();M.length?M.wrapAll(m):x.append(m)})},wrap:function(m){var x=v(m);return this.each(function(M){T(this).wrapAll(x?m.call(this,M):m)})},unwrap:function(m){return this.parent(m).not("body").each(function(){T(this).replaceWith(this.childNodes)}),this}}),T.expr.pseudos.hidden=function(m){return!T.expr.pseudos.visible(m)},T.expr.pseudos.visible=function(m){return!!(m.offsetWidth||m.offsetHeight||m.getClientRects().length)},T.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch{}};var zn={0:200,1223:204},ei=T.ajaxSettings.xhr();S.cors=!!ei&&"withCredentials"in ei,S.ajax=ei=!!ei,T.ajaxTransport(function(m){var x,M;if(S.cors||ei&&!m.crossDomain)return{send:function(w,N){var F,D=m.xhr();if(D.open(m.type,m.url,m.async,m.username,m.password),m.xhrFields)for(F in m.xhrFields)D[F]=m.xhrFields[F];m.mimeType&&D.overrideMimeType&&D.overrideMimeType(m.mimeType),!m.crossDomain&&!w["X-Requested-With"]&&(w["X-Requested-With"]="XMLHttpRequest");for(F in w)D.setRequestHeader(F,w[F]);x=function(X){return function(){x&&(x=M=D.onload=D.onerror=D.onabort=D.ontimeout=D.onreadystatechange=null,X==="abort"?D.abort():X==="error"?typeof D.status!="number"?N(0,"error"):N(D.status,D.statusText):N(zn[D.status]||D.status,D.statusText,(D.responseType||"text")!=="text"||typeof D.responseText!="string"?{binary:D.response}:{text:D.responseText},D.getAllResponseHeaders()))}},D.onload=x(),M=D.onerror=D.ontimeout=x("error"),D.onabort!==void 0?D.onabort=M:D.onreadystatechange=function(){D.readyState===4&&e.setTimeout(function(){x&&M()})},x=x("abort");try{D.send(m.hasContent&&m.data||null)}catch(X){if(x)throw X}},abort:function(){x&&x()}}}),T.ajaxPrefilter(function(m){m.crossDomain&&(m.contents.script=!1)}),T.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(m){return T.globalEval(m),m}}}),T.ajaxPrefilter("script",function(m){m.cache===void 0&&(m.cache=!1),m.crossDomain&&(m.type="GET")}),T.ajaxTransport("script",function(m){if(m.crossDomain||m.scriptAttrs){var x,M;return{send:function(w,N){x=T("<script>").attr(m.scriptAttrs||{}).prop({charset:m.scriptCharset,src:m.url}).on("load error",M=function(F){x.remove(),M=null,F&&N(F.type==="error"?404:200,F.type)}),A.head.appendChild(x[0])},abort:function(){M&&M()}}}});var en=[],bi=/(=)\?(?=&|$)|\?\?/;T.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var m=en.pop()||T.expando+"_"+qi.guid++;return this[m]=!0,m}}),T.ajaxPrefilter("json jsonp",function(m,x,M){var w,N,F,D=m.jsonp!==!1&&(bi.test(m.url)?"url":typeof m.data=="string"&&(m.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&bi.test(m.data)&&"data");if(D||m.dataTypes[0]==="jsonp")return w=m.jsonpCallback=v(m.jsonpCallback)?m.jsonpCallback():m.jsonpCallback,D?m[D]=m[D].replace(bi,"$1"+w):m.jsonp!==!1&&(m.url+=(yi.test(m.url)?"&":"?")+m.jsonp+"="+w),m.converters["script json"]=function(){return F||T.error(w+" was not called"),F[0]},m.dataTypes[0]="json",N=e[w],e[w]=function(){F=arguments},M.always(function(){N===void 0?T(e).removeProp(w):e[w]=N,m[w]&&(m.jsonpCallback=x.jsonpCallback,en.push(w)),F&&v(N)&&N(F[0]),F=N=void 0}),"script"}),S.createHTMLDocument=(function(){var m=A.implementation.createHTMLDocument("").body;return m.innerHTML="<form></form><form></form>",m.childNodes.length===2})(),T.parseHTML=function(m,x,M){if(typeof m!="string")return[];typeof x=="boolean"&&(M=x,x=!1);var w,N,F;return x||(S.createHTMLDocument?(x=A.implementation.createHTMLDocument(""),w=x.createElement("base"),w.href=A.location.href,x.head.appendChild(w)):x=A),N=p.exec(m),F=!M&&[],N?[x.createElement(N[1])]:(N=dt([m],x,F),F&&F.length&&T(F).remove(),T.merge([],N.childNodes))},T.fn.load=function(m,x,M){var w,N,F,D=this,X=m.indexOf(" ");return X>-1&&(w=Ht(m.slice(X)),m=m.slice(0,X)),v(x)?(M=x,x=void 0):x&&typeof x=="object"&&(N="POST"),D.length>0&&T.ajax({url:m,type:N||"GET",dataType:"html",data:x}).done(function(W){F=arguments,D.html(w?T("<div>").append(T.parseHTML(W)).find(w):W)}).always(M&&function(W,Q){D.each(function(){M.apply(this,F||[W.responseText,Q,W])})}),this},T.expr.pseudos.animated=function(m){return T.grep(T.timers,function(x){return m===x.elem}).length},T.offset={setOffset:function(m,x,M){var w,N,F,D,X,W,Q,fe=T.css(m,"position"),_e=T(m),oe={};fe==="static"&&(m.style.position="relative"),X=_e.offset(),F=T.css(m,"top"),W=T.css(m,"left"),Q=(fe==="absolute"||fe==="fixed")&&(F+W).indexOf("auto")>-1,Q?(w=_e.position(),D=w.top,N=w.left):(D=parseFloat(F)||0,N=parseFloat(W)||0),v(x)&&(x=x.call(m,M,T.extend({},X))),x.top!=null&&(oe.top=x.top-X.top+D),x.left!=null&&(oe.left=x.left-X.left+N),"using"in x?x.using.call(m,oe):_e.css(oe)}},T.fn.extend({offset:function(m){if(arguments.length)return m===void 0?this:this.each(function(N){T.offset.setOffset(this,m,N)});var x,M,w=this[0];if(w)return w.getClientRects().length?(x=w.getBoundingClientRect(),M=w.ownerDocument.defaultView,{top:x.top+M.pageYOffset,left:x.left+M.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var m,x,M,w=this[0],N={top:0,left:0};if(T.css(w,"position")==="fixed")x=w.getBoundingClientRect();else{for(x=this.offset(),M=w.ownerDocument,m=w.offsetParent||M.documentElement;m&&(m===M.body||m===M.documentElement)&&T.css(m,"position")==="static";)m=m.parentNode;m&&m!==w&&m.nodeType===1&&(N=T(m).offset(),N.top+=T.css(m,"borderTopWidth",!0),N.left+=T.css(m,"borderLeftWidth",!0))}return{top:x.top-N.top-T.css(w,"marginTop",!0),left:x.left-N.left-T.css(w,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var m=this.offsetParent;m&&T.css(m,"position")==="static";)m=m.offsetParent;return m||J})}}),T.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(m,x){var M=x==="pageYOffset";T.fn[m]=function(w){return Ee(this,function(N,F,D){var X;if(I(N)?X=N:N.nodeType===9&&(X=N.defaultView),D===void 0)return X?X[x]:N[F];X?X.scrollTo(M?X.pageXOffset:D,M?D:X.pageYOffset):N[F]=D},m,w,arguments.length)}}),T.each(["top","left"],function(m,x){T.cssHooks[x]=Di(S.pixelPosition,function(M,w){if(w)return w=Zt(M,x),di.test(w)?T(M).position()[x]+"px":w})}),T.each({Height:"height",Width:"width"},function(m,x){T.each({padding:"inner"+m,content:x,"":"outer"+m},function(M,w){T.fn[w]=function(N,F){var D=arguments.length&&(M||typeof N!="boolean"),X=M||(N===!0||F===!0?"margin":"border");return Ee(this,function(W,Q,fe){var _e;return I(W)?w.indexOf("outer")===0?W["inner"+m]:W.document.documentElement["client"+m]:W.nodeType===9?(_e=W.documentElement,Math.max(W.body["scroll"+m],_e["scroll"+m],W.body["offset"+m],_e["offset"+m],_e["client"+m])):fe===void 0?T.css(W,Q,X):T.style(W,Q,fe,X)},x,D?N:void 0,D)}})}),T.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(m,x){T.fn[x]=function(M){return this.on(x,M)}}),T.fn.extend({bind:function(m,x,M){return this.on(m,null,x,M)},unbind:function(m,x){return this.off(m,null,x)},delegate:function(m,x,M,w){return this.on(x,m,M,w)},undelegate:function(m,x,M){return arguments.length===1?this.off(m,"**"):this.off(x,m||"**",M)},hover:function(m,x){return this.on("mouseenter",m).on("mouseleave",x||m)}}),T.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(m,x){T.fn[x]=function(M,w){return arguments.length>0?this.on(x,null,M,w):this.trigger(x)}});var Gn=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;T.proxy=function(m,x){var M,w,N;if(typeof x=="string"&&(M=m[x],x=m,m=M),!!v(m))return w=r.call(arguments,2),N=function(){return m.apply(x||this,w.concat(r.call(arguments)))},N.guid=m.guid=m.guid||T.guid++,N},T.holdReady=function(m){m?T.readyWait++:T.ready(!0)},T.isArray=Array.isArray,T.parseJSON=JSON.parse,T.nodeName=te,T.isFunction=v,T.isWindow=I,T.camelCase=De,T.type=k,T.now=Date.now,T.isNumeric=function(m){var x=T.type(m);return(x==="number"||x==="string")&&!isNaN(m-parseFloat(m))},T.trim=function(m){return m==null?"":(m+"").replace(Gn,"$1")};var Un=e.jQuery,Vn=e.$;return T.noConflict=function(m){return e.$===T&&(e.$=Vn),m&&e.jQuery===T&&(e.jQuery=Un),T},typeof t>"u"&&(e.jQuery=e.$=T),T})})(jquery$1)),jquery$1.exports}var jqueryExports=requireJquery();const $=getDefaultExportFromCjs(jqueryExports);/*! jQuery UI - v1.13.3 - 2024-04-26
* https://jqueryui.com
* Includes: widget.js, position.js, data.js, disable-selection.js, effect.js, effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js, effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js, effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js, effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js, effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js, focusable.js, form-reset-mixin.js, jquery-patch.js, keycode.js, labels.js, scroll-parent.js, tabbable.js, unique-id.js, widgets/accordion.js, widgets/autocomplete.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/datepicker.js, widgets/dialog.js, widgets/draggable.js, widgets/droppable.js, widgets/menu.js, widgets/mouse.js, widgets/progressbar.js, widgets/resizable.js, widgets/selectable.js, widgets/selectmenu.js, widgets/slider.js, widgets/sortable.js, widgets/spinner.js, widgets/tabs.js, widgets/tooltip.js
* Copyright OpenJS Foundation and other contributors; Licensed MIT */(function(n){typeof define=="function"&&define.amd?define(["jquery"],n):n($)})(function(n){n.ui=n.ui||{},n.ui.version="1.13.3";/*!
 * jQuery UI Widget 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */var e=0,t=Array.prototype.hasOwnProperty,i=Array.prototype.slice;n.cleanData=(function(l){return function(u){var p,g,C;for(C=0;(g=u[C])!=null;C++)p=n._data(g,"events"),p&&p.remove&&n(g).triggerHandler("remove");l(u)}})(n.cleanData),n.widget=function(l,u,p){var g,C,b,P={},O=l.split(".")[0];l=l.split(".")[1];var L=O+"-"+l;return p||(p=u,u=n.Widget),Array.isArray(p)&&(p=n.extend.apply(null,[{}].concat(p))),n.expr.pseudos[L.toLowerCase()]=function(U){return!!n.data(U,L)},n[O]=n[O]||{},g=n[O][l],C=n[O][l]=function(U,H){if(!this||!this._createWidget)return new C(U,H);arguments.length&&this._createWidget(U,H)},n.extend(C,g,{version:p.version,_proto:n.extend({},p),_childConstructors:[]}),b=new u,b.options=n.widget.extend({},b.options),n.each(p,function(U,H){if(typeof H!="function"){P[U]=H;return}P[U]=(function(){function ee(){return u.prototype[U].apply(this,arguments)}function ae(Y){return u.prototype[U].apply(this,Y)}return function(){var Y=this._super,Z=this._superApply,ce;return this._super=ee,this._superApply=ae,ce=H.apply(this,arguments),this._super=Y,this._superApply=Z,ce}})()}),C.prototype=n.widget.extend(b,{widgetEventPrefix:g&&b.widgetEventPrefix||l},P,{constructor:C,namespace:O,widgetName:l,widgetFullName:L}),g?(n.each(g._childConstructors,function(U,H){var ee=H.prototype;n.widget(ee.namespace+"."+ee.widgetName,C,H._proto)}),delete g._childConstructors):u._childConstructors.push(C),n.widget.bridge(l,C),C},n.widget.extend=function(l){for(var u=i.call(arguments,1),p=0,g=u.length,C,b;p<g;p++)for(C in u[p])b=u[p][C],t.call(u[p],C)&&b!==void 0&&(n.isPlainObject(b)?l[C]=n.isPlainObject(l[C])?n.widget.extend({},l[C],b):n.widget.extend({},b):l[C]=b);return l},n.widget.bridge=function(l,u){var p=u.prototype.widgetFullName||l;n.fn[l]=function(g){var C=typeof g=="string",b=i.call(arguments,1),P=this;return C?!this.length&&g==="instance"?P=void 0:this.each(function(){var O,L=n.data(this,p);if(g==="instance")return P=L,!1;if(!L)return n.error("cannot call methods on "+l+" prior to initialization; attempted to call method '"+g+"'");if(typeof L[g]!="function"||g.charAt(0)==="_")return n.error("no such method '"+g+"' for "+l+" widget instance");if(O=L[g].apply(L,b),O!==L&&O!==void 0)return P=O&&O.jquery?P.pushStack(O.get()):O,!1}):(b.length&&(g=n.widget.extend.apply(null,[g].concat(b))),this.each(function(){var O=n.data(this,p);O?(O.option(g||{}),O._init&&O._init()):n.data(this,p,new u(g,this))})),P}},n.Widget=function(){},n.Widget._childConstructors=[],n.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(l,u){u=n(u||this.defaultElement||this)[0],this.element=n(u),this.uuid=e++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=n(),this.hoverable=n(),this.focusable=n(),this.classesElementLookup={},u!==this&&(n.data(u,this.widgetFullName,this),this._on(!0,this.element,{remove:function(p){p.target===u&&this.destroy()}}),this.document=n(u.style?u.ownerDocument:u.document||u),this.window=n(this.document[0].defaultView||this.document[0].parentWindow)),this.options=n.widget.extend({},this.options,this._getCreateOptions(),l),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:n.noop,_create:n.noop,_init:n.noop,destroy:function(){var l=this;this._destroy(),n.each(this.classesElementLookup,function(u,p){l._removeClass(p,u)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:n.noop,widget:function(){return this.element},option:function(l,u){var p=l,g,C,b;if(arguments.length===0)return n.widget.extend({},this.options);if(typeof l=="string")if(p={},g=l.split("."),l=g.shift(),g.length){for(C=p[l]=n.widget.extend({},this.options[l]),b=0;b<g.length-1;b++)C[g[b]]=C[g[b]]||{},C=C[g[b]];if(l=g.pop(),arguments.length===1)return C[l]===void 0?null:C[l];C[l]=u}else{if(arguments.length===1)return this.options[l]===void 0?null:this.options[l];p[l]=u}return this._setOptions(p),this},_setOptions:function(l){var u;for(u in l)this._setOption(u,l[u]);return this},_setOption:function(l,u){return l==="classes"&&this._setOptionClasses(u),this.options[l]=u,l==="disabled"&&this._setOptionDisabled(u),this},_setOptionClasses:function(l){var u,p,g;for(u in l)g=this.classesElementLookup[u],!(l[u]===this.options.classes[u]||!g||!g.length)&&(p=n(g.get()),this._removeClass(g,u),p.addClass(this._classes({element:p,keys:u,classes:l,add:!0})))},_setOptionDisabled:function(l){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!l),l&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(l){var u=[],p=this;l=n.extend({element:this.element,classes:this.options.classes||{}},l);function g(){var b=[];l.element.each(function(P,O){var L=n.map(p.classesElementLookup,function(U){return U}).some(function(U){return U.is(O)});L||b.push(O)}),p._on(n(b),{remove:"_untrackClassesElement"})}function C(b,P){var O,L;for(L=0;L<b.length;L++)O=p.classesElementLookup[b[L]]||n(),l.add?(g(),O=n(n.uniqueSort(O.get().concat(l.element.get())))):O=n(O.not(l.element).get()),p.classesElementLookup[b[L]]=O,u.push(b[L]),P&&l.classes[b[L]]&&u.push(l.classes[b[L]])}return l.keys&&C(l.keys.match(/\S+/g)||[],!0),l.extra&&C(l.extra.match(/\S+/g)||[]),u.join(" ")},_untrackClassesElement:function(l){var u=this;n.each(u.classesElementLookup,function(p,g){n.inArray(l.target,g)!==-1&&(u.classesElementLookup[p]=n(g.not(l.target).get()))}),this._off(n(l.target))},_removeClass:function(l,u,p){return this._toggleClass(l,u,p,!1)},_addClass:function(l,u,p){return this._toggleClass(l,u,p,!0)},_toggleClass:function(l,u,p,g){g=typeof g=="boolean"?g:p;var C=typeof l=="string"||l===null,b={extra:C?u:p,keys:C?l:u,element:C?this.element:l,add:g};return b.element.toggleClass(this._classes(b),g),this},_on:function(l,u,p){var g,C=this;typeof l!="boolean"&&(p=u,u=l,l=!1),p?(u=g=n(u),this.bindings=this.bindings.add(u)):(p=u,u=this.element,g=this.widget()),n.each(p,function(b,P){function O(){if(!(!l&&(C.options.disabled===!0||n(this).hasClass("ui-state-disabled"))))return(typeof P=="string"?C[P]:P).apply(C,arguments)}typeof P!="string"&&(O.guid=P.guid=P.guid||O.guid||n.guid++);var L=b.match(/^([\w:-]*)\s*(.*)$/),U=L[1]+C.eventNamespace,H=L[2];H?g.on(U,H,O):u.on(U,O)})},_off:function(l,u){u=(u||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,l.off(u),this.bindings=n(this.bindings.not(l).get()),this.focusable=n(this.focusable.not(l).get()),this.hoverable=n(this.hoverable.not(l).get())},_delay:function(l,u){function p(){return(typeof l=="string"?g[l]:l).apply(g,arguments)}var g=this;return setTimeout(p,u||0)},_hoverable:function(l){this.hoverable=this.hoverable.add(l),this._on(l,{mouseenter:function(u){this._addClass(n(u.currentTarget),null,"ui-state-hover")},mouseleave:function(u){this._removeClass(n(u.currentTarget),null,"ui-state-hover")}})},_focusable:function(l){this.focusable=this.focusable.add(l),this._on(l,{focusin:function(u){this._addClass(n(u.currentTarget),null,"ui-state-focus")},focusout:function(u){this._removeClass(n(u.currentTarget),null,"ui-state-focus")}})},_trigger:function(l,u,p){var g,C,b=this.options[l];if(p=p||{},u=n.Event(u),u.type=(l===this.widgetEventPrefix?l:this.widgetEventPrefix+l).toLowerCase(),u.target=this.element[0],C=u.originalEvent,C)for(g in C)g in u||(u[g]=C[g]);return this.element.trigger(u,p),!(typeof b=="function"&&b.apply(this.element[0],[u].concat(p))===!1||u.isDefaultPrevented())}},n.each({show:"fadeIn",hide:"fadeOut"},function(l,u){n.Widget.prototype["_"+l]=function(p,g,C){typeof g=="string"&&(g={effect:g});var b,P=g?g===!0||typeof g=="number"?u:g.effect||u:l;g=g||{},typeof g=="number"?g={duration:g}:g===!0&&(g={}),b=!n.isEmptyObject(g),g.complete=C,g.delay&&p.delay(g.delay),b&&n.effects&&n.effects.effect[P]?p[l](g):P!==l&&p[P]?p[P](g.duration,g.easing,C):p.queue(function(O){n(this)[l](),C&&C.call(p[0]),O()})}}),n.widget;/*!
 * jQuery UI Position 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 *
 * https://api.jqueryui.com/position/
 */(function(){var l,u=Math.max,p=Math.abs,g=/left|center|right/,C=/top|center|bottom/,b=/[\+\-]\d+(\.[\d]+)?%?/,P=/^\w+/,O=/%$/,L=n.fn.position;function U(Y,Z,ce){return[parseFloat(Y[0])*(O.test(Y[0])?Z/100:1),parseFloat(Y[1])*(O.test(Y[1])?ce/100:1)]}function H(Y,Z){return parseInt(n.css(Y,Z),10)||0}function ee(Y){return Y!=null&&Y===Y.window}function ae(Y){var Z=Y[0];return Z.nodeType===9?{width:Y.width(),height:Y.height(),offset:{top:0,left:0}}:ee(Z)?{width:Y.width(),height:Y.height(),offset:{top:Y.scrollTop(),left:Y.scrollLeft()}}:Z.preventDefault?{width:0,height:0,offset:{top:Z.pageY,left:Z.pageX}}:{width:Y.outerWidth(),height:Y.outerHeight(),offset:Y.offset()}}n.position={scrollbarWidth:function(){if(l!==void 0)return l;var Y,Z,ce=n("<div style='display:block;position:absolute;width:200px;height:200px;overflow:hidden;'><div style='height:300px;width:auto;'></div></div>"),ye=ce.children()[0];return n("body").append(ce),Y=ye.offsetWidth,ce.css("overflow","scroll"),Z=ye.offsetWidth,Y===Z&&(Z=ce[0].clientWidth),ce.remove(),l=Y-Z},getScrollInfo:function(Y){var Z=Y.isWindow||Y.isDocument?"":Y.element.css("overflow-x"),ce=Y.isWindow||Y.isDocument?"":Y.element.css("overflow-y"),ye=Z==="scroll"||Z==="auto"&&Y.width<Y.element[0].scrollWidth,ve=ce==="scroll"||ce==="auto"&&Y.height<Y.element[0].scrollHeight;return{width:ve?n.position.scrollbarWidth():0,height:ye?n.position.scrollbarWidth():0}},getWithinInfo:function(Y){var Z=n(Y||window),ce=ee(Z[0]),ye=!!Z[0]&&Z[0].nodeType===9,ve=!ce&&!ye;return{element:Z,isWindow:ce,isDocument:ye,offset:ve?n(Y).offset():{left:0,top:0},scrollLeft:Z.scrollLeft(),scrollTop:Z.scrollTop(),width:Z.outerWidth(),height:Z.outerHeight()}}},n.fn.position=function(Y){if(!Y||!Y.of)return L.apply(this,arguments);Y=n.extend({},Y);var Z,ce,ye,ve,Ee,Re,Ne=typeof Y.of=="string"?n(document).find(Y.of):n(Y.of),Fe=n.position.getWithinInfo(Y.within),De=n.position.getScrollInfo(Fe),Ae=(Y.collision||"flip").split(" "),Ue={};return Re=ae(Ne),Ne[0].preventDefault&&(Y.at="left top"),ce=Re.width,ye=Re.height,ve=Re.offset,Ee=n.extend({},ve),n.each(["my","at"],function(){var Ce=(Y[this]||"").split(" "),Oe,Ve;Ce.length===1&&(Ce=g.test(Ce[0])?Ce.concat(["center"]):C.test(Ce[0])?["center"].concat(Ce):["center","center"]),Ce[0]=g.test(Ce[0])?Ce[0]:"center",Ce[1]=C.test(Ce[1])?Ce[1]:"center",Oe=b.exec(Ce[0]),Ve=b.exec(Ce[1]),Ue[this]=[Oe?Oe[0]:0,Ve?Ve[0]:0],Y[this]=[P.exec(Ce[0])[0],P.exec(Ce[1])[0]]}),Ae.length===1&&(Ae[1]=Ae[0]),Y.at[0]==="right"?Ee.left+=ce:Y.at[0]==="center"&&(Ee.left+=ce/2),Y.at[1]==="bottom"?Ee.top+=ye:Y.at[1]==="center"&&(Ee.top+=ye/2),Z=U(Ue.at,ce,ye),Ee.left+=Z[0],Ee.top+=Z[1],this.each(function(){var Ce,Oe,Ve=n(this),tt=Ve.outerWidth(),it=Ve.outerHeight(),ct=H(this,"marginLeft"),mt=H(this,"marginTop"),st=tt+ct+H(this,"marginRight")+De.width,ut=it+mt+H(this,"marginBottom")+De.height,J=n.extend({},Ee),ze=U(Ue.my,Ve.outerWidth(),Ve.outerHeight());Y.my[0]==="right"?J.left-=tt:Y.my[0]==="center"&&(J.left-=tt/2),Y.my[1]==="bottom"?J.top-=it:Y.my[1]==="center"&&(J.top-=it/2),J.left+=ze[0],J.top+=ze[1],Ce={marginLeft:ct,marginTop:mt},n.each(["left","top"],function(pt,ot){n.ui.position[Ae[pt]]&&n.ui.position[Ae[pt]][ot](J,{targetWidth:ce,targetHeight:ye,elemWidth:tt,elemHeight:it,collisionPosition:Ce,collisionWidth:st,collisionHeight:ut,offset:[Z[0]+ze[0],Z[1]+ze[1]],my:Y.my,at:Y.at,within:Fe,elem:Ve})}),Y.using&&(Oe=function(pt){var ot=ve.left-J.left,Ct=ot+ce-tt,St=ve.top-J.top,vt=St+ye-it,at={target:{element:Ne,left:ve.left,top:ve.top,width:ce,height:ye},element:{element:Ve,left:J.left,top:J.top,width:tt,height:it},horizontal:Ct<0?"left":ot>0?"right":"center",vertical:vt<0?"top":St>0?"bottom":"middle"};ce<tt&&p(ot+Ct)<ce&&(at.horizontal="center"),ye<it&&p(St+vt)<ye&&(at.vertical="middle"),u(p(ot),p(Ct))>u(p(St),p(vt))?at.important="horizontal":at.important="vertical",Y.using.call(this,pt,at)}),Ve.offset(n.extend(J,{using:Oe}))})},n.ui.position={fit:{left:function(Y,Z){var ce=Z.within,ye=ce.isWindow?ce.scrollLeft:ce.offset.left,ve=ce.width,Ee=Y.left-Z.collisionPosition.marginLeft,Re=ye-Ee,Ne=Ee+Z.collisionWidth-ve-ye,Fe;Z.collisionWidth>ve?Re>0&&Ne<=0?(Fe=Y.left+Re+Z.collisionWidth-ve-ye,Y.left+=Re-Fe):Ne>0&&Re<=0?Y.left=ye:Re>Ne?Y.left=ye+ve-Z.collisionWidth:Y.left=ye:Re>0?Y.left+=Re:Ne>0?Y.left-=Ne:Y.left=u(Y.left-Ee,Y.left)},top:function(Y,Z){var ce=Z.within,ye=ce.isWindow?ce.scrollTop:ce.offset.top,ve=Z.within.height,Ee=Y.top-Z.collisionPosition.marginTop,Re=ye-Ee,Ne=Ee+Z.collisionHeight-ve-ye,Fe;Z.collisionHeight>ve?Re>0&&Ne<=0?(Fe=Y.top+Re+Z.collisionHeight-ve-ye,Y.top+=Re-Fe):Ne>0&&Re<=0?Y.top=ye:Re>Ne?Y.top=ye+ve-Z.collisionHeight:Y.top=ye:Re>0?Y.top+=Re:Ne>0?Y.top-=Ne:Y.top=u(Y.top-Ee,Y.top)}},flip:{left:function(Y,Z){var ce=Z.within,ye=ce.offset.left+ce.scrollLeft,ve=ce.width,Ee=ce.isWindow?ce.scrollLeft:ce.offset.left,Re=Y.left-Z.collisionPosition.marginLeft,Ne=Re-Ee,Fe=Re+Z.collisionWidth-ve-Ee,De=Z.my[0]==="left"?-Z.elemWidth:Z.my[0]==="right"?Z.elemWidth:0,Ae=Z.at[0]==="left"?Z.targetWidth:Z.at[0]==="right"?-Z.targetWidth:0,Ue=-2*Z.offset[0],Ce,Oe;Ne<0?(Ce=Y.left+De+Ae+Ue+Z.collisionWidth-ve-ye,(Ce<0||Ce<p(Ne))&&(Y.left+=De+Ae+Ue)):Fe>0&&(Oe=Y.left-Z.collisionPosition.marginLeft+De+Ae+Ue-Ee,(Oe>0||p(Oe)<Fe)&&(Y.left+=De+Ae+Ue))},top:function(Y,Z){var ce=Z.within,ye=ce.offset.top+ce.scrollTop,ve=ce.height,Ee=ce.isWindow?ce.scrollTop:ce.offset.top,Re=Y.top-Z.collisionPosition.marginTop,Ne=Re-Ee,Fe=Re+Z.collisionHeight-ve-Ee,De=Z.my[1]==="top",Ae=De?-Z.elemHeight:Z.my[1]==="bottom"?Z.elemHeight:0,Ue=Z.at[1]==="top"?Z.targetHeight:Z.at[1]==="bottom"?-Z.targetHeight:0,Ce=-2*Z.offset[1],Oe,Ve;Ne<0?(Ve=Y.top+Ae+Ue+Ce+Z.collisionHeight-ve-ye,(Ve<0||Ve<p(Ne))&&(Y.top+=Ae+Ue+Ce)):Fe>0&&(Oe=Y.top-Z.collisionPosition.marginTop+Ae+Ue+Ce-Ee,(Oe>0||p(Oe)<Fe)&&(Y.top+=Ae+Ue+Ce))}},flipfit:{left:function(){n.ui.position.flip.left.apply(this,arguments),n.ui.position.fit.left.apply(this,arguments)},top:function(){n.ui.position.flip.top.apply(this,arguments),n.ui.position.fit.top.apply(this,arguments)}}}})(),n.ui.position;/*!
 * jQuery UI :data 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.extend(n.expr.pseudos,{data:n.expr.createPseudo?n.expr.createPseudo(function(l){return function(u){return!!n.data(u,l)}}):function(l,u,p){return!!n.data(l,p[3])}});/*!
 * jQuery UI Disable Selection 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.fn.extend({disableSelection:(function(){var l="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(l+".ui-disableSelection",function(u){u.preventDefault()})}})(),enableSelection:function(){return this.off(".ui-disableSelection")}});var s=n;/*!
 * jQuery Color Animations v2.2.0
 * https://github.com/jquery/jquery-color
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 *
 * Date: Sun May 10 09:02:36 2020 +0200
 */var r="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",o={},a=o.toString,h=/^([\-+])=\s*(\d+\.?\d*)/,c=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(l){return[l[1],l[2],l[3],l[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(l){return[l[1]*2.55,l[2]*2.55,l[3]*2.55,l[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?/,parse:function(l){return[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16),l[4]?(parseInt(l[4],16)/255).toFixed(2):1]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?/,parse:function(l){return[parseInt(l[1]+l[1],16),parseInt(l[2]+l[2],16),parseInt(l[3]+l[3],16),l[4]?(parseInt(l[4]+l[4],16)/255).toFixed(2):1]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(l){return[l[1],l[2]/100,l[3]/100,l[4]]}}],d=s.Color=function(l,u,p,g){return new s.Color.fn.parse(l,u,p,g)},f={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},_={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},y=d.support={},S=s("<p>")[0],v,I=s.each;S.style.cssText="background-color:rgba(1,1,1,.5)",y.rgba=S.style.backgroundColor.indexOf("rgba")>-1,I(f,function(l,u){u.cache="_"+l,u.props.alpha={idx:3,type:"percent",def:1}}),s.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(l,u){o["[object "+u+"]"]=u.toLowerCase()});function A(l){return l==null?l+"":typeof l=="object"?o[a.call(l)]||"object":typeof l}function B(l,u,p){var g=_[u.type]||{};return l==null?p||!u.def?null:u.def:(l=g.floor?~~l:parseFloat(l),isNaN(l)?u.def:g.mod?(l+g.mod)%g.mod:Math.min(g.max,Math.max(0,l)))}function G(l){var u=d(),p=u._rgba=[];return l=l.toLowerCase(),I(c,function(g,C){var b,P=C.re.exec(l),O=P&&C.parse(P),L=C.space||"rgba";if(O)return b=u[L](O),u[f[L].cache]=b[f[L].cache],p=u._rgba=b._rgba,!1}),p.length?(p.join()==="0,0,0,0"&&s.extend(p,v.transparent),u):v[l]}d.fn=s.extend(d.prototype,{parse:function(l,u,p,g){if(l===void 0)return this._rgba=[null,null,null,null],this;(l.jquery||l.nodeType)&&(l=s(l).css(u),u=void 0);var C=this,b=A(l),P=this._rgba=[];if(u!==void 0&&(l=[l,u,p,g],b="array"),b==="string")return this.parse(G(l)||v._default);if(b==="array")return I(f.rgba.props,function(O,L){P[L.idx]=B(l[L.idx],L)}),this;if(b==="object")return l instanceof d?I(f,function(O,L){l[L.cache]&&(C[L.cache]=l[L.cache].slice())}):I(f,function(O,L){var U=L.cache;I(L.props,function(H,ee){if(!C[U]&&L.to){if(H==="alpha"||l[H]==null)return;C[U]=L.to(C._rgba)}C[U][ee.idx]=B(l[H],ee,!0)}),C[U]&&s.inArray(null,C[U].slice(0,3))<0&&(C[U][3]==null&&(C[U][3]=1),L.from&&(C._rgba=L.from(C[U])))}),this},is:function(l){var u=d(l),p=!0,g=this;return I(f,function(C,b){var P,O=u[b.cache];return O&&(P=g[b.cache]||b.to&&b.to(g._rgba)||[],I(b.props,function(L,U){if(O[U.idx]!=null)return p=O[U.idx]===P[U.idx],p})),p}),p},_space:function(){var l=[],u=this;return I(f,function(p,g){u[g.cache]&&l.push(p)}),l.pop()},transition:function(l,u){var p=d(l),g=p._space(),C=f[g],b=this.alpha()===0?d("transparent"):this,P=b[C.cache]||C.to(b._rgba),O=P.slice();return p=p[C.cache],I(C.props,function(L,U){var H=U.idx,ee=P[H],ae=p[H],Y=_[U.type]||{};ae!==null&&(ee===null?O[H]=ae:(Y.mod&&(ae-ee>Y.mod/2?ee+=Y.mod:ee-ae>Y.mod/2&&(ee-=Y.mod)),O[H]=B((ae-ee)*u+ee,U)))}),this[g](O)},blend:function(l){if(this._rgba[3]===1)return this;var u=this._rgba.slice(),p=u.pop(),g=d(l)._rgba;return d(s.map(u,function(C,b){return(1-p)*g[b]+p*C}))},toRgbaString:function(){var l="rgba(",u=s.map(this._rgba,function(p,g){return p??(g>2?1:0)});return u[3]===1&&(u.pop(),l="rgb("),l+u.join()+")"},toHslaString:function(){var l="hsla(",u=s.map(this.hsla(),function(p,g){return p==null&&(p=g>2?1:0),g&&g<3&&(p=Math.round(p*100)+"%"),p});return u[3]===1&&(u.pop(),l="hsl("),l+u.join()+")"},toHexString:function(l){var u=this._rgba.slice(),p=u.pop();return l&&u.push(~~(p*255)),"#"+s.map(u,function(g){return g=(g||0).toString(16),g.length===1?"0"+g:g}).join("")},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString()}}),d.fn.parse.prototype=d.fn;function k(l,u,p){return p=(p+1)%1,p*6<1?l+(u-l)*p*6:p*2<1?u:p*3<2?l+(u-l)*(2/3-p)*6:l}f.hsla.to=function(l){if(l[0]==null||l[1]==null||l[2]==null)return[null,null,null,l[3]];var u=l[0]/255,p=l[1]/255,g=l[2]/255,C=l[3],b=Math.max(u,p,g),P=Math.min(u,p,g),O=b-P,L=b+P,U=L*.5,H,ee;return P===b?H=0:u===b?H=60*(p-g)/O+360:p===b?H=60*(g-u)/O+120:H=60*(u-p)/O+240,O===0?ee=0:U<=.5?ee=O/L:ee=O/(2-L),[Math.round(H)%360,ee,U,C??1]},f.hsla.from=function(l){if(l[0]==null||l[1]==null||l[2]==null)return[null,null,null,l[3]];var u=l[0]/360,p=l[1],g=l[2],C=l[3],b=g<=.5?g*(1+p):g+p-g*p,P=2*g-b;return[Math.round(k(P,b,u+1/3)*255),Math.round(k(P,b,u)*255),Math.round(k(P,b,u-1/3)*255),C]},I(f,function(l,u){var p=u.props,g=u.cache,C=u.to,b=u.from;d.fn[l]=function(P){if(C&&!this[g]&&(this[g]=C(this._rgba)),P===void 0)return this[g].slice();var O,L=A(P),U=L==="array"||L==="object"?P:arguments,H=this[g].slice();return I(p,function(ee,ae){var Y=U[L==="object"?ee:ae.idx];Y==null&&(Y=H[ae.idx]),H[ae.idx]=B(Y,ae)}),b?(O=d(b(H)),O[g]=H,O):d(H)},I(p,function(P,O){d.fn[P]||(d.fn[P]=function(L){var U,H,ee,ae,Y=A(L);return P==="alpha"?ae=this._hsla?"hsla":"rgba":ae=l,U=this[ae](),H=U[O.idx],Y==="undefined"?H:(Y==="function"&&(L=L.call(this,H),Y=A(L)),L==null&&O.empty?this:(Y==="string"&&(ee=h.exec(L),ee&&(L=H+parseFloat(ee[2])*(ee[1]==="+"?1:-1))),U[O.idx]=L,this[ae](U)))})})}),d.hook=function(l){var u=l.split(" ");I(u,function(p,g){s.cssHooks[g]={set:function(C,b){var P,O,L="";if(b!=="transparent"&&(A(b)!=="string"||(P=G(b)))){if(b=d(P||b),!y.rgba&&b._rgba[3]!==1){for(O=g==="backgroundColor"?C.parentNode:C;(L===""||L==="transparent")&&O&&O.style;)try{L=s.css(O,"backgroundColor"),O=O.parentNode}catch{}b=b.blend(L&&L!=="transparent"?L:"_default")}b=b.toRgbaString()}try{C.style[g]=b}catch{}}},s.fx.step[g]=function(C){C.colorInit||(C.start=d(C.elem,g),C.end=d(C.end),C.colorInit=!0),s.cssHooks[g].set(C.elem,C.start.transition(C.end,C.pos))}})},d.hook(r),s.cssHooks.borderColor={expand:function(l){var u={};return I(["Top","Right","Bottom","Left"],function(p,g){u["border"+g+"Color"]=l}),u}},v=s.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"};/*!
 * jQuery UI Effects 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */var z="ui-effects-",q="ui-effects-style",T="ui-effects-animated";n.effects={effect:{}},(function(){var l=["add","remove","toggle"],u={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};n.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(b,P){n.fx.step[P]=function(O){(O.end!=="none"&&!O.setAttr||O.pos===1&&!O.setAttr)&&(s.style(O.elem,P,O.end),O.setAttr=!0)}});function p(b){return b.replace(/-([\da-z])/gi,function(P,O){return O.toUpperCase()})}function g(b){var P,O,L=b.ownerDocument.defaultView?b.ownerDocument.defaultView.getComputedStyle(b,null):b.currentStyle,U={};if(L&&L.length&&L[0]&&L[L[0]])for(O=L.length;O--;)P=L[O],typeof L[P]=="string"&&(U[p(P)]=L[P]);else for(P in L)typeof L[P]=="string"&&(U[P]=L[P]);return U}function C(b,P){var O={},L,U;for(L in P)U=P[L],b[L]!==U&&(u[L]||(n.fx.step[L]||!isNaN(parseFloat(U)))&&(O[L]=U));return O}n.fn.addBack||(n.fn.addBack=function(b){return this.add(b==null?this.prevObject:this.prevObject.filter(b))}),n.effects.animateClass=function(b,P,O,L){var U=n.speed(P,O,L);return this.queue(function(){var H=n(this),ee=H.attr("class")||"",ae,Y=U.children?H.find("*").addBack():H;Y=Y.map(function(){var Z=n(this);return{el:Z,start:g(this)}}),ae=function(){n.each(l,function(Z,ce){b[ce]&&H[ce+"Class"](b[ce])})},ae(),Y=Y.map(function(){return this.end=g(this.el[0]),this.diff=C(this.start,this.end),this}),H.attr("class",ee),Y=Y.map(function(){var Z=this,ce=n.Deferred(),ye=n.extend({},U,{queue:!1,complete:function(){ce.resolve(Z)}});return this.el.animate(this.diff,ye),ce.promise()}),n.when.apply(n,Y.get()).done(function(){ae(),n.each(arguments,function(){var Z=this.el;n.each(this.diff,function(ce){Z.css(ce,"")})}),U.complete.call(H[0])})})},n.fn.extend({addClass:(function(b){return function(P,O,L,U){return O?n.effects.animateClass.call(this,{add:P},O,L,U):b.apply(this,arguments)}})(n.fn.addClass),removeClass:(function(b){return function(P,O,L,U){return arguments.length>1?n.effects.animateClass.call(this,{remove:P},O,L,U):b.apply(this,arguments)}})(n.fn.removeClass),toggleClass:(function(b){return function(P,O,L,U,H){return typeof O=="boolean"||O===void 0?L?n.effects.animateClass.call(this,O?{add:P}:{remove:P},L,U,H):b.apply(this,arguments):n.effects.animateClass.call(this,{toggle:P},O,L,U)}})(n.fn.toggleClass),switchClass:function(b,P,O,L,U){return n.effects.animateClass.call(this,{add:P,remove:b},O,L,U)}})})(),(function(){n.expr&&n.expr.pseudos&&n.expr.pseudos.animated&&(n.expr.pseudos.animated=(function(g){return function(C){return!!n(C).data(T)||g(C)}})(n.expr.pseudos.animated)),n.uiBackCompat!==!1&&n.extend(n.effects,{save:function(g,C){for(var b=0,P=C.length;b<P;b++)C[b]!==null&&g.data(z+C[b],g[0].style[C[b]])},restore:function(g,C){for(var b,P=0,O=C.length;P<O;P++)C[P]!==null&&(b=g.data(z+C[P]),g.css(C[P],b))},setMode:function(g,C){return C==="toggle"&&(C=g.is(":hidden")?"show":"hide"),C},createWrapper:function(g){if(g.parent().is(".ui-effects-wrapper"))return g.parent();var C={width:g.outerWidth(!0),height:g.outerHeight(!0),float:g.css("float")},b=n("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),P={width:g.width(),height:g.height()},O=document.activeElement;try{O.id}catch{O=document.body}return g.wrap(b),(g[0]===O||n.contains(g[0],O))&&n(O).trigger("focus"),b=g.parent(),g.css("position")==="static"?(b.css({position:"relative"}),g.css({position:"relative"})):(n.extend(C,{position:g.css("position"),zIndex:g.css("z-index")}),n.each(["top","left","bottom","right"],function(L,U){C[U]=g.css(U),isNaN(parseInt(C[U],10))&&(C[U]="auto")}),g.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),g.css(P),b.css(C).show()},removeWrapper:function(g){var C=document.activeElement;return g.parent().is(".ui-effects-wrapper")&&(g.parent().replaceWith(g),(g[0]===C||n.contains(g[0],C))&&n(C).trigger("focus")),g}}),n.extend(n.effects,{version:"1.13.3",define:function(g,C,b){return b||(b=C,C="effect"),n.effects.effect[g]=b,n.effects.effect[g].mode=C,b},scaledDimensions:function(g,C,b){if(C===0)return{height:0,width:0,outerHeight:0,outerWidth:0};var P=b!=="horizontal"?(C||100)/100:1,O=b!=="vertical"?(C||100)/100:1;return{height:g.height()*O,width:g.width()*P,outerHeight:g.outerHeight()*O,outerWidth:g.outerWidth()*P}},clipToBox:function(g){return{width:g.clip.right-g.clip.left,height:g.clip.bottom-g.clip.top,left:g.clip.left,top:g.clip.top}},unshift:function(g,C,b){var P=g.queue();C>1&&P.splice.apply(P,[1,0].concat(P.splice(C,b))),g.dequeue()},saveStyle:function(g){g.data(q,g[0].style.cssText)},restoreStyle:function(g){g[0].style.cssText=g.data(q)||"",g.removeData(q)},mode:function(g,C){var b=g.is(":hidden");return C==="toggle"&&(C=b?"show":"hide"),(b?C==="hide":C==="show")&&(C="none"),C},getBaseline:function(g,C){var b,P;switch(g[0]){case"top":b=0;break;case"middle":b=.5;break;case"bottom":b=1;break;default:b=g[0]/C.height}switch(g[1]){case"left":P=0;break;case"center":P=.5;break;case"right":P=1;break;default:P=g[1]/C.width}return{x:P,y:b}},createPlaceholder:function(g){var C,b=g.css("position"),P=g.position();return g.css({marginTop:g.css("marginTop"),marginBottom:g.css("marginBottom"),marginLeft:g.css("marginLeft"),marginRight:g.css("marginRight")}).outerWidth(g.outerWidth()).outerHeight(g.outerHeight()),/^(static|relative)/.test(b)&&(b="absolute",C=n("<"+g[0].nodeName+">").insertAfter(g).css({display:/^(inline|ruby)/.test(g.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:g.css("marginTop"),marginBottom:g.css("marginBottom"),marginLeft:g.css("marginLeft"),marginRight:g.css("marginRight"),float:g.css("float")}).outerWidth(g.outerWidth()).outerHeight(g.outerHeight()).addClass("ui-effects-placeholder"),g.data(z+"placeholder",C)),g.css({position:b,left:P.left,top:P.top}),C},removePlaceholder:function(g){var C=z+"placeholder",b=g.data(C);b&&(b.remove(),g.removeData(C))},cleanUp:function(g){n.effects.restoreStyle(g),n.effects.removePlaceholder(g)},setTransition:function(g,C,b,P){return P=P||{},n.each(C,function(O,L){var U=g.cssUnit(L);U[0]>0&&(P[L]=U[0]*b+U[1])}),P}});function l(g,C,b,P){return n.isPlainObject(g)&&(C=g,g=g.effect),g={effect:g},C==null&&(C={}),typeof C=="function"&&(P=C,b=null,C={}),(typeof C=="number"||n.fx.speeds[C])&&(P=b,b=C,C={}),typeof b=="function"&&(P=b,b=null),C&&n.extend(g,C),b=b||C.duration,g.duration=n.fx.off?0:typeof b=="number"?b:b in n.fx.speeds?n.fx.speeds[b]:n.fx.speeds._default,g.complete=P||C.complete,g}function u(g){return!!(!g||typeof g=="number"||n.fx.speeds[g]||typeof g=="string"&&!n.effects.effect[g]||typeof g=="function"||typeof g=="object"&&!g.effect)}n.fn.extend({effect:function(){var g=l.apply(this,arguments),C=n.effects.effect[g.effect],b=C.mode,P=g.queue,O=P||"fx",L=g.complete,U=g.mode,H=[],ee=function(Y){var Z=n(this),ce=n.effects.mode(Z,U)||b;Z.data(T,!0),H.push(ce),b&&(ce==="show"||ce===b&&ce==="hide")&&Z.show(),(!b||ce!=="none")&&n.effects.saveStyle(Z),typeof Y=="function"&&Y()};if(n.fx.off||!C)return U?this[U](g.duration,L):this.each(function(){L&&L.call(this)});function ae(Y){var Z=n(this);function ce(){Z.removeData(T),n.effects.cleanUp(Z),g.mode==="hide"&&Z.hide(),ye()}function ye(){typeof L=="function"&&L.call(Z[0]),typeof Y=="function"&&Y()}g.mode=H.shift(),n.uiBackCompat!==!1&&!b?(Z.is(":hidden")?U==="hide":U==="show")?(Z[U](),ye()):C.call(Z[0],g,ye):g.mode==="none"?(Z[U](),ye()):C.call(Z[0],g,ce)}return P===!1?this.each(ee).each(ae):this.queue(O,ee).queue(O,ae)},show:(function(g){return function(C){if(u(C))return g.apply(this,arguments);var b=l.apply(this,arguments);return b.mode="show",this.effect.call(this,b)}})(n.fn.show),hide:(function(g){return function(C){if(u(C))return g.apply(this,arguments);var b=l.apply(this,arguments);return b.mode="hide",this.effect.call(this,b)}})(n.fn.hide),toggle:(function(g){return function(C){if(u(C)||typeof C=="boolean")return g.apply(this,arguments);var b=l.apply(this,arguments);return b.mode="toggle",this.effect.call(this,b)}})(n.fn.toggle),cssUnit:function(g){var C=this.css(g),b=[];return n.each(["em","px","%","pt"],function(P,O){C.indexOf(O)>0&&(b=[parseFloat(C),O])}),b},cssClip:function(g){return g?this.css("clip","rect("+g.top+"px "+g.right+"px "+g.bottom+"px "+g.left+"px)"):p(this.css("clip"),this)},transfer:function(g,C){var b=n(this),P=n(g.to),O=P.css("position")==="fixed",L=n("body"),U=O?L.scrollTop():0,H=O?L.scrollLeft():0,ee=P.offset(),ae={top:ee.top-U,left:ee.left-H,height:P.innerHeight(),width:P.innerWidth()},Y=b.offset(),Z=n("<div class='ui-effects-transfer'></div>");Z.appendTo("body").addClass(g.className).css({top:Y.top-U,left:Y.left-H,height:b.innerHeight(),width:b.innerWidth(),position:O?"fixed":"absolute"}).animate(ae,g.duration,g.easing,function(){Z.remove(),typeof C=="function"&&C()})}});function p(g,C){var b=C.outerWidth(),P=C.outerHeight(),O=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,L=O.exec(g)||["",0,b,P,0];return{top:parseFloat(L[1])||0,right:L[2]==="auto"?b:parseFloat(L[2]),bottom:L[3]==="auto"?P:parseFloat(L[3]),left:parseFloat(L[4])||0}}n.fx.step.clip=function(g){g.clipInit||(g.start=n(g.elem).cssClip(),typeof g.end=="string"&&(g.end=p(g.end,g.elem)),g.clipInit=!0),n(g.elem).cssClip({top:g.pos*(g.end.top-g.start.top)+g.start.top,right:g.pos*(g.end.right-g.start.right)+g.start.right,bottom:g.pos*(g.end.bottom-g.start.bottom)+g.start.bottom,left:g.pos*(g.end.left-g.start.left)+g.start.left})}})(),(function(){var l={};n.each(["Quad","Cubic","Quart","Quint","Expo"],function(u,p){l[p]=function(g){return Math.pow(g,u+2)}}),n.extend(l,{Sine:function(u){return 1-Math.cos(u*Math.PI/2)},Circ:function(u){return 1-Math.sqrt(1-u*u)},Elastic:function(u){return u===0||u===1?u:-Math.pow(2,8*(u-1))*Math.sin(((u-1)*80-7.5)*Math.PI/15)},Back:function(u){return u*u*(3*u-2)},Bounce:function(u){for(var p,g=4;u<((p=Math.pow(2,--g))-1)/11;);return 1/Math.pow(4,3-g)-7.5625*Math.pow((p*3-2)/22-u,2)}}),n.each(l,function(u,p){n.easing["easeIn"+u]=p,n.easing["easeOut"+u]=function(g){return 1-p(1-g)},n.easing["easeInOut"+u]=function(g){return g<.5?p(g*2)/2:1-p(g*-2+2)/2}})})(),n.effects;/*!
 * jQuery UI Effects Blind 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("blind","hide",function(l,u){var p={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},g=n(this),C=l.direction||"up",b=g.cssClip(),P={clip:n.extend({},b)},O=n.effects.createPlaceholder(g);P.clip[p[C][0]]=P.clip[p[C][1]],l.mode==="show"&&(g.cssClip(P.clip),O&&O.css(n.effects.clipToBox(P)),P.clip=b),O&&O.animate(n.effects.clipToBox(P),l.duration,l.easing),g.animate(P,{queue:!1,duration:l.duration,easing:l.easing,complete:u})});/*!
 * jQuery UI Effects Bounce 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("bounce",function(l,u){var p,g,C,b=n(this),P=l.mode,O=P==="hide",L=P==="show",U=l.direction||"up",H=l.distance,ee=l.times||5,ae=ee*2+(L||O?1:0),Y=l.duration/ae,Z=l.easing,ce=U==="up"||U==="down"?"top":"left",ye=U==="up"||U==="left",ve=0,Ee=b.queue().length;for(n.effects.createPlaceholder(b),C=b.css(ce),H||(H=b[ce==="top"?"outerHeight":"outerWidth"]()/3),L&&(g={opacity:1},g[ce]=C,b.css("opacity",0).css(ce,ye?-H*2:H*2).animate(g,Y,Z)),O&&(H=H/Math.pow(2,ee-1)),g={},g[ce]=C;ve<ee;ve++)p={},p[ce]=(ye?"-=":"+=")+H,b.animate(p,Y,Z).animate(g,Y,Z),H=O?H*2:H/2;O&&(p={opacity:0},p[ce]=(ye?"-=":"+=")+H,b.animate(p,Y,Z)),b.queue(u),n.effects.unshift(b,Ee,ae+1)});/*!
 * jQuery UI Effects Clip 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("clip","hide",function(l,u){var p,g={},C=n(this),b=l.direction||"vertical",P=b==="both",O=P||b==="horizontal",L=P||b==="vertical";p=C.cssClip(),g.clip={top:L?(p.bottom-p.top)/2:p.top,right:O?(p.right-p.left)/2:p.right,bottom:L?(p.bottom-p.top)/2:p.bottom,left:O?(p.right-p.left)/2:p.left},n.effects.createPlaceholder(C),l.mode==="show"&&(C.cssClip(g.clip),g.clip=p),C.animate(g,{queue:!1,duration:l.duration,easing:l.easing,complete:u})});/*!
 * jQuery UI Effects Drop 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("drop","hide",function(l,u){var p,g=n(this),C=l.mode,b=C==="show",P=l.direction||"left",O=P==="up"||P==="down"?"top":"left",L=P==="up"||P==="left"?"-=":"+=",U=L==="+="?"-=":"+=",H={opacity:0};n.effects.createPlaceholder(g),p=l.distance||g[O==="top"?"outerHeight":"outerWidth"](!0)/2,H[O]=L+p,b&&(g.css(H),H[O]=U+p,H.opacity=1),g.animate(H,{queue:!1,duration:l.duration,easing:l.easing,complete:u})});/*!
 * jQuery UI Effects Explode 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("explode","hide",function(l,u){var p,g,C,b,P,O,L=l.pieces?Math.round(Math.sqrt(l.pieces)):3,U=L,H=n(this),ee=l.mode,ae=ee==="show",Y=H.show().css("visibility","hidden").offset(),Z=Math.ceil(H.outerWidth()/U),ce=Math.ceil(H.outerHeight()/L),ye=[];function ve(){ye.push(this),ye.length===L*U&&Ee()}for(p=0;p<L;p++)for(b=Y.top+p*ce,O=p-(L-1)/2,g=0;g<U;g++)C=Y.left+g*Z,P=g-(U-1)/2,H.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-g*Z,top:-p*ce}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:Z,height:ce,left:C+(ae?P*Z:0),top:b+(ae?O*ce:0),opacity:ae?0:1}).animate({left:C+(ae?0:P*Z),top:b+(ae?0:O*ce),opacity:ae?1:0},l.duration||500,l.easing,ve);function Ee(){H.css({visibility:"visible"}),n(ye).remove(),u()}});/*!
 * jQuery UI Effects Fade 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("fade","toggle",function(l,u){var p=l.mode==="show";n(this).css("opacity",p?0:1).animate({opacity:p?1:0},{queue:!1,duration:l.duration,easing:l.easing,complete:u})});/*!
 * jQuery UI Effects Fold 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("fold","hide",function(l,u){var p=n(this),g=l.mode,C=g==="show",b=g==="hide",P=l.size||15,O=/([0-9]+)%/.exec(P),L=!!l.horizFirst,U=L?["right","bottom"]:["bottom","right"],H=l.duration/2,ee=n.effects.createPlaceholder(p),ae=p.cssClip(),Y={clip:n.extend({},ae)},Z={clip:n.extend({},ae)},ce=[ae[U[0]],ae[U[1]]],ye=p.queue().length;O&&(P=parseInt(O[1],10)/100*ce[b?0:1]),Y.clip[U[0]]=P,Z.clip[U[0]]=P,Z.clip[U[1]]=0,C&&(p.cssClip(Z.clip),ee&&ee.css(n.effects.clipToBox(Z)),Z.clip=ae),p.queue(function(ve){ee&&ee.animate(n.effects.clipToBox(Y),H,l.easing).animate(n.effects.clipToBox(Z),H,l.easing),ve()}).animate(Y,H,l.easing).animate(Z,H,l.easing).queue(u),n.effects.unshift(p,ye,4)});/*!
 * jQuery UI Effects Highlight 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("highlight","show",function(l,u){var p=n(this),g={backgroundColor:p.css("backgroundColor")};l.mode==="hide"&&(g.opacity=0),n.effects.saveStyle(p),p.css({backgroundImage:"none",backgroundColor:l.color||"#ffff99"}).animate(g,{queue:!1,duration:l.duration,easing:l.easing,complete:u})});/*!
 * jQuery UI Effects Size 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("size",function(l,u){var p,g,C,b=n(this),P=["fontSize"],O=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],L=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],U=l.mode,H=U!=="effect",ee=l.scale||"both",ae=l.origin||["middle","center"],Y=b.css("position"),Z=b.position(),ce=n.effects.scaledDimensions(b),ye=l.from||ce,ve=l.to||n.effects.scaledDimensions(b,0);n.effects.createPlaceholder(b),U==="show"&&(C=ye,ye=ve,ve=C),g={from:{y:ye.height/ce.height,x:ye.width/ce.width},to:{y:ve.height/ce.height,x:ve.width/ce.width}},(ee==="box"||ee==="both")&&(g.from.y!==g.to.y&&(ye=n.effects.setTransition(b,O,g.from.y,ye),ve=n.effects.setTransition(b,O,g.to.y,ve)),g.from.x!==g.to.x&&(ye=n.effects.setTransition(b,L,g.from.x,ye),ve=n.effects.setTransition(b,L,g.to.x,ve))),(ee==="content"||ee==="both")&&g.from.y!==g.to.y&&(ye=n.effects.setTransition(b,P,g.from.y,ye),ve=n.effects.setTransition(b,P,g.to.y,ve)),ae&&(p=n.effects.getBaseline(ae,ce),ye.top=(ce.outerHeight-ye.outerHeight)*p.y+Z.top,ye.left=(ce.outerWidth-ye.outerWidth)*p.x+Z.left,ve.top=(ce.outerHeight-ve.outerHeight)*p.y+Z.top,ve.left=(ce.outerWidth-ve.outerWidth)*p.x+Z.left),delete ye.outerHeight,delete ye.outerWidth,b.css(ye),(ee==="content"||ee==="both")&&(O=O.concat(["marginTop","marginBottom"]).concat(P),L=L.concat(["marginLeft","marginRight"]),b.find("*[width]").each(function(){var Ee=n(this),Re=n.effects.scaledDimensions(Ee),Ne={height:Re.height*g.from.y,width:Re.width*g.from.x,outerHeight:Re.outerHeight*g.from.y,outerWidth:Re.outerWidth*g.from.x},Fe={height:Re.height*g.to.y,width:Re.width*g.to.x,outerHeight:Re.height*g.to.y,outerWidth:Re.width*g.to.x};g.from.y!==g.to.y&&(Ne=n.effects.setTransition(Ee,O,g.from.y,Ne),Fe=n.effects.setTransition(Ee,O,g.to.y,Fe)),g.from.x!==g.to.x&&(Ne=n.effects.setTransition(Ee,L,g.from.x,Ne),Fe=n.effects.setTransition(Ee,L,g.to.x,Fe)),H&&n.effects.saveStyle(Ee),Ee.css(Ne),Ee.animate(Fe,l.duration,l.easing,function(){H&&n.effects.restoreStyle(Ee)})})),b.animate(ve,{queue:!1,duration:l.duration,easing:l.easing,complete:function(){var Ee=b.offset();ve.opacity===0&&b.css("opacity",ye.opacity),H||(b.css("position",Y==="static"?"relative":Y).offset(Ee),n.effects.saveStyle(b)),u()}})});/*!
 * jQuery UI Effects Scale 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("scale",function(l,u){var p=n(this),g=l.mode,C=parseInt(l.percent,10)||(parseInt(l.percent,10)===0||g!=="effect"?0:100),b=n.extend(!0,{from:n.effects.scaledDimensions(p),to:n.effects.scaledDimensions(p,C,l.direction||"both"),origin:l.origin||["middle","center"]},l);l.fade&&(b.from.opacity=1,b.to.opacity=0),n.effects.effect.size.call(this,b,u)});/*!
 * jQuery UI Effects Puff 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("puff","hide",function(l,u){var p=n.extend(!0,{},l,{fade:!0,percent:parseInt(l.percent,10)||150});n.effects.effect.scale.call(this,p,u)});/*!
 * jQuery UI Effects Pulsate 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("pulsate","show",function(l,u){var p=n(this),g=l.mode,C=g==="show",b=g==="hide",P=C||b,O=(l.times||5)*2+(P?1:0),L=l.duration/O,U=0,H=1,ee=p.queue().length;for((C||!p.is(":visible"))&&(p.css("opacity",0).show(),U=1);H<O;H++)p.animate({opacity:U},L,l.easing),U=1-U;p.animate({opacity:U},L,l.easing),p.queue(u),n.effects.unshift(p,ee,O+1)});/*!
 * jQuery UI Effects Shake 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("shake",function(l,u){var p=1,g=n(this),C=l.direction||"left",b=l.distance||20,P=l.times||3,O=P*2+1,L=Math.round(l.duration/O),U=C==="up"||C==="down"?"top":"left",H=C==="up"||C==="left",ee={},ae={},Y={},Z=g.queue().length;for(n.effects.createPlaceholder(g),ee[U]=(H?"-=":"+=")+b,ae[U]=(H?"+=":"-=")+b*2,Y[U]=(H?"-=":"+=")+b*2,g.animate(ee,L,l.easing);p<P;p++)g.animate(ae,L,l.easing).animate(Y,L,l.easing);g.animate(ae,L,l.easing).animate(ee,L/2,l.easing).queue(u),n.effects.unshift(g,Z,O+1)});/*!
 * jQuery UI Effects Slide 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.effects.define("slide","show",function(l,u){var p,g,C=n(this),b={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},P=l.mode,O=l.direction||"left",L=O==="up"||O==="down"?"top":"left",U=O==="up"||O==="left",H=l.distance||C[L==="top"?"outerHeight":"outerWidth"](!0),ee={};n.effects.createPlaceholder(C),p=C.cssClip(),g=C.position()[L],ee[L]=(U?-1:1)*H+g,ee.clip=C.cssClip(),ee.clip[b[O][1]]=ee.clip[b[O][0]],P==="show"&&(C.cssClip(ee.clip),C.css(L,ee[L]),ee.clip=p,ee[L]=g),C.animate(ee,{queue:!1,duration:l.duration,easing:l.easing,complete:u})}),n.uiBackCompat!==!1&&n.effects.define("transfer",function(l,u){n(this).transfer(l,u)});/*!
 * jQuery UI Focusable 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.ui.focusable=function(l,u){var p,g,C,b,P,O=l.nodeName.toLowerCase();return O==="area"?(p=l.parentNode,g=p.name,!l.href||!g||p.nodeName.toLowerCase()!=="map"?!1:(C=n("img[usemap='#"+g+"']"),C.length>0&&C.is(":visible"))):(/^(input|select|textarea|button|object)$/.test(O)?(b=!l.disabled,b&&(P=n(l).closest("fieldset")[0],P&&(b=!P.disabled))):O==="a"?b=l.href||u:b=u,b&&n(l).is(":visible")&&j(n(l)))};function j(l){for(var u=l.css("visibility");u==="inherit";)l=l.parent(),u=l.css("visibility");return u==="visible"}n.extend(n.expr.pseudos,{focusable:function(l){return n.ui.focusable(l,n.attr(l,"tabindex")!=null)}}),n.ui.focusable,n.fn._form=function(){return typeof this[0].form=="string"?this.closest("form"):n(this[0].form)};/*!
 * jQuery UI Form Reset Mixin 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.ui.formResetMixin={_formResetHandler:function(){var l=n(this);setTimeout(function(){var u=l.data("ui-form-reset-instances");n.each(u,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element._form(),!!this.form.length){var l=this.form.data("ui-form-reset-instances")||[];l.length||this.form.on("reset.ui-form-reset",this._formResetHandler),l.push(this),this.form.data("ui-form-reset-instances",l)}},_unbindFormResetHandler:function(){if(this.form.length){var l=this.form.data("ui-form-reset-instances");l.splice(n.inArray(this,l),1),l.length?this.form.data("ui-form-reset-instances",l):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}};/*!
 * jQuery UI Support for jQuery core 1.8.x and newer 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 *
 */if(n.expr.pseudos||(n.expr.pseudos=n.expr[":"]),n.uniqueSort||(n.uniqueSort=n.unique),!n.escapeSelector){var te=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g,Se=function(l,u){return u?l==="\0"?"ï¿½":l.slice(0,-1)+"\\"+l.charCodeAt(l.length-1).toString(16)+" ":"\\"+l};n.escapeSelector=function(l){return(l+"").replace(te,Se)}}(!n.fn.even||!n.fn.odd)&&n.fn.extend({even:function(){return this.filter(function(l){return l%2===0})},odd:function(){return this.filter(function(l){return l%2===1})}});/*!
 * jQuery UI Keycode 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38};/*!
 * jQuery UI Labels 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.fn.labels=function(){var l,u,p,g,C;return this.length?this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(g=this.eq(0).parents("label"),p=this.attr("id"),p&&(l=this.eq(0).parents().last(),C=l.add(l.length?l.siblings():this.siblings()),u="label[for='"+n.escapeSelector(p)+"']",g=g.add(C.find(u).addBack(u))),this.pushStack(g)):this.pushStack([])};/*!
 * jQuery UI Scroll Parent 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.fn.scrollParent=function(l){var u=this.css("position"),p=u==="absolute",g=l?/(auto|scroll|hidden)/:/(auto|scroll)/,C=this.parents().filter(function(){var b=n(this);return p&&b.css("position")==="static"?!1:g.test(b.css("overflow")+b.css("overflow-y")+b.css("overflow-x"))}).eq(0);return u==="fixed"||!C.length?n(this[0].ownerDocument||document):C};/*!
 * jQuery UI Tabbable 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.extend(n.expr.pseudos,{tabbable:function(l){var u=n.attr(l,"tabindex"),p=u!=null;return(!p||u>=0)&&n.ui.focusable(l,p)}});/*!
 * jQuery UI Unique ID 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.fn.extend({uniqueId:(function(){var l=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++l)})}})(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&n(this).removeAttr("id")})}});/*!
 * jQuery UI Accordion 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.accordion",{version:"1.13.3",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:function(l){return l.find("> li > :first-child").add(l.find("> :not(li)").even())},heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var l=this.options;this.prevShow=this.prevHide=n(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),!l.collapsible&&(l.active===!1||l.active==null)&&(l.active=0),this._processPanels(),l.active<0&&(l.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():n()}},_createIcons:function(){var l,u,p=this.options.icons;p&&(l=n("<span>"),this._addClass(l,"ui-accordion-header-icon","ui-icon "+p.header),l.prependTo(this.headers),u=this.active.children(".ui-accordion-header-icon"),this._removeClass(u,p.header)._addClass(u,null,p.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var l;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),l=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),this.options.heightStyle!=="content"&&l.css("height","")},_setOption:function(l,u){if(l==="active"){this._activate(u);return}l==="event"&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(u)),this._super(l,u),l==="collapsible"&&!u&&this.options.active===!1&&this._activate(0),l==="icons"&&(this._destroyIcons(),u&&this._createIcons())},_setOptionDisabled:function(l){this._super(l),this.element.attr("aria-disabled",l),this._toggleClass(null,"ui-state-disabled",!!l),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!l)},_keydown:function(l){if(!(l.altKey||l.ctrlKey)){var u=n.ui.keyCode,p=this.headers.length,g=this.headers.index(l.target),C=!1;switch(l.keyCode){case u.RIGHT:case u.DOWN:C=this.headers[(g+1)%p];break;case u.LEFT:case u.UP:C=this.headers[(g-1+p)%p];break;case u.SPACE:case u.ENTER:this._eventHandler(l);break;case u.HOME:C=this.headers[0];break;case u.END:C=this.headers[p-1];break}C&&(n(l.target).attr("tabIndex",-1),n(C).attr("tabIndex",0),n(C).trigger("focus"),l.preventDefault())}},_panelKeyDown:function(l){l.keyCode===n.ui.keyCode.UP&&l.ctrlKey&&n(l.currentTarget).prev().trigger("focus")},refresh:function(){var l=this.options;this._processPanels(),l.active===!1&&l.collapsible===!0||!this.headers.length?(l.active=!1,this.active=n()):l.active===!1?this._activate(0):this.active.length&&!n.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(l.active=!1,this.active=n()):this._activate(Math.max(0,l.active-1)):l.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var l=this.headers,u=this.panels;typeof this.options.header=="function"?this.headers=this.options.header(this.element):this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),u&&(this._off(l.not(this.headers)),this._off(u.not(this.panels)))},_refresh:function(){var l,u=this.options,p=u.heightStyle,g=this.element.parent();this.active=this._findActive(u.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var C=n(this),b=C.uniqueId().attr("id"),P=C.next(),O=P.uniqueId().attr("id");C.attr("aria-controls",O),P.attr("aria-labelledby",b)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(u.event),p==="fill"?(l=g.height(),this.element.siblings(":visible").each(function(){var C=n(this),b=C.css("position");b==="absolute"||b==="fixed"||(l-=C.outerHeight(!0))}),this.headers.each(function(){l-=n(this).outerHeight(!0)}),this.headers.next().each(function(){n(this).height(Math.max(0,l-n(this).innerHeight()+n(this).height()))}).css("overflow","auto")):p==="auto"&&(l=0,this.headers.next().each(function(){var C=n(this).is(":visible");C||n(this).show(),l=Math.max(l,n(this).css("height","").height()),C||n(this).hide()}).height(l))},_activate:function(l){var u=this._findActive(l)[0];u!==this.active[0]&&(u=u||this.active[0],this._eventHandler({target:u,currentTarget:u,preventDefault:n.noop}))},_findActive:function(l){return typeof l=="number"?this.headers.eq(l):n()},_setupEvents:function(l){var u={keydown:"_keydown"};l&&n.each(l.split(" "),function(p,g){u[g]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,u),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(l){var u,p,g=this.options,C=this.active,b=n(l.currentTarget),P=b[0]===C[0],O=P&&g.collapsible,L=O?n():b.next(),U=C.next(),H={oldHeader:C,oldPanel:U,newHeader:O?n():b,newPanel:L};l.preventDefault(),!(P&&!g.collapsible||this._trigger("beforeActivate",l,H)===!1)&&(g.active=O?!1:this.headers.index(b),this.active=P?n():b,this._toggle(H),this._removeClass(C,"ui-accordion-header-active","ui-state-active"),g.icons&&(u=C.children(".ui-accordion-header-icon"),this._removeClass(u,null,g.icons.activeHeader)._addClass(u,null,g.icons.header)),P||(this._removeClass(b,"ui-accordion-header-collapsed")._addClass(b,"ui-accordion-header-active","ui-state-active"),g.icons&&(p=b.children(".ui-accordion-header-icon"),this._removeClass(p,null,g.icons.header)._addClass(p,null,g.icons.activeHeader)),this._addClass(b.next(),"ui-accordion-content-active")))},_toggle:function(l){var u=l.newPanel,p=this.prevShow.length?this.prevShow:l.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=u,this.prevHide=p,this.options.animate?this._animate(u,p,l):(p.hide(),u.show(),this._toggleComplete(l)),p.attr({"aria-hidden":"true"}),p.prev().attr({"aria-selected":"false","aria-expanded":"false"}),u.length&&p.length?p.prev().attr({tabIndex:-1,"aria-expanded":"false"}):u.length&&this.headers.filter(function(){return parseInt(n(this).attr("tabIndex"),10)===0}).attr("tabIndex",-1),u.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(l,u,p){var g,C,b,P=this,O=0,L=l.css("box-sizing"),U=l.length&&(!u.length||l.index()<u.index()),H=this.options.animate||{},ee=U&&H.down||H,ae=function(){P._toggleComplete(p)};if(typeof ee=="number"&&(b=ee),typeof ee=="string"&&(C=ee),C=C||ee.easing||H.easing,b=b||ee.duration||H.duration,!u.length)return l.animate(this.showProps,b,C,ae);if(!l.length)return u.animate(this.hideProps,b,C,ae);g=l.show().outerHeight(),u.animate(this.hideProps,{duration:b,easing:C,step:function(Y,Z){Z.now=Math.round(Y)}}),l.hide().animate(this.showProps,{duration:b,easing:C,complete:ae,step:function(Y,Z){Z.now=Math.round(Y),Z.prop!=="height"?L==="content-box"&&(O+=Z.now):P.options.heightStyle!=="content"&&(Z.now=Math.round(g-u.outerHeight()-O),O=0)}})},_toggleComplete:function(l){var u=l.oldPanel,p=u.prev();this._removeClass(u,"ui-accordion-content-active"),this._removeClass(p,"ui-accordion-header-active")._addClass(p,"ui-accordion-header-collapsed"),u.length&&(u.parent()[0].className=u.parent()[0].className),this._trigger("activate",null,l)}}),n.ui.safeActiveElement=function(l){var u;try{u=l.activeElement}catch{u=l.body}return u||(u=l.body),u.nodeName||(u=l.body),u};/*!
 * jQuery UI Menu 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.menu",{version:"1.13.3",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.lastMousePosition={x:null,y:null},this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(l){l.preventDefault(),this._activateItem(l)},"click .ui-menu-item":function(l){var u=n(l.target),p=n(n.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&u.not(".ui-state-disabled").length&&(this.select(l),l.isPropagationStopped()||(this.mouseHandled=!0),u.has(".ui-menu").length?this.expand(l):!this.element.is(":focus")&&p.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&this.active.parents(".ui-menu").length===1&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":"_activateItem","mousemove .ui-menu-item":"_activateItem",mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(l,u){var p=this.active||this._menuItems().first();u||this.focus(l,p)},blur:function(l){this._delay(function(){var u=!n.contains(this.element[0],n.ui.safeActiveElement(this.document[0]));u&&this.collapseAll(l)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(l){this._closeOnDocumentClick(l)&&this.collapseAll(l,!0),this.mouseHandled=!1}})},_activateItem:function(l){if(!this.previousFilter&&!(l.clientX===this.lastMousePosition.x&&l.clientY===this.lastMousePosition.y)){this.lastMousePosition={x:l.clientX,y:l.clientY};var u=n(l.target).closest(".ui-menu-item"),p=n(l.currentTarget);u[0]===p[0]&&(p.is(".ui-state-active")||(this._removeClass(p.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(l,p)))}},_destroy:function(){var l=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),u=l.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),u.children().each(function(){var p=n(this);p.data("ui-menu-submenu-caret")&&p.remove()})},_keydown:function(l){var u,p,g,C,b=!0;switch(l.keyCode){case n.ui.keyCode.PAGE_UP:this.previousPage(l);break;case n.ui.keyCode.PAGE_DOWN:this.nextPage(l);break;case n.ui.keyCode.HOME:this._move("first","first",l);break;case n.ui.keyCode.END:this._move("last","last",l);break;case n.ui.keyCode.UP:this.previous(l);break;case n.ui.keyCode.DOWN:this.next(l);break;case n.ui.keyCode.LEFT:this.collapse(l);break;case n.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(l);break;case n.ui.keyCode.ENTER:case n.ui.keyCode.SPACE:this._activate(l);break;case n.ui.keyCode.ESCAPE:this.collapse(l);break;default:b=!1,p=this.previousFilter||"",C=!1,g=l.keyCode>=96&&l.keyCode<=105?(l.keyCode-96).toString():String.fromCharCode(l.keyCode),clearTimeout(this.filterTimer),g===p?C=!0:g=p+g,u=this._filterMenuItems(g),u=C&&u.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):u,u.length||(g=String.fromCharCode(l.keyCode),u=this._filterMenuItems(g)),u.length?(this.focus(l,u),this.previousFilter=g,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}b&&l.preventDefault()},_activate:function(l){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(l):this.select(l))},refresh:function(){var l,u,p,g,C,b=this,P=this.options.icons.submenu,O=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),p=O.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var L=n(this),U=L.prev(),H=n("<span>").data("ui-menu-submenu-caret",!0);b._addClass(H,"ui-menu-icon","ui-icon "+P),U.attr("aria-haspopup","true").prepend(H),L.attr("aria-labelledby",U.attr("id"))}),this._addClass(p,"ui-menu","ui-widget ui-widget-content ui-front"),l=O.add(this.element),u=l.find(this.options.items),u.not(".ui-menu-item").each(function(){var L=n(this);b._isDivider(L)&&b._addClass(L,"ui-menu-divider","ui-widget-content")}),g=u.not(".ui-menu-item, .ui-menu-divider"),C=g.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(g,"ui-menu-item")._addClass(C,"ui-menu-item-wrapper"),u.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!n.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(l,u){if(l==="icons"){var p=this.element.find(".ui-menu-icon");this._removeClass(p,null,this.options.icons.submenu)._addClass(p,null,u.submenu)}this._super(l,u)},_setOptionDisabled:function(l){this._super(l),this.element.attr("aria-disabled",String(l)),this._toggleClass(null,"ui-state-disabled",!!l)},focus:function(l,u){var p,g,C;this.blur(l,l&&l.type==="focus"),this._scrollIntoView(u),this.active=u.first(),g=this.active.children(".ui-menu-item-wrapper"),this._addClass(g,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",g.attr("id")),C=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(C,null,"ui-state-active"),l&&l.type==="keydown"?this._close():this.timer=this._delay(function(){this._close()},this.delay),p=u.children(".ui-menu"),p.length&&l&&/^mouse/.test(l.type)&&this._startOpening(p),this.activeMenu=u.parent(),this._trigger("focus",l,{item:u})},_scrollIntoView:function(l){var u,p,g,C,b,P;this._hasScroll()&&(u=parseFloat(n.css(this.activeMenu[0],"borderTopWidth"))||0,p=parseFloat(n.css(this.activeMenu[0],"paddingTop"))||0,g=l.offset().top-this.activeMenu.offset().top-u-p,C=this.activeMenu.scrollTop(),b=this.activeMenu.height(),P=l.outerHeight(),g<0?this.activeMenu.scrollTop(C+g):g+P>b&&this.activeMenu.scrollTop(C+g-b+P))},blur:function(l,u){u||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",l,{item:this.active}),this.active=null)},_startOpening:function(l){clearTimeout(this.timer),l.attr("aria-hidden")==="true"&&(this.timer=this._delay(function(){this._close(),this._open(l)},this.delay))},_open:function(l){var u=n.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(l.parents(".ui-menu")).hide().attr("aria-hidden","true"),l.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(u)},collapseAll:function(l,u){clearTimeout(this.timer),this.timer=this._delay(function(){var p=u?this.element:n(l&&l.target).closest(this.element.find(".ui-menu"));p.length||(p=this.element),this._close(p),this.blur(l),this._removeClass(p.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=p},u?0:this.delay)},_close:function(l){l||(l=this.active?this.active.parent():this.element),l.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(l){return!n(l.target).closest(".ui-menu").length},_isDivider:function(l){return!/[^\-\u2014\u2013\s]/.test(l.text())},collapse:function(l){var u=this.active&&this.active.parent().closest(".ui-menu-item",this.element);u&&u.length&&(this._close(),this.focus(l,u))},expand:function(l){var u=this.active&&this._menuItems(this.active.children(".ui-menu")).first();u&&u.length&&(this._open(u.parent()),this._delay(function(){this.focus(l,u)}))},next:function(l){this._move("next","first",l)},previous:function(l){this._move("prev","last",l)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_menuItems:function(l){return(l||this.element).find(this.options.items).filter(".ui-menu-item")},_move:function(l,u,p){var g;this.active&&(l==="first"||l==="last"?g=this.active[l==="first"?"prevAll":"nextAll"](".ui-menu-item").last():g=this.active[l+"All"](".ui-menu-item").first()),(!g||!g.length||!this.active)&&(g=this._menuItems(this.activeMenu)[u]()),this.focus(p,g)},nextPage:function(l){var u,p,g;if(!this.active){this.next(l);return}this.isLastItem()||(this._hasScroll()?(p=this.active.offset().top,g=this.element.innerHeight(),n.fn.jquery.indexOf("3.2.")===0&&(g+=this.element[0].offsetHeight-this.element.outerHeight()),this.active.nextAll(".ui-menu-item").each(function(){return u=n(this),u.offset().top-p-g<0}),this.focus(l,u)):this.focus(l,this._menuItems(this.activeMenu)[this.active?"last":"first"]()))},previousPage:function(l){var u,p,g;if(!this.active){this.next(l);return}this.isFirstItem()||(this._hasScroll()?(p=this.active.offset().top,g=this.element.innerHeight(),n.fn.jquery.indexOf("3.2.")===0&&(g+=this.element[0].offsetHeight-this.element.outerHeight()),this.active.prevAll(".ui-menu-item").each(function(){return u=n(this),u.offset().top-p+g>0}),this.focus(l,u)):this.focus(l,this._menuItems(this.activeMenu).first()))},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(l){this.active=this.active||n(l.target).closest(".ui-menu-item");var u={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(l,!0),this._trigger("select",l,u)},_filterMenuItems:function(l){var u=l.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),p=new RegExp("^"+u,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return p.test(String.prototype.trim.call(n(this).children(".ui-menu-item-wrapper").text()))})}});/*!
 * jQuery UI Autocomplete 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.autocomplete",{version:"1.13.3",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,liveRegionTimer:null,_create:function(){var l,u,p,g=this.element[0].nodeName.toLowerCase(),C=g==="textarea",b=g==="input";this.isMultiLine=C||!b&&this._isContentEditable(this.element),this.valueMethod=this.element[C||b?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(P){if(this.element.prop("readOnly")){l=!0,p=!0,u=!0;return}l=!1,p=!1,u=!1;var O=n.ui.keyCode;switch(P.keyCode){case O.PAGE_UP:l=!0,this._move("previousPage",P);break;case O.PAGE_DOWN:l=!0,this._move("nextPage",P);break;case O.UP:l=!0,this._keyEvent("previous",P);break;case O.DOWN:l=!0,this._keyEvent("next",P);break;case O.ENTER:this.menu.active&&(l=!0,P.preventDefault(),this.menu.select(P));break;case O.TAB:this.menu.active&&this.menu.select(P);break;case O.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(P),P.preventDefault());break;default:u=!0,this._searchTimeout(P);break}},keypress:function(P){if(l){l=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&P.preventDefault();return}if(!u){var O=n.ui.keyCode;switch(P.keyCode){case O.PAGE_UP:this._move("previousPage",P);break;case O.PAGE_DOWN:this._move("nextPage",P);break;case O.UP:this._keyEvent("previous",P);break;case O.DOWN:this._keyEvent("next",P);break}}},input:function(P){if(p){p=!1,P.preventDefault();return}this._searchTimeout(P)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(P){clearTimeout(this.searching),this.close(P),this._change(P)}}),this._initSource(),this.menu=n("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().attr({unselectable:"on"}).menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(P){P.preventDefault()},menufocus:function(P,O){var L,U;if(this.isNewMenu&&(this.isNewMenu=!1,P.originalEvent&&/^mouse/.test(P.originalEvent.type))){this.menu.blur(),this.document.one("mousemove",function(){n(P.target).trigger(P.originalEvent)});return}U=O.item.data("ui-autocomplete-item"),this._trigger("focus",P,{item:U})!==!1&&P.originalEvent&&/^key/.test(P.originalEvent.type)&&this._value(U.value),L=O.item.attr("aria-label")||U.value,L&&String.prototype.trim.call(L).length&&(clearTimeout(this.liveRegionTimer),this.liveRegionTimer=this._delay(function(){this.liveRegion.html(n("<div>").text(L))},100))},menuselect:function(P,O){var L=O.item.data("ui-autocomplete-item"),U=this.previous;this.element[0]!==n.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=U,this._delay(function(){this.previous=U,this.selectedItem=L})),this._trigger("select",P,{item:L})!==!1&&this._value(L.value),this.term=this._value(),this.close(P),this.selectedItem=L}}),this.liveRegion=n("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(l,u){this._super(l,u),l==="source"&&this._initSource(),l==="appendTo"&&this.menu.element.appendTo(this._appendTo()),l==="disabled"&&u&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(l){var u=this.menu.element[0];return l.target===this.element[0]||l.target===u||n.contains(u,l.target)},_closeOnClickOutside:function(l){this._isEventTargetInWidget(l)||this.close()},_appendTo:function(){var l=this.options.appendTo;return l&&(l=l.jquery||l.nodeType?n(l):this.document.find(l).eq(0)),(!l||!l[0])&&(l=this.element.closest(".ui-front, dialog")),l.length||(l=this.document[0].body),l},_initSource:function(){var l,u,p=this;Array.isArray(this.options.source)?(l=this.options.source,this.source=function(g,C){C(n.ui.autocomplete.filter(l,g.term))}):typeof this.options.source=="string"?(u=this.options.source,this.source=function(g,C){p.xhr&&p.xhr.abort(),p.xhr=n.ajax({url:u,data:g,dataType:"json",success:function(b){C(b)},error:function(){C([])}})}):this.source=this.options.source},_searchTimeout:function(l){clearTimeout(this.searching),this.searching=this._delay(function(){var u=this.term===this._value(),p=this.menu.element.is(":visible"),g=l.altKey||l.ctrlKey||l.metaKey||l.shiftKey;(!u||u&&!p&&!g)&&(this.selectedItem=null,this.search(null,l))},this.options.delay)},search:function(l,u){if(l=l??this._value(),this.term=this._value(),l.length<this.options.minLength)return this.close(u);if(this._trigger("search",u)!==!1)return this._search(l)},_search:function(l){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:l},this._response())},_response:function(){var l=++this.requestIndex;return(function(u){l===this.requestIndex&&this.__response(u),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")}).bind(this)},__response:function(l){l&&(l=this._normalize(l)),this._trigger("response",null,{content:l}),!this.options.disabled&&l&&l.length&&!this.cancelSearch?(this._suggest(l),this._trigger("open")):this._close()},close:function(l){this.cancelSearch=!0,this._close(l)},_close:function(l){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",l))},_change:function(l){this.previous!==this._value()&&this._trigger("change",l,{item:this.selectedItem})},_normalize:function(l){return l.length&&l[0].label&&l[0].value?l:n.map(l,function(u){return typeof u=="string"?{label:u,value:u}:n.extend({},u,{label:u.label||u.value,value:u.value||u.label})})},_suggest:function(l){var u=this.menu.element.empty();this._renderMenu(u,l),this.isNewMenu=!0,this.menu.refresh(),u.show(),this._resizeMenu(),u.position(n.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var l=this.menu.element;l.outerWidth(Math.max(l.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(l,u){var p=this;n.each(u,function(g,C){p._renderItemData(l,C)})},_renderItemData:function(l,u){return this._renderItem(l,u).data("ui-autocomplete-item",u)},_renderItem:function(l,u){return n("<li>").append(n("<div>").text(u.label)).appendTo(l)},_move:function(l,u){if(!this.menu.element.is(":visible")){this.search(null,u);return}if(this.menu.isFirstItem()&&/^previous/.test(l)||this.menu.isLastItem()&&/^next/.test(l)){this.isMultiLine||this._value(this.term),this.menu.blur();return}this.menu[l](u)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(l,u){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(l,u),u.preventDefault())},_isContentEditable:function(l){if(!l.length)return!1;var u=l.prop("contentEditable");return u==="inherit"?this._isContentEditable(l.parent()):u==="true"}}),n.extend(n.ui.autocomplete,{escapeRegex:function(l){return l.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(l,u){var p=new RegExp(n.ui.autocomplete.escapeRegex(u),"i");return n.grep(l,function(g){return p.test(g.label||g.value||g)})}}),n.widget("ui.autocomplete",n.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(l){return l+(l>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(l){var u;this._superApply(arguments),!(this.options.disabled||this.cancelSearch)&&(l&&l.length?u=this.options.messages.results(l.length):u=this.options.messages.noResults,clearTimeout(this.liveRegionTimer),this.liveRegionTimer=this._delay(function(){this.liveRegion.html(n("<div>").text(u))},100))}}),n.ui.autocomplete;/*!
 * jQuery UI Controlgroup 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */var be=/ui-corner-([a-z]){2,6}/g;n.widget("ui.controlgroup",{version:"1.13.3",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var l=this,u=[];n.each(this.options.items,function(p,g){var C,b={};if(g){if(p==="controlgroupLabel"){C=l.element.find(g),C.each(function(){var P=n(this);P.children(".ui-controlgroup-label-contents").length||P.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),l._addClass(C,null,"ui-widget ui-widget-content ui-state-default"),u=u.concat(C.get());return}n.fn[p]&&(l["_"+p+"Options"]?b=l["_"+p+"Options"]("middle"):b={classes:{}},l.element.find(g).each(function(){var P=n(this),O=P[p]("instance"),L=n.widget.extend({},b);if(!(p==="button"&&P.parent(".ui-spinner").length)){O||(O=P[p]()[p]("instance")),O&&(L.classes=l._resolveClassesValues(L.classes,O)),P[p](L);var U=P[p]("widget");n.data(U[0],"ui-controlgroup-data",O||P[p]("instance")),u.push(U[0])}}))}}),this.childWidgets=n(n.uniqueSort(u)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(l){this.childWidgets.each(function(){var u=n(this),p=u.data("ui-controlgroup-data");p&&p[l]&&p[l]()})},_updateCornerClass:function(l,u){var p="ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all",g=this._buildSimpleOptions(u,"label").classes.label;this._removeClass(l,null,p),this._addClass(l,null,g)},_buildSimpleOptions:function(l,u){var p=this.options.direction==="vertical",g={classes:{}};return g.classes[u]={middle:"",first:"ui-corner-"+(p?"top":"left"),last:"ui-corner-"+(p?"bottom":"right"),only:"ui-corner-all"}[l],g},_spinnerOptions:function(l){var u=this._buildSimpleOptions(l,"ui-spinner");return u.classes["ui-spinner-up"]="",u.classes["ui-spinner-down"]="",u},_buttonOptions:function(l){return this._buildSimpleOptions(l,"ui-button")},_checkboxradioOptions:function(l){return this._buildSimpleOptions(l,"ui-checkboxradio-label")},_selectmenuOptions:function(l){var u=this.options.direction==="vertical";return{width:u?"auto":!1,classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(u?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(u?"top":"left")},last:{"ui-selectmenu-button-open":u?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(u?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[l]}},_resolveClassesValues:function(l,u){var p={};return n.each(l,function(g){var C=u.options.classes[g]||"";C=String.prototype.trim.call(C.replace(be,"")),p[g]=(C+" "+l[g]).replace(/\s+/g," ")}),p},_setOption:function(l,u){if(l==="direction"&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(l,u),l==="disabled"){this._callChildMethod(u?"disable":"enable");return}this.refresh()},refresh:function(){var l,u=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),this.options.direction==="horizontal"&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),l=this.childWidgets,this.options.onlyVisible&&(l=l.filter(":visible")),l.length&&(n.each(["first","last"],function(p,g){var C=l[g]().data("ui-controlgroup-data");if(C&&u["_"+C.widgetName+"Options"]){var b=u["_"+C.widgetName+"Options"](l.length===1?"only":g);b.classes=u._resolveClassesValues(b.classes,C),C.element[C.widgetName](b)}else u._updateCornerClass(l[g](),g)}),this._callChildMethod("refresh"))}});/*!
 * jQuery UI Checkboxradio 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.checkboxradio",[n.ui.formResetMixin,{version:"1.13.3",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var l,u,p,g=this._super()||{};return this._readType(),u=this.element.labels(),this.label=n(u[u.length-1]),this.label.length||n.error("No label found for checkboxradio widget"),this.originalLabel="",p=this.label.contents().not(this.element[0]),p.length&&(this.originalLabel+=p.clone().wrapAll("<div></div>").parent().html()),this.originalLabel&&(g.label=this.originalLabel),l=this.element[0].disabled,l!=null&&(g.disabled=l),g},_create:function(){var l=this.element[0].checked;this._bindFormResetHandler(),this.options.disabled==null&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),this.type==="radio"&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),l&&this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var l=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,(l!=="input"||!/radio|checkbox/.test(this.type))&&n.error("Can't create checkboxradio on element.nodeName="+l+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var l,u=this.element[0].name,p="input[name='"+n.escapeSelector(u)+"']";return u?(this.form.length?l=n(this.form[0].elements).filter(p):l=n(p).filter(function(){return n(this)._form().length===0}),l.not(this.element)):n([])},_toggleClasses:function(){var l=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",l),this.options.icon&&this.type==="checkbox"&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",l)._toggleClass(this.icon,null,"ui-icon-blank",!l),this.type==="radio"&&this._getRadioGroup().each(function(){var u=n(this).checkboxradio("instance");u&&u._removeClass(u.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(l,u){if(!(l==="label"&&!u)){if(this._super(l,u),l==="disabled"){this._toggleClass(this.label,null,"ui-state-disabled",u),this.element[0].disabled=u;return}this.refresh()}},_updateIcon:function(l){var u="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=n("<span>"),this.iconSpace=n("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),this.type==="checkbox"?(u+=l?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,l?"ui-icon-blank":"ui-icon-check")):u+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",u),l||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):this.icon!==void 0&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var l=this.label.contents().not(this.element[0]);this.icon&&(l=l.not(this.icon[0])),this.iconSpace&&(l=l.not(this.iconSpace[0])),l.remove(),this.label.append(this.options.label)},refresh:function(){var l=this.element[0].checked,u=this.element[0].disabled;this._updateIcon(l),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",l),this.options.label!==null&&this._updateLabel(),u!==this.options.disabled&&this._setOptions({disabled:u})}}]),n.ui.checkboxradio;/*!
 * jQuery UI Button 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.button",{version:"1.13.3",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var l,u=this._super()||{};return this.isInput=this.element.is("input"),l=this.element[0].disabled,l!=null&&(u.disabled=l),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(u.label=this.originalLabel),u},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),this.options.disabled==null&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(l){l.keyCode===n.ui.keyCode.SPACE&&(l.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),!this.options.showLabel&&!this.title&&this.element.attr("title",this.options.label)},_updateIcon:function(l,u){var p=l!=="iconPosition",g=p?this.options.iconPosition:u,C=g==="top"||g==="bottom";this.icon?p&&this._removeClass(this.icon,null,this.options.icon):(this.icon=n("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),p&&this._addClass(this.icon,null,u),this._attachIcon(g),C?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=n("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(g))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(l){this.icon[/^(?:end|bottom)/.test(l)?"before":"after"](this.iconSpace)},_attachIcon:function(l){this.element[/^(?:end|bottom)/.test(l)?"append":"prepend"](this.icon)},_setOptions:function(l){var u=l.showLabel===void 0?this.options.showLabel:l.showLabel,p=l.icon===void 0?this.options.icon:l.icon;!u&&!p&&(l.showLabel=!0),this._super(l)},_setOption:function(l,u){l==="icon"&&(u?this._updateIcon(l,u):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),l==="iconPosition"&&this._updateIcon(l,u),l==="showLabel"&&(this._toggleClass("ui-button-icon-only",null,!u),this._updateTooltip()),l==="label"&&(this.isInput?this.element.val(u):(this.element.html(u),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(l,u),l==="disabled"&&(this._toggleClass(null,"ui-state-disabled",u),this.element[0].disabled=u,u&&this.element.trigger("blur"))},refresh:function(){var l=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");l!==this.options.disabled&&this._setOptions({disabled:l}),this._updateTooltip()}}),n.uiBackCompat!==!1&&(n.widget("ui.button",n.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),!this.options.icon&&(this.options.icons.primary||this.options.icons.secondary)?this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"):this.options.icon&&(this.options.icons.primary=this.options.icon),this._super()},_setOption:function(l,u){if(l==="text"){this._super("showLabel",u);return}l==="showLabel"&&(this.options.text=u),l==="icon"&&(this.options.icons.primary=u),l==="icons"&&(u.primary?(this._super("icon",u.primary),this._super("iconPosition","beginning")):u.secondary&&(this._super("icon",u.secondary),this._super("iconPosition","end"))),this._superApply(arguments)}}),n.fn.button=(function(l){return function(u){var p=typeof u=="string",g=Array.prototype.slice.call(arguments,1),C=this;return p?!this.length&&u==="instance"?C=void 0:this.each(function(){var b,P=n(this).attr("type"),O=P!=="checkbox"&&P!=="radio"?"button":"checkboxradio",L=n.data(this,"ui-"+O);if(u==="instance")return C=L,!1;if(!L)return n.error("cannot call methods on button prior to initialization; attempted to call method '"+u+"'");if(typeof L[u]!="function"||u.charAt(0)==="_")return n.error("no such method '"+u+"' for button widget instance");if(b=L[u].apply(L,g),b!==L&&b!==void 0)return C=b&&b.jquery?C.pushStack(b.get()):b,!1}):(g.length&&(u=n.widget.extend.apply(null,[u].concat(g))),this.each(function(){var b=n(this).attr("type"),P=b!=="checkbox"&&b!=="radio"?"button":"checkboxradio",O=n.data(this,"ui-"+P);if(O)O.option(u||{}),O._init&&O._init();else{if(P==="button"){l.call(n(this),u);return}n(this).checkboxradio(n.extend({icon:!1},u))}})),C}})(n.fn.button),n.fn.buttonset=function(){return n.ui.controlgroup||n.error("Controlgroup widget missing"),arguments[0]==="option"&&arguments[1]==="items"&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):arguments[0]==="option"&&arguments[1]==="items"?this.controlgroup.apply(this,[arguments[0],"items.button"]):(typeof arguments[0]=="object"&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),n.ui.button;/*!
 * jQuery UI Datepicker 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.extend(n.ui,{datepicker:{version:"1.13.3"}});var Te;function pe(l){for(var u,p;l.length&&l[0]!==document;){if(u=l.css("position"),(u==="absolute"||u==="relative"||u==="fixed")&&(p=parseInt(l.css("zIndex"),10),!isNaN(p)&&p!==0))return p;l=l.parent()}return 0}function ie(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:"",selectMonthLabel:"Select month",selectYearLabel:"Select year"},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,onUpdateDatepicker:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},n.extend(this._defaults,this.regional[""]),this.regional.en=n.extend(!0,{},this.regional[""]),this.regional["en-US"]=n.extend(!0,{},this.regional.en),this.dpDiv=he(n("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}n.extend(ie.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(l){return ue(this._defaults,l||{}),this},_attachDatepicker:function(l,u){var p,g,C;p=l.nodeName.toLowerCase(),g=p==="div"||p==="span",l.id||(this.uuid+=1,l.id="dp"+this.uuid),C=this._newInst(n(l),g),C.settings=n.extend({},u||{}),p==="input"?this._connectDatepicker(l,C):g&&this._inlineDatepicker(l,C)},_newInst:function(l,u){var p=l[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:p,input:l,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:u,dpDiv:u?he(n("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(l,u){var p=n(l);u.append=n([]),u.trigger=n([]),!p.hasClass(this.markerClassName)&&(this._attachments(p,u),p.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(u),n.data(l,"datepicker",u),u.settings.disabled&&this._disableDatepicker(l))},_attachments:function(l,u){var p,g,C,b=this._get(u,"appendText"),P=this._get(u,"isRTL");u.append&&u.append.remove(),b&&(u.append=n("<span>").addClass(this._appendClass).text(b),l[P?"before":"after"](u.append)),l.off("focus",this._showDatepicker),u.trigger&&u.trigger.remove(),p=this._get(u,"showOn"),(p==="focus"||p==="both")&&l.on("focus",this._showDatepicker),(p==="button"||p==="both")&&(g=this._get(u,"buttonText"),C=this._get(u,"buttonImage"),this._get(u,"buttonImageOnly")?u.trigger=n("<img>").addClass(this._triggerClass).attr({src:C,alt:g,title:g}):(u.trigger=n("<button type='button'>").addClass(this._triggerClass),C?u.trigger.html(n("<img>").attr({src:C,alt:g,title:g})):u.trigger.text(g)),l[P?"before":"after"](u.trigger),u.trigger.on("click",function(){return n.datepicker._datepickerShowing&&n.datepicker._lastInput===l[0]?n.datepicker._hideDatepicker():(n.datepicker._datepickerShowing&&n.datepicker._lastInput!==l[0]&&n.datepicker._hideDatepicker(),n.datepicker._showDatepicker(l[0])),!1}))},_autoSize:function(l){if(this._get(l,"autoSize")&&!l.inline){var u,p,g,C,b=new Date(2009,11,20),P=this._get(l,"dateFormat");P.match(/[DM]/)&&(u=function(O){for(p=0,g=0,C=0;C<O.length;C++)O[C].length>p&&(p=O[C].length,g=C);return g},b.setMonth(u(this._get(l,P.match(/MM/)?"monthNames":"monthNamesShort"))),b.setDate(u(this._get(l,P.match(/DD/)?"dayNames":"dayNamesShort"))+20-b.getDay())),l.input.attr("size",this._formatDate(l,b).length)}},_inlineDatepicker:function(l,u){var p=n(l);p.hasClass(this.markerClassName)||(p.addClass(this.markerClassName).append(u.dpDiv),n.data(l,"datepicker",u),this._setDate(u,this._getDefaultDate(u),!0),this._updateDatepicker(u),this._updateAlternate(u),u.settings.disabled&&this._disableDatepicker(l),u.dpDiv.css("display","block"))},_dialogDatepicker:function(l,u,p,g,C){var b,P,O,L,U,H=this._dialogInst;return H||(this.uuid+=1,b="dp"+this.uuid,this._dialogInput=n("<input type='text' id='"+b+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),n("body").append(this._dialogInput),H=this._dialogInst=this._newInst(this._dialogInput,!1),H.settings={},n.data(this._dialogInput[0],"datepicker",H)),ue(H.settings,g||{}),u=u&&u.constructor===Date?this._formatDate(H,u):u,this._dialogInput.val(u),this._pos=C?C.length?C:[C.pageX,C.pageY]:null,this._pos||(P=document.documentElement.clientWidth,O=document.documentElement.clientHeight,L=document.documentElement.scrollLeft||document.body.scrollLeft,U=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[P/2-100+L,O/2-150+U]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),H.settings.onSelect=p,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),n.blockUI&&n.blockUI(this.dpDiv),n.data(this._dialogInput[0],"datepicker",H),this},_destroyDatepicker:function(l){var u,p=n(l),g=n.data(l,"datepicker");p.hasClass(this.markerClassName)&&(u=l.nodeName.toLowerCase(),n.removeData(l,"datepicker"),u==="input"?(g.append.remove(),g.trigger.remove(),p.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):(u==="div"||u==="span")&&p.removeClass(this.markerClassName).empty(),Te===g&&(Te=null,this._curInst=null))},_enableDatepicker:function(l){var u,p,g=n(l),C=n.data(l,"datepicker");g.hasClass(this.markerClassName)&&(u=l.nodeName.toLowerCase(),u==="input"?(l.disabled=!1,C.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):(u==="div"||u==="span")&&(p=g.children("."+this._inlineClass),p.children().removeClass("ui-state-disabled"),p.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=n.map(this._disabledInputs,function(b){return b===l?null:b}))},_disableDatepicker:function(l){var u,p,g=n(l),C=n.data(l,"datepicker");g.hasClass(this.markerClassName)&&(u=l.nodeName.toLowerCase(),u==="input"?(l.disabled=!0,C.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):(u==="div"||u==="span")&&(p=g.children("."+this._inlineClass),p.children().addClass("ui-state-disabled"),p.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=n.map(this._disabledInputs,function(b){return b===l?null:b}),this._disabledInputs[this._disabledInputs.length]=l)},_isDisabledDatepicker:function(l){if(!l)return!1;for(var u=0;u<this._disabledInputs.length;u++)if(this._disabledInputs[u]===l)return!0;return!1},_getInst:function(l){try{return n.data(l,"datepicker")}catch{throw"Missing instance data for this datepicker"}},_optionDatepicker:function(l,u,p){var g,C,b,P,O=this._getInst(l);if(arguments.length===2&&typeof u=="string")return u==="defaults"?n.extend({},n.datepicker._defaults):O?u==="all"?n.extend({},O.settings):this._get(O,u):null;g=u||{},typeof u=="string"&&(g={},g[u]=p),O&&(this._curInst===O&&this._hideDatepicker(),C=this._getDateDatepicker(l,!0),b=this._getMinMaxDate(O,"min"),P=this._getMinMaxDate(O,"max"),ue(O.settings,g),b!==null&&g.dateFormat!==void 0&&g.minDate===void 0&&(O.settings.minDate=this._formatDate(O,b)),P!==null&&g.dateFormat!==void 0&&g.maxDate===void 0&&(O.settings.maxDate=this._formatDate(O,P)),"disabled"in g&&(g.disabled?this._disableDatepicker(l):this._enableDatepicker(l)),this._attachments(n(l),O),this._autoSize(O),this._setDate(O,C),this._updateAlternate(O),this._updateDatepicker(O))},_changeDatepicker:function(l,u,p){this._optionDatepicker(l,u,p)},_refreshDatepicker:function(l){var u=this._getInst(l);u&&this._updateDatepicker(u)},_setDateDatepicker:function(l,u){var p=this._getInst(l);p&&(this._setDate(p,u),this._updateDatepicker(p),this._updateAlternate(p))},_getDateDatepicker:function(l,u){var p=this._getInst(l);return p&&!p.inline&&this._setDateFromField(p,u),p?this._getDate(p):null},_doKeyDown:function(l){var u,p,g,C=n.datepicker._getInst(l.target),b=!0,P=C.dpDiv.is(".ui-datepicker-rtl");if(C._keyEvent=!0,n.datepicker._datepickerShowing)switch(l.keyCode){case 9:n.datepicker._hideDatepicker(),b=!1;break;case 13:return g=n("td."+n.datepicker._dayOverClass+":not(."+n.datepicker._currentClass+")",C.dpDiv),g[0]&&n.datepicker._selectDay(l.target,C.selectedMonth,C.selectedYear,g[0]),u=n.datepicker._get(C,"onSelect"),u?(p=n.datepicker._formatDate(C),u.apply(C.input?C.input[0]:null,[p,C])):n.datepicker._hideDatepicker(),!1;case 27:n.datepicker._hideDatepicker();break;case 33:n.datepicker._adjustDate(l.target,l.ctrlKey?-n.datepicker._get(C,"stepBigMonths"):-n.datepicker._get(C,"stepMonths"),"M");break;case 34:n.datepicker._adjustDate(l.target,l.ctrlKey?+n.datepicker._get(C,"stepBigMonths"):+n.datepicker._get(C,"stepMonths"),"M");break;case 35:(l.ctrlKey||l.metaKey)&&n.datepicker._clearDate(l.target),b=l.ctrlKey||l.metaKey;break;case 36:(l.ctrlKey||l.metaKey)&&n.datepicker._gotoToday(l.target),b=l.ctrlKey||l.metaKey;break;case 37:(l.ctrlKey||l.metaKey)&&n.datepicker._adjustDate(l.target,P?1:-1,"D"),b=l.ctrlKey||l.metaKey,l.originalEvent.altKey&&n.datepicker._adjustDate(l.target,l.ctrlKey?-n.datepicker._get(C,"stepBigMonths"):-n.datepicker._get(C,"stepMonths"),"M");break;case 38:(l.ctrlKey||l.metaKey)&&n.datepicker._adjustDate(l.target,-7,"D"),b=l.ctrlKey||l.metaKey;break;case 39:(l.ctrlKey||l.metaKey)&&n.datepicker._adjustDate(l.target,P?-1:1,"D"),b=l.ctrlKey||l.metaKey,l.originalEvent.altKey&&n.datepicker._adjustDate(l.target,l.ctrlKey?+n.datepicker._get(C,"stepBigMonths"):+n.datepicker._get(C,"stepMonths"),"M");break;case 40:(l.ctrlKey||l.metaKey)&&n.datepicker._adjustDate(l.target,7,"D"),b=l.ctrlKey||l.metaKey;break;default:b=!1}else l.keyCode===36&&l.ctrlKey?n.datepicker._showDatepicker(this):b=!1;b&&(l.preventDefault(),l.stopPropagation())},_doKeyPress:function(l){var u,p,g=n.datepicker._getInst(l.target);if(n.datepicker._get(g,"constrainInput"))return u=n.datepicker._possibleChars(n.datepicker._get(g,"dateFormat")),p=String.fromCharCode(l.charCode==null?l.keyCode:l.charCode),l.ctrlKey||l.metaKey||p<" "||!u||u.indexOf(p)>-1},_doKeyUp:function(l){var u,p=n.datepicker._getInst(l.target);if(p.input.val()!==p.lastVal)try{u=n.datepicker.parseDate(n.datepicker._get(p,"dateFormat"),p.input?p.input.val():null,n.datepicker._getFormatConfig(p)),u&&(n.datepicker._setDateFromField(p),n.datepicker._updateAlternate(p),n.datepicker._updateDatepicker(p))}catch{}return!0},_showDatepicker:function(l){if(l=l.target||l,l.nodeName.toLowerCase()!=="input"&&(l=n("input",l.parentNode)[0]),!(n.datepicker._isDisabledDatepicker(l)||n.datepicker._lastInput===l)){var u,p,g,C,b,P,O;u=n.datepicker._getInst(l),n.datepicker._curInst&&n.datepicker._curInst!==u&&(n.datepicker._curInst.dpDiv.stop(!0,!0),u&&n.datepicker._datepickerShowing&&n.datepicker._hideDatepicker(n.datepicker._curInst.input[0])),p=n.datepicker._get(u,"beforeShow"),g=p?p.apply(l,[l,u]):{},g!==!1&&(ue(u.settings,g),u.lastVal=null,n.datepicker._lastInput=l,n.datepicker._setDateFromField(u),n.datepicker._inDialog&&(l.value=""),n.datepicker._pos||(n.datepicker._pos=n.datepicker._findPos(l),n.datepicker._pos[1]+=l.offsetHeight),C=!1,n(l).parents().each(function(){return C|=n(this).css("position")==="fixed",!C}),b={left:n.datepicker._pos[0],top:n.datepicker._pos[1]},n.datepicker._pos=null,u.dpDiv.empty(),u.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),n.datepicker._updateDatepicker(u),b=n.datepicker._checkOffset(u,b,C),u.dpDiv.css({position:n.datepicker._inDialog&&n.blockUI?"static":C?"fixed":"absolute",display:"none",left:b.left+"px",top:b.top+"px"}),u.inline||(P=n.datepicker._get(u,"showAnim"),O=n.datepicker._get(u,"duration"),u.dpDiv.css("z-index",pe(n(l))+1),n.datepicker._datepickerShowing=!0,n.effects&&n.effects.effect[P]?u.dpDiv.show(P,n.datepicker._get(u,"showOptions"),O):u.dpDiv[P||"show"](P?O:null),n.datepicker._shouldFocusInput(u)&&u.input.trigger("focus"),n.datepicker._curInst=u))}},_updateDatepicker:function(l){this.maxRows=4,Te=l,l.dpDiv.empty().append(this._generateHTML(l)),this._attachHandlers(l);var u,p=this._getNumberOfMonths(l),g=p[1],C=17,b=l.dpDiv.find("."+this._dayOverClass+" a"),P=n.datepicker._get(l,"onUpdateDatepicker");b.length>0&&ge.apply(b.get(0)),l.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),g>1&&l.dpDiv.addClass("ui-datepicker-multi-"+g).css("width",C*g+"em"),l.dpDiv[(p[0]!==1||p[1]!==1?"add":"remove")+"Class"]("ui-datepicker-multi"),l.dpDiv[(this._get(l,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),l===n.datepicker._curInst&&n.datepicker._datepickerShowing&&n.datepicker._shouldFocusInput(l)&&l.input.trigger("focus"),l.yearshtml&&(u=l.yearshtml,setTimeout(function(){u===l.yearshtml&&l.yearshtml&&l.dpDiv.find("select.ui-datepicker-year").first().replaceWith(l.yearshtml),u=l.yearshtml=null},0)),P&&P.apply(l.input?l.input[0]:null,[l])},_shouldFocusInput:function(l){return l.input&&l.input.is(":visible")&&!l.input.is(":disabled")&&!l.input.is(":focus")},_checkOffset:function(l,u,p){var g=l.dpDiv.outerWidth(),C=l.dpDiv.outerHeight(),b=l.input?l.input.outerWidth():0,P=l.input?l.input.outerHeight():0,O=document.documentElement.clientWidth+(p?0:n(document).scrollLeft()),L=document.documentElement.clientHeight+(p?0:n(document).scrollTop());return u.left-=this._get(l,"isRTL")?g-b:0,u.left-=p&&u.left===l.input.offset().left?n(document).scrollLeft():0,u.top-=p&&u.top===l.input.offset().top+P?n(document).scrollTop():0,u.left-=Math.min(u.left,u.left+g>O&&O>g?Math.abs(u.left+g-O):0),u.top-=Math.min(u.top,u.top+C>L&&L>C?Math.abs(C+P):0),u},_findPos:function(l){for(var u,p=this._getInst(l),g=this._get(p,"isRTL");l&&(l.type==="hidden"||l.nodeType!==1||n.expr.pseudos.hidden(l));)l=l[g?"previousSibling":"nextSibling"];return u=n(l).offset(),[u.left,u.top]},_hideDatepicker:function(l){var u,p,g,C,b=this._curInst;!b||l&&b!==n.data(l,"datepicker")||this._datepickerShowing&&(u=this._get(b,"showAnim"),p=this._get(b,"duration"),g=function(){n.datepicker._tidyDialog(b)},n.effects&&(n.effects.effect[u]||n.effects[u])?b.dpDiv.hide(u,n.datepicker._get(b,"showOptions"),p,g):b.dpDiv[u==="slideDown"?"slideUp":u==="fadeIn"?"fadeOut":"hide"](u?p:null,g),u||g(),this._datepickerShowing=!1,C=this._get(b,"onClose"),C&&C.apply(b.input?b.input[0]:null,[b.input?b.input.val():"",b]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),n.blockUI&&(n.unblockUI(),n("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(l){l.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(l){if(n.datepicker._curInst){var u=n(l.target),p=n.datepicker._getInst(u[0]);(u[0].id!==n.datepicker._mainDivId&&u.parents("#"+n.datepicker._mainDivId).length===0&&!u.hasClass(n.datepicker.markerClassName)&&!u.closest("."+n.datepicker._triggerClass).length&&n.datepicker._datepickerShowing&&!(n.datepicker._inDialog&&n.blockUI)||u.hasClass(n.datepicker.markerClassName)&&n.datepicker._curInst!==p)&&n.datepicker._hideDatepicker()}},_adjustDate:function(l,u,p){var g=n(l),C=this._getInst(g[0]);this._isDisabledDatepicker(g[0])||(this._adjustInstDate(C,u,p),this._updateDatepicker(C))},_gotoToday:function(l){var u,p=n(l),g=this._getInst(p[0]);this._get(g,"gotoCurrent")&&g.currentDay?(g.selectedDay=g.currentDay,g.drawMonth=g.selectedMonth=g.currentMonth,g.drawYear=g.selectedYear=g.currentYear):(u=new Date,g.selectedDay=u.getDate(),g.drawMonth=g.selectedMonth=u.getMonth(),g.drawYear=g.selectedYear=u.getFullYear()),this._notifyChange(g),this._adjustDate(p)},_selectMonthYear:function(l,u,p){var g=n(l),C=this._getInst(g[0]);C["selected"+(p==="M"?"Month":"Year")]=C["draw"+(p==="M"?"Month":"Year")]=parseInt(u.options[u.selectedIndex].value,10),this._notifyChange(C),this._adjustDate(g)},_selectDay:function(l,u,p,g){var C,b=n(l);n(g).hasClass(this._unselectableClass)||this._isDisabledDatepicker(b[0])||(C=this._getInst(b[0]),C.selectedDay=C.currentDay=parseInt(n("a",g).attr("data-date")),C.selectedMonth=C.currentMonth=u,C.selectedYear=C.currentYear=p,this._selectDate(l,this._formatDate(C,C.currentDay,C.currentMonth,C.currentYear)))},_clearDate:function(l){var u=n(l);this._selectDate(u,"")},_selectDate:function(l,u){var p,g=n(l),C=this._getInst(g[0]);u=u??this._formatDate(C),C.input&&C.input.val(u),this._updateAlternate(C),p=this._get(C,"onSelect"),p?p.apply(C.input?C.input[0]:null,[u,C]):C.input&&C.input.trigger("change"),C.inline?this._updateDatepicker(C):(this._hideDatepicker(),this._lastInput=C.input[0],typeof C.input[0]!="object"&&C.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(l){var u,p,g,C=this._get(l,"altField");C&&(u=this._get(l,"altFormat")||this._get(l,"dateFormat"),p=this._getDate(l),g=this.formatDate(u,p,this._getFormatConfig(l)),n(document).find(C).val(g))},noWeekends:function(l){var u=l.getDay();return[u>0&&u<6,""]},iso8601Week:function(l){var u,p=new Date(l.getTime());return p.setDate(p.getDate()+4-(p.getDay()||7)),u=p.getTime(),p.setMonth(0),p.setDate(1),Math.floor(Math.round((u-p)/864e5)/7)+1},parseDate:function(l,u,p){if(l==null||u==null)throw"Invalid arguments";if(u=typeof u=="object"?u.toString():u+"",u==="")return null;var g,C,b,P=0,O=(p?p.shortYearCutoff:null)||this._defaults.shortYearCutoff,L=typeof O!="string"?O:new Date().getFullYear()%100+parseInt(O,10),U=(p?p.dayNamesShort:null)||this._defaults.dayNamesShort,H=(p?p.dayNames:null)||this._defaults.dayNames,ee=(p?p.monthNamesShort:null)||this._defaults.monthNamesShort,ae=(p?p.monthNames:null)||this._defaults.monthNames,Y=-1,Z=-1,ce=-1,ye=-1,ve=!1,Ee,Re=function(Ae){var Ue=g+1<l.length&&l.charAt(g+1)===Ae;return Ue&&g++,Ue},Ne=function(Ae){var Ue=Re(Ae),Ce=Ae==="@"?14:Ae==="!"?20:Ae==="y"&&Ue?4:Ae==="o"?3:2,Oe=Ae==="y"?Ce:1,Ve=new RegExp("^\\d{"+Oe+","+Ce+"}"),tt=u.substring(P).match(Ve);if(!tt)throw"Missing number at position "+P;return P+=tt[0].length,parseInt(tt[0],10)},Fe=function(Ae,Ue,Ce){var Oe=-1,Ve=n.map(Re(Ae)?Ce:Ue,function(tt,it){return[[it,tt]]}).sort(function(tt,it){return-(tt[1].length-it[1].length)});if(n.each(Ve,function(tt,it){var ct=it[1];if(u.substr(P,ct.length).toLowerCase()===ct.toLowerCase())return Oe=it[0],P+=ct.length,!1}),Oe!==-1)return Oe+1;throw"Unknown name at position "+P},De=function(){if(u.charAt(P)!==l.charAt(g))throw"Unexpected literal at position "+P;P++};for(g=0;g<l.length;g++)if(ve)l.charAt(g)==="'"&&!Re("'")?ve=!1:De();else switch(l.charAt(g)){case"d":ce=Ne("d");break;case"D":Fe("D",U,H);break;case"o":ye=Ne("o");break;case"m":Z=Ne("m");break;case"M":Z=Fe("M",ee,ae);break;case"y":Y=Ne("y");break;case"@":Ee=new Date(Ne("@")),Y=Ee.getFullYear(),Z=Ee.getMonth()+1,ce=Ee.getDate();break;case"!":Ee=new Date((Ne("!")-this._ticksTo1970)/1e4),Y=Ee.getFullYear(),Z=Ee.getMonth()+1,ce=Ee.getDate();break;case"'":Re("'")?De():ve=!0;break;default:De()}if(P<u.length&&(b=u.substr(P),!/^\s+/.test(b)))throw"Extra/unparsed characters found in date: "+b;if(Y===-1?Y=new Date().getFullYear():Y<100&&(Y+=new Date().getFullYear()-new Date().getFullYear()%100+(Y<=L?0:-100)),ye>-1){Z=1,ce=ye;do{if(C=this._getDaysInMonth(Y,Z-1),ce<=C)break;Z++,ce-=C}while(!0)}if(Ee=this._daylightSavingAdjust(new Date(Y,Z-1,ce)),Ee.getFullYear()!==Y||Ee.getMonth()+1!==Z||Ee.getDate()!==ce)throw"Invalid date";return Ee},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(1969*365+Math.floor(1970/4)-Math.floor(1970/100)+Math.floor(1970/400))*24*60*60*1e7,formatDate:function(l,u,p){if(!u)return"";var g,C=(p?p.dayNamesShort:null)||this._defaults.dayNamesShort,b=(p?p.dayNames:null)||this._defaults.dayNames,P=(p?p.monthNamesShort:null)||this._defaults.monthNamesShort,O=(p?p.monthNames:null)||this._defaults.monthNames,L=function(Y){var Z=g+1<l.length&&l.charAt(g+1)===Y;return Z&&g++,Z},U=function(Y,Z,ce){var ye=""+Z;if(L(Y))for(;ye.length<ce;)ye="0"+ye;return ye},H=function(Y,Z,ce,ye){return L(Y)?ye[Z]:ce[Z]},ee="",ae=!1;if(u)for(g=0;g<l.length;g++)if(ae)l.charAt(g)==="'"&&!L("'")?ae=!1:ee+=l.charAt(g);else switch(l.charAt(g)){case"d":ee+=U("d",u.getDate(),2);break;case"D":ee+=H("D",u.getDay(),C,b);break;case"o":ee+=U("o",Math.round((new Date(u.getFullYear(),u.getMonth(),u.getDate()).getTime()-new Date(u.getFullYear(),0,0).getTime())/864e5),3);break;case"m":ee+=U("m",u.getMonth()+1,2);break;case"M":ee+=H("M",u.getMonth(),P,O);break;case"y":ee+=L("y")?u.getFullYear():(u.getFullYear()%100<10?"0":"")+u.getFullYear()%100;break;case"@":ee+=u.getTime();break;case"!":ee+=u.getTime()*1e4+this._ticksTo1970;break;case"'":L("'")?ee+="'":ae=!0;break;default:ee+=l.charAt(g)}return ee},_possibleChars:function(l){var u,p="",g=!1,C=function(b){var P=u+1<l.length&&l.charAt(u+1)===b;return P&&u++,P};for(u=0;u<l.length;u++)if(g)l.charAt(u)==="'"&&!C("'")?g=!1:p+=l.charAt(u);else switch(l.charAt(u)){case"d":case"m":case"y":case"@":p+="0123456789";break;case"D":case"M":return null;case"'":C("'")?p+="'":g=!0;break;default:p+=l.charAt(u)}return p},_get:function(l,u){return l.settings[u]!==void 0?l.settings[u]:this._defaults[u]},_setDateFromField:function(l,u){if(l.input.val()!==l.lastVal){var p=this._get(l,"dateFormat"),g=l.lastVal=l.input?l.input.val():null,C=this._getDefaultDate(l),b=C,P=this._getFormatConfig(l);try{b=this.parseDate(p,g,P)||C}catch{g=u?"":g}l.selectedDay=b.getDate(),l.drawMonth=l.selectedMonth=b.getMonth(),l.drawYear=l.selectedYear=b.getFullYear(),l.currentDay=g?b.getDate():0,l.currentMonth=g?b.getMonth():0,l.currentYear=g?b.getFullYear():0,this._adjustInstDate(l)}},_getDefaultDate:function(l){return this._restrictMinMax(l,this._determineDate(l,this._get(l,"defaultDate"),new Date))},_determineDate:function(l,u,p){var g=function(P){var O=new Date;return O.setDate(O.getDate()+P),O},C=function(P){try{return n.datepicker.parseDate(n.datepicker._get(l,"dateFormat"),P,n.datepicker._getFormatConfig(l))}catch{}for(var O=(P.toLowerCase().match(/^c/)?n.datepicker._getDate(l):null)||new Date,L=O.getFullYear(),U=O.getMonth(),H=O.getDate(),ee=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,ae=ee.exec(P);ae;){switch(ae[2]||"d"){case"d":case"D":H+=parseInt(ae[1],10);break;case"w":case"W":H+=parseInt(ae[1],10)*7;break;case"m":case"M":U+=parseInt(ae[1],10),H=Math.min(H,n.datepicker._getDaysInMonth(L,U));break;case"y":case"Y":L+=parseInt(ae[1],10),H=Math.min(H,n.datepicker._getDaysInMonth(L,U));break}ae=ee.exec(P)}return new Date(L,U,H)},b=u==null||u===""?p:typeof u=="string"?C(u):typeof u=="number"?isNaN(u)?p:g(u):new Date(u.getTime());return b=b&&b.toString()==="Invalid Date"?p:b,b&&(b.setHours(0),b.setMinutes(0),b.setSeconds(0),b.setMilliseconds(0)),this._daylightSavingAdjust(b)},_daylightSavingAdjust:function(l){return l?(l.setHours(l.getHours()>12?l.getHours()+2:0),l):null},_setDate:function(l,u,p){var g=!u,C=l.selectedMonth,b=l.selectedYear,P=this._restrictMinMax(l,this._determineDate(l,u,new Date));l.selectedDay=l.currentDay=P.getDate(),l.drawMonth=l.selectedMonth=l.currentMonth=P.getMonth(),l.drawYear=l.selectedYear=l.currentYear=P.getFullYear(),(C!==l.selectedMonth||b!==l.selectedYear)&&!p&&this._notifyChange(l),this._adjustInstDate(l),l.input&&l.input.val(g?"":this._formatDate(l))},_getDate:function(l){var u=!l.currentYear||l.input&&l.input.val()===""?null:this._daylightSavingAdjust(new Date(l.currentYear,l.currentMonth,l.currentDay));return u},_attachHandlers:function(l){var u=this._get(l,"stepMonths"),p="#"+l.id.replace(/\\\\/g,"\\");l.dpDiv.find("[data-handler]").map(function(){var g={prev:function(){n.datepicker._adjustDate(p,-u,"M")},next:function(){n.datepicker._adjustDate(p,+u,"M")},hide:function(){n.datepicker._hideDatepicker()},today:function(){n.datepicker._gotoToday(p)},selectDay:function(){return n.datepicker._selectDay(p,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return n.datepicker._selectMonthYear(p,this,"M"),!1},selectYear:function(){return n.datepicker._selectMonthYear(p,this,"Y"),!1}};n(this).on(this.getAttribute("data-event"),g[this.getAttribute("data-handler")])})},_generateHTML:function(l){var u,p,g,C,b,P,O,L,U,H,ee,ae,Y,Z,ce,ye,ve,Ee,Re,Ne,Fe,De,Ae,Ue,Ce,Oe,Ve,tt,it,ct,mt,st,ut,J,ze,pt,ot,Ct,St,vt=new Date,at=this._daylightSavingAdjust(new Date(vt.getFullYear(),vt.getMonth(),vt.getDate())),lt=this._get(l,"isRTL"),Vt=this._get(l,"showButtonPanel"),kt=this._get(l,"hideIfNoPrevNext"),Qe=this._get(l,"navigationAsDateFormat"),Ke=this._getNumberOfMonths(l),gt=this._get(l,"showCurrentAtPos"),bt=this._get(l,"stepMonths"),dt=Ke[0]!==1||Ke[1]!==1,_t=this._daylightSavingAdjust(l.currentDay?new Date(l.currentYear,l.currentMonth,l.currentDay):new Date(9999,9,9)),rt=this._getMinMaxDate(l,"min"),$e=this._getMinMaxDate(l,"max"),He=l.drawMonth-gt,Je=l.drawYear;if(He<0&&(He+=12,Je--),$e)for(u=this._daylightSavingAdjust(new Date($e.getFullYear(),$e.getMonth()-Ke[0]*Ke[1]+1,$e.getDate())),u=rt&&u<rt?rt:u;this._daylightSavingAdjust(new Date(Je,He,1))>u;)He--,He<0&&(He=11,Je--);for(l.drawMonth=He,l.drawYear=Je,p=this._get(l,"prevText"),p=Qe?this.formatDate(p,this._daylightSavingAdjust(new Date(Je,He-bt,1)),this._getFormatConfig(l)):p,this._canAdjustMonth(l,-1,Je,He)?g=n("<a>").attr({class:"ui-datepicker-prev ui-corner-all","data-handler":"prev","data-event":"click",title:p}).append(n("<span>").addClass("ui-icon ui-icon-circle-triangle-"+(lt?"e":"w")).text(p))[0].outerHTML:kt?g="":g=n("<a>").attr({class:"ui-datepicker-prev ui-corner-all ui-state-disabled",title:p}).append(n("<span>").addClass("ui-icon ui-icon-circle-triangle-"+(lt?"e":"w")).text(p))[0].outerHTML,C=this._get(l,"nextText"),C=Qe?this.formatDate(C,this._daylightSavingAdjust(new Date(Je,He+bt,1)),this._getFormatConfig(l)):C,this._canAdjustMonth(l,1,Je,He)?b=n("<a>").attr({class:"ui-datepicker-next ui-corner-all","data-handler":"next","data-event":"click",title:C}).append(n("<span>").addClass("ui-icon ui-icon-circle-triangle-"+(lt?"w":"e")).text(C))[0].outerHTML:kt?b="":b=n("<a>").attr({class:"ui-datepicker-next ui-corner-all ui-state-disabled",title:C}).append(n("<span>").attr("class","ui-icon ui-icon-circle-triangle-"+(lt?"w":"e")).text(C))[0].outerHTML,P=this._get(l,"currentText"),O=this._get(l,"gotoCurrent")&&l.currentDay?_t:at,P=Qe?this.formatDate(P,O,this._getFormatConfig(l)):P,L="",l.inline||(L=n("<button>").attr({type:"button",class:"ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all","data-handler":"hide","data-event":"click"}).text(this._get(l,"closeText"))[0].outerHTML),U="",Vt&&(U=n("<div class='ui-datepicker-buttonpane ui-widget-content'>").append(lt?L:"").append(this._isInRange(l,O)?n("<button>").attr({type:"button",class:"ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all","data-handler":"today","data-event":"click"}).text(P):"").append(lt?"":L)[0].outerHTML),H=parseInt(this._get(l,"firstDay"),10),H=isNaN(H)?0:H,ee=this._get(l,"showWeek"),ae=this._get(l,"dayNames"),Y=this._get(l,"dayNamesMin"),Z=this._get(l,"monthNames"),ce=this._get(l,"monthNamesShort"),ye=this._get(l,"beforeShowDay"),ve=this._get(l,"showOtherMonths"),Ee=this._get(l,"selectOtherMonths"),Re=this._getDefaultDate(l),Ne="",De=0;De<Ke[0];De++){for(Ae="",this.maxRows=4,Ue=0;Ue<Ke[1];Ue++){if(Ce=this._daylightSavingAdjust(new Date(Je,He,l.selectedDay)),Oe=" ui-corner-all",Ve="",dt){if(Ve+="<div class='ui-datepicker-group",Ke[1]>1)switch(Ue){case 0:Ve+=" ui-datepicker-group-first",Oe=" ui-corner-"+(lt?"right":"left");break;case Ke[1]-1:Ve+=" ui-datepicker-group-last",Oe=" ui-corner-"+(lt?"left":"right");break;default:Ve+=" ui-datepicker-group-middle",Oe="";break}Ve+="'>"}for(Ve+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+Oe+"'>"+(/all|left/.test(Oe)&&De===0?lt?b:g:"")+(/all|right/.test(Oe)&&De===0?lt?g:b:"")+this._generateMonthYearHeader(l,He,Je,rt,$e,De>0||Ue>0,Z,ce)+"</div><table class='ui-datepicker-calendar'><thead><tr>",tt=ee?"<th class='ui-datepicker-week-col'>"+this._get(l,"weekHeader")+"</th>":"",Fe=0;Fe<7;Fe++)it=(Fe+H)%7,tt+="<th scope='col'"+((Fe+H+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+ae[it]+"'>"+Y[it]+"</span></th>";for(Ve+=tt+"</tr></thead><tbody>",ct=this._getDaysInMonth(Je,He),Je===l.selectedYear&&He===l.selectedMonth&&(l.selectedDay=Math.min(l.selectedDay,ct)),mt=(this._getFirstDayOfMonth(Je,He)-H+7)%7,st=Math.ceil((mt+ct)/7),ut=dt&&this.maxRows>st?this.maxRows:st,this.maxRows=ut,J=this._daylightSavingAdjust(new Date(Je,He,1-mt)),ze=0;ze<ut;ze++){for(Ve+="<tr>",pt=ee?"<td class='ui-datepicker-week-col'>"+this._get(l,"calculateWeek")(J)+"</td>":"",Fe=0;Fe<7;Fe++)ot=ye?ye.apply(l.input?l.input[0]:null,[J]):[!0,""],Ct=J.getMonth()!==He,St=Ct&&!Ee||!ot[0]||rt&&J<rt||$e&&J>$e,pt+="<td class='"+((Fe+H+6)%7>=5?" ui-datepicker-week-end":"")+(Ct?" ui-datepicker-other-month":"")+(J.getTime()===Ce.getTime()&&He===l.selectedMonth&&l._keyEvent||Re.getTime()===J.getTime()&&Re.getTime()===Ce.getTime()?" "+this._dayOverClass:"")+(St?" "+this._unselectableClass+" ui-state-disabled":"")+(Ct&&!ve?"":" "+ot[1]+(J.getTime()===_t.getTime()?" "+this._currentClass:"")+(J.getTime()===at.getTime()?" ui-datepicker-today":""))+"'"+((!Ct||ve)&&ot[2]?" title='"+ot[2].replace(/'/g,"&#39;")+"'":"")+(St?"":" data-handler='selectDay' data-event='click' data-month='"+J.getMonth()+"' data-year='"+J.getFullYear()+"'")+">"+(Ct&&!ve?"&#xa0;":St?"<span class='ui-state-default'>"+J.getDate()+"</span>":"<a class='ui-state-default"+(J.getTime()===at.getTime()?" ui-state-highlight":"")+(J.getTime()===_t.getTime()?" ui-state-active":"")+(Ct?" ui-priority-secondary":"")+"' href='#' aria-current='"+(J.getTime()===_t.getTime()?"true":"false")+"' data-date='"+J.getDate()+"'>"+J.getDate()+"</a>")+"</td>",J.setDate(J.getDate()+1),J=this._daylightSavingAdjust(J);Ve+=pt+"</tr>"}He++,He>11&&(He=0,Je++),Ve+="</tbody></table>"+(dt?"</div>"+(Ke[0]>0&&Ue===Ke[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),Ae+=Ve}Ne+=Ae}return Ne+=U,l._keyEvent=!1,Ne},_generateMonthYearHeader:function(l,u,p,g,C,b,P,O){var L,U,H,ee,ae,Y,Z,ce,ye=this._get(l,"changeMonth"),ve=this._get(l,"changeYear"),Ee=this._get(l,"showMonthAfterYear"),Re=this._get(l,"selectMonthLabel"),Ne=this._get(l,"selectYearLabel"),Fe="<div class='ui-datepicker-title'>",De="";if(b||!ye)De+="<span class='ui-datepicker-month'>"+P[u]+"</span>";else{for(L=g&&g.getFullYear()===p,U=C&&C.getFullYear()===p,De+="<select class='ui-datepicker-month' aria-label='"+Re+"' data-handler='selectMonth' data-event='change'>",H=0;H<12;H++)(!L||H>=g.getMonth())&&(!U||H<=C.getMonth())&&(De+="<option value='"+H+"'"+(H===u?" selected='selected'":"")+">"+O[H]+"</option>");De+="</select>"}if(Ee||(Fe+=De+(b||!(ye&&ve)?"&#xa0;":"")),!l.yearshtml)if(l.yearshtml="",b||!ve)Fe+="<span class='ui-datepicker-year'>"+p+"</span>";else{for(ee=this._get(l,"yearRange").split(":"),ae=new Date().getFullYear(),Y=function(Ae){var Ue=Ae.match(/c[+\-].*/)?p+parseInt(Ae.substring(1),10):Ae.match(/[+\-].*/)?ae+parseInt(Ae,10):parseInt(Ae,10);return isNaN(Ue)?ae:Ue},Z=Y(ee[0]),ce=Math.max(Z,Y(ee[1]||"")),Z=g?Math.max(Z,g.getFullYear()):Z,ce=C?Math.min(ce,C.getFullYear()):ce,l.yearshtml+="<select class='ui-datepicker-year' aria-label='"+Ne+"' data-handler='selectYear' data-event='change'>";Z<=ce;Z++)l.yearshtml+="<option value='"+Z+"'"+(Z===p?" selected='selected'":"")+">"+Z+"</option>";l.yearshtml+="</select>",Fe+=l.yearshtml,l.yearshtml=null}return Fe+=this._get(l,"yearSuffix"),Ee&&(Fe+=(b||!(ye&&ve)?"&#xa0;":"")+De),Fe+="</div>",Fe},_adjustInstDate:function(l,u,p){var g=l.selectedYear+(p==="Y"?u:0),C=l.selectedMonth+(p==="M"?u:0),b=Math.min(l.selectedDay,this._getDaysInMonth(g,C))+(p==="D"?u:0),P=this._restrictMinMax(l,this._daylightSavingAdjust(new Date(g,C,b)));l.selectedDay=P.getDate(),l.drawMonth=l.selectedMonth=P.getMonth(),l.drawYear=l.selectedYear=P.getFullYear(),(p==="M"||p==="Y")&&this._notifyChange(l)},_restrictMinMax:function(l,u){var p=this._getMinMaxDate(l,"min"),g=this._getMinMaxDate(l,"max"),C=p&&u<p?p:u;return g&&C>g?g:C},_notifyChange:function(l){var u=this._get(l,"onChangeMonthYear");u&&u.apply(l.input?l.input[0]:null,[l.selectedYear,l.selectedMonth+1,l])},_getNumberOfMonths:function(l){var u=this._get(l,"numberOfMonths");return u==null?[1,1]:typeof u=="number"?[1,u]:u},_getMinMaxDate:function(l,u){return this._determineDate(l,this._get(l,u+"Date"),null)},_getDaysInMonth:function(l,u){return 32-this._daylightSavingAdjust(new Date(l,u,32)).getDate()},_getFirstDayOfMonth:function(l,u){return new Date(l,u,1).getDay()},_canAdjustMonth:function(l,u,p,g){var C=this._getNumberOfMonths(l),b=this._daylightSavingAdjust(new Date(p,g+(u<0?u:C[0]*C[1]),1));return u<0&&b.setDate(this._getDaysInMonth(b.getFullYear(),b.getMonth())),this._isInRange(l,b)},_isInRange:function(l,u){var p,g,C=this._getMinMaxDate(l,"min"),b=this._getMinMaxDate(l,"max"),P=null,O=null,L=this._get(l,"yearRange");return L&&(p=L.split(":"),g=new Date().getFullYear(),P=parseInt(p[0],10),O=parseInt(p[1],10),p[0].match(/[+\-].*/)&&(P+=g),p[1].match(/[+\-].*/)&&(O+=g)),(!C||u.getTime()>=C.getTime())&&(!b||u.getTime()<=b.getTime())&&(!P||u.getFullYear()>=P)&&(!O||u.getFullYear()<=O)},_getFormatConfig:function(l){var u=this._get(l,"shortYearCutoff");return u=typeof u!="string"?u:new Date().getFullYear()%100+parseInt(u,10),{shortYearCutoff:u,dayNamesShort:this._get(l,"dayNamesShort"),dayNames:this._get(l,"dayNames"),monthNamesShort:this._get(l,"monthNamesShort"),monthNames:this._get(l,"monthNames")}},_formatDate:function(l,u,p,g){u||(l.currentDay=l.selectedDay,l.currentMonth=l.selectedMonth,l.currentYear=l.selectedYear);var C=u?typeof u=="object"?u:this._daylightSavingAdjust(new Date(g,p,u)):this._daylightSavingAdjust(new Date(l.currentYear,l.currentMonth,l.currentDay));return this.formatDate(this._get(l,"dateFormat"),C,this._getFormatConfig(l))}});function he(l){var u="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return l.on("mouseout",u,function(){n(this).removeClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&n(this).removeClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&n(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",u,ge)}function ge(){n.datepicker._isDisabledDatepicker(Te.inline?Te.dpDiv.parent()[0]:Te.input[0])||(n(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),n(this).addClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&n(this).addClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&n(this).addClass("ui-datepicker-next-hover"))}function ue(l,u){n.extend(l,u);for(var p in u)u[p]==null&&(l[p]=u[p]);return l}n.fn.datepicker=function(l){if(!this.length)return this;n.datepicker.initialized||(n(document).on("mousedown",n.datepicker._checkExternalClick),n.datepicker.initialized=!0),n("#"+n.datepicker._mainDivId).length===0&&n("body").append(n.datepicker.dpDiv);var u=Array.prototype.slice.call(arguments,1);return typeof l=="string"&&(l==="isDisabled"||l==="getDate"||l==="widget")?n.datepicker["_"+l+"Datepicker"].apply(n.datepicker,[this[0]].concat(u)):l==="option"&&arguments.length===2&&typeof arguments[1]=="string"?n.datepicker["_"+l+"Datepicker"].apply(n.datepicker,[this[0]].concat(u)):this.each(function(){typeof l=="string"?n.datepicker["_"+l+"Datepicker"].apply(n.datepicker,[this].concat(u)):n.datepicker._attachDatepicker(this,l)})},n.datepicker=new ie,n.datepicker.initialized=!1,n.datepicker.uuid=new Date().getTime(),n.datepicker.version="1.13.3",n.datepicker,n.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());/*!
 * jQuery UI Mouse 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */var de=!1;n(document).on("mouseup",function(){de=!1}),n.widget("ui.mouse",{version:"1.13.3",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var l=this;this.element.on("mousedown."+this.widgetName,function(u){return l._mouseDown(u)}).on("click."+this.widgetName,function(u){if(n.data(u.target,l.widgetName+".preventClickEvent")===!0)return n.removeData(u.target,l.widgetName+".preventClickEvent"),u.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(l){if(!de){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(l),this._mouseDownEvent=l;var u=this,p=l.which===1,g=typeof this.options.cancel=="string"&&l.target.nodeName?n(l.target).closest(this.options.cancel).length:!1;return!p||g||!this._mouseCapture(l)?!0:(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){u.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(l)&&this._mouseDelayMet(l)&&(this._mouseStarted=this._mouseStart(l)!==!1,!this._mouseStarted)?(l.preventDefault(),!0):(n.data(l.target,this.widgetName+".preventClickEvent")===!0&&n.removeData(l.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(C){return u._mouseMove(C)},this._mouseUpDelegate=function(C){return u._mouseUp(C)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),l.preventDefault(),de=!0,!0))}},_mouseMove:function(l){if(this._mouseMoved){if(n.ui.ie&&(!document.documentMode||document.documentMode<9)&&!l.button)return this._mouseUp(l);if(!l.which){if(l.originalEvent.altKey||l.originalEvent.ctrlKey||l.originalEvent.metaKey||l.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(l)}}return(l.which||l.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(l),l.preventDefault()):(this._mouseDistanceMet(l)&&this._mouseDelayMet(l)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,l)!==!1,this._mouseStarted?this._mouseDrag(l):this._mouseUp(l)),!this._mouseStarted)},_mouseUp:function(l){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,l.target===this._mouseDownEvent.target&&n.data(l.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(l)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,de=!1,l.preventDefault()},_mouseDistanceMet:function(l){return Math.max(Math.abs(this._mouseDownEvent.pageX-l.pageX),Math.abs(this._mouseDownEvent.pageY-l.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),n.ui.plugin={add:function(l,u,p){var g,C=n.ui[l].prototype;for(g in p)C.plugins[g]=C.plugins[g]||[],C.plugins[g].push([u,p[g]])},call:function(l,u,p,g){var C,b=l.plugins[u];if(b&&!(!g&&(!l.element[0].parentNode||l.element[0].parentNode.nodeType===11)))for(C=0;C<b.length;C++)l.options[b[C][0]]&&b[C][1].apply(l.element,p)}},n.ui.safeBlur=function(l){l&&l.nodeName.toLowerCase()!=="body"&&n(l).trigger("blur")};/*!
 * jQuery UI Draggable 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.draggable",n.ui.mouse,{version:"1.13.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){this.options.helper==="original"&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(l,u){this._super(l,u),l==="handle"&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){if((this.helper||this.element).is(".ui-draggable-dragging")){this.destroyOnClear=!0;return}this._removeHandleClassName(),this._mouseDestroy()},_mouseCapture:function(l){var u=this.options;return this.helper||u.disabled||n(l.target).closest(".ui-resizable-handle").length>0||(this.handle=this._getHandle(l),!this.handle)?!1:(this._blurActiveElement(l),this._blockFrames(u.iframeFix===!0?"iframe":u.iframeFix),!0)},_blockFrames:function(l){this.iframeBlocks=this.document.find(l).map(function(){var u=n(this);return n("<div>").css("position","absolute").appendTo(u.parent()).outerWidth(u.outerWidth()).outerHeight(u.outerHeight()).offset(u.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(l){var u=n.ui.safeActiveElement(this.document[0]),p=n(l.target);p.closest(u).length||n.ui.safeBlur(u)},_mouseStart:function(l){var u=this.options;return this.helper=this._createHelper(l),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),n.ui.ddmanager&&(n.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return n(this).css("position")==="fixed"}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(l),this.originalPosition=this.position=this._generatePosition(l,!1),this.originalPageX=l.pageX,this.originalPageY=l.pageY,u.cursorAt&&this._adjustOffsetFromHelper(u.cursorAt),this._setContainment(),this._trigger("start",l)===!1?(this._clear(),!1):(this._cacheHelperProportions(),n.ui.ddmanager&&!u.dropBehaviour&&n.ui.ddmanager.prepareOffsets(this,l),this._mouseDrag(l,!0),n.ui.ddmanager&&n.ui.ddmanager.dragStart(this,l),!0)},_refreshOffsets:function(l){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:l.pageX-this.offset.left,top:l.pageY-this.offset.top}},_mouseDrag:function(l,u){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(l,!0),this.positionAbs=this._convertPositionTo("absolute"),!u){var p=this._uiHash();if(this._trigger("drag",l,p)===!1)return this._mouseUp(new n.Event("mouseup",l)),!1;this.position=p.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",n.ui.ddmanager&&n.ui.ddmanager.drag(this,l),!1},_mouseStop:function(l){var u=this,p=!1;return n.ui.ddmanager&&!this.options.dropBehaviour&&(p=n.ui.ddmanager.drop(this,l)),this.dropped&&(p=this.dropped,this.dropped=!1),this.options.revert==="invalid"&&!p||this.options.revert==="valid"&&p||this.options.revert===!0||typeof this.options.revert=="function"&&this.options.revert.call(this.element,p)?n(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){u._trigger("stop",l)!==!1&&u._clear()}):this._trigger("stop",l)!==!1&&this._clear(),!1},_mouseUp:function(l){return this._unblockFrames(),n.ui.ddmanager&&n.ui.ddmanager.dragStop(this,l),this.handleElement.is(l.target)&&this.element.trigger("focus"),n.ui.mouse.prototype._mouseUp.call(this,l)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new n.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(l){return this.options.handle?!!n(l.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(l){var u=this.options,p=typeof u.helper=="function",g=p?n(u.helper.apply(this.element[0],[l])):u.helper==="clone"?this.element.clone().removeAttr("id"):this.element;return g.parents("body").length||g.appendTo(u.appendTo==="parent"?this.element[0].parentNode:u.appendTo),p&&g[0]===this.element[0]&&this._setPositionRelative(),g[0]!==this.element[0]&&!/(fixed|absolute)/.test(g.css("position"))&&g.css("position","absolute"),g},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(l){typeof l=="string"&&(l=l.split(" ")),Array.isArray(l)&&(l={left:+l[0],top:+l[1]||0}),"left"in l&&(this.offset.click.left=l.left+this.margins.left),"right"in l&&(this.offset.click.left=this.helperProportions.width-l.right+this.margins.left),"top"in l&&(this.offset.click.top=l.top+this.margins.top),"bottom"in l&&(this.offset.click.top=this.helperProportions.height-l.bottom+this.margins.top)},_isRootNode:function(l){return/(html|body)/i.test(l.tagName)||l===this.document[0]},_getParentOffset:function(){var l=this.offsetParent.offset(),u=this.document[0];return this.cssPosition==="absolute"&&this.scrollParent[0]!==u&&n.contains(this.scrollParent[0],this.offsetParent[0])&&(l.left+=this.scrollParent.scrollLeft(),l.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(l={top:0,left:0}),{top:l.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:l.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition!=="relative")return{top:0,left:0};var l=this.element.position(),u=this._isRootNode(this.scrollParent[0]);return{top:l.top-(parseInt(this.helper.css("top"),10)||0)+(u?0:this.scrollParent.scrollTop()),left:l.left-(parseInt(this.helper.css("left"),10)||0)+(u?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var l,u,p,g=this.options,C=this.document[0];if(this.relativeContainer=null,!g.containment){this.containment=null;return}if(g.containment==="window"){this.containment=[n(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,n(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,n(window).scrollLeft()+n(window).width()-this.helperProportions.width-this.margins.left,n(window).scrollTop()+(n(window).height()||C.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(g.containment==="document"){this.containment=[0,0,n(C).width()-this.helperProportions.width-this.margins.left,(n(C).height()||C.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(g.containment.constructor===Array){this.containment=g.containment;return}g.containment==="parent"&&(g.containment=this.helper[0].parentNode),u=n(g.containment),p=u[0],p&&(l=/(scroll|auto)/.test(u.css("overflow")),this.containment=[(parseInt(u.css("borderLeftWidth"),10)||0)+(parseInt(u.css("paddingLeft"),10)||0),(parseInt(u.css("borderTopWidth"),10)||0)+(parseInt(u.css("paddingTop"),10)||0),(l?Math.max(p.scrollWidth,p.offsetWidth):p.offsetWidth)-(parseInt(u.css("borderRightWidth"),10)||0)-(parseInt(u.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(l?Math.max(p.scrollHeight,p.offsetHeight):p.offsetHeight)-(parseInt(u.css("borderBottomWidth"),10)||0)-(parseInt(u.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=u)},_convertPositionTo:function(l,u){u||(u=this.position);var p=l==="absolute"?1:-1,g=this._isRootNode(this.scrollParent[0]);return{top:u.top+this.offset.relative.top*p+this.offset.parent.top*p-(this.cssPosition==="fixed"?-this.offset.scroll.top:g?0:this.offset.scroll.top)*p,left:u.left+this.offset.relative.left*p+this.offset.parent.left*p-(this.cssPosition==="fixed"?-this.offset.scroll.left:g?0:this.offset.scroll.left)*p}},_generatePosition:function(l,u){var p,g,C,b,P=this.options,O=this._isRootNode(this.scrollParent[0]),L=l.pageX,U=l.pageY;return(!O||!this.offset.scroll)&&(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),u&&(this.containment&&(this.relativeContainer?(g=this.relativeContainer.offset(),p=[this.containment[0]+g.left,this.containment[1]+g.top,this.containment[2]+g.left,this.containment[3]+g.top]):p=this.containment,l.pageX-this.offset.click.left<p[0]&&(L=p[0]+this.offset.click.left),l.pageY-this.offset.click.top<p[1]&&(U=p[1]+this.offset.click.top),l.pageX-this.offset.click.left>p[2]&&(L=p[2]+this.offset.click.left),l.pageY-this.offset.click.top>p[3]&&(U=p[3]+this.offset.click.top)),P.grid&&(C=P.grid[1]?this.originalPageY+Math.round((U-this.originalPageY)/P.grid[1])*P.grid[1]:this.originalPageY,U=p?C-this.offset.click.top>=p[1]||C-this.offset.click.top>p[3]?C:C-this.offset.click.top>=p[1]?C-P.grid[1]:C+P.grid[1]:C,b=P.grid[0]?this.originalPageX+Math.round((L-this.originalPageX)/P.grid[0])*P.grid[0]:this.originalPageX,L=p?b-this.offset.click.left>=p[0]||b-this.offset.click.left>p[2]?b:b-this.offset.click.left>=p[0]?b-P.grid[0]:b+P.grid[0]:b),P.axis==="y"&&(L=this.originalPageX),P.axis==="x"&&(U=this.originalPageY)),{top:U-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.offset.scroll.top:O?0:this.offset.scroll.top),left:L-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.offset.scroll.left:O?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(l,u,p){return p=p||this._uiHash(),n.ui.plugin.call(this,l,[u,p,this],!0),/^(drag|start|stop)/.test(l)&&(this.positionAbs=this._convertPositionTo("absolute"),p.offset=this.positionAbs),n.Widget.prototype._trigger.call(this,l,u,p)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),n.ui.plugin.add("draggable","connectToSortable",{start:function(l,u,p){var g=n.extend({},u,{item:p.element});p.sortables=[],n(p.options.connectToSortable).each(function(){var C=n(this).sortable("instance");C&&!C.options.disabled&&(p.sortables.push(C),C.refreshPositions(),C._trigger("activate",l,g))})},stop:function(l,u,p){var g=n.extend({},u,{item:p.element});p.cancelHelperRemoval=!1,n.each(p.sortables,function(){var C=this;C.isOver?(C.isOver=0,p.cancelHelperRemoval=!0,C.cancelHelperRemoval=!1,C._storedCSS={position:C.placeholder.css("position"),top:C.placeholder.css("top"),left:C.placeholder.css("left")},C._mouseStop(l),C.options.helper=C.options._helper):(C.cancelHelperRemoval=!0,C._trigger("deactivate",l,g))})},drag:function(l,u,p){n.each(p.sortables,function(){var g=!1,C=this;C.positionAbs=p.positionAbs,C.helperProportions=p.helperProportions,C.offset.click=p.offset.click,C._intersectsWith(C.containerCache)&&(g=!0,n.each(p.sortables,function(){return this.positionAbs=p.positionAbs,this.helperProportions=p.helperProportions,this.offset.click=p.offset.click,this!==C&&this._intersectsWith(this.containerCache)&&n.contains(C.element[0],this.element[0])&&(g=!1),g})),g?(C.isOver||(C.isOver=1,p._parent=u.helper.parent(),C.currentItem=u.helper.appendTo(C.element).data("ui-sortable-item",!0),C.options._helper=C.options.helper,C.options.helper=function(){return u.helper[0]},l.target=C.currentItem[0],C._mouseCapture(l,!0),C._mouseStart(l,!0,!0),C.offset.click.top=p.offset.click.top,C.offset.click.left=p.offset.click.left,C.offset.parent.left-=p.offset.parent.left-C.offset.parent.left,C.offset.parent.top-=p.offset.parent.top-C.offset.parent.top,p._trigger("toSortable",l),p.dropped=C.element,n.each(p.sortables,function(){this.refreshPositions()}),p.currentItem=p.element,C.fromOutside=p),C.currentItem&&(C._mouseDrag(l),u.position=C.position)):C.isOver&&(C.isOver=0,C.cancelHelperRemoval=!0,C.options._revert=C.options.revert,C.options.revert=!1,C._trigger("out",l,C._uiHash(C)),C._mouseStop(l,!0),C.options.revert=C.options._revert,C.options.helper=C.options._helper,C.placeholder&&C.placeholder.remove(),u.helper.appendTo(p._parent),p._refreshOffsets(l),u.position=p._generatePosition(l,!0),p._trigger("fromSortable",l),p.dropped=!1,n.each(p.sortables,function(){this.refreshPositions()}))})}}),n.ui.plugin.add("draggable","cursor",{start:function(l,u,p){var g=n("body"),C=p.options;g.css("cursor")&&(C._cursor=g.css("cursor")),g.css("cursor",C.cursor)},stop:function(l,u,p){var g=p.options;g._cursor&&n("body").css("cursor",g._cursor)}}),n.ui.plugin.add("draggable","opacity",{start:function(l,u,p){var g=n(u.helper),C=p.options;g.css("opacity")&&(C._opacity=g.css("opacity")),g.css("opacity",C.opacity)},stop:function(l,u,p){var g=p.options;g._opacity&&n(u.helper).css("opacity",g._opacity)}}),n.ui.plugin.add("draggable","scroll",{start:function(l,u,p){p.scrollParentNotHidden||(p.scrollParentNotHidden=p.helper.scrollParent(!1)),p.scrollParentNotHidden[0]!==p.document[0]&&p.scrollParentNotHidden[0].tagName!=="HTML"&&(p.overflowOffset=p.scrollParentNotHidden.offset())},drag:function(l,u,p){var g=p.options,C=!1,b=p.scrollParentNotHidden[0],P=p.document[0];b!==P&&b.tagName!=="HTML"?((!g.axis||g.axis!=="x")&&(p.overflowOffset.top+b.offsetHeight-l.pageY<g.scrollSensitivity?b.scrollTop=C=b.scrollTop+g.scrollSpeed:l.pageY-p.overflowOffset.top<g.scrollSensitivity&&(b.scrollTop=C=b.scrollTop-g.scrollSpeed)),(!g.axis||g.axis!=="y")&&(p.overflowOffset.left+b.offsetWidth-l.pageX<g.scrollSensitivity?b.scrollLeft=C=b.scrollLeft+g.scrollSpeed:l.pageX-p.overflowOffset.left<g.scrollSensitivity&&(b.scrollLeft=C=b.scrollLeft-g.scrollSpeed))):((!g.axis||g.axis!=="x")&&(l.pageY-n(P).scrollTop()<g.scrollSensitivity?C=n(P).scrollTop(n(P).scrollTop()-g.scrollSpeed):n(window).height()-(l.pageY-n(P).scrollTop())<g.scrollSensitivity&&(C=n(P).scrollTop(n(P).scrollTop()+g.scrollSpeed))),(!g.axis||g.axis!=="y")&&(l.pageX-n(P).scrollLeft()<g.scrollSensitivity?C=n(P).scrollLeft(n(P).scrollLeft()-g.scrollSpeed):n(window).width()-(l.pageX-n(P).scrollLeft())<g.scrollSensitivity&&(C=n(P).scrollLeft(n(P).scrollLeft()+g.scrollSpeed)))),C!==!1&&n.ui.ddmanager&&!g.dropBehaviour&&n.ui.ddmanager.prepareOffsets(p,l)}}),n.ui.plugin.add("draggable","snap",{start:function(l,u,p){var g=p.options;p.snapElements=[],n(g.snap.constructor!==String?g.snap.items||":data(ui-draggable)":g.snap).each(function(){var C=n(this),b=C.offset();this!==p.element[0]&&p.snapElements.push({item:this,width:C.outerWidth(),height:C.outerHeight(),top:b.top,left:b.left})})},drag:function(l,u,p){var g,C,b,P,O,L,U,H,ee,ae,Y=p.options,Z=Y.snapTolerance,ce=u.offset.left,ye=ce+p.helperProportions.width,ve=u.offset.top,Ee=ve+p.helperProportions.height;for(ee=p.snapElements.length-1;ee>=0;ee--){if(O=p.snapElements[ee].left-p.margins.left,L=O+p.snapElements[ee].width,U=p.snapElements[ee].top-p.margins.top,H=U+p.snapElements[ee].height,ye<O-Z||ce>L+Z||Ee<U-Z||ve>H+Z||!n.contains(p.snapElements[ee].item.ownerDocument,p.snapElements[ee].item)){p.snapElements[ee].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,l,n.extend(p._uiHash(),{snapItem:p.snapElements[ee].item})),p.snapElements[ee].snapping=!1;continue}Y.snapMode!=="inner"&&(g=Math.abs(U-Ee)<=Z,C=Math.abs(H-ve)<=Z,b=Math.abs(O-ye)<=Z,P=Math.abs(L-ce)<=Z,g&&(u.position.top=p._convertPositionTo("relative",{top:U-p.helperProportions.height,left:0}).top),C&&(u.position.top=p._convertPositionTo("relative",{top:H,left:0}).top),b&&(u.position.left=p._convertPositionTo("relative",{top:0,left:O-p.helperProportions.width}).left),P&&(u.position.left=p._convertPositionTo("relative",{top:0,left:L}).left)),ae=g||C||b||P,Y.snapMode!=="outer"&&(g=Math.abs(U-ve)<=Z,C=Math.abs(H-Ee)<=Z,b=Math.abs(O-ce)<=Z,P=Math.abs(L-ye)<=Z,g&&(u.position.top=p._convertPositionTo("relative",{top:U,left:0}).top),C&&(u.position.top=p._convertPositionTo("relative",{top:H-p.helperProportions.height,left:0}).top),b&&(u.position.left=p._convertPositionTo("relative",{top:0,left:O}).left),P&&(u.position.left=p._convertPositionTo("relative",{top:0,left:L-p.helperProportions.width}).left)),!p.snapElements[ee].snapping&&(g||C||b||P||ae)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,l,n.extend(p._uiHash(),{snapItem:p.snapElements[ee].item})),p.snapElements[ee].snapping=g||C||b||P||ae}}}),n.ui.plugin.add("draggable","stack",{start:function(l,u,p){var g,C=p.options,b=n.makeArray(n(C.stack)).sort(function(P,O){return(parseInt(n(P).css("zIndex"),10)||0)-(parseInt(n(O).css("zIndex"),10)||0)});b.length&&(g=parseInt(n(b[0]).css("zIndex"),10)||0,n(b).each(function(P){n(this).css("zIndex",g+P)}),this.css("zIndex",g+b.length))}}),n.ui.plugin.add("draggable","zIndex",{start:function(l,u,p){var g=n(u.helper),C=p.options;g.css("zIndex")&&(C._zIndex=g.css("zIndex")),g.css("zIndex",C.zIndex)},stop:function(l,u,p){var g=p.options;g._zIndex&&n(u.helper).css("zIndex",g._zIndex)}}),n.ui.draggable;/*!
 * jQuery UI Resizable 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.resizable",n.ui.mouse,{version:"1.13.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(l){return parseFloat(l)||0},_isNumber:function(l){return!isNaN(parseFloat(l))},_hasScroll:function(l,u){if(n(l).css("overflow")==="hidden")return!1;var p=u&&u==="left"?"scrollLeft":"scrollTop",g=!1;if(l[p]>0)return!0;try{l[p]=1,g=l[p]>0,l[p]=0}catch{}return g},_create:function(){var l,u=this.options,p=this;this._addClass("ui-resizable"),n.extend(this,{_aspectRatio:!!u.aspectRatio,aspectRatio:u.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:u.helper||u.ghost||u.animate?u.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(n("<div class='ui-wrapper'></div>").css({overflow:"hidden",position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,l={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(l),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(l),this._proportionallyResize()),this._setupHandles(),u.autoHide&&n(this.element).on("mouseenter",function(){u.disabled||(p._removeClass("ui-resizable-autohide"),p._handles.show())}).on("mouseleave",function(){u.disabled||p.resizing||(p._addClass("ui-resizable-autohide"),p._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy(),this._addedHandles.remove();var l,u=function(p){n(p).removeData("resizable").removeData("ui-resizable").off(".resizable")};return this.elementIsWrapper&&(u(this.element),l=this.element,this.originalElement.css({position:l.css("position"),width:l.outerWidth(),height:l.outerHeight(),top:l.css("top"),left:l.css("left")}).insertAfter(l),l.remove()),this.originalElement.css("resize",this.originalResizeStyle),u(this.originalElement),this},_setOption:function(l,u){switch(this._super(l,u),l){case"handles":this._removeHandles(),this._setupHandles();break;case"aspectRatio":this._aspectRatio=!!u;break}},_setupHandles:function(){var l=this.options,u,p,g,C,b,P=this;if(this.handles=l.handles||(n(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=n(),this._addedHandles=n(),this.handles.constructor===String)for(this.handles==="all"&&(this.handles="n,e,s,w,se,sw,ne,nw"),g=this.handles.split(","),this.handles={},p=0;p<g.length;p++)u=String.prototype.trim.call(g[p]),C="ui-resizable-"+u,b=n("<div>"),this._addClass(b,"ui-resizable-handle "+C),b.css({zIndex:l.zIndex}),this.handles[u]=".ui-resizable-"+u,this.element.children(this.handles[u]).length||(this.element.append(b),this._addedHandles=this._addedHandles.add(b));this._renderAxis=function(O){var L,U,H,ee;O=O||this.element;for(L in this.handles)this.handles[L].constructor===String?this.handles[L]=this.element.children(this.handles[L]).first().show():(this.handles[L].jquery||this.handles[L].nodeType)&&(this.handles[L]=n(this.handles[L]),this._on(this.handles[L],{mousedown:P._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(U=n(this.handles[L],this.element),ee=/sw|ne|nw|se|n|s/.test(L)?U.outerHeight():U.outerWidth(),H=["padding",/ne|nw|n/.test(L)?"Top":/se|sw|s/.test(L)?"Bottom":/^e$/.test(L)?"Right":"Left"].join(""),O.css(H,ee),this._proportionallyResize()),this._handles=this._handles.add(this.handles[L])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){P.resizing||(this.className&&(b=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),P.axis=b&&b[1]?b[1]:"se")}),l.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._addedHandles.remove()},_mouseCapture:function(l){var u,p,g=!1;for(u in this.handles)p=n(this.handles[u])[0],(p===l.target||n.contains(p,l.target))&&(g=!0);return!this.options.disabled&&g},_mouseStart:function(l){var u,p,g,C=this.options,b=this.element;return this.resizing=!0,this._renderProxy(),u=this._num(this.helper.css("left")),p=this._num(this.helper.css("top")),C.containment&&(u+=n(C.containment).scrollLeft()||0,p+=n(C.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:u,top:p},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:b.width(),height:b.height()},this.originalSize=this._helper?{width:b.outerWidth(),height:b.outerHeight()}:{width:b.width(),height:b.height()},this.sizeDiff={width:b.outerWidth()-b.width(),height:b.outerHeight()-b.height()},this.originalPosition={left:u,top:p},this.originalMousePosition={left:l.pageX,top:l.pageY},this.aspectRatio=typeof C.aspectRatio=="number"?C.aspectRatio:this.originalSize.width/this.originalSize.height||1,g=n(".ui-resizable-"+this.axis).css("cursor"),n("body").css("cursor",g==="auto"?this.axis+"-resize":g),this._addClass("ui-resizable-resizing"),this._propagate("start",l),!0},_mouseDrag:function(l){var u,p,g=this.originalMousePosition,C=this.axis,b=l.pageX-g.left||0,P=l.pageY-g.top||0,O=this._change[C];return this._updatePrevProperties(),O&&(u=O.apply(this,[l,b,P]),this._updateVirtualBoundaries(l.shiftKey),(this._aspectRatio||l.shiftKey)&&(u=this._updateRatio(u,l)),u=this._respectSize(u,l),this._updateCache(u),this._propagate("resize",l),p=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),n.isEmptyObject(p)||(this._updatePrevProperties(),this._trigger("resize",l,this.ui()),this._applyChanges())),!1},_mouseStop:function(l){this.resizing=!1;var u,p,g,C,b,P,O,L=this.options,U=this;return this._helper&&(u=this._proportionallyResizeElements,p=u.length&&/textarea/i.test(u[0].nodeName),g=p&&this._hasScroll(u[0],"left")?0:U.sizeDiff.height,C=p?0:U.sizeDiff.width,b={width:U.helper.width()-C,height:U.helper.height()-g},P=parseFloat(U.element.css("left"))+(U.position.left-U.originalPosition.left)||null,O=parseFloat(U.element.css("top"))+(U.position.top-U.originalPosition.top)||null,L.animate||this.element.css(n.extend(b,{top:O,left:P})),U.helper.height(U.size.height),U.helper.width(U.size.width),this._helper&&!L.animate&&this._proportionallyResize()),n("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",l),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var l={};return this.position.top!==this.prevPosition.top&&(l.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(l.left=this.position.left+"px"),this.helper.css(l),this.size.width!==this.prevSize.width&&(l.width=this.size.width+"px",this.helper.width(l.width)),this.size.height!==this.prevSize.height&&(l.height=this.size.height+"px",this.helper.height(l.height)),l},_updateVirtualBoundaries:function(l){var u,p,g,C,b,P=this.options;b={minWidth:this._isNumber(P.minWidth)?P.minWidth:0,maxWidth:this._isNumber(P.maxWidth)?P.maxWidth:1/0,minHeight:this._isNumber(P.minHeight)?P.minHeight:0,maxHeight:this._isNumber(P.maxHeight)?P.maxHeight:1/0},(this._aspectRatio||l)&&(u=b.minHeight*this.aspectRatio,g=b.minWidth/this.aspectRatio,p=b.maxHeight*this.aspectRatio,C=b.maxWidth/this.aspectRatio,u>b.minWidth&&(b.minWidth=u),g>b.minHeight&&(b.minHeight=g),p<b.maxWidth&&(b.maxWidth=p),C<b.maxHeight&&(b.maxHeight=C)),this._vBoundaries=b},_updateCache:function(l){this.offset=this.helper.offset(),this._isNumber(l.left)&&(this.position.left=l.left),this._isNumber(l.top)&&(this.position.top=l.top),this._isNumber(l.height)&&(this.size.height=l.height),this._isNumber(l.width)&&(this.size.width=l.width)},_updateRatio:function(l){var u=this.position,p=this.size,g=this.axis;return this._isNumber(l.height)?l.width=l.height*this.aspectRatio:this._isNumber(l.width)&&(l.height=l.width/this.aspectRatio),g==="sw"&&(l.left=u.left+(p.width-l.width),l.top=null),g==="nw"&&(l.top=u.top+(p.height-l.height),l.left=u.left+(p.width-l.width)),l},_respectSize:function(l){var u=this._vBoundaries,p=this.axis,g=this._isNumber(l.width)&&u.maxWidth&&u.maxWidth<l.width,C=this._isNumber(l.height)&&u.maxHeight&&u.maxHeight<l.height,b=this._isNumber(l.width)&&u.minWidth&&u.minWidth>l.width,P=this._isNumber(l.height)&&u.minHeight&&u.minHeight>l.height,O=this.originalPosition.left+this.originalSize.width,L=this.originalPosition.top+this.originalSize.height,U=/sw|nw|w/.test(p),H=/nw|ne|n/.test(p);return b&&(l.width=u.minWidth),P&&(l.height=u.minHeight),g&&(l.width=u.maxWidth),C&&(l.height=u.maxHeight),b&&U&&(l.left=O-u.minWidth),g&&U&&(l.left=O-u.maxWidth),P&&H&&(l.top=L-u.minHeight),C&&H&&(l.top=L-u.maxHeight),!l.width&&!l.height&&!l.left&&l.top?l.top=null:!l.width&&!l.height&&!l.top&&l.left&&(l.left=null),l},_getPaddingPlusBorderDimensions:function(l){for(var u=0,p=[],g=[l.css("borderTopWidth"),l.css("borderRightWidth"),l.css("borderBottomWidth"),l.css("borderLeftWidth")],C=[l.css("paddingTop"),l.css("paddingRight"),l.css("paddingBottom"),l.css("paddingLeft")];u<4;u++)p[u]=parseFloat(g[u])||0,p[u]+=parseFloat(C[u])||0;return{height:p[0]+p[2],width:p[1]+p[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var l,u=0,p=this.helper||this.element;u<this._proportionallyResizeElements.length;u++)l=this._proportionallyResizeElements[u],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(l)),l.css({height:p.height()-this.outerDimensions.height||0,width:p.width()-this.outerDimensions.width||0})},_renderProxy:function(){var l=this.element,u=this.options;this.elementOffset=l.offset(),this._helper?(this.helper=this.helper||n("<div></div>").css({overflow:"hidden"}),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++u.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(l,u){return{width:this.originalSize.width+u}},w:function(l,u){var p=this.originalSize,g=this.originalPosition;return{left:g.left+u,width:p.width-u}},n:function(l,u,p){var g=this.originalSize,C=this.originalPosition;return{top:C.top+p,height:g.height-p}},s:function(l,u,p){return{height:this.originalSize.height+p}},se:function(l,u,p){return n.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[l,u,p]))},sw:function(l,u,p){return n.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[l,u,p]))},ne:function(l,u,p){return n.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[l,u,p]))},nw:function(l,u,p){return n.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[l,u,p]))}},_propagate:function(l,u){n.ui.plugin.call(this,l,[u,this.ui()]),l!=="resize"&&this._trigger(l,u,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),n.ui.plugin.add("resizable","animate",{stop:function(l){var u=n(this).resizable("instance"),p=u.options,g=u._proportionallyResizeElements,C=g.length&&/textarea/i.test(g[0].nodeName),b=C&&u._hasScroll(g[0],"left")?0:u.sizeDiff.height,P=C?0:u.sizeDiff.width,O={width:u.size.width-P,height:u.size.height-b},L=parseFloat(u.element.css("left"))+(u.position.left-u.originalPosition.left)||null,U=parseFloat(u.element.css("top"))+(u.position.top-u.originalPosition.top)||null;u.element.animate(n.extend(O,U&&L?{top:U,left:L}:{}),{duration:p.animateDuration,easing:p.animateEasing,step:function(){var H={width:parseFloat(u.element.css("width")),height:parseFloat(u.element.css("height")),top:parseFloat(u.element.css("top")),left:parseFloat(u.element.css("left"))};g&&g.length&&n(g[0]).css({width:H.width,height:H.height}),u._updateCache(H),u._propagate("resize",l)}})}}),n.ui.plugin.add("resizable","containment",{start:function(){var l,u,p,g,C,b,P,O=n(this).resizable("instance"),L=O.options,U=O.element,H=L.containment,ee=H instanceof n?H.get(0):/parent/.test(H)?U.parent().get(0):H;ee&&(O.containerElement=n(ee),/document/.test(H)||H===document?(O.containerOffset={left:0,top:0},O.containerPosition={left:0,top:0},O.parentData={element:n(document),left:0,top:0,width:n(document).width(),height:n(document).height()||document.body.parentNode.scrollHeight}):(l=n(ee),u=[],n(["Top","Right","Left","Bottom"]).each(function(ae,Y){u[ae]=O._num(l.css("padding"+Y))}),O.containerOffset=l.offset(),O.containerPosition=l.position(),O.containerSize={height:l.innerHeight()-u[3],width:l.innerWidth()-u[1]},p=O.containerOffset,g=O.containerSize.height,C=O.containerSize.width,b=O._hasScroll(ee,"left")?ee.scrollWidth:C,P=O._hasScroll(ee)?ee.scrollHeight:g,O.parentData={element:ee,left:p.left,top:p.top,width:b,height:P}))},resize:function(l){var u,p,g,C,b=n(this).resizable("instance"),P=b.options,O=b.containerOffset,L=b.position,U=b._aspectRatio||l.shiftKey,H={top:0,left:0},ee=b.containerElement,ae=!0;ee[0]!==document&&/static/.test(ee.css("position"))&&(H=O),L.left<(b._helper?O.left:0)&&(b.size.width=b.size.width+(b._helper?b.position.left-O.left:b.position.left-H.left),U&&(b.size.height=b.size.width/b.aspectRatio,ae=!1),b.position.left=P.helper?O.left:0),L.top<(b._helper?O.top:0)&&(b.size.height=b.size.height+(b._helper?b.position.top-O.top:b.position.top),U&&(b.size.width=b.size.height*b.aspectRatio,ae=!1),b.position.top=b._helper?O.top:0),g=b.containerElement.get(0)===b.element.parent().get(0),C=/relative|absolute/.test(b.containerElement.css("position")),g&&C?(b.offset.left=b.parentData.left+b.position.left,b.offset.top=b.parentData.top+b.position.top):(b.offset.left=b.element.offset().left,b.offset.top=b.element.offset().top),u=Math.abs(b.sizeDiff.width+(b._helper?b.offset.left-H.left:b.offset.left-O.left)),p=Math.abs(b.sizeDiff.height+(b._helper?b.offset.top-H.top:b.offset.top-O.top)),u+b.size.width>=b.parentData.width&&(b.size.width=b.parentData.width-u,U&&(b.size.height=b.size.width/b.aspectRatio,ae=!1)),p+b.size.height>=b.parentData.height&&(b.size.height=b.parentData.height-p,U&&(b.size.width=b.size.height*b.aspectRatio,ae=!1)),ae||(b.position.left=b.prevPosition.left,b.position.top=b.prevPosition.top,b.size.width=b.prevSize.width,b.size.height=b.prevSize.height)},stop:function(){var l=n(this).resizable("instance"),u=l.options,p=l.containerOffset,g=l.containerPosition,C=l.containerElement,b=n(l.helper),P=b.offset(),O=b.outerWidth()-l.sizeDiff.width,L=b.outerHeight()-l.sizeDiff.height;l._helper&&!u.animate&&/relative/.test(C.css("position"))&&n(this).css({left:P.left-g.left-p.left,width:O,height:L}),l._helper&&!u.animate&&/static/.test(C.css("position"))&&n(this).css({left:P.left-g.left-p.left,width:O,height:L})}}),n.ui.plugin.add("resizable","alsoResize",{start:function(){var l=n(this).resizable("instance"),u=l.options;n(u.alsoResize).each(function(){var p=n(this);p.data("ui-resizable-alsoresize",{width:parseFloat(p.css("width")),height:parseFloat(p.css("height")),left:parseFloat(p.css("left")),top:parseFloat(p.css("top"))})})},resize:function(l,u){var p=n(this).resizable("instance"),g=p.options,C=p.originalSize,b=p.originalPosition,P={height:p.size.height-C.height||0,width:p.size.width-C.width||0,top:p.position.top-b.top||0,left:p.position.left-b.left||0};n(g.alsoResize).each(function(){var O=n(this),L=n(this).data("ui-resizable-alsoresize"),U={},H=O.parents(u.originalElement[0]).length?["width","height"]:["width","height","top","left"];n.each(H,function(ee,ae){var Y=(L[ae]||0)+(P[ae]||0);Y&&Y>=0&&(U[ae]=Y||null)}),O.css(U)})},stop:function(){n(this).removeData("ui-resizable-alsoresize")}}),n.ui.plugin.add("resizable","ghost",{start:function(){var l=n(this).resizable("instance"),u=l.size;l.ghost=l.originalElement.clone(),l.ghost.css({opacity:.25,display:"block",position:"relative",height:u.height,width:u.width,margin:0,left:0,top:0}),l._addClass(l.ghost,"ui-resizable-ghost"),n.uiBackCompat!==!1&&typeof l.options.ghost=="string"&&l.ghost.addClass(this.options.ghost),l.ghost.appendTo(l.helper)},resize:function(){var l=n(this).resizable("instance");l.ghost&&l.ghost.css({position:"relative",height:l.size.height,width:l.size.width})},stop:function(){var l=n(this).resizable("instance");l.ghost&&l.helper&&l.helper.get(0).removeChild(l.ghost.get(0))}}),n.ui.plugin.add("resizable","grid",{resize:function(){var l,u=n(this).resizable("instance"),p=u.options,g=u.size,C=u.originalSize,b=u.originalPosition,P=u.axis,O=typeof p.grid=="number"?[p.grid,p.grid]:p.grid,L=O[0]||1,U=O[1]||1,H=Math.round((g.width-C.width)/L)*L,ee=Math.round((g.height-C.height)/U)*U,ae=C.width+H,Y=C.height+ee,Z=p.maxWidth&&p.maxWidth<ae,ce=p.maxHeight&&p.maxHeight<Y,ye=p.minWidth&&p.minWidth>ae,ve=p.minHeight&&p.minHeight>Y;p.grid=O,ye&&(ae+=L),ve&&(Y+=U),Z&&(ae-=L),ce&&(Y-=U),/^(se|s|e)$/.test(P)?(u.size.width=ae,u.size.height=Y):/^(ne)$/.test(P)?(u.size.width=ae,u.size.height=Y,u.position.top=b.top-ee):/^(sw)$/.test(P)?(u.size.width=ae,u.size.height=Y,u.position.left=b.left-H):((Y-U<=0||ae-L<=0)&&(l=u._getPaddingPlusBorderDimensions(this)),Y-U>0?(u.size.height=Y,u.position.top=b.top-ee):(Y=U-l.height,u.size.height=Y,u.position.top=b.top+C.height-Y),ae-L>0?(u.size.width=ae,u.position.left=b.left-H):(ae=L-l.width,u.size.width=ae,u.position.left=b.left+C.width-ae))}}),n.ui.resizable;/*!
 * jQuery UI Dialog 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.dialog",{version:"1.13.3",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(l){var u=n(this).css(l).offset().top;u<0&&n(this).css("top",l.top-u)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title==null&&this.originalTitle!=null&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&n.fn.draggable&&this._makeDraggable(),this.options.resizable&&n.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var l=this.options.appendTo;return l&&(l.jquery||l.nodeType)?n(l):this.document.find(l||"body").eq(0)},_destroy:function(){var l,u=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),l=u.parent.children().eq(u.index),l.length&&l[0]!==this.element[0]?l.before(this.element):u.parent.append(this.element)},widget:function(){return this.uiDialog},disable:n.noop,enable:n.noop,close:function(l){var u=this;!this._isOpen||this._trigger("beforeClose",l)===!1||(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||n.ui.safeBlur(n.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){u._trigger("close",l)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(l,u){var p=!1,g=this.uiDialog.siblings(".ui-front:visible").map(function(){return+n(this).css("z-index")}).get(),C=Math.max.apply(null,g);return C>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",C+1),p=!0),p&&!u&&this._trigger("focus",l),p},open:function(){var l=this;if(this._isOpen){this._moveToTop()&&this._focusTabbable();return}this._isOpen=!0,this.opener=n(n.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){l._focusTabbable(),l._trigger("focus")}),this._makeFocusTarget(),this._trigger("open")},_focusTabbable:function(){var l=this._focusedElement;l||(l=this.element.find("[autofocus]")),l.length||(l=this.element.find(":tabbable")),l.length||(l=this.uiDialogButtonPane.find(":tabbable")),l.length||(l=this.uiDialogTitlebarClose.filter(":tabbable")),l.length||(l=this.uiDialog),l.eq(0).trigger("focus")},_restoreTabbableFocus:function(){var l=n.ui.safeActiveElement(this.document[0]),u=this.uiDialog[0]===l||n.contains(this.uiDialog[0],l);u||this._focusTabbable()},_keepFocus:function(l){l.preventDefault(),this._restoreTabbableFocus(),this._delay(this._restoreTabbableFocus)},_createWrapper:function(){this.uiDialog=n("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(l){if(this.options.closeOnEscape&&!l.isDefaultPrevented()&&l.keyCode&&l.keyCode===n.ui.keyCode.ESCAPE){l.preventDefault(),this.close(l);return}if(!(l.keyCode!==n.ui.keyCode.TAB||l.isDefaultPrevented())){var u=this.uiDialog.find(":tabbable"),p=u.first(),g=u.last();(l.target===g[0]||l.target===this.uiDialog[0])&&!l.shiftKey?(this._delay(function(){p.trigger("focus")}),l.preventDefault()):(l.target===p[0]||l.target===this.uiDialog[0])&&l.shiftKey&&(this._delay(function(){g.trigger("focus")}),l.preventDefault())}},mousedown:function(l){this._moveToTop(l)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var l;this.uiDialogTitlebar=n("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(u){n(u.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=n("<button type='button'></button>").button({label:n("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(u){u.preventDefault(),this.close(u)}}),l=n("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(l,"ui-dialog-title"),this._title(l),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":l.attr("id")})},_title:function(l){this.options.title?l.text(this.options.title):l.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=n("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=n("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var l=this,u=this.options.buttons;if(this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),n.isEmptyObject(u)||Array.isArray(u)&&!u.length){this._removeClass(this.uiDialog,"ui-dialog-buttons");return}n.each(u,function(p,g){var C,b;g=typeof g=="function"?{click:g,text:p}:g,g=n.extend({type:"button"},g),C=g.click,b={icon:g.icon,iconPosition:g.iconPosition,showLabel:g.showLabel,icons:g.icons,text:g.text},delete g.click,delete g.icon,delete g.iconPosition,delete g.showLabel,delete g.icons,typeof g.text=="boolean"&&delete g.text,n("<button></button>",g).button(b).appendTo(l.uiButtonSet).on("click",function(){C.apply(l.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog)},_makeDraggable:function(){var l=this,u=this.options;function p(g){return{position:g.position,offset:g.offset}}this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(g,C){l._addClass(n(this),"ui-dialog-dragging"),l._blockFrames(),l._trigger("dragStart",g,p(C))},drag:function(g,C){l._trigger("drag",g,p(C))},stop:function(g,C){var b=C.offset.left-l.document.scrollLeft(),P=C.offset.top-l.document.scrollTop();u.position={my:"left top",at:"left"+(b>=0?"+":"")+b+" top"+(P>=0?"+":"")+P,of:l.window},l._removeClass(n(this),"ui-dialog-dragging"),l._unblockFrames(),l._trigger("dragStop",g,p(C))}})},_makeResizable:function(){var l=this,u=this.options,p=u.resizable,g=this.uiDialog.css("position"),C=typeof p=="string"?p:"n,e,s,w,se,sw,ne,nw";function b(P){return{originalPosition:P.originalPosition,originalSize:P.originalSize,position:P.position,size:P.size}}this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:u.maxWidth,maxHeight:u.maxHeight,minWidth:u.minWidth,minHeight:this._minHeight(),handles:C,start:function(P,O){l._addClass(n(this),"ui-dialog-resizing"),l._blockFrames(),l._trigger("resizeStart",P,b(O))},resize:function(P,O){l._trigger("resize",P,b(O))},stop:function(P,O){var L=l.uiDialog.offset(),U=L.left-l.document.scrollLeft(),H=L.top-l.document.scrollTop();u.height=l.uiDialog.height(),u.width=l.uiDialog.width(),u.position={my:"left top",at:"left"+(U>=0?"+":"")+U+" top"+(H>=0?"+":"")+H,of:l.window},l._removeClass(n(this),"ui-dialog-resizing"),l._unblockFrames(),l._trigger("resizeStop",P,b(O))}}).css("position",g)},_trackFocus:function(){this._on(this.widget(),{focusin:function(l){this._makeFocusTarget(),this._focusedElement=n(l.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var l=this._trackingInstances(),u=n.inArray(this,l);u!==-1&&l.splice(u,1)},_trackingInstances:function(){var l=this.document.data("ui-dialog-instances");return l||(l=[],this.document.data("ui-dialog-instances",l)),l},_minHeight:function(){var l=this.options;return l.height==="auto"?l.minHeight:Math.min(l.minHeight,l.height)},_position:function(){var l=this.uiDialog.is(":visible");l||this.uiDialog.show(),this.uiDialog.position(this.options.position),l||this.uiDialog.hide()},_setOptions:function(l){var u=this,p=!1,g={};n.each(l,function(C,b){u._setOption(C,b),C in u.sizeRelatedOptions&&(p=!0),C in u.resizableRelatedOptions&&(g[C]=b)}),p&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",g)},_setOption:function(l,u){var p,g,C=this.uiDialog;l!=="disabled"&&(this._super(l,u),l==="appendTo"&&this.uiDialog.appendTo(this._appendTo()),l==="buttons"&&this._createButtons(),l==="closeText"&&this.uiDialogTitlebarClose.button({label:n("<a>").text(""+this.options.closeText).html()}),l==="draggable"&&(p=C.is(":data(ui-draggable)"),p&&!u&&C.draggable("destroy"),!p&&u&&this._makeDraggable()),l==="position"&&this._position(),l==="resizable"&&(g=C.is(":data(ui-resizable)"),g&&!u&&C.resizable("destroy"),g&&typeof u=="string"&&C.resizable("option","handles",u),!g&&u!==!1&&this._makeResizable()),l==="title"&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var l,u,p,g=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),g.minWidth>g.width&&(g.width=g.minWidth),l=this.uiDialog.css({height:"auto",width:g.width}).outerHeight(),u=Math.max(0,g.minHeight-l),p=typeof g.maxHeight=="number"?Math.max(0,g.maxHeight-l):"none",g.height==="auto"?this.element.css({minHeight:u,maxHeight:p,height:"auto"}):this.element.height(Math.max(0,g.height-l)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var l=n(this);return n("<div>").css({position:"absolute",width:l.outerWidth(),height:l.outerHeight()}).appendTo(l.parent()).offset(l.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(l){return n(l.target).closest(".ui-dialog").length?!0:!!n(l.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var l=n.fn.jquery.substring(0,4),u=!0;this._delay(function(){u=!1}),this.document.data("ui-dialog-overlays")||this.document.on("focusin.ui-dialog",(function(p){if(!u){var g=this._trackingInstances()[0];g._allowInteraction(p)||(p.preventDefault(),g._focusTabbable(),(l==="3.4."||l==="3.5."||l==="3.6.")&&g._delay(g._restoreTabbableFocus))}}).bind(this)),this.overlay=n("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var l=this.document.data("ui-dialog-overlays")-1;l?this.document.data("ui-dialog-overlays",l):(this.document.off("focusin.ui-dialog"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),n.uiBackCompat!==!1&&n.widget("ui.dialog",n.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(l,u){l==="dialogClass"&&this.uiDialog.removeClass(this.options.dialogClass).addClass(u),this._superApply(arguments)}}),n.ui.dialog;/*!
 * jQuery UI Droppable 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.droppable",{version:"1.13.3",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var l,u=this.options,p=u.accept;this.isover=!1,this.isout=!0,this.accept=typeof p=="function"?p:function(g){return g.is(p)},this.proportions=function(){if(arguments.length)l=arguments[0];else return l||(l={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight})},this._addToManager(u.scope),u.addClasses&&this._addClass("ui-droppable")},_addToManager:function(l){n.ui.ddmanager.droppables[l]=n.ui.ddmanager.droppables[l]||[],n.ui.ddmanager.droppables[l].push(this)},_splice:function(l){for(var u=0;u<l.length;u++)l[u]===this&&l.splice(u,1)},_destroy:function(){var l=n.ui.ddmanager.droppables[this.options.scope];this._splice(l)},_setOption:function(l,u){if(l==="accept")this.accept=typeof u=="function"?u:function(g){return g.is(u)};else if(l==="scope"){var p=n.ui.ddmanager.droppables[this.options.scope];this._splice(p),this._addToManager(u)}this._super(l,u)},_activate:function(l){var u=n.ui.ddmanager.current;this._addActiveClass(),u&&this._trigger("activate",l,this.ui(u))},_deactivate:function(l){var u=n.ui.ddmanager.current;this._removeActiveClass(),u&&this._trigger("deactivate",l,this.ui(u))},_over:function(l){var u=n.ui.ddmanager.current;!u||(u.currentItem||u.element)[0]===this.element[0]||this.accept.call(this.element[0],u.currentItem||u.element)&&(this._addHoverClass(),this._trigger("over",l,this.ui(u)))},_out:function(l){var u=n.ui.ddmanager.current;!u||(u.currentItem||u.element)[0]===this.element[0]||this.accept.call(this.element[0],u.currentItem||u.element)&&(this._removeHoverClass(),this._trigger("out",l,this.ui(u)))},_drop:function(l,u){var p=u||n.ui.ddmanager.current,g=!1;return!p||(p.currentItem||p.element)[0]===this.element[0]||(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var C=n(this).droppable("instance");if(C.options.greedy&&!C.options.disabled&&C.options.scope===p.options.scope&&C.accept.call(C.element[0],p.currentItem||p.element)&&n.ui.intersect(p,n.extend(C,{offset:C.element.offset()}),C.options.tolerance,l))return g=!0,!1}),g)?!1:this.accept.call(this.element[0],p.currentItem||p.element)?(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",l,this.ui(p)),this.element):!1},ui:function(l){return{draggable:l.currentItem||l.element,helper:l.helper,position:l.position,offset:l.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}}),n.ui.intersect=(function(){function l(u,p,g){return u>=p&&u<p+g}return function(u,p,g,C){if(!p.offset)return!1;var b=(u.positionAbs||u.position.absolute).left+u.margins.left,P=(u.positionAbs||u.position.absolute).top+u.margins.top,O=b+u.helperProportions.width,L=P+u.helperProportions.height,U=p.offset.left,H=p.offset.top,ee=U+p.proportions().width,ae=H+p.proportions().height;switch(g){case"fit":return U<=b&&O<=ee&&H<=P&&L<=ae;case"intersect":return U<b+u.helperProportions.width/2&&O-u.helperProportions.width/2<ee&&H<P+u.helperProportions.height/2&&L-u.helperProportions.height/2<ae;case"pointer":return l(C.pageY,H,p.proportions().height)&&l(C.pageX,U,p.proportions().width);case"touch":return(P>=H&&P<=ae||L>=H&&L<=ae||P<H&&L>ae)&&(b>=U&&b<=ee||O>=U&&O<=ee||b<U&&O>ee);default:return!1}}})(),n.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(l,u){var p,g,C=n.ui.ddmanager.droppables[l.options.scope]||[],b=u?u.type:null,P=(l.currentItem||l.element).find(":data(ui-droppable)").addBack();e:for(p=0;p<C.length;p++)if(!(C[p].options.disabled||l&&!C[p].accept.call(C[p].element[0],l.currentItem||l.element))){for(g=0;g<P.length;g++)if(P[g]===C[p].element[0]){C[p].proportions().height=0;continue e}C[p].visible=C[p].element.css("display")!=="none",C[p].visible&&(b==="mousedown"&&C[p]._activate.call(C[p],u),C[p].offset=C[p].element.offset(),C[p].proportions({width:C[p].element[0].offsetWidth,height:C[p].element[0].offsetHeight}))}},drop:function(l,u){var p=!1;return n.each((n.ui.ddmanager.droppables[l.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&n.ui.intersect(l,this,this.options.tolerance,u)&&(p=this._drop.call(this,u)||p),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],l.currentItem||l.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,u)))}),p},dragStart:function(l,u){l.element.parentsUntil("body").on("scroll.droppable",function(){l.options.refreshPositions||n.ui.ddmanager.prepareOffsets(l,u)})},drag:function(l,u){l.options.refreshPositions&&n.ui.ddmanager.prepareOffsets(l,u),n.each(n.ui.ddmanager.droppables[l.options.scope]||[],function(){if(!(this.options.disabled||this.greedyChild||!this.visible)){var p,g,C,b=n.ui.intersect(l,this,this.options.tolerance,u),P=!b&&this.isover?"isout":b&&!this.isover?"isover":null;P&&(this.options.greedy&&(g=this.options.scope,C=this.element.parents(":data(ui-droppable)").filter(function(){return n(this).droppable("instance").options.scope===g}),C.length&&(p=n(C[0]).droppable("instance"),p.greedyChild=P==="isover")),p&&P==="isover"&&(p.isover=!1,p.isout=!0,p._out.call(p,u)),this[P]=!0,this[P==="isout"?"isover":"isout"]=!1,this[P==="isover"?"_over":"_out"].call(this,u),p&&P==="isout"&&(p.isout=!1,p.isover=!0,p._over.call(p,u)))}})},dragStop:function(l,u){l.element.parentsUntil("body").off("scroll.droppable"),l.options.refreshPositions||n.ui.ddmanager.prepareOffsets(l,u)}},n.uiBackCompat!==!1&&n.widget("ui.droppable",n.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),n.ui.droppable;/*!
 * jQuery UI Progressbar 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.progressbar",{version:"1.13.3",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=n("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(l){if(l===void 0)return this.options.value;this.options.value=this._constrainedValue(l),this._refreshValue()},_constrainedValue:function(l){return l===void 0&&(l=this.options.value),this.indeterminate=l===!1,typeof l!="number"&&(l=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,l))},_setOptions:function(l){var u=l.value;delete l.value,this._super(l),this.options.value=this._constrainedValue(u),this._refreshValue()},_setOption:function(l,u){l==="max"&&(u=Math.max(this.min,u)),this._super(l,u)},_setOptionDisabled:function(l){this._super(l),this.element.attr("aria-disabled",l),this._toggleClass(null,"ui-state-disabled",!!l)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var l=this.options.value,u=this._percentage();this.valueDiv.toggle(this.indeterminate||l>this.min).width(u.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,l===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=n("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":l}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==l&&(this.oldValue=l,this._trigger("change")),l===this.options.max&&this._trigger("complete")}});/*!
 * jQuery UI Selectable 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.selectable",n.ui.mouse,{version:"1.13.3",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var l=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){l.elementPos=n(l.element[0]).offset(),l.selectees=n(l.options.filter,l.element[0]),l._addClass(l.selectees,"ui-selectee"),l.selectees.each(function(){var u=n(this),p=u.offset(),g={left:p.left-l.elementPos.left,top:p.top-l.elementPos.top};n.data(this,"selectable-item",{element:this,$element:u,left:g.left,top:g.top,right:g.left+u.outerWidth(),bottom:g.top+u.outerHeight(),startselected:!1,selected:u.hasClass("ui-selected"),selecting:u.hasClass("ui-selecting"),unselecting:u.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=n("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(l){var u=this,p=this.options;this.opos=[l.pageX,l.pageY],this.elementPos=n(this.element[0]).offset(),!this.options.disabled&&(this.selectees=n(p.filter,this.element[0]),this._trigger("start",l),n(p.appendTo).append(this.helper),this.helper.css({left:l.pageX,top:l.pageY,width:0,height:0}),p.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var g=n.data(this,"selectable-item");g.startselected=!0,!l.metaKey&&!l.ctrlKey&&(u._removeClass(g.$element,"ui-selected"),g.selected=!1,u._addClass(g.$element,"ui-unselecting"),g.unselecting=!0,u._trigger("unselecting",l,{unselecting:g.element}))}),n(l.target).parents().addBack().each(function(){var g,C=n.data(this,"selectable-item");if(C)return g=!l.metaKey&&!l.ctrlKey||!C.$element.hasClass("ui-selected"),u._removeClass(C.$element,g?"ui-unselecting":"ui-selected")._addClass(C.$element,g?"ui-selecting":"ui-unselecting"),C.unselecting=!g,C.selecting=g,C.selected=g,g?u._trigger("selecting",l,{selecting:C.element}):u._trigger("unselecting",l,{unselecting:C.element}),!1}))},_mouseDrag:function(l){if(this.dragged=!0,!this.options.disabled){var u,p=this,g=this.options,C=this.opos[0],b=this.opos[1],P=l.pageX,O=l.pageY;return C>P&&(u=P,P=C,C=u),b>O&&(u=O,O=b,b=u),this.helper.css({left:C,top:b,width:P-C,height:O-b}),this.selectees.each(function(){var L=n.data(this,"selectable-item"),U=!1,H={};!L||L.element===p.element[0]||(H.left=L.left+p.elementPos.left,H.right=L.right+p.elementPos.left,H.top=L.top+p.elementPos.top,H.bottom=L.bottom+p.elementPos.top,g.tolerance==="touch"?U=!(H.left>P||H.right<C||H.top>O||H.bottom<b):g.tolerance==="fit"&&(U=H.left>C&&H.right<P&&H.top>b&&H.bottom<O),U?(L.selected&&(p._removeClass(L.$element,"ui-selected"),L.selected=!1),L.unselecting&&(p._removeClass(L.$element,"ui-unselecting"),L.unselecting=!1),L.selecting||(p._addClass(L.$element,"ui-selecting"),L.selecting=!0,p._trigger("selecting",l,{selecting:L.element}))):(L.selecting&&((l.metaKey||l.ctrlKey)&&L.startselected?(p._removeClass(L.$element,"ui-selecting"),L.selecting=!1,p._addClass(L.$element,"ui-selected"),L.selected=!0):(p._removeClass(L.$element,"ui-selecting"),L.selecting=!1,L.startselected&&(p._addClass(L.$element,"ui-unselecting"),L.unselecting=!0),p._trigger("unselecting",l,{unselecting:L.element}))),L.selected&&!l.metaKey&&!l.ctrlKey&&!L.startselected&&(p._removeClass(L.$element,"ui-selected"),L.selected=!1,p._addClass(L.$element,"ui-unselecting"),L.unselecting=!0,p._trigger("unselecting",l,{unselecting:L.element}))))}),!1}},_mouseStop:function(l){var u=this;return this.dragged=!1,n(".ui-unselecting",this.element[0]).each(function(){var p=n.data(this,"selectable-item");u._removeClass(p.$element,"ui-unselecting"),p.unselecting=!1,p.startselected=!1,u._trigger("unselected",l,{unselected:p.element})}),n(".ui-selecting",this.element[0]).each(function(){var p=n.data(this,"selectable-item");u._removeClass(p.$element,"ui-selecting")._addClass(p.$element,"ui-selected"),p.selecting=!1,p.selected=!0,p.startselected=!0,u._trigger("selected",l,{selected:p.element})}),this._trigger("stop",l),this.helper.remove(),!1}});/*!
 * jQuery UI Selectmenu 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.selectmenu",[n.ui.formResetMixin,{version:"1.13.3",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var l=this.element.uniqueId().attr("id");this.ids={element:l,button:l+"-button",menu:l+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=n()},_drawButton:function(){var l,u=this,p=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(g){this.button.trigger("focus"),g.preventDefault()}}),this.element.hide(),this.button=n("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),l=n("<span>").appendTo(this.button),this._addClass(l,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(p).appendTo(this.button),this.options.width!==!1&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){u._rendered||u._refreshMenu()})},_drawMenu:function(){var l=this;this.menu=n("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=n("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(u,p){u.preventDefault(),l._setSelection(),l._select(p.item.data("ui-selectmenu-item"),u)},focus:function(u,p){var g=p.item.data("ui-selectmenu-item");l.focusIndex!=null&&g.index!==l.focusIndex&&(l._trigger("focus",u,{item:g}),l.isOpen||l._select(g,u)),l.focusIndex=g.index,l.button.attr("aria-activedescendant",l.menuItems.eq(g.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),this.options.width===null&&this._resizeButton()},_refreshMenu:function(){var l,u=this.element.find("option");this.menu.empty(),this._parseOptions(u),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,u.length&&(l=this._getSelectedItem(),this.menuInstance.focus(null,l),this._setAria(l.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(l){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",l)))},_position:function(){this.menuWrap.position(n.extend({of:this.button},this.options.position))},close:function(l){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",l))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(l){var u=n("<span>");return this._setText(u,l.label),this._addClass(u,"ui-selectmenu-text"),u},_renderMenu:function(l,u){var p=this,g="";n.each(u,function(C,b){var P;b.optgroup!==g&&(P=n("<li>",{text:b.optgroup}),p._addClass(P,"ui-selectmenu-optgroup","ui-menu-divider"+(b.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),P.appendTo(l),g=b.optgroup),p._renderItemData(l,b)})},_renderItemData:function(l,u){return this._renderItem(l,u).data("ui-selectmenu-item",u)},_renderItem:function(l,u){var p=n("<li>"),g=n("<div>",{title:u.element.attr("title")});return u.disabled&&this._addClass(p,null,"ui-state-disabled"),u.hidden?p.prop("hidden",!0):this._setText(g,u.label),p.append(g).appendTo(l)},_setText:function(l,u){u?l.text(u):l.html("&#160;")},_move:function(l,u){var p,g,C=".ui-menu-item";this.isOpen?p=this.menuItems.eq(this.focusIndex).parent("li"):(p=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),C+=":not(.ui-state-disabled)"),l==="first"||l==="last"?g=p[l==="first"?"prevAll":"nextAll"](C).eq(-1):g=p[l+"All"](C).eq(0),g.length&&this.menuInstance.focus(u,g)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(l){this[this.isOpen?"close":"open"](l)},_setSelection:function(){var l;this.range&&(window.getSelection?(l=window.getSelection(),l.removeAllRanges(),l.addRange(this.range)):this.range.select(),this.button.trigger("focus"))},_documentClick:{mousedown:function(l){this.isOpen&&(n(l.target).closest(".ui-selectmenu-menu, #"+n.escapeSelector(this.ids.button)).length||this.close(l))}},_buttonEvents:{mousedown:function(){var l;window.getSelection?(l=window.getSelection(),l.rangeCount&&(this.range=l.getRangeAt(0))):this.range=document.selection.createRange()},click:function(l){this._setSelection(),this._toggle(l)},keydown:function(l){var u=!0;switch(l.keyCode){case n.ui.keyCode.TAB:case n.ui.keyCode.ESCAPE:this.close(l),u=!1;break;case n.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(l);break;case n.ui.keyCode.UP:l.altKey?this._toggle(l):this._move("prev",l);break;case n.ui.keyCode.DOWN:l.altKey?this._toggle(l):this._move("next",l);break;case n.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(l):this._toggle(l);break;case n.ui.keyCode.LEFT:this._move("prev",l);break;case n.ui.keyCode.RIGHT:this._move("next",l);break;case n.ui.keyCode.HOME:case n.ui.keyCode.PAGE_UP:this._move("first",l);break;case n.ui.keyCode.END:case n.ui.keyCode.PAGE_DOWN:this._move("last",l);break;default:this.menu.trigger(l),u=!1}u&&l.preventDefault()}},_selectFocusedItem:function(l){var u=this.menuItems.eq(this.focusIndex).parent("li");u.hasClass("ui-state-disabled")||this._select(u.data("ui-selectmenu-item"),l)},_select:function(l,u){var p=this.element[0].selectedIndex;this.element[0].selectedIndex=l.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(l)),this._setAria(l),this._trigger("select",u,{item:l}),l.index!==p&&this._trigger("change",u,{item:l}),this.close(u)},_setAria:function(l){var u=this.menuItems.eq(l.index).attr("id");this.button.attr({"aria-labelledby":u,"aria-activedescendant":u}),this.menu.attr("aria-activedescendant",u)},_setOption:function(l,u){if(l==="icons"){var p=this.button.find("span.ui-icon");this._removeClass(p,null,this.options.icons.button)._addClass(p,null,u.button)}this._super(l,u),l==="appendTo"&&this.menuWrap.appendTo(this._appendTo()),l==="width"&&this._resizeButton()},_setOptionDisabled:function(l){this._super(l),this.menuInstance.option("disabled",l),this.button.attr("aria-disabled",l),this._toggleClass(this.button,null,"ui-state-disabled",l),this.element.prop("disabled",l),l?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var l=this.options.appendTo;return l&&(l=l.jquery||l.nodeType?n(l):this.document.find(l).eq(0)),(!l||!l[0])&&(l=this.element.closest(".ui-front, dialog")),l.length||(l=this.document[0].body),l},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var l=this.options.width;if(l===!1){this.button.css("width","");return}l===null&&(l=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(l)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var l=this._super();return l.disabled=this.element.prop("disabled"),l},_parseOptions:function(l){var u=this,p=[];l.each(function(g,C){p.push(u._parseOption(n(C),g))}),this.items=p},_parseOption:function(l,u){var p=l.parent("optgroup");return{element:l,index:u,value:l.val(),label:l.text(),hidden:p.prop("hidden")||l.prop("hidden"),optgroup:p.attr("label")||"",disabled:p.prop("disabled")||l.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]);/*!
 * jQuery UI Slider 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.slider",n.ui.mouse,{version:"1.13.3",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var l,u,p=this.options,g=this.element.find(".ui-slider-handle"),C="<span tabindex='0'></span>",b=[];for(u=p.values&&p.values.length||1,g.length>u&&(g.slice(u).remove(),g=g.slice(0,u)),l=g.length;l<u;l++)b.push(C);this.handles=g.add(n(b.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(P){n(this).data("ui-slider-handle-index",P).attr("tabIndex",0)})},_createRange:function(){var l=this.options;l.range?(l.range===!0&&(l.values?l.values.length&&l.values.length!==2?l.values=[l.values[0],l.values[0]]:Array.isArray(l.values)&&(l.values=l.values.slice(0)):l.values=[this._valueMin(),this._valueMin()]),!this.range||!this.range.length?(this.range=n("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")):(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})),(l.range==="min"||l.range==="max")&&this._addClass(this.range,"ui-slider-range-"+l.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(l){var u,p,g,C,b,P,O,L,U=this,H=this.options;return H.disabled||(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),u={x:l.pageX,y:l.pageY},p=this._normValueFromMouse(u),g=this._valueMax()-this._valueMin()+1,this.handles.each(function(ee){var ae=Math.abs(p-U.values(ee));(g>ae||g===ae&&(ee===U._lastChangedValue||U.values(ee)===H.min))&&(g=ae,C=n(this),b=ee)}),P=this._start(l,b),P===!1)?!1:(this._mouseSliding=!0,this._handleIndex=b,this._addClass(C,null,"ui-state-active"),C.trigger("focus"),O=C.offset(),L=!n(l.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=L?{left:0,top:0}:{left:l.pageX-O.left-C.width()/2,top:l.pageY-O.top-C.height()/2-(parseInt(C.css("borderTopWidth"),10)||0)-(parseInt(C.css("borderBottomWidth"),10)||0)+(parseInt(C.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(l,b,p),this._animateOff=!0,!0)},_mouseStart:function(){return!0},_mouseDrag:function(l){var u={x:l.pageX,y:l.pageY},p=this._normValueFromMouse(u);return this._slide(l,this._handleIndex,p),!1},_mouseStop:function(l){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(l,this._handleIndex),this._change(l,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(l){var u,p,g,C,b;return this.orientation==="horizontal"?(u=this.elementSize.width,p=l.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(u=this.elementSize.height,p=l.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),g=p/u,g>1&&(g=1),g<0&&(g=0),this.orientation==="vertical"&&(g=1-g),C=this._valueMax()-this._valueMin(),b=this._valueMin()+g*C,this._trimAlignValue(b)},_uiHash:function(l,u,p){var g={handle:this.handles[l],handleIndex:l,value:u!==void 0?u:this.value()};return this._hasMultipleValues()&&(g.value=u!==void 0?u:this.values(l),g.values=p||this.values()),g},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(l,u){return this._trigger("start",l,this._uiHash(u))},_slide:function(l,u,p){var g,C,b=this.value(),P=this.values();this._hasMultipleValues()&&(C=this.values(u?0:1),b=this.values(u),this.options.values.length===2&&this.options.range===!0&&(p=u===0?Math.min(C,p):Math.max(C,p)),P[u]=p),p!==b&&(g=this._trigger("slide",l,this._uiHash(u,p,P)),g!==!1&&(this._hasMultipleValues()?this.values(u,p):this.value(p)))},_stop:function(l,u){this._trigger("stop",l,this._uiHash(u))},_change:function(l,u){!this._keySliding&&!this._mouseSliding&&(this._lastChangedValue=u,this._trigger("change",l,this._uiHash(u)))},value:function(l){if(arguments.length){this.options.value=this._trimAlignValue(l),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(l,u){var p,g,C;if(arguments.length>1){this.options.values[l]=this._trimAlignValue(u),this._refreshValue(),this._change(null,l);return}if(arguments.length)if(Array.isArray(arguments[0])){for(p=this.options.values,g=arguments[0],C=0;C<p.length;C+=1)p[C]=this._trimAlignValue(g[C]),this._change(null,C);this._refreshValue()}else return this._hasMultipleValues()?this._values(l):this.value();else return this._values()},_setOption:function(l,u){var p,g=0;switch(l==="range"&&this.options.range===!0&&(u==="min"?(this.options.value=this._values(0),this.options.values=null):u==="max"&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),Array.isArray(this.options.values)&&(g=this.options.values.length),this._super(l,u),l){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(u),this.handles.css(u==="horizontal"?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),p=g-1;p>=0;p--)this._change(null,p);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1;break}},_setOptionDisabled:function(l){this._super(l),this._toggleClass(null,"ui-state-disabled",!!l)},_value:function(){var l=this.options.value;return l=this._trimAlignValue(l),l},_values:function(l){var u,p,g;if(arguments.length)return u=this.options.values[l],u=this._trimAlignValue(u),u;if(this._hasMultipleValues()){for(p=this.options.values.slice(),g=0;g<p.length;g+=1)p[g]=this._trimAlignValue(p[g]);return p}else return[]},_trimAlignValue:function(l){if(l<=this._valueMin())return this._valueMin();if(l>=this._valueMax())return this._valueMax();var u=this.options.step>0?this.options.step:1,p=(l-this._valueMin())%u,g=l-p;return Math.abs(p)*2>=u&&(g+=p>0?u:-u),parseFloat(g.toFixed(5))},_calculateNewMax:function(){var l=this.options.max,u=this._valueMin(),p=this.options.step,g=Math.round((l-u)/p)*p;l=g+u,l>this.options.max&&(l-=p),this.max=parseFloat(l.toFixed(this._precision()))},_precision:function(){var l=this._precisionOf(this.options.step);return this.options.min!==null&&(l=Math.max(l,this._precisionOf(this.options.min))),l},_precisionOf:function(l){var u=l.toString(),p=u.indexOf(".");return p===-1?0:u.length-p-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(l){l==="vertical"&&this.range.css({width:"",left:""}),l==="horizontal"&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var l,u,p,g,C,b=this.options.range,P=this.options,O=this,L=this._animateOff?!1:P.animate,U={};this._hasMultipleValues()?this.handles.each(function(H){u=(O.values(H)-O._valueMin())/(O._valueMax()-O._valueMin())*100,U[O.orientation==="horizontal"?"left":"bottom"]=u+"%",n(this).stop(1,1)[L?"animate":"css"](U,P.animate),O.options.range===!0&&(O.orientation==="horizontal"?(H===0&&O.range.stop(1,1)[L?"animate":"css"]({left:u+"%"},P.animate),H===1&&O.range[L?"animate":"css"]({width:u-l+"%"},{queue:!1,duration:P.animate})):(H===0&&O.range.stop(1,1)[L?"animate":"css"]({bottom:u+"%"},P.animate),H===1&&O.range[L?"animate":"css"]({height:u-l+"%"},{queue:!1,duration:P.animate}))),l=u}):(p=this.value(),g=this._valueMin(),C=this._valueMax(),u=C!==g?(p-g)/(C-g)*100:0,U[this.orientation==="horizontal"?"left":"bottom"]=u+"%",this.handle.stop(1,1)[L?"animate":"css"](U,P.animate),b==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[L?"animate":"css"]({width:u+"%"},P.animate),b==="max"&&this.orientation==="horizontal"&&this.range.stop(1,1)[L?"animate":"css"]({width:100-u+"%"},P.animate),b==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[L?"animate":"css"]({height:u+"%"},P.animate),b==="max"&&this.orientation==="vertical"&&this.range.stop(1,1)[L?"animate":"css"]({height:100-u+"%"},P.animate))},_handleEvents:{keydown:function(l){var u,p,g,C,b=n(l.target).data("ui-slider-handle-index");switch(l.keyCode){case n.ui.keyCode.HOME:case n.ui.keyCode.END:case n.ui.keyCode.PAGE_UP:case n.ui.keyCode.PAGE_DOWN:case n.ui.keyCode.UP:case n.ui.keyCode.RIGHT:case n.ui.keyCode.DOWN:case n.ui.keyCode.LEFT:if(l.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(n(l.target),null,"ui-state-active"),u=this._start(l,b),u===!1))return;break}switch(C=this.options.step,this._hasMultipleValues()?p=g=this.values(b):p=g=this.value(),l.keyCode){case n.ui.keyCode.HOME:g=this._valueMin();break;case n.ui.keyCode.END:g=this._valueMax();break;case n.ui.keyCode.PAGE_UP:g=this._trimAlignValue(p+(this._valueMax()-this._valueMin())/this.numPages);break;case n.ui.keyCode.PAGE_DOWN:g=this._trimAlignValue(p-(this._valueMax()-this._valueMin())/this.numPages);break;case n.ui.keyCode.UP:case n.ui.keyCode.RIGHT:if(p===this._valueMax())return;g=this._trimAlignValue(p+C);break;case n.ui.keyCode.DOWN:case n.ui.keyCode.LEFT:if(p===this._valueMin())return;g=this._trimAlignValue(p-C);break}this._slide(l,b,g)},keyup:function(l){var u=n(l.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(l,u),this._change(l,u),this._removeClass(n(l.target),null,"ui-state-active"))}}});/*!
 * jQuery UI Sortable 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.sortable",n.ui.mouse,{version:"1.13.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(l,u,p){return l>=u&&l<u+p},_isFloating:function(l){return/left|right/.test(l.css("float"))||/inline|table-cell/.test(l.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(l,u){this._super(l,u),l==="handle"&&this._setHandleClassName()},_setHandleClassName:function(){var l=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),n.each(this.items,function(){l._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var l=this.items.length-1;l>=0;l--)this.items[l].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(l,u){var p=null,g=!1,C=this;return this.reverting||this.options.disabled||this.options.type==="static"||(this._refreshItems(l),n(l.target).parents().each(function(){if(n.data(this,C.widgetName+"-item")===C)return p=n(this),!1}),n.data(l.target,C.widgetName+"-item")===C&&(p=n(l.target)),!p)||this.options.handle&&!u&&(n(this.options.handle,p).find("*").addBack().each(function(){this===l.target&&(g=!0)}),!g)?!1:(this.currentItem=p,this._removeCurrentsFromItems(),!0)},_mouseStart:function(l,u,p){var g,C,b=this.options;if(this.currentContainer=this,this.refreshPositions(),this.appendTo=n(b.appendTo!=="parent"?b.appendTo:this.currentItem.parent()),this.helper=this._createHelper(l),this._cacheHelperProportions(),this._cacheMargins(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},n.extend(this.offset,{click:{left:l.pageX-this.offset.left,top:l.pageY-this.offset.top},relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),b.cursorAt&&this._adjustOffsetFromHelper(b.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),this.scrollParent=this.placeholder.scrollParent(),n.extend(this.offset,{parent:this._getParentOffset()}),b.containment&&this._setContainment(),b.cursor&&b.cursor!=="auto"&&(C=this.document.find("body"),this.storedCursor=C.css("cursor"),C.css("cursor",b.cursor),this.storedStylesheet=n("<style>*{ cursor: "+b.cursor+" !important; }</style>").appendTo(C)),b.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",b.zIndex)),b.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",b.opacity)),this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",l,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!p)for(g=this.containers.length-1;g>=0;g--)this.containers[g]._trigger("activate",l,this._uiHash(this));return n.ui.ddmanager&&(n.ui.ddmanager.current=this),n.ui.ddmanager&&!b.dropBehaviour&&n.ui.ddmanager.prepareOffsets(this,l),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this.helper.parent().is(this.appendTo)||(this.helper.detach().appendTo(this.appendTo),this.offset.parent=this._getParentOffset()),this.position=this.originalPosition=this._generatePosition(l),this.originalPageX=l.pageX,this.originalPageY=l.pageY,this.lastPositionAbs=this.positionAbs=this._convertPositionTo("absolute"),this._mouseDrag(l),!0},_scroll:function(l){var u=this.options,p=!1;return this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-l.pageY<u.scrollSensitivity?this.scrollParent[0].scrollTop=p=this.scrollParent[0].scrollTop+u.scrollSpeed:l.pageY-this.overflowOffset.top<u.scrollSensitivity&&(this.scrollParent[0].scrollTop=p=this.scrollParent[0].scrollTop-u.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-l.pageX<u.scrollSensitivity?this.scrollParent[0].scrollLeft=p=this.scrollParent[0].scrollLeft+u.scrollSpeed:l.pageX-this.overflowOffset.left<u.scrollSensitivity&&(this.scrollParent[0].scrollLeft=p=this.scrollParent[0].scrollLeft-u.scrollSpeed)):(l.pageY-this.document.scrollTop()<u.scrollSensitivity?p=this.document.scrollTop(this.document.scrollTop()-u.scrollSpeed):this.window.height()-(l.pageY-this.document.scrollTop())<u.scrollSensitivity&&(p=this.document.scrollTop(this.document.scrollTop()+u.scrollSpeed)),l.pageX-this.document.scrollLeft()<u.scrollSensitivity?p=this.document.scrollLeft(this.document.scrollLeft()-u.scrollSpeed):this.window.width()-(l.pageX-this.document.scrollLeft())<u.scrollSensitivity&&(p=this.document.scrollLeft(this.document.scrollLeft()+u.scrollSpeed))),p},_mouseDrag:function(l){var u,p,g,C,b=this.options;for(this.position=this._generatePosition(l),this.positionAbs=this._convertPositionTo("absolute"),(!this.options.axis||this.options.axis!=="y")&&(this.helper[0].style.left=this.position.left+"px"),(!this.options.axis||this.options.axis!=="x")&&(this.helper[0].style.top=this.position.top+"px"),b.scroll&&this._scroll(l)!==!1&&(this._refreshItemPositions(!0),n.ui.ddmanager&&!b.dropBehaviour&&n.ui.ddmanager.prepareOffsets(this,l)),this.dragDirection={vertical:this._getDragVerticalDirection(),horizontal:this._getDragHorizontalDirection()},u=this.items.length-1;u>=0;u--)if(p=this.items[u],g=p.item[0],C=this._intersectsWithPointer(p),!!C&&p.instance===this.currentContainer&&g!==this.currentItem[0]&&this.placeholder[C===1?"next":"prev"]()[0]!==g&&!n.contains(this.placeholder[0],g)&&(this.options.type!=="semi-dynamic"||!n.contains(this.element[0],g))){if(this.direction=C===1?"down":"up",this.options.tolerance==="pointer"||this._intersectsWithSides(p))this._rearrange(l,p);else break;this._trigger("change",l,this._uiHash());break}return this._contactContainers(l),n.ui.ddmanager&&n.ui.ddmanager.drag(this,l),this._trigger("sort",l,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(l,u){if(l){if(n.ui.ddmanager&&!this.options.dropBehaviour&&n.ui.ddmanager.drop(this,l),this.options.revert){var p=this,g=this.placeholder.offset(),C=this.options.axis,b={};(!C||C==="x")&&(b.left=g.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),(!C||C==="y")&&(b.top=g.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,n(this.helper).animate(b,parseInt(this.options.revert,10)||500,function(){p._clear(l)})}else this._clear(l,u);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new n.Event("mouseup",{target:null})),this.options.helper==="original"?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var l=this.containers.length-1;l>=0;l--)this.containers[l]._trigger("deactivate",null,this._uiHash(this)),this.containers[l].containerCache.over&&(this.containers[l]._trigger("out",null,this._uiHash(this)),this.containers[l].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),n.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?n(this.domPosition.prev).after(this.currentItem):n(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(l){var u=this._getItemsAsjQuery(l&&l.connected),p=[];return l=l||{},n(u).each(function(){var g=(n(l.item||this).attr(l.attribute||"id")||"").match(l.expression||/(.+)[\-=_](.+)/);g&&p.push((l.key||g[1]+"[]")+"="+(l.key&&l.expression?g[1]:g[2]))}),!p.length&&l.key&&p.push(l.key+"="),p.join("&")},toArray:function(l){var u=this._getItemsAsjQuery(l&&l.connected),p=[];return l=l||{},u.each(function(){p.push(n(l.item||this).attr(l.attribute||"id")||"")}),p},_intersectsWith:function(l){var u=this.positionAbs.left,p=u+this.helperProportions.width,g=this.positionAbs.top,C=g+this.helperProportions.height,b=l.left,P=b+l.width,O=l.top,L=O+l.height,U=this.offset.click.top,H=this.offset.click.left,ee=this.options.axis==="x"||g+U>O&&g+U<L,ae=this.options.axis==="y"||u+H>b&&u+H<P,Y=ee&&ae;return this.options.tolerance==="pointer"||this.options.forcePointerForContainers||this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>l[this.floating?"width":"height"]?Y:b<u+this.helperProportions.width/2&&p-this.helperProportions.width/2<P&&O<g+this.helperProportions.height/2&&C-this.helperProportions.height/2<L},_intersectsWithPointer:function(l){var u,p,g=this.options.axis==="x"||this._isOverAxis(this.positionAbs.top+this.offset.click.top,l.top,l.height),C=this.options.axis==="y"||this._isOverAxis(this.positionAbs.left+this.offset.click.left,l.left,l.width),b=g&&C;return b?(u=this.dragDirection.vertical,p=this.dragDirection.horizontal,this.floating?p==="right"||u==="down"?2:1:u&&(u==="down"?2:1)):!1},_intersectsWithSides:function(l){var u=this._isOverAxis(this.positionAbs.top+this.offset.click.top,l.top+l.height/2,l.height),p=this._isOverAxis(this.positionAbs.left+this.offset.click.left,l.left+l.width/2,l.width),g=this.dragDirection.vertical,C=this.dragDirection.horizontal;return this.floating&&C?C==="right"&&p||C==="left"&&!p:g&&(g==="down"&&u||g==="up"&&!u)},_getDragVerticalDirection:function(){var l=this.positionAbs.top-this.lastPositionAbs.top;return l!==0&&(l>0?"down":"up")},_getDragHorizontalDirection:function(){var l=this.positionAbs.left-this.lastPositionAbs.left;return l!==0&&(l>0?"right":"left")},refresh:function(l){return this._refreshItems(l),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var l=this.options;return l.connectWith.constructor===String?[l.connectWith]:l.connectWith},_getItemsAsjQuery:function(l){var u,p,g,C,b=[],P=[],O=this._connectWith();if(O&&l)for(u=O.length-1;u>=0;u--)for(g=n(O[u],this.document[0]),p=g.length-1;p>=0;p--)C=n.data(g[p],this.widgetFullName),C&&C!==this&&!C.options.disabled&&P.push([typeof C.options.items=="function"?C.options.items.call(C.element):n(C.options.items,C.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),C]);P.push([typeof this.options.items=="function"?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):n(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);function L(){b.push(this)}for(u=P.length-1;u>=0;u--)P[u][0].each(L);return n(b)},_removeCurrentsFromItems:function(){var l=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=n.grep(this.items,function(u){for(var p=0;p<l.length;p++)if(l[p]===u.item[0])return!1;return!0})},_refreshItems:function(l){this.items=[],this.containers=[this];var u,p,g,C,b,P,O,L,U=this.items,H=[[typeof this.options.items=="function"?this.options.items.call(this.element[0],l,{item:this.currentItem}):n(this.options.items,this.element),this]],ee=this._connectWith();if(ee&&this.ready)for(u=ee.length-1;u>=0;u--)for(g=n(ee[u],this.document[0]),p=g.length-1;p>=0;p--)C=n.data(g[p],this.widgetFullName),C&&C!==this&&!C.options.disabled&&(H.push([typeof C.options.items=="function"?C.options.items.call(C.element[0],l,{item:this.currentItem}):n(C.options.items,C.element),C]),this.containers.push(C));for(u=H.length-1;u>=0;u--)for(b=H[u][1],P=H[u][0],p=0,L=P.length;p<L;p++)O=n(P[p]),O.data(this.widgetName+"-item",b),U.push({item:O,instance:b,width:0,height:0,left:0,top:0})},_refreshItemPositions:function(l){var u,p,g,C;for(u=this.items.length-1;u>=0;u--)p=this.items[u],!(this.currentContainer&&p.instance!==this.currentContainer&&p.item[0]!==this.currentItem[0])&&(g=this.options.toleranceElement?n(this.options.toleranceElement,p.item):p.item,l||(p.width=g.outerWidth(),p.height=g.outerHeight()),C=g.offset(),p.left=C.left,p.top=C.top)},refreshPositions:function(l){this.floating=this.items.length?this.options.axis==="x"||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),this._refreshItemPositions(l);var u,p;if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(u=this.containers.length-1;u>=0;u--)p=this.containers[u].element.offset(),this.containers[u].containerCache.left=p.left,this.containers[u].containerCache.top=p.top,this.containers[u].containerCache.width=this.containers[u].element.outerWidth(),this.containers[u].containerCache.height=this.containers[u].element.outerHeight();return this},_createPlaceholder:function(l){l=l||this;var u,p,g=l.options;(!g.placeholder||g.placeholder.constructor===String)&&(u=g.placeholder,p=l.currentItem[0].nodeName.toLowerCase(),g.placeholder={element:function(){var C=n("<"+p+">",l.document[0]);return l._addClass(C,"ui-sortable-placeholder",u||l.currentItem[0].className)._removeClass(C,"ui-sortable-helper"),p==="tbody"?l._createTrPlaceholder(l.currentItem.find("tr").eq(0),n("<tr>",l.document[0]).appendTo(C)):p==="tr"?l._createTrPlaceholder(l.currentItem,C):p==="img"&&C.attr("src",l.currentItem.attr("src")),u||C.css("visibility","hidden"),C},update:function(C,b){u&&!g.forcePlaceholderSize||((!b.height()||g.forcePlaceholderSize&&(p==="tbody"||p==="tr"))&&b.height(l.currentItem.innerHeight()-parseInt(l.currentItem.css("paddingTop")||0,10)-parseInt(l.currentItem.css("paddingBottom")||0,10)),b.width()||b.width(l.currentItem.innerWidth()-parseInt(l.currentItem.css("paddingLeft")||0,10)-parseInt(l.currentItem.css("paddingRight")||0,10)))}}),l.placeholder=n(g.placeholder.element.call(l.element,l.currentItem)),l.currentItem.after(l.placeholder),g.placeholder.update(l,l.placeholder)},_createTrPlaceholder:function(l,u){var p=this;l.children().each(function(){n("<td>&#160;</td>",p.document[0]).attr("colspan",n(this).attr("colspan")||1).appendTo(u)})},_contactContainers:function(l){var u,p,g,C,b,P,O,L,U,H,ee=null,ae=null;for(u=this.containers.length-1;u>=0;u--)if(!n.contains(this.currentItem[0],this.containers[u].element[0]))if(this._intersectsWith(this.containers[u].containerCache)){if(ee&&n.contains(this.containers[u].element[0],ee.element[0]))continue;ee=this.containers[u],ae=u}else this.containers[u].containerCache.over&&(this.containers[u]._trigger("out",l,this._uiHash(this)),this.containers[u].containerCache.over=0);if(ee)if(this.containers.length===1)this.containers[ae].containerCache.over||(this.containers[ae]._trigger("over",l,this._uiHash(this)),this.containers[ae].containerCache.over=1);else{for(g=1e4,C=null,U=ee.floating||this._isFloating(this.currentItem),b=U?"left":"top",P=U?"width":"height",H=U?"pageX":"pageY",p=this.items.length-1;p>=0;p--)n.contains(this.containers[ae].element[0],this.items[p].item[0])&&this.items[p].item[0]!==this.currentItem[0]&&(O=this.items[p].item.offset()[b],L=!1,l[H]-O>this.items[p][P]/2&&(L=!0),Math.abs(l[H]-O)<g&&(g=Math.abs(l[H]-O),C=this.items[p],this.direction=L?"up":"down"));if(!C&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[ae]){this.currentContainer.containerCache.over||(this.containers[ae]._trigger("over",l,this._uiHash()),this.currentContainer.containerCache.over=1);return}C?this._rearrange(l,C,null,!0):this._rearrange(l,null,this.containers[ae].element,!0),this._trigger("change",l,this._uiHash()),this.containers[ae]._trigger("change",l,this._uiHash(this)),this.currentContainer=this.containers[ae],this.options.placeholder.update(this.currentContainer,this.placeholder),this.scrollParent=this.placeholder.scrollParent(),this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this.containers[ae]._trigger("over",l,this._uiHash(this)),this.containers[ae].containerCache.over=1}},_createHelper:function(l){var u=this.options,p=typeof u.helper=="function"?n(u.helper.apply(this.element[0],[l,this.currentItem])):u.helper==="clone"?this.currentItem.clone():this.currentItem;return p.parents("body").length||this.appendTo[0].appendChild(p[0]),p[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!p[0].style.width||u.forceHelperSize)&&p.width(this.currentItem.width()),(!p[0].style.height||u.forceHelperSize)&&p.height(this.currentItem.height()),p},_adjustOffsetFromHelper:function(l){typeof l=="string"&&(l=l.split(" ")),Array.isArray(l)&&(l={left:+l[0],top:+l[1]||0}),"left"in l&&(this.offset.click.left=l.left+this.margins.left),"right"in l&&(this.offset.click.left=this.helperProportions.width-l.right+this.margins.left),"top"in l&&(this.offset.click.top=l.top+this.margins.top),"bottom"in l&&(this.offset.click.top=this.helperProportions.height-l.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var l=this.offsetParent.offset();return this.cssPosition==="absolute"&&this.scrollParent[0]!==this.document[0]&&n.contains(this.scrollParent[0],this.offsetParent[0])&&(l.left+=this.scrollParent.scrollLeft(),l.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&n.ui.ie)&&(l={top:0,left:0}),{top:l.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:l.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var l=this.currentItem.position();return{top:l.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:l.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var l,u,p,g=this.options;g.containment==="parent"&&(g.containment=this.helper[0].parentNode),(g.containment==="document"||g.containment==="window")&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,g.containment==="document"?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,(g.containment==="document"?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(g.containment)||(l=n(g.containment)[0],u=n(g.containment).offset(),p=n(l).css("overflow")!=="hidden",this.containment=[u.left+(parseInt(n(l).css("borderLeftWidth"),10)||0)+(parseInt(n(l).css("paddingLeft"),10)||0)-this.margins.left,u.top+(parseInt(n(l).css("borderTopWidth"),10)||0)+(parseInt(n(l).css("paddingTop"),10)||0)-this.margins.top,u.left+(p?Math.max(l.scrollWidth,l.offsetWidth):l.offsetWidth)-(parseInt(n(l).css("borderLeftWidth"),10)||0)-(parseInt(n(l).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,u.top+(p?Math.max(l.scrollHeight,l.offsetHeight):l.offsetHeight)-(parseInt(n(l).css("borderTopWidth"),10)||0)-(parseInt(n(l).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(l,u){u||(u=this.position);var p=l==="absolute"?1:-1,g=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&n.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,C=/(html|body)/i.test(g[0].tagName);return{top:u.top+this.offset.relative.top*p+this.offset.parent.top*p-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():C?0:g.scrollTop())*p,left:u.left+this.offset.relative.left*p+this.offset.parent.left*p-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():C?0:g.scrollLeft())*p}},_generatePosition:function(l){var u,p,g=this.options,C=l.pageX,b=l.pageY,P=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&n.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,O=/(html|body)/i.test(P[0].tagName);return this.cssPosition==="relative"&&!(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(l.pageX-this.offset.click.left<this.containment[0]&&(C=this.containment[0]+this.offset.click.left),l.pageY-this.offset.click.top<this.containment[1]&&(b=this.containment[1]+this.offset.click.top),l.pageX-this.offset.click.left>this.containment[2]&&(C=this.containment[2]+this.offset.click.left),l.pageY-this.offset.click.top>this.containment[3]&&(b=this.containment[3]+this.offset.click.top)),g.grid&&(u=this.originalPageY+Math.round((b-this.originalPageY)/g.grid[1])*g.grid[1],b=this.containment?u-this.offset.click.top>=this.containment[1]&&u-this.offset.click.top<=this.containment[3]?u:u-this.offset.click.top>=this.containment[1]?u-g.grid[1]:u+g.grid[1]:u,p=this.originalPageX+Math.round((C-this.originalPageX)/g.grid[0])*g.grid[0],C=this.containment?p-this.offset.click.left>=this.containment[0]&&p-this.offset.click.left<=this.containment[2]?p:p-this.offset.click.left>=this.containment[0]?p-g.grid[0]:p+g.grid[0]:p)),{top:b-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():O?0:P.scrollTop()),left:C-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():O?0:P.scrollLeft())}},_rearrange:function(l,u,p,g){p?p[0].appendChild(this.placeholder[0]):u.item[0].parentNode.insertBefore(this.placeholder[0],this.direction==="down"?u.item[0]:u.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var C=this.counter;this._delay(function(){C===this.counter&&this.refreshPositions(!g)})},_clear:function(l,u){this.reverting=!1;var p,g=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(p in this._storedCSS)(this._storedCSS[p]==="auto"||this._storedCSS[p]==="static")&&(this._storedCSS[p]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!u&&g.push(function(b){this._trigger("receive",b,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!u&&g.push(function(b){this._trigger("update",b,this._uiHash())}),this!==this.currentContainer&&(u||(g.push(function(b){this._trigger("remove",b,this._uiHash())}),g.push((function(b){return function(P){b._trigger("receive",P,this._uiHash(this))}}).call(this,this.currentContainer)),g.push((function(b){return function(P){b._trigger("update",P,this._uiHash(this))}}).call(this,this.currentContainer))));function C(b,P,O){return function(L){O._trigger(b,L,P._uiHash(P))}}for(p=this.containers.length-1;p>=0;p--)u||g.push(C("deactivate",this,this.containers[p])),this.containers[p].containerCache.over&&(g.push(C("out",this,this.containers[p])),this.containers[p].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex),this.dragging=!1,u||this._trigger("beforeStop",l,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!u){for(p=0;p<g.length;p++)g[p].call(this,l);this._trigger("stop",l,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){n.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(l){var u=l||this;return{helper:u.helper,placeholder:u.placeholder||n([]),position:u.position,originalPosition:u.originalPosition,offset:u.positionAbs,item:u.currentItem,sender:l?l.element:null}}});/*!
 * jQuery UI Spinner 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */function se(l){return function(){var u=this.element.val();l.apply(this,arguments),this._refresh(),u!==this.element.val()&&this._trigger("change")}}n.widget("ui.spinner",{version:"1.13.3",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),this.value()!==""&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var l=this._super(),u=this.element;return n.each(["min","max","step"],function(p,g){var C=u.attr(g);C!=null&&C.length&&(l[g]=C)}),l},_events:{keydown:function(l){this._start(l)&&this._keydown(l)&&l.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(l){if(this.cancelBlur){delete this.cancelBlur;return}this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",l)},mousewheel:function(l,u){var p=n.ui.safeActiveElement(this.document[0]),g=this.element[0]===p;if(!(!g||!u)){if(!this.spinning&&!this._start(l))return!1;this._spin((u>0?1:-1)*this.options.step,l),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(l)},100),l.preventDefault()}},"mousedown .ui-spinner-button":function(l){var u;u=this.element[0]===n.ui.safeActiveElement(this.document[0])?this.previous:this.element.val();function p(){var g=this.element[0]===n.ui.safeActiveElement(this.document[0]);g||(this.element.trigger("focus"),this.previous=u,this._delay(function(){this.previous=u}))}l.preventDefault(),p.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,p.call(this)}),this._start(l)!==!1&&this._repeat(null,n(l.currentTarget).hasClass("ui-spinner-up")?1:-1,l)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(l){if(n(l.currentTarget).hasClass("ui-state-active")){if(this._start(l)===!1)return!1;this._repeat(null,n(l.currentTarget).hasClass("ui-spinner-up")?1:-1,l)}},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(this.uiSpinner.height()*.5)&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(l){var u=this.options,p=n.ui.keyCode;switch(l.keyCode){case p.UP:return this._repeat(null,1,l),!0;case p.DOWN:return this._repeat(null,-1,l),!0;case p.PAGE_UP:return this._repeat(null,u.page,l),!0;case p.PAGE_DOWN:return this._repeat(null,-u.page,l),!0}return!1},_start:function(l){return!this.spinning&&this._trigger("start",l)===!1?!1:(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(l,u,p){l=l||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,u,p)},l),this._spin(u*this.options.step,p)},_spin:function(l,u){var p=this.value()||0;this.counter||(this.counter=1),p=this._adjustValue(p+l*this._increment(this.counter)),(!this.spinning||this._trigger("spin",u,{value:p})!==!1)&&(this._value(p),this.counter++)},_increment:function(l){var u=this.options.incremental;return u?typeof u=="function"?u(l):Math.floor(l*l*l/5e4-l*l/500+17*l/200+1):1},_precision:function(){var l=this._precisionOf(this.options.step);return this.options.min!==null&&(l=Math.max(l,this._precisionOf(this.options.min))),l},_precisionOf:function(l){var u=l.toString(),p=u.indexOf(".");return p===-1?0:u.length-p-1},_adjustValue:function(l){var u,p,g=this.options;return u=g.min!==null?g.min:0,p=l-u,p=Math.round(p/g.step)*g.step,l=u+p,l=parseFloat(l.toFixed(this._precision())),g.max!==null&&l>g.max?g.max:g.min!==null&&l<g.min?g.min:l},_stop:function(l){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",l))},_setOption:function(l,u){var p,g,C;if(l==="culture"||l==="numberFormat"){p=this._parse(this.element.val()),this.options[l]=u,this.element.val(this._format(p));return}(l==="max"||l==="min"||l==="step")&&typeof u=="string"&&(u=this._parse(u)),l==="icons"&&(g=this.buttons.first().find(".ui-icon"),this._removeClass(g,null,this.options.icons.up),this._addClass(g,null,u.up),C=this.buttons.last().find(".ui-icon"),this._removeClass(C,null,this.options.icons.down),this._addClass(C,null,u.down)),this._super(l,u)},_setOptionDisabled:function(l){this._super(l),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!l),this.element.prop("disabled",!!l),this.buttons.button(l?"disable":"enable")},_setOptions:se(function(l){this._super(l)}),_parse:function(l){return typeof l=="string"&&l!==""&&(l=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(l,10,this.options.culture):+l),l===""||isNaN(l)?null:l},_format:function(l){return l===""?"":window.Globalize&&this.options.numberFormat?Globalize.format(l,this.options.numberFormat,this.options.culture):l},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var l=this.value();return l===null?!1:l===this._adjustValue(l)},_value:function(l,u){var p;l!==""&&(p=this._parse(l),p!==null&&(u||(p=this._adjustValue(p)),l=this._format(p))),this.element.val(l),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:se(function(l){this._stepUp(l)}),_stepUp:function(l){this._start()&&(this._spin((l||1)*this.options.step),this._stop())},stepDown:se(function(l){this._stepDown(l)}),_stepDown:function(l){this._start()&&(this._spin((l||1)*-this.options.step),this._stop())},pageUp:se(function(l){this._stepUp((l||1)*this.options.page)}),pageDown:se(function(l){this._stepDown((l||1)*this.options.page)}),value:function(l){if(!arguments.length)return this._parse(this.element.val());se(this._value).call(this,l)},widget:function(){return this.uiSpinner}}),n.uiBackCompat!==!1&&n.widget("ui.spinner",n.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),n.ui.spinner;/*!
 * jQuery UI Tabs 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.tabs",{version:"1.13.3",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:(function(){var l=/#.*$/;return function(u){var p,g;p=u.href.replace(l,""),g=location.href.replace(l,"");try{p=decodeURIComponent(p)}catch{}try{g=decodeURIComponent(g)}catch{}return u.hash.length>1&&p===g}})(),_create:function(){var l=this,u=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,u.collapsible),this._processTabs(),u.active=this._initialActive(),Array.isArray(u.disabled)&&(u.disabled=n.uniqueSort(u.disabled.concat(n.map(this.tabs.filter(".ui-state-disabled"),function(p){return l.tabs.index(p)}))).sort()),this.options.active!==!1&&this.anchors.length?this.active=this._findActive(u.active):this.active=n(),this._refresh(),this.active.length&&this.load(u.active)},_initialActive:function(){var l=this.options.active,u=this.options.collapsible,p=location.hash.substring(1);return l===null&&(p&&this.tabs.each(function(g,C){if(n(C).attr("aria-controls")===p)return l=g,!1}),l===null&&(l=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(l===null||l===-1)&&(l=this.tabs.length?0:!1)),l!==!1&&(l=this.tabs.index(this.tabs.eq(l)),l===-1&&(l=u?!1:0)),!u&&l===!1&&this.anchors.length&&(l=0),l},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):n()}},_tabKeydown:function(l){var u=n(n.ui.safeActiveElement(this.document[0])).closest("li"),p=this.tabs.index(u),g=!0;if(!this._handlePageNav(l)){switch(l.keyCode){case n.ui.keyCode.RIGHT:case n.ui.keyCode.DOWN:p++;break;case n.ui.keyCode.UP:case n.ui.keyCode.LEFT:g=!1,p--;break;case n.ui.keyCode.END:p=this.anchors.length-1;break;case n.ui.keyCode.HOME:p=0;break;case n.ui.keyCode.SPACE:l.preventDefault(),clearTimeout(this.activating),this._activate(p);return;case n.ui.keyCode.ENTER:l.preventDefault(),clearTimeout(this.activating),this._activate(p===this.options.active?!1:p);return;default:return}l.preventDefault(),clearTimeout(this.activating),p=this._focusNextTab(p,g),!l.ctrlKey&&!l.metaKey&&(u.attr("aria-selected","false"),this.tabs.eq(p).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",p)},this.delay))}},_panelKeydown:function(l){this._handlePageNav(l)||l.ctrlKey&&l.keyCode===n.ui.keyCode.UP&&(l.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(l){if(l.altKey&&l.keyCode===n.ui.keyCode.PAGE_UP)return this._activate(this._focusNextTab(this.options.active-1,!1)),!0;if(l.altKey&&l.keyCode===n.ui.keyCode.PAGE_DOWN)return this._activate(this._focusNextTab(this.options.active+1,!0)),!0},_findNextTab:function(l,u){var p=this.tabs.length-1;function g(){return l>p&&(l=0),l<0&&(l=p),l}for(;n.inArray(g(),this.options.disabled)!==-1;)l=u?l+1:l-1;return l},_focusNextTab:function(l,u){return l=this._findNextTab(l,u),this.tabs.eq(l).trigger("focus"),l},_setOption:function(l,u){if(l==="active"){this._activate(u);return}this._super(l,u),l==="collapsible"&&(this._toggleClass("ui-tabs-collapsible",null,u),!u&&this.options.active===!1&&this._activate(0)),l==="event"&&this._setupEvents(u),l==="heightStyle"&&this._setupHeightStyle(u)},_sanitizeSelector:function(l){return l?l.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var l=this.options,u=this.tablist.children(":has(a[href])");l.disabled=n.map(u.filter(".ui-state-disabled"),function(p){return u.index(p)}),this._processTabs(),l.active===!1||!this.anchors.length?(l.active=!1,this.active=n()):this.active.length&&!n.contains(this.tablist[0],this.active[0])?this.tabs.length===l.disabled.length?(l.active=!1,this.active=n()):this._activate(this._findNextTab(Math.max(0,l.active-1),!1)):l.active=this.tabs.index(this.active),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var l=this,u=this.tabs,p=this.anchors,g=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(C){n(this).is(".ui-state-disabled")&&C.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){n(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return n("a",this)[0]}).attr({tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=n(),this.anchors.each(function(C,b){var P,O,L,U=n(b).uniqueId().attr("id"),H=n(b).closest("li"),ee=H.attr("aria-controls");l._isLocal(b)?(P=b.hash,L=P.substring(1),O=l.element.find(l._sanitizeSelector(P))):(L=H.attr("aria-controls")||n({}).uniqueId()[0].id,P="#"+L,O=l.element.find(P),O.length||(O=l._createPanel(L),O.insertAfter(l.panels[C-1]||l.tablist)),O.attr("aria-live","polite")),O.length&&(l.panels=l.panels.add(O)),ee&&H.data("ui-tabs-aria-controls",ee),H.attr({"aria-controls":L,"aria-labelledby":U}),O.attr("aria-labelledby",U)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),u&&(this._off(u.not(this.tabs)),this._off(p.not(this.anchors)),this._off(g.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(l){return n("<div>").attr("id",l).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(l){var u,p,g;for(Array.isArray(l)&&(l.length?l.length===this.anchors.length&&(l=!0):l=!1),g=0;p=this.tabs[g];g++)u=n(p),l===!0||n.inArray(g,l)!==-1?(u.attr("aria-disabled","true"),this._addClass(u,null,"ui-state-disabled")):(u.removeAttr("aria-disabled"),this._removeClass(u,null,"ui-state-disabled"));this.options.disabled=l,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,l===!0)},_setupEvents:function(l){var u={};l&&n.each(l.split(" "),function(p,g){u[g]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(p){p.preventDefault()}}),this._on(this.anchors,u),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(l){var u,p=this.element.parent();l==="fill"?(u=p.height(),u-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var g=n(this),C=g.css("position");C==="absolute"||C==="fixed"||(u-=g.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){u-=n(this).outerHeight(!0)}),this.panels.each(function(){n(this).height(Math.max(0,u-n(this).innerHeight()+n(this).height()))}).css("overflow","auto")):l==="auto"&&(u=0,this.panels.each(function(){u=Math.max(u,n(this).height("").height())}).height(u))},_eventHandler:function(l){var u=this.options,p=this.active,g=n(l.currentTarget),C=g.closest("li"),b=C[0]===p[0],P=b&&u.collapsible,O=P?n():this._getPanelForTab(C),L=p.length?this._getPanelForTab(p):n(),U={oldTab:p,oldPanel:L,newTab:P?n():C,newPanel:O};l.preventDefault(),!(C.hasClass("ui-state-disabled")||C.hasClass("ui-tabs-loading")||this.running||b&&!u.collapsible||this._trigger("beforeActivate",l,U)===!1)&&(u.active=P?!1:this.tabs.index(C),this.active=b?n():C,this.xhr&&this.xhr.abort(),!L.length&&!O.length&&n.error("jQuery UI Tabs: Mismatching fragment identifier."),O.length&&this.load(this.tabs.index(C),l),this._toggle(l,U))},_toggle:function(l,u){var p=this,g=u.newPanel,C=u.oldPanel;this.running=!0;function b(){p.running=!1,p._trigger("activate",l,u)}function P(){p._addClass(u.newTab.closest("li"),"ui-tabs-active","ui-state-active"),g.length&&p.options.show?p._show(g,p.options.show,b):(g.show(),b())}C.length&&this.options.hide?this._hide(C,this.options.hide,function(){p._removeClass(u.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),P()}):(this._removeClass(u.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),C.hide(),P()),C.attr("aria-hidden","true"),u.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),g.length&&C.length?u.oldTab.attr("tabIndex",-1):g.length&&this.tabs.filter(function(){return n(this).attr("tabIndex")===0}).attr("tabIndex",-1),g.attr("aria-hidden","false"),u.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(l){var u,p=this._findActive(l);p[0]!==this.active[0]&&(p.length||(p=this.active),u=p.find(".ui-tabs-anchor")[0],this._eventHandler({target:u,currentTarget:u,preventDefault:n.noop}))},_findActive:function(l){return l===!1?n():this.tabs.eq(l)},_getIndex:function(l){return typeof l=="string"&&(l=this.anchors.index(this.anchors.filter("[href$='"+n.escapeSelector(l)+"']"))),l},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){n.data(this,"ui-tabs-destroy")?n(this).remove():n(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var l=n(this),u=l.data("ui-tabs-aria-controls");u?l.attr("aria-controls",u).removeData("ui-tabs-aria-controls"):l.removeAttr("aria-controls")}),this.panels.show(),this.options.heightStyle!=="content"&&this.panels.css("height","")},enable:function(l){var u=this.options.disabled;u!==!1&&(l===void 0?u=!1:(l=this._getIndex(l),Array.isArray(u)?u=n.map(u,function(p){return p!==l?p:null}):u=n.map(this.tabs,function(p,g){return g!==l?g:null})),this._setOptionDisabled(u))},disable:function(l){var u=this.options.disabled;if(u!==!0){if(l===void 0)u=!0;else{if(l=this._getIndex(l),n.inArray(l,u)!==-1)return;Array.isArray(u)?u=n.merge([l],u).sort():u=[l]}this._setOptionDisabled(u)}},load:function(l,u){l=this._getIndex(l);var p=this,g=this.tabs.eq(l),C=g.find(".ui-tabs-anchor"),b=this._getPanelForTab(g),P={tab:g,panel:b},O=function(L,U){U==="abort"&&p.panels.stop(!1,!0),p._removeClass(g,"ui-tabs-loading"),b.removeAttr("aria-busy"),L===p.xhr&&delete p.xhr};this._isLocal(C[0])||(this.xhr=n.ajax(this._ajaxSettings(C,u,P)),this.xhr&&this.xhr.statusText!=="canceled"&&(this._addClass(g,"ui-tabs-loading"),b.attr("aria-busy","true"),this.xhr.done(function(L,U,H){setTimeout(function(){b.html(L),p._trigger("load",u,P),O(H,U)},1)}).fail(function(L,U){setTimeout(function(){O(L,U)},1)})))},_ajaxSettings:function(l,u,p){var g=this;return{url:l.attr("href").replace(/#.*$/,""),beforeSend:function(C,b){return g._trigger("beforeLoad",u,n.extend({jqXHR:C,ajaxSettings:b},p))}}},_getPanelForTab:function(l){var u=n(l).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+u))}}),n.uiBackCompat!==!1&&n.widget("ui.tabs",n.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),n.ui.tabs;/*!
 * jQuery UI Tooltip 1.13.3
 * https://jqueryui.com
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * https://jquery.org/license
 */n.widget("ui.tooltip",{version:"1.13.3",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var l=n(this).attr("title");return n("<a>").text(l).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(l,u){var p=(l.attr("aria-describedby")||"").split(/\s+/);p.push(u),l.data("ui-tooltip-id",u).attr("aria-describedby",String.prototype.trim.call(p.join(" ")))},_removeDescribedBy:function(l){var u=l.data("ui-tooltip-id"),p=(l.attr("aria-describedby")||"").split(/\s+/),g=n.inArray(u,p);g!==-1&&p.splice(g,1),l.removeData("ui-tooltip-id"),p=String.prototype.trim.call(p.join(" ")),p?l.attr("aria-describedby",p):l.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=n("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=n([])},_setOption:function(l,u){var p=this;this._super(l,u),l==="content"&&n.each(this.tooltips,function(g,C){p._updateContent(C.element)})},_setOptionDisabled:function(l){this[l?"_disable":"_enable"]()},_disable:function(){var l=this;n.each(this.tooltips,function(u,p){var g=n.Event("blur");g.target=g.currentTarget=p.element[0],l.close(g,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var u=n(this);if(u.is("[title]"))return u.data("ui-tooltip-title",u.attr("title")).removeAttr("title")}))},_enable:function(){this.disabledTitles.each(function(){var l=n(this);l.data("ui-tooltip-title")&&l.attr("title",l.data("ui-tooltip-title"))}),this.disabledTitles=n([])},open:function(l){var u=this,p=n(l?l.target:this.element).closest(this.options.items);!p.length||p.data("ui-tooltip-id")||(p.attr("title")&&p.data("ui-tooltip-title",p.attr("title")),p.data("ui-tooltip-open",!0),l&&l.type==="mouseover"&&p.parents().each(function(){var g=n(this),C;g.data("ui-tooltip-open")&&(C=n.Event("blur"),C.target=C.currentTarget=this,u.close(C,!0)),g.attr("title")&&(g.uniqueId(),u.parents[this.id]={element:this,title:g.attr("title")},g.attr("title",""))}),this._registerCloseHandlers(l,p),this._updateContent(p,l))},_updateContent:function(l,u){var p,g=this.options.content,C=this,b=u?u.type:null;if(typeof g=="string"||g.nodeType||g.jquery)return this._open(u,l,g);p=g.call(l[0],function(P){C._delay(function(){l.data("ui-tooltip-open")&&(u&&(u.type=b),this._open(u,l,P))})}),p&&this._open(u,l,p)},_open:function(l,u,p){var g,C,b,P,O=n.extend({},this.options.position);if(!p)return;if(g=this._find(u),g){g.tooltip.find(".ui-tooltip-content").html(p);return}u.is("[title]")&&(l&&l.type==="mouseover"?u.attr("title",""):u.removeAttr("title")),g=this._tooltip(u),C=g.tooltip,this._addDescribedBy(u,C.attr("id")),C.find(".ui-tooltip-content").html(p),this.liveRegion.children().hide(),P=n("<div>").html(C.find(".ui-tooltip-content").html()),P.removeAttr("name").find("[name]").removeAttr("name"),P.removeAttr("id").find("[id]").removeAttr("id"),P.appendTo(this.liveRegion);function L(U){O.of=U,!C.is(":hidden")&&C.position(O)}this.options.track&&l&&/^mouse/.test(l.type)?(this._on(this.document,{mousemove:L}),L(l)):C.position(n.extend({of:u},this.options.position)),C.hide(),this._show(C,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(b=this.delayedShow=setInterval(function(){C.is(":visible")&&(L(O.of),clearInterval(b))},13)),this._trigger("open",l,{tooltip:C})},_registerCloseHandlers:function(l,u){var p={keyup:function(g){if(g.keyCode===n.ui.keyCode.ESCAPE){var C=n.Event(g);C.currentTarget=u[0],this.close(C,!0)}}};u[0]!==this.element[0]&&(p.remove=function(){var g=this._find(u);g&&this._removeTooltip(g.tooltip)}),(!l||l.type==="mouseover")&&(p.mouseleave="close"),(!l||l.type==="focusin")&&(p.focusout="close"),this._on(!0,u,p)},close:function(l){var u,p=this,g=n(l?l.currentTarget:this.element),C=this._find(g);if(!C){g.removeData("ui-tooltip-open");return}u=C.tooltip,!C.closing&&(clearInterval(this.delayedShow),g.data("ui-tooltip-title")&&!g.attr("title")&&g.attr("title",g.data("ui-tooltip-title")),this._removeDescribedBy(g),C.hiding=!0,u.stop(!0),this._hide(u,this.options.hide,function(){p._removeTooltip(n(this))}),g.removeData("ui-tooltip-open"),this._off(g,"mouseleave focusout keyup"),g[0]!==this.element[0]&&this._off(g,"remove"),this._off(this.document,"mousemove"),l&&l.type==="mouseleave"&&n.each(this.parents,function(b,P){n(P.element).attr("title",P.title),delete p.parents[b]}),C.closing=!0,this._trigger("close",l,{tooltip:u}),C.hiding||(C.closing=!1))},_tooltip:function(l){var u=n("<div>").attr("role","tooltip"),p=n("<div>").appendTo(u),g=u.uniqueId().attr("id");return this._addClass(p,"ui-tooltip-content"),this._addClass(u,"ui-tooltip","ui-widget ui-widget-content"),u.appendTo(this._appendTo(l)),this.tooltips[g]={element:l,tooltip:u}},_find:function(l){var u=l.data("ui-tooltip-id");return u?this.tooltips[u]:null},_removeTooltip:function(l){clearInterval(this.delayedShow),l.remove(),delete this.tooltips[l.attr("id")]},_appendTo:function(l){var u=l.closest(".ui-front, dialog");return u.length||(u=this.document[0].body),u},_destroy:function(){var l=this;n.each(this.tooltips,function(u,p){var g=n.Event("blur"),C=p.element;g.target=g.currentTarget=C[0],l.close(g,!0),n("#"+u).remove(),C.data("ui-tooltip-title")&&(C.attr("title")||C.attr("title",C.data("ui-tooltip-title")),C.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),n.uiBackCompat!==!1&&n.widget("ui.tooltip",n.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var l=this._superApply(arguments);return this.options.tooltipClass&&l.tooltip.addClass(this.options.tooltipClass),l}}),n.ui.tooltip});/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const REVISION="180",MOUSE={ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,ConstantColorFactor=211,OneMinusConstantColorFactor=212,ConstantAlphaFactor=213,OneMinusConstantAlphaFactor=214,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping$1=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,AgXToneMapping=6,NeutralToneMapping=7,AttachedBindMode="attached",DetachedBindMode="detached",UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipmapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipmapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType$1=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,UnsignedInt5999Type=35902,UnsignedInt101111Type=35899,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace$1="",SRGBColorSpace$1="srgb",LinearSRGBColorSpace$1="srgb-linear",LinearTransfer$1="linear",SRGBTransfer$1="srgb",KeepStencilOp=7680,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage$1=35044,GLSL3="300 es",WebGLCoordinateSystem$1=2e3,WebGPUCoordinateSystem$1=2001;let EventDispatcher$1=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i===void 0?!1:i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners;if(i===void 0)return;const s=i[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const i=t[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}};const _lut$1=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed$1=1234567;const DEG2RAD$1=Math.PI/180,RAD2DEG$1=180/Math.PI;function generateUUID$1(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(_lut$1[n&255]+_lut$1[n>>8&255]+_lut$1[n>>16&255]+_lut$1[n>>24&255]+"-"+_lut$1[e&255]+_lut$1[e>>8&255]+"-"+_lut$1[e>>16&15|64]+_lut$1[e>>24&255]+"-"+_lut$1[t&63|128]+_lut$1[t>>8&255]+"-"+_lut$1[t>>16&255]+_lut$1[t>>24&255]+_lut$1[i&255]+_lut$1[i>>8&255]+_lut$1[i>>16&255]+_lut$1[i>>24&255]).toLowerCase()}function clamp$3(n,e,t){return Math.max(e,Math.min(t,n))}function euclideanModulo$1(n,e){return(n%e+e)%e}function mapLinear$1(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)}function inverseLerp$1(n,e,t){return n!==e?(t-n)/(e-n):0}function lerp$2(n,e,t){return(1-t)*n+t*e}function damp$1(n,e,t,i){return lerp$2(n,e,1-Math.exp(-t*i))}function pingpong$1(n,e=1){return e-Math.abs(euclideanModulo$1(n,e*2)-e)}function smoothstep$2(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function smootherstep$1(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function randInt$1(n,e){return n+Math.floor(Math.random()*(e-n+1))}function randFloat$1(n,e){return n+Math.random()*(e-n)}function randFloatSpread$1(n){return n*(.5-Math.random())}function seededRandom$1(n){n!==void 0&&(_seed$1=n);let e=_seed$1+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function degToRad$1(n){return n*DEG2RAD$1}function radToDeg$1(n){return n*RAD2DEG$1}function isPowerOfTwo$1(n){return(n&n-1)===0&&n!==0}function ceilPowerOfTwo$1(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function floorPowerOfTwo$1(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function setQuaternionFromProperEuler$1(n,e,t,i,s){const r=Math.cos,o=Math.sin,a=r(t/2),h=o(t/2),c=r((e+i)/2),d=o((e+i)/2),f=r((e-i)/2),_=o((e-i)/2),y=r((i-e)/2),S=o((i-e)/2);switch(s){case"XYX":n.set(a*d,h*f,h*_,a*c);break;case"YZY":n.set(h*_,a*d,h*f,a*c);break;case"ZXZ":n.set(h*f,h*_,a*d,a*c);break;case"XZX":n.set(a*d,h*S,h*y,a*c);break;case"YXY":n.set(h*y,a*d,h*S,a*c);break;case"ZYZ":n.set(h*S,h*y,a*d,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function denormalize$1(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function normalize$2(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const MathUtils$1={DEG2RAD:DEG2RAD$1,RAD2DEG:RAD2DEG$1,generateUUID:generateUUID$1,clamp:clamp$3,euclideanModulo:euclideanModulo$1,mapLinear:mapLinear$1,inverseLerp:inverseLerp$1,lerp:lerp$2,damp:damp$1,pingpong:pingpong$1,smoothstep:smoothstep$2,smootherstep:smootherstep$1,randInt:randInt$1,randFloat:randFloat$1,randFloatSpread:randFloatSpread$1,seededRandom:seededRandom$1,degToRad:degToRad$1,radToDeg:radToDeg$1,isPowerOfTwo:isPowerOfTwo$1,ceilPowerOfTwo:ceilPowerOfTwo$1,floorPowerOfTwo:floorPowerOfTwo$1,setQuaternionFromProperEuler:setQuaternionFromProperEuler$1,normalize:normalize$2,denormalize:denormalize$1};let Vector2$1=class rn{constructor(e=0,t=0){rn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=clamp$3(this.x,e.x,t.x),this.y=clamp$3(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=clamp$3(this.x,e,t),this.y=clamp$3(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(clamp$3(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(clamp$3(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*s+e.x,this.y=r*s+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Quaternion$1=class{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,r,o,a){let h=i[s+0],c=i[s+1],d=i[s+2],f=i[s+3];const _=r[o+0],y=r[o+1],S=r[o+2],v=r[o+3];if(a===0){e[t+0]=h,e[t+1]=c,e[t+2]=d,e[t+3]=f;return}if(a===1){e[t+0]=_,e[t+1]=y,e[t+2]=S,e[t+3]=v;return}if(f!==v||h!==_||c!==y||d!==S){let I=1-a;const A=h*_+c*y+d*S+f*v,B=A>=0?1:-1,G=1-A*A;if(G>Number.EPSILON){const z=Math.sqrt(G),q=Math.atan2(z,A*B);I=Math.sin(I*q)/z,a=Math.sin(a*q)/z}const k=a*B;if(h=h*I+_*k,c=c*I+y*k,d=d*I+S*k,f=f*I+v*k,I===1-a){const z=1/Math.sqrt(h*h+c*c+d*d+f*f);h*=z,c*=z,d*=z,f*=z}}e[t]=h,e[t+1]=c,e[t+2]=d,e[t+3]=f}static multiplyQuaternionsFlat(e,t,i,s,r,o){const a=i[s],h=i[s+1],c=i[s+2],d=i[s+3],f=r[o],_=r[o+1],y=r[o+2],S=r[o+3];return e[t]=a*S+d*f+h*y-c*_,e[t+1]=h*S+d*_+c*f-a*y,e[t+2]=c*S+d*y+a*_-h*f,e[t+3]=d*S-a*f-h*_-c*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,s=e._y,r=e._z,o=e._order,a=Math.cos,h=Math.sin,c=a(i/2),d=a(s/2),f=a(r/2),_=h(i/2),y=h(s/2),S=h(r/2);switch(o){case"XYZ":this._x=_*d*f+c*y*S,this._y=c*y*f-_*d*S,this._z=c*d*S+_*y*f,this._w=c*d*f-_*y*S;break;case"YXZ":this._x=_*d*f+c*y*S,this._y=c*y*f-_*d*S,this._z=c*d*S-_*y*f,this._w=c*d*f+_*y*S;break;case"ZXY":this._x=_*d*f-c*y*S,this._y=c*y*f+_*d*S,this._z=c*d*S+_*y*f,this._w=c*d*f-_*y*S;break;case"ZYX":this._x=_*d*f-c*y*S,this._y=c*y*f+_*d*S,this._z=c*d*S-_*y*f,this._w=c*d*f+_*y*S;break;case"YZX":this._x=_*d*f+c*y*S,this._y=c*y*f+_*d*S,this._z=c*d*S-_*y*f,this._w=c*d*f-_*y*S;break;case"XZY":this._x=_*d*f-c*y*S,this._y=c*y*f-_*d*S,this._z=c*d*S+_*y*f,this._w=c*d*f+_*y*S;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],r=t[8],o=t[1],a=t[5],h=t[9],c=t[2],d=t[6],f=t[10],_=i+a+f;if(_>0){const y=.5/Math.sqrt(_+1);this._w=.25/y,this._x=(d-h)*y,this._y=(r-c)*y,this._z=(o-s)*y}else if(i>a&&i>f){const y=2*Math.sqrt(1+i-a-f);this._w=(d-h)/y,this._x=.25*y,this._y=(s+o)/y,this._z=(r+c)/y}else if(a>f){const y=2*Math.sqrt(1+a-i-f);this._w=(r-c)/y,this._x=(s+o)/y,this._y=.25*y,this._z=(h+d)/y}else{const y=2*Math.sqrt(1+f-i-a);this._w=(o-s)/y,this._x=(r+c)/y,this._y=(h+d)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<1e-8?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(clamp$3(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,r=e._z,o=e._w,a=t._x,h=t._y,c=t._z,d=t._w;return this._x=i*d+o*a+s*c-r*h,this._y=s*d+o*h+r*a-i*c,this._z=r*d+o*c+i*h-s*a,this._w=o*d-i*a-s*h-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,s=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+s*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const h=1-a*a;if(h<=Number.EPSILON){const y=1-t;return this._w=y*o+t*this._w,this._x=y*i+t*this._x,this._y=y*s+t*this._y,this._z=y*r+t*this._z,this.normalize(),this}const c=Math.sqrt(h),d=Math.atan2(c,a),f=Math.sin((1-t)*d)/c,_=Math.sin(t*d)/c;return this._w=o*f+this._w*_,this._x=i*f+this._x*_,this._y=s*f+this._y*_,this._z=r*f+this._z*_,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(s*Math.sin(e),s*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Vector3$1=class on{constructor(e=0,t=0,i=0){on.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(_quaternion$4.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*s,this.y=r[1]*t+r[4]*i+r[7]*s,this.z=r[2]*t+r[5]*i+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*s+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*s+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*s+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,r=e.x,o=e.y,a=e.z,h=e.w,c=2*(o*s-a*i),d=2*(a*t-r*s),f=2*(r*i-o*t);return this.x=t+h*c+o*f-a*d,this.y=i+h*d+a*c-r*f,this.z=s+h*f+r*d-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*s,this.y=r[1]*t+r[5]*i+r[9]*s,this.z=r[2]*t+r[6]*i+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=clamp$3(this.x,e.x,t.x),this.y=clamp$3(this.y,e.y,t.y),this.z=clamp$3(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=clamp$3(this.x,e,t),this.y=clamp$3(this.y,e,t),this.z=clamp$3(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(clamp$3(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,r=e.z,o=t.x,a=t.y,h=t.z;return this.x=s*h-r*a,this.y=r*o-i*h,this.z=i*a-s*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return _vector$c.copy(this).projectOnVector(e),this.sub(_vector$c)}reflect(e){return this.sub(_vector$c.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(clamp$3(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const _vector$c=new Vector3$1,_quaternion$4=new Quaternion$1;let Matrix3$1=class an{constructor(e,t,i,s,r,o,a,h,c){an.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,o,a,h,c)}set(e,t,i,s,r,o,a,h,c){const d=this.elements;return d[0]=e,d[1]=s,d[2]=a,d[3]=t,d[4]=r,d[5]=h,d[6]=i,d[7]=o,d[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[3],h=i[6],c=i[1],d=i[4],f=i[7],_=i[2],y=i[5],S=i[8],v=s[0],I=s[3],A=s[6],B=s[1],G=s[4],k=s[7],z=s[2],q=s[5],T=s[8];return r[0]=o*v+a*B+h*z,r[3]=o*I+a*G+h*q,r[6]=o*A+a*k+h*T,r[1]=c*v+d*B+f*z,r[4]=c*I+d*G+f*q,r[7]=c*A+d*k+f*T,r[2]=_*v+y*B+S*z,r[5]=_*I+y*G+S*q,r[8]=_*A+y*k+S*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],c=e[7],d=e[8];return t*o*d-t*a*c-i*r*d+i*a*h+s*r*c-s*o*h}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],c=e[7],d=e[8],f=d*o-a*c,_=a*h-d*r,y=c*r-o*h,S=t*f+i*_+s*y;if(S===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/S;return e[0]=f*v,e[1]=(s*c-d*i)*v,e[2]=(a*i-s*o)*v,e[3]=_*v,e[4]=(d*t-s*h)*v,e[5]=(s*r-a*t)*v,e[6]=y*v,e[7]=(i*h-c*t)*v,e[8]=(o*t-i*r)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,r,o,a){const h=Math.cos(r),c=Math.sin(r);return this.set(i*h,i*c,-i*(h*o+c*a)+o+e,-s*c,s*h,-s*(-c*o+h*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(_m3$1.makeScale(e,t)),this}rotate(e){return this.premultiply(_m3$1.makeRotation(-e)),this}translate(e,t){return this.premultiply(_m3$1.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const _m3$1=new Matrix3$1;function arrayNeedsUint32(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function createElementNS(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function createCanvasElement(){const n=createElementNS("canvas");return n.style.display="block",n}const _cache$1={};function warnOnce$1(n){n in _cache$1||(_cache$1[n]=!0,console.warn(n))}function probeAsync(n,e,t){return new Promise(function(i,s){function r(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:s();break;case n.TIMEOUT_EXPIRED:setTimeout(r,t);break;default:i()}}setTimeout(r,t)})}const LINEAR_REC709_TO_XYZ$1=new Matrix3$1().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),XYZ_TO_LINEAR_REC709$1=new Matrix3$1().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function createColorManagement$1(){const n={enabled:!0,workingColorSpace:LinearSRGBColorSpace$1,spaces:{},convert:function(s,r,o){return this.enabled===!1||r===o||!r||!o||(this.spaces[r].transfer===SRGBTransfer$1&&(s.r=SRGBToLinear$1(s.r),s.g=SRGBToLinear$1(s.g),s.b=SRGBToLinear$1(s.b)),this.spaces[r].primaries!==this.spaces[o].primaries&&(s.applyMatrix3(this.spaces[r].toXYZ),s.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===SRGBTransfer$1&&(s.r=LinearToSRGB$1(s.r),s.g=LinearToSRGB$1(s.g),s.b=LinearToSRGB$1(s.b))),s},workingToColorSpace:function(s,r){return this.convert(s,this.workingColorSpace,r)},colorSpaceToWorking:function(s,r){return this.convert(s,r,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===NoColorSpace$1?LinearTransfer$1:this.spaces[s].transfer},getToneMappingMode:function(s){return this.spaces[s].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(s,r=this.workingColorSpace){return s.fromArray(this.spaces[r].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,r,o){return s.copy(this.spaces[r].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(s,r){return warnOnce$1("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(s,r)},toWorkingColorSpace:function(s,r){return warnOnce$1("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(s,r)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[LinearSRGBColorSpace$1]:{primaries:e,whitePoint:i,transfer:LinearTransfer$1,toXYZ:LINEAR_REC709_TO_XYZ$1,fromXYZ:XYZ_TO_LINEAR_REC709$1,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:SRGBColorSpace$1},outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace$1}},[SRGBColorSpace$1]:{primaries:e,whitePoint:i,transfer:SRGBTransfer$1,toXYZ:LINEAR_REC709_TO_XYZ$1,fromXYZ:XYZ_TO_LINEAR_REC709$1,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace$1}}}),n}const ColorManagement$1=createColorManagement$1();function SRGBToLinear$1(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function LinearToSRGB$1(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let _canvas;class ImageUtils{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=e.width,_canvas.height=e.height;const s=_canvas.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),i=_canvas}return i.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=createElementNS("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=SRGBToLinear$1(r[o]/255)*255;return i.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(SRGBToLinear$1(t[i]/255)*255):t[i]=SRGBToLinear$1(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let _sourceId=0,Source$1=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_sourceId++}),this.uuid=generateUUID$1(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?r.push(serializeImage(s[o].image)):r.push(serializeImage(s[o]))}else r=serializeImage(s);i.url=r}return t||(e.images[this.uuid]=i),i}};function serializeImage(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?ImageUtils.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;const _tempVec3=new Vector3$1;class Texture extends EventDispatcher$1{constructor(e=Texture.DEFAULT_IMAGE,t=Texture.DEFAULT_MAPPING,i=ClampToEdgeWrapping,s=ClampToEdgeWrapping,r=LinearFilter,o=LinearMipmapLinearFilter,a=RGBAFormat,h=UnsignedByteType,c=Texture.DEFAULT_ANISOTROPY,d=NoColorSpace$1){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID$1(),this.name="",this.source=new Source$1(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=h,this.offset=new Vector2$1(0,0),this.repeat=new Vector2$1(1,1),this.center=new Vector2$1(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3$1,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(_tempVec3).x}get height(){return this.source.getSize(_tempVec3).y}get depth(){return this.source.getSize(_tempVec3).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}s&&i&&s.isVector2&&i.isVector2||s&&i&&s.isVector3&&i.isVector3||s&&i&&s.isMatrix3&&i.isMatrix3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==UVMapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;let Vector4$1=class ln{constructor(e=0,t=0,i=0,s=1){ln.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*s+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*s+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*s+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*s+o[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,r;const h=e.elements,c=h[0],d=h[4],f=h[8],_=h[1],y=h[5],S=h[9],v=h[2],I=h[6],A=h[10];if(Math.abs(d-_)<.01&&Math.abs(f-v)<.01&&Math.abs(S-I)<.01){if(Math.abs(d+_)<.1&&Math.abs(f+v)<.1&&Math.abs(S+I)<.1&&Math.abs(c+y+A-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const G=(c+1)/2,k=(y+1)/2,z=(A+1)/2,q=(d+_)/4,T=(f+v)/4,j=(S+I)/4;return G>k&&G>z?G<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(G),s=q/i,r=T/i):k>z?k<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(k),i=q/s,r=j/s):z<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(z),i=T/r,s=j/r),this.set(i,s,r,t),this}let B=Math.sqrt((I-S)*(I-S)+(f-v)*(f-v)+(_-d)*(_-d));return Math.abs(B)<.001&&(B=1),this.x=(I-S)/B,this.y=(f-v)/B,this.z=(_-d)/B,this.w=Math.acos((c+y+A-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=clamp$3(this.x,e.x,t.x),this.y=clamp$3(this.y,e.y,t.y),this.z=clamp$3(this.z,e.z,t.z),this.w=clamp$3(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=clamp$3(this.x,e,t),this.y=clamp$3(this.y,e,t),this.z=clamp$3(this.z,e,t),this.w=clamp$3(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(clamp$3(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};class RenderTarget extends EventDispatcher$1{constructor(e=1,t=1,i={}){super(),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:LinearFilter,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},i),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=i.depth,this.scissor=new Vector4$1(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4$1(0,0,e,t);const s={width:e,height:t,depth:i.depth},r=new Texture(s);this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=r.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this._setTextureOptions(i),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples,this.multiview=i.multiview}_setTextureOptions(e={}){const t={minFilter:LinearFilter,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let i=0;i<this.textures.length;i++)this.textures[i].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let s=0,r=this.textures.length;s<r;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=i,this.textures[s].isArrayTexture=this.textures[s].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,i=e.textures.length;t<i;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const s=Object.assign({},e.textures[t].image);this.textures[t].source=new Source$1(s)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(e=null,t=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Data3DTexture extends Texture{constructor(e=null,t=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Box3{constructor(e=new Vector3$1(1/0,1/0,1/0),t=new Vector3$1(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(_vector$b.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(_vector$b.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=_vector$b.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const r=i.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,_vector$b):_vector$b.fromBufferAttribute(r,o),_vector$b.applyMatrix4(e.matrixWorld),this.expandByPoint(_vector$b);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),_box$4.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),_box$4.copy(i.boundingBox)),_box$4.applyMatrix4(e.matrixWorld),this.union(_box$4)}const s=e.children;for(let r=0,o=s.length;r<o;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,_vector$b),_vector$b.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(e.a,_center),_v1$7.subVectors(e.b,_center),_v2$4.subVectors(e.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let t=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(t,_v0$2,_v1$7,_v2$4,_extents)||(t=[1,0,0,0,1,0,0,0,1],!satForAxes(t,_v0$2,_v1$7,_v2$4,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),t=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(t,_v0$2,_v1$7,_v2$4,_extents))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_vector$b).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(_vector$b).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_points),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const _points=[new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1],_vector$b=new Vector3$1,_box$4=new Box3,_v0$2=new Vector3$1,_v1$7=new Vector3$1,_v2$4=new Vector3$1,_f0=new Vector3$1,_f1=new Vector3$1,_f2=new Vector3$1,_center=new Vector3$1,_extents=new Vector3$1,_triangleNormal=new Vector3$1,_testAxis=new Vector3$1;function satForAxes(n,e,t,i,s){for(let r=0,o=n.length-3;r<=o;r+=3){_testAxis.fromArray(n,r);const a=s.x*Math.abs(_testAxis.x)+s.y*Math.abs(_testAxis.y)+s.z*Math.abs(_testAxis.z),h=e.dot(_testAxis),c=t.dot(_testAxis),d=i.dot(_testAxis);if(Math.max(-Math.max(h,c,d),Math.min(h,c,d))>a)return!1}return!0}const _box$3=new Box3,_v1$6=new Vector3$1,_v2$3=new Vector3$1;class Sphere{constructor(e=new Vector3$1,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):_box$3.setFromPoints(e).getCenter(i);let s=0;for(let r=0,o=e.length;r<o;r++)s=Math.max(s,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;_v1$6.subVectors(e,this.center);const t=_v1$6.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),s=(i-this.radius)*.5;this.center.addScaledVector(_v1$6,s/i),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(_v2$3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(_v1$6.copy(e.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(e.center).sub(_v2$3))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const _vector$a=new Vector3$1,_segCenter=new Vector3$1,_segDir=new Vector3$1,_diff=new Vector3$1,_edge1=new Vector3$1,_edge2=new Vector3$1,_normal$1=new Vector3$1;class Ray{constructor(e=new Vector3$1,t=new Vector3$1(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,_vector$a)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=_vector$a.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_vector$a.copy(this.origin).addScaledVector(this.direction,t),_vector$a.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){_segCenter.copy(e).add(t).multiplyScalar(.5),_segDir.copy(t).sub(e).normalize(),_diff.copy(this.origin).sub(_segCenter);const r=e.distanceTo(t)*.5,o=-this.direction.dot(_segDir),a=_diff.dot(this.direction),h=-_diff.dot(_segDir),c=_diff.lengthSq(),d=Math.abs(1-o*o);let f,_,y,S;if(d>0)if(f=o*h-a,_=o*a-h,S=r*d,f>=0)if(_>=-S)if(_<=S){const v=1/d;f*=v,_*=v,y=f*(f+o*_+2*a)+_*(o*f+_+2*h)+c}else _=r,f=Math.max(0,-(o*_+a)),y=-f*f+_*(_+2*h)+c;else _=-r,f=Math.max(0,-(o*_+a)),y=-f*f+_*(_+2*h)+c;else _<=-S?(f=Math.max(0,-(-o*r+a)),_=f>0?-r:Math.min(Math.max(-r,-h),r),y=-f*f+_*(_+2*h)+c):_<=S?(f=0,_=Math.min(Math.max(-r,-h),r),y=_*(_+2*h)+c):(f=Math.max(0,-(o*r+a)),_=f>0?r:Math.min(Math.max(-r,-h),r),y=-f*f+_*(_+2*h)+c);else _=o>0?-r:r,f=Math.max(0,-(o*_+a)),y=-f*f+_*(_+2*h)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,f),s&&s.copy(_segCenter).addScaledVector(_segDir,_),y}intersectSphere(e,t){_vector$a.subVectors(e.center,this.origin);const i=_vector$a.dot(this.direction),s=_vector$a.dot(_vector$a)-i*i,r=e.radius*e.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=i-o,h=i+o;return h<0?null:a<0?this.at(h,t):this.at(a,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,r,o,a,h;const c=1/this.direction.x,d=1/this.direction.y,f=1/this.direction.z,_=this.origin;return c>=0?(i=(e.min.x-_.x)*c,s=(e.max.x-_.x)*c):(i=(e.max.x-_.x)*c,s=(e.min.x-_.x)*c),d>=0?(r=(e.min.y-_.y)*d,o=(e.max.y-_.y)*d):(r=(e.max.y-_.y)*d,o=(e.min.y-_.y)*d),i>o||r>s||((r>i||isNaN(i))&&(i=r),(o<s||isNaN(s))&&(s=o),f>=0?(a=(e.min.z-_.z)*f,h=(e.max.z-_.z)*f):(a=(e.max.z-_.z)*f,h=(e.min.z-_.z)*f),i>h||a>s)||((a>i||i!==i)&&(i=a),(h<s||s!==s)&&(s=h),s<0)?null:this.at(i>=0?i:s,t)}intersectsBox(e){return this.intersectBox(e,_vector$a)!==null}intersectTriangle(e,t,i,s,r){_edge1.subVectors(t,e),_edge2.subVectors(i,e),_normal$1.crossVectors(_edge1,_edge2);let o=this.direction.dot(_normal$1),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;_diff.subVectors(this.origin,e);const h=a*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(h<0)return null;const c=a*this.direction.dot(_edge1.cross(_diff));if(c<0||h+c>o)return null;const d=-a*_diff.dot(_normal$1);return d<0?null:this.at(d/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}let Matrix4$1=class Pi{constructor(e,t,i,s,r,o,a,h,c,d,f,_,y,S,v,I){Pi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,o,a,h,c,d,f,_,y,S,v,I)}set(e,t,i,s,r,o,a,h,c,d,f,_,y,S,v,I){const A=this.elements;return A[0]=e,A[4]=t,A[8]=i,A[12]=s,A[1]=r,A[5]=o,A[9]=a,A[13]=h,A[2]=c,A[6]=d,A[10]=f,A[14]=_,A[3]=y,A[7]=S,A[11]=v,A[15]=I,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Pi().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/_v1$5.setFromMatrixColumn(e,0).length(),r=1/_v1$5.setFromMatrixColumn(e,1).length(),o=1/_v1$5.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,s=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),h=Math.cos(s),c=Math.sin(s),d=Math.cos(r),f=Math.sin(r);if(e.order==="XYZ"){const _=o*d,y=o*f,S=a*d,v=a*f;t[0]=h*d,t[4]=-h*f,t[8]=c,t[1]=y+S*c,t[5]=_-v*c,t[9]=-a*h,t[2]=v-_*c,t[6]=S+y*c,t[10]=o*h}else if(e.order==="YXZ"){const _=h*d,y=h*f,S=c*d,v=c*f;t[0]=_+v*a,t[4]=S*a-y,t[8]=o*c,t[1]=o*f,t[5]=o*d,t[9]=-a,t[2]=y*a-S,t[6]=v+_*a,t[10]=o*h}else if(e.order==="ZXY"){const _=h*d,y=h*f,S=c*d,v=c*f;t[0]=_-v*a,t[4]=-o*f,t[8]=S+y*a,t[1]=y+S*a,t[5]=o*d,t[9]=v-_*a,t[2]=-o*c,t[6]=a,t[10]=o*h}else if(e.order==="ZYX"){const _=o*d,y=o*f,S=a*d,v=a*f;t[0]=h*d,t[4]=S*c-y,t[8]=_*c+v,t[1]=h*f,t[5]=v*c+_,t[9]=y*c-S,t[2]=-c,t[6]=a*h,t[10]=o*h}else if(e.order==="YZX"){const _=o*h,y=o*c,S=a*h,v=a*c;t[0]=h*d,t[4]=v-_*f,t[8]=S*f+y,t[1]=f,t[5]=o*d,t[9]=-a*d,t[2]=-c*d,t[6]=y*f+S,t[10]=_-v*f}else if(e.order==="XZY"){const _=o*h,y=o*c,S=a*h,v=a*c;t[0]=h*d,t[4]=-f,t[8]=c*d,t[1]=_*f+v,t[5]=o*d,t[9]=y*f-S,t[2]=S*f-y,t[6]=a*d,t[10]=v*f+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_zero$1,e,_one$1)}lookAt(e,t,i){const s=this.elements;return _z$1.subVectors(e,t),_z$1.lengthSq()===0&&(_z$1.z=1),_z$1.normalize(),_x$1.crossVectors(i,_z$1),_x$1.lengthSq()===0&&(Math.abs(i.z)===1?_z$1.x+=1e-4:_z$1.z+=1e-4,_z$1.normalize(),_x$1.crossVectors(i,_z$1)),_x$1.normalize(),_y$1.crossVectors(_z$1,_x$1),s[0]=_x$1.x,s[4]=_y$1.x,s[8]=_z$1.x,s[1]=_x$1.y,s[5]=_y$1.y,s[9]=_z$1.y,s[2]=_x$1.z,s[6]=_y$1.z,s[10]=_z$1.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[4],h=i[8],c=i[12],d=i[1],f=i[5],_=i[9],y=i[13],S=i[2],v=i[6],I=i[10],A=i[14],B=i[3],G=i[7],k=i[11],z=i[15],q=s[0],T=s[4],j=s[8],te=s[12],Se=s[1],be=s[5],Te=s[9],pe=s[13],ie=s[2],he=s[6],ge=s[10],ue=s[14],de=s[3],se=s[7],l=s[11],u=s[15];return r[0]=o*q+a*Se+h*ie+c*de,r[4]=o*T+a*be+h*he+c*se,r[8]=o*j+a*Te+h*ge+c*l,r[12]=o*te+a*pe+h*ue+c*u,r[1]=d*q+f*Se+_*ie+y*de,r[5]=d*T+f*be+_*he+y*se,r[9]=d*j+f*Te+_*ge+y*l,r[13]=d*te+f*pe+_*ue+y*u,r[2]=S*q+v*Se+I*ie+A*de,r[6]=S*T+v*be+I*he+A*se,r[10]=S*j+v*Te+I*ge+A*l,r[14]=S*te+v*pe+I*ue+A*u,r[3]=B*q+G*Se+k*ie+z*de,r[7]=B*T+G*be+k*he+z*se,r[11]=B*j+G*Te+k*ge+z*l,r[15]=B*te+G*pe+k*ue+z*u,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],r=e[12],o=e[1],a=e[5],h=e[9],c=e[13],d=e[2],f=e[6],_=e[10],y=e[14],S=e[3],v=e[7],I=e[11],A=e[15];return S*(+r*h*f-s*c*f-r*a*_+i*c*_+s*a*y-i*h*y)+v*(+t*h*y-t*c*_+r*o*_-s*o*y+s*c*d-r*h*d)+I*(+t*c*f-t*a*y-r*o*f+i*o*y+r*a*d-i*c*d)+A*(-s*a*d-t*h*f+t*a*_+s*o*f-i*o*_+i*h*d)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],c=e[7],d=e[8],f=e[9],_=e[10],y=e[11],S=e[12],v=e[13],I=e[14],A=e[15],B=f*I*c-v*_*c+v*h*y-a*I*y-f*h*A+a*_*A,G=S*_*c-d*I*c-S*h*y+o*I*y+d*h*A-o*_*A,k=d*v*c-S*f*c+S*a*y-o*v*y-d*a*A+o*f*A,z=S*f*h-d*v*h-S*a*_+o*v*_+d*a*I-o*f*I,q=t*B+i*G+s*k+r*z;if(q===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/q;return e[0]=B*T,e[1]=(v*_*r-f*I*r-v*s*y+i*I*y+f*s*A-i*_*A)*T,e[2]=(a*I*r-v*h*r+v*s*c-i*I*c-a*s*A+i*h*A)*T,e[3]=(f*h*r-a*_*r-f*s*c+i*_*c+a*s*y-i*h*y)*T,e[4]=G*T,e[5]=(d*I*r-S*_*r+S*s*y-t*I*y-d*s*A+t*_*A)*T,e[6]=(S*h*r-o*I*r-S*s*c+t*I*c+o*s*A-t*h*A)*T,e[7]=(o*_*r-d*h*r+d*s*c-t*_*c-o*s*y+t*h*y)*T,e[8]=k*T,e[9]=(S*f*r-d*v*r-S*i*y+t*v*y+d*i*A-t*f*A)*T,e[10]=(o*v*r-S*a*r+S*i*c-t*v*c-o*i*A+t*a*A)*T,e[11]=(d*a*r-o*f*r-d*i*c+t*f*c+o*i*y-t*a*y)*T,e[12]=z*T,e[13]=(d*v*s-S*f*s+S*i*_-t*v*_-d*i*I+t*f*I)*T,e[14]=(S*a*s-o*v*s-S*i*h+t*v*h+o*i*I-t*a*I)*T,e[15]=(o*f*s-d*a*s+d*i*h-t*f*h-o*i*_+t*a*_)*T,this}scale(e){const t=this.elements,i=e.x,s=e.y,r=e.z;return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),r=1-i,o=e.x,a=e.y,h=e.z,c=r*o,d=r*a;return this.set(c*o+i,c*a-s*h,c*h+s*a,0,c*a+s*h,d*a+i,d*h-s*o,0,c*h-s*a,d*h+s*o,r*h*h+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,r,o){return this.set(1,i,r,0,e,1,o,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,r=t._x,o=t._y,a=t._z,h=t._w,c=r+r,d=o+o,f=a+a,_=r*c,y=r*d,S=r*f,v=o*d,I=o*f,A=a*f,B=h*c,G=h*d,k=h*f,z=i.x,q=i.y,T=i.z;return s[0]=(1-(v+A))*z,s[1]=(y+k)*z,s[2]=(S-G)*z,s[3]=0,s[4]=(y-k)*q,s[5]=(1-(_+A))*q,s[6]=(I+B)*q,s[7]=0,s[8]=(S+G)*T,s[9]=(I-B)*T,s[10]=(1-(_+v))*T,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let r=_v1$5.set(s[0],s[1],s[2]).length();const o=_v1$5.set(s[4],s[5],s[6]).length(),a=_v1$5.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],_m1$2.copy(this);const c=1/r,d=1/o,f=1/a;return _m1$2.elements[0]*=c,_m1$2.elements[1]*=c,_m1$2.elements[2]*=c,_m1$2.elements[4]*=d,_m1$2.elements[5]*=d,_m1$2.elements[6]*=d,_m1$2.elements[8]*=f,_m1$2.elements[9]*=f,_m1$2.elements[10]*=f,t.setFromRotationMatrix(_m1$2),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,s,r,o,a=WebGLCoordinateSystem$1,h=!1){const c=this.elements,d=2*r/(t-e),f=2*r/(i-s),_=(t+e)/(t-e),y=(i+s)/(i-s);let S,v;if(h)S=r/(o-r),v=o*r/(o-r);else if(a===WebGLCoordinateSystem$1)S=-(o+r)/(o-r),v=-2*o*r/(o-r);else if(a===WebGPUCoordinateSystem$1)S=-o/(o-r),v=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=d,c[4]=0,c[8]=_,c[12]=0,c[1]=0,c[5]=f,c[9]=y,c[13]=0,c[2]=0,c[6]=0,c[10]=S,c[14]=v,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,i,s,r,o,a=WebGLCoordinateSystem$1,h=!1){const c=this.elements,d=2/(t-e),f=2/(i-s),_=-(t+e)/(t-e),y=-(i+s)/(i-s);let S,v;if(h)S=1/(o-r),v=o/(o-r);else if(a===WebGLCoordinateSystem$1)S=-2/(o-r),v=-(o+r)/(o-r);else if(a===WebGPUCoordinateSystem$1)S=-1/(o-r),v=-r/(o-r);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=d,c[4]=0,c[8]=0,c[12]=_,c[1]=0,c[5]=f,c[9]=0,c[13]=y,c[2]=0,c[6]=0,c[10]=S,c[14]=v,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}};const _v1$5=new Vector3$1,_m1$2=new Matrix4$1,_zero$1=new Vector3$1(0,0,0),_one$1=new Vector3$1(1,1,1),_x$1=new Vector3$1,_y$1=new Vector3$1,_z$1=new Vector3$1,_matrix$2=new Matrix4$1,_quaternion$3=new Quaternion$1;class Euler{constructor(e=0,t=0,i=0,s=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,r=s[0],o=s[4],a=s[8],h=s[1],c=s[5],d=s[9],f=s[2],_=s[6],y=s[10];switch(t){case"XYZ":this._y=Math.asin(clamp$3(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-d,y),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(_,c),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp$3(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(a,y),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-f,r),this._z=0);break;case"ZXY":this._x=Math.asin(clamp$3(_,-1,1)),Math.abs(_)<.9999999?(this._y=Math.atan2(-f,y),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(h,r));break;case"ZYX":this._y=Math.asin(-clamp$3(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(_,y),this._z=Math.atan2(h,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(clamp$3(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-d,c),this._y=Math.atan2(-f,r)):(this._x=0,this._y=Math.atan2(a,y));break;case"XZY":this._z=Math.asin(-clamp$3(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(_,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-d,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return _matrix$2.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_matrix$2,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let _object3DId=0;const _v1$4=new Vector3$1,_q1=new Quaternion$1,_m1$1=new Matrix4$1,_target=new Vector3$1,_position$3=new Vector3$1,_scale$2=new Vector3$1,_quaternion$2=new Quaternion$1,_xAxis=new Vector3$1(1,0,0),_yAxis=new Vector3$1(0,1,0),_zAxis=new Vector3$1(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"},_childaddedEvent={type:"childadded",child:null},_childremovedEvent={type:"childremoved",child:null};class Object3D extends EventDispatcher$1{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID$1(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const e=new Vector3$1,t=new Euler,i=new Quaternion$1,s=new Vector3$1(1,1,1);function r(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Matrix4$1},normalMatrix:{value:new Matrix3$1}}),this.matrix=new Matrix4$1,this.matrixWorld=new Matrix4$1,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.premultiply(_q1),this}rotateX(e){return this.rotateOnAxis(_xAxis,e)}rotateY(e){return this.rotateOnAxis(_yAxis,e)}rotateZ(e){return this.rotateOnAxis(_zAxis,e)}translateOnAxis(e,t){return _v1$4.copy(e).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(_xAxis,e)}translateY(e){return this.translateOnAxis(_yAxis,e)}translateZ(e){return this.translateOnAxis(_zAxis,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?_target.copy(e):_target.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),s&&(_m1$1.extractRotation(s.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(_addedEvent),_childaddedEvent.child=e,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(_removedEvent),_childremovedEvent.child=e,this.dispatchEvent(_childremovedEvent),_childremovedEvent.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(e.parent.matrixWorld)),e.applyMatrix4(_m1$1),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(_addedEvent),_childaddedEvent.child=e,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const s=this.children;for(let r=0,o=s.length;r<o;r++)s[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,e,_scale$2),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const s=this.children;for(let r=0,o=s.length;r<o;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(a=>({...a,boundingBox:a.boundingBox?a.boundingBox.toJSON():void 0,boundingSphere:a.boundingSphere?a.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(a=>({...a})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(e),s.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(s.boundingBox=this.boundingBox.toJSON()));function r(a,h){return a[h.uuid]===void 0&&(a[h.uuid]=h.toJSON(e)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const h=a.shapes;if(Array.isArray(h))for(let c=0,d=h.length;c<d;c++){const f=h[c];r(e.shapes,f)}else r(e.shapes,h)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let h=0,c=this.material.length;h<c;h++)a.push(r(e.materials,this.material[h]));s.material=a}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const h=this.animations[a];s.animations.push(r(e.animations,h))}}if(t){const a=o(e.geometries),h=o(e.materials),c=o(e.textures),d=o(e.images),f=o(e.shapes),_=o(e.skeletons),y=o(e.animations),S=o(e.nodes);a.length>0&&(i.geometries=a),h.length>0&&(i.materials=h),c.length>0&&(i.textures=c),d.length>0&&(i.images=d),f.length>0&&(i.shapes=f),_.length>0&&(i.skeletons=_),y.length>0&&(i.animations=y),S.length>0&&(i.nodes=S)}return i.object=s,i;function o(a){const h=[];for(const c in a){const d=a[c];delete d.metadata,h.push(d)}return h}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}Object3D.DEFAULT_UP=new Vector3$1(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3$1,_v1$3=new Vector3$1,_v2$2=new Vector3$1,_v3$2=new Vector3$1,_vab=new Vector3$1,_vac=new Vector3$1,_vbc=new Vector3$1,_vap=new Vector3$1,_vbp=new Vector3$1,_vcp=new Vector3$1,_v40=new Vector4$1,_v41=new Vector4$1,_v42=new Vector4$1;class Triangle{constructor(e=new Vector3$1,t=new Vector3$1,i=new Vector3$1){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,s){s.subVectors(i,t),_v0$1.subVectors(e,t),s.cross(_v0$1);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,i,s,r){_v0$1.subVectors(s,t),_v1$3.subVectors(i,t),_v2$2.subVectors(e,t);const o=_v0$1.dot(_v0$1),a=_v0$1.dot(_v1$3),h=_v0$1.dot(_v2$2),c=_v1$3.dot(_v1$3),d=_v1$3.dot(_v2$2),f=o*c-a*a;if(f===0)return r.set(0,0,0),null;const _=1/f,y=(c*h-a*d)*_,S=(o*d-a*h)*_;return r.set(1-y-S,S,y)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,_v3$2)===null?!1:_v3$2.x>=0&&_v3$2.y>=0&&_v3$2.x+_v3$2.y<=1}static getInterpolation(e,t,i,s,r,o,a,h){return this.getBarycoord(e,t,i,s,_v3$2)===null?(h.x=0,h.y=0,"z"in h&&(h.z=0),"w"in h&&(h.w=0),null):(h.setScalar(0),h.addScaledVector(r,_v3$2.x),h.addScaledVector(o,_v3$2.y),h.addScaledVector(a,_v3$2.z),h)}static getInterpolatedAttribute(e,t,i,s,r,o){return _v40.setScalar(0),_v41.setScalar(0),_v42.setScalar(0),_v40.fromBufferAttribute(e,t),_v41.fromBufferAttribute(e,i),_v42.fromBufferAttribute(e,s),o.setScalar(0),o.addScaledVector(_v40,r.x),o.addScaledVector(_v41,r.y),o.addScaledVector(_v42,r.z),o}static isFrontFacing(e,t,i,s){return _v0$1.subVectors(i,t),_v1$3.subVectors(e,t),_v0$1.cross(_v1$3).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,i,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Triangle.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,s,r){return Triangle.getInterpolation(e,this.a,this.b,this.c,t,i,s,r)}containsPoint(e){return Triangle.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,s=this.b,r=this.c;let o,a;_vab.subVectors(s,i),_vac.subVectors(r,i),_vap.subVectors(e,i);const h=_vab.dot(_vap),c=_vac.dot(_vap);if(h<=0&&c<=0)return t.copy(i);_vbp.subVectors(e,s);const d=_vab.dot(_vbp),f=_vac.dot(_vbp);if(d>=0&&f<=d)return t.copy(s);const _=h*f-d*c;if(_<=0&&h>=0&&d<=0)return o=h/(h-d),t.copy(i).addScaledVector(_vab,o);_vcp.subVectors(e,r);const y=_vab.dot(_vcp),S=_vac.dot(_vcp);if(S>=0&&y<=S)return t.copy(r);const v=y*c-h*S;if(v<=0&&c>=0&&S<=0)return a=c/(c-S),t.copy(i).addScaledVector(_vac,a);const I=d*S-y*f;if(I<=0&&f-d>=0&&y-S>=0)return _vbc.subVectors(r,s),a=(f-d)/(f-d+(y-S)),t.copy(s).addScaledVector(_vbc,a);const A=1/(I+v+_);return o=v*A,a=_*A,t.copy(i).addScaledVector(_vab,o).addScaledVector(_vac,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const _colorKeywords$1={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA$1={h:0,s:0,l:0},_hslB$1={h:0,s:0,l:0};function hue2rgb$1(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}let Color$1=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=SRGBColorSpace$1){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ColorManagement$1.colorSpaceToWorking(this,t),this}setRGB(e,t,i,s=ColorManagement$1.workingColorSpace){return this.r=e,this.g=t,this.b=i,ColorManagement$1.colorSpaceToWorking(this,s),this}setHSL(e,t,i,s=ColorManagement$1.workingColorSpace){if(e=euclideanModulo$1(e,1),t=clamp$3(t,0,1),i=clamp$3(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=hue2rgb$1(o,r,e+1/3),this.g=hue2rgb$1(o,r,e),this.b=hue2rgb$1(o,r,e-1/3)}return ColorManagement$1.colorSpaceToWorking(this,s),this}setStyle(e,t=SRGBColorSpace$1){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=SRGBColorSpace$1){const i=_colorKeywords$1[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=SRGBToLinear$1(e.r),this.g=SRGBToLinear$1(e.g),this.b=SRGBToLinear$1(e.b),this}copyLinearToSRGB(e){return this.r=LinearToSRGB$1(e.r),this.g=LinearToSRGB$1(e.g),this.b=LinearToSRGB$1(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=SRGBColorSpace$1){return ColorManagement$1.workingToColorSpace(_color$1.copy(this),e),Math.round(clamp$3(_color$1.r*255,0,255))*65536+Math.round(clamp$3(_color$1.g*255,0,255))*256+Math.round(clamp$3(_color$1.b*255,0,255))}getHexString(e=SRGBColorSpace$1){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ColorManagement$1.workingColorSpace){ColorManagement$1.workingToColorSpace(_color$1.copy(this),t);const i=_color$1.r,s=_color$1.g,r=_color$1.b,o=Math.max(i,s,r),a=Math.min(i,s,r);let h,c;const d=(a+o)/2;if(a===o)h=0,c=0;else{const f=o-a;switch(c=d<=.5?f/(o+a):f/(2-o-a),o){case i:h=(s-r)/f+(s<r?6:0);break;case s:h=(r-i)/f+2;break;case r:h=(i-s)/f+4;break}h/=6}return e.h=h,e.s=c,e.l=d,e}getRGB(e,t=ColorManagement$1.workingColorSpace){return ColorManagement$1.workingToColorSpace(_color$1.copy(this),t),e.r=_color$1.r,e.g=_color$1.g,e.b=_color$1.b,e}getStyle(e=SRGBColorSpace$1){ColorManagement$1.workingToColorSpace(_color$1.copy(this),e);const t=_color$1.r,i=_color$1.g,s=_color$1.b;return e!==SRGBColorSpace$1?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(e,t,i){return this.getHSL(_hslA$1),this.setHSL(_hslA$1.h+e,_hslA$1.s+t,_hslA$1.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(_hslA$1),e.getHSL(_hslB$1);const i=lerp$2(_hslA$1.h,_hslB$1.h,t),s=lerp$2(_hslA$1.s,_hslB$1.s,t),r=lerp$2(_hslA$1.l,_hslB$1.l,t);return this.setHSL(i,s,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,s=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*s,this.g=r[1]*t+r[4]*i+r[7]*s,this.b=r[2]*t+r[5]*i+r[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const _color$1=new Color$1;Color$1.NAMES=_colorKeywords$1;let _materialId=0;class Material extends EventDispatcher$1{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID$1(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Color$1(0,0,0),this.blendAlpha=0,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(i.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(i.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(i.blending=this.blending),this.side!==FrontSide&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==SrcAlphaFactor&&(i.blendSrc=this.blendSrc),this.blendDst!==OneMinusSrcAlphaFactor&&(i.blendDst=this.blendDst),this.blendEquation!==AddEquation&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==LessEqualDepth&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AlwaysStencilFunc&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==KeepStencilOp&&(i.stencilFail=this.stencilFail),this.stencilZFail!==KeepStencilOp&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==KeepStencilOp&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(r){const o=[];for(const a in r){const h=r[a];delete h.metadata,o.push(h)}return o}if(t){const r=s(e.textures),o=s(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const s=t.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class MeshBasicMaterial extends Material{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color$1(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const _vector$9=new Vector3$1,_vector2$1=new Vector2$1;let _id$2=0,BufferAttribute$1=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=StaticDrawUsage$1,this.updateRanges=[],this.gpuType=FloatType$1,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)_vector2$1.fromBufferAttribute(this,t),_vector2$1.applyMatrix3(e),this.setXY(t,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)_vector$9.fromBufferAttribute(this,t),_vector$9.applyMatrix3(e),this.setXYZ(t,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)_vector$9.fromBufferAttribute(this,t),_vector$9.applyMatrix4(e),this.setXYZ(t,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)_vector$9.fromBufferAttribute(this,t),_vector$9.applyNormalMatrix(e),this.setXYZ(t,_vector$9.x,_vector$9.y,_vector$9.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)_vector$9.fromBufferAttribute(this,t),_vector$9.transformDirection(e),this.setXYZ(t,_vector$9.x,_vector$9.y,_vector$9.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=denormalize$1(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=normalize$2(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=denormalize$1(t,this.array)),t}setX(e,t){return this.normalized&&(t=normalize$2(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=denormalize$1(t,this.array)),t}setY(e,t){return this.normalized&&(t=normalize$2(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=denormalize$1(t,this.array)),t}setZ(e,t){return this.normalized&&(t=normalize$2(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=denormalize$1(t,this.array)),t}setW(e,t){return this.normalized&&(t=normalize$2(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=normalize$2(t,this.array),i=normalize$2(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=normalize$2(t,this.array),i=normalize$2(i,this.array),s=normalize$2(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e*=this.itemSize,this.normalized&&(t=normalize$2(t,this.array),i=normalize$2(i,this.array),s=normalize$2(s,this.array),r=normalize$2(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==StaticDrawUsage$1&&(e.usage=this.usage),e}};class Uint16BufferAttribute extends BufferAttribute$1{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class Uint32BufferAttribute extends BufferAttribute$1{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Float32BufferAttribute extends BufferAttribute$1{constructor(e,t,i){super(new Float32Array(e),t,i)}}let _id$1=0;const _m1$3=new Matrix4$1,_obj=new Object3D,_offset=new Vector3$1,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$8=new Vector3$1;class BufferGeometry extends EventDispatcher$1{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$1++}),this.uuid=generateUUID$1(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(arrayNeedsUint32(e)?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new Matrix3$1().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return _m1$3.makeRotationFromQuaternion(e),this.applyMatrix4(_m1$3),this}rotateX(e){return _m1$3.makeRotationX(e),this.applyMatrix4(_m1$3),this}rotateY(e){return _m1$3.makeRotationY(e),this.applyMatrix4(_m1$3),this}rotateZ(e){return _m1$3.makeRotationZ(e),this.applyMatrix4(_m1$3),this}translate(e,t,i){return _m1$3.makeTranslation(e,t,i),this.applyMatrix4(_m1$3),this}scale(e,t,i){return _m1$3.makeScale(e,t,i),this.applyMatrix4(_m1$3),this}lookAt(e){return _obj.lookAt(e),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let s=0,r=e.length;s<r;s++){const o=e[s];i.push(o.x,o.y,o.z||0)}this.setAttribute("position",new Float32BufferAttribute(i,3))}else{const i=Math.min(e.length,t.count);for(let s=0;s<i;s++){const r=e[s];t.setXYZ(s,r.x,r.y,r.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Vector3$1(-1/0,-1/0,-1/0),new Vector3$1(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++){const r=t[i];_box$2.setFromBufferAttribute(r),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Vector3$1,1/0);return}if(e){const i=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];_boxMorphTargets.setFromBufferAttribute(a),this.morphTargetsRelative?(_vector$8.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$8),_vector$8.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$8)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(i);let s=0;for(let r=0,o=e.count;r<o;r++)_vector$8.fromBufferAttribute(e,r),s=Math.max(s,i.distanceToSquared(_vector$8));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],h=this.morphTargetsRelative;for(let c=0,d=a.count;c<d;c++)_vector$8.fromBufferAttribute(a,c),h&&(_offset.fromBufferAttribute(e,c),_vector$8.add(_offset)),s=Math.max(s,i.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,s=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute$1(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],h=[];for(let j=0;j<i.count;j++)a[j]=new Vector3$1,h[j]=new Vector3$1;const c=new Vector3$1,d=new Vector3$1,f=new Vector3$1,_=new Vector2$1,y=new Vector2$1,S=new Vector2$1,v=new Vector3$1,I=new Vector3$1;function A(j,te,Se){c.fromBufferAttribute(i,j),d.fromBufferAttribute(i,te),f.fromBufferAttribute(i,Se),_.fromBufferAttribute(r,j),y.fromBufferAttribute(r,te),S.fromBufferAttribute(r,Se),d.sub(c),f.sub(c),y.sub(_),S.sub(_);const be=1/(y.x*S.y-S.x*y.y);isFinite(be)&&(v.copy(d).multiplyScalar(S.y).addScaledVector(f,-y.y).multiplyScalar(be),I.copy(f).multiplyScalar(y.x).addScaledVector(d,-S.x).multiplyScalar(be),a[j].add(v),a[te].add(v),a[Se].add(v),h[j].add(I),h[te].add(I),h[Se].add(I))}let B=this.groups;B.length===0&&(B=[{start:0,count:e.count}]);for(let j=0,te=B.length;j<te;++j){const Se=B[j],be=Se.start,Te=Se.count;for(let pe=be,ie=be+Te;pe<ie;pe+=3)A(e.getX(pe+0),e.getX(pe+1),e.getX(pe+2))}const G=new Vector3$1,k=new Vector3$1,z=new Vector3$1,q=new Vector3$1;function T(j){z.fromBufferAttribute(s,j),q.copy(z);const te=a[j];G.copy(te),G.sub(z.multiplyScalar(z.dot(te))).normalize(),k.crossVectors(q,te);const be=k.dot(h[j])<0?-1:1;o.setXYZW(j,G.x,G.y,G.z,be)}for(let j=0,te=B.length;j<te;++j){const Se=B[j],be=Se.start,Te=Se.count;for(let pe=be,ie=be+Te;pe<ie;pe+=3)T(e.getX(pe+0)),T(e.getX(pe+1)),T(e.getX(pe+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new BufferAttribute$1(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let _=0,y=i.count;_<y;_++)i.setXYZ(_,0,0,0);const s=new Vector3$1,r=new Vector3$1,o=new Vector3$1,a=new Vector3$1,h=new Vector3$1,c=new Vector3$1,d=new Vector3$1,f=new Vector3$1;if(e)for(let _=0,y=e.count;_<y;_+=3){const S=e.getX(_+0),v=e.getX(_+1),I=e.getX(_+2);s.fromBufferAttribute(t,S),r.fromBufferAttribute(t,v),o.fromBufferAttribute(t,I),d.subVectors(o,r),f.subVectors(s,r),d.cross(f),a.fromBufferAttribute(i,S),h.fromBufferAttribute(i,v),c.fromBufferAttribute(i,I),a.add(d),h.add(d),c.add(d),i.setXYZ(S,a.x,a.y,a.z),i.setXYZ(v,h.x,h.y,h.z),i.setXYZ(I,c.x,c.y,c.z)}else for(let _=0,y=t.count;_<y;_+=3)s.fromBufferAttribute(t,_+0),r.fromBufferAttribute(t,_+1),o.fromBufferAttribute(t,_+2),d.subVectors(o,r),f.subVectors(s,r),d.cross(f),i.setXYZ(_+0,d.x,d.y,d.z),i.setXYZ(_+1,d.x,d.y,d.z),i.setXYZ(_+2,d.x,d.y,d.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)_vector$8.fromBufferAttribute(e,t),_vector$8.normalize(),e.setXYZ(t,_vector$8.x,_vector$8.y,_vector$8.z)}toNonIndexed(){function e(a,h){const c=a.array,d=a.itemSize,f=a.normalized,_=new c.constructor(h.length*d);let y=0,S=0;for(let v=0,I=h.length;v<I;v++){a.isInterleavedBufferAttribute?y=h[v]*a.data.stride+a.offset:y=h[v]*d;for(let A=0;A<d;A++)_[S++]=c[y++]}return new BufferAttribute$1(_,d,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new BufferGeometry,i=this.index.array,s=this.attributes;for(const a in s){const h=s[a],c=e(h,i);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const h=[],c=r[a];for(let d=0,f=c.length;d<f;d++){const _=c[d],y=e(_,i);h.push(y)}t.morphAttributes[a]=h}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,h=o.length;a<h;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const c in h)h[c]!==void 0&&(e[c]=h[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const h in i){const c=i[h];e.data.attributes[h]=c.toJSON(e.data)}const s={};let r=!1;for(const h in this.morphAttributes){const c=this.morphAttributes[h],d=[];for(let f=0,_=c.length;f<_;f++){const y=c[f];d.push(y.toJSON(e.data))}d.length>0&&(s[h]=d,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere=a.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone());const s=e.attributes;for(const c in s){const d=s[c];this.setAttribute(c,d.clone(t))}const r=e.morphAttributes;for(const c in r){const d=[],f=r[c];for(let _=0,y=f.length;_<y;_++)d.push(f[_].clone(t));this.morphAttributes[c]=d}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,d=o.length;c<d;c++){const f=o[c];this.addGroup(f.start,f.count,f.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const h=e.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4$1,_ray$3=new Ray,_sphere$6=new Sphere,_sphereHitAt=new Vector3$1,_vA$1=new Vector3$1,_vB$1=new Vector3$1,_vC$1=new Vector3$1,_tempA=new Vector3$1,_morphA=new Vector3$1,_intersectionPoint=new Vector3$1,_intersectionPointWorld=new Vector3$1;class Mesh extends Object3D{constructor(e=new BufferGeometry,t=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(e,t){const i=this.geometry,s=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(s,e);const a=this.morphTargetInfluences;if(r&&a){_morphA.set(0,0,0);for(let h=0,c=r.length;h<c;h++){const d=a[h],f=r[h];d!==0&&(_tempA.fromBufferAttribute(f,e),o?_morphA.addScaledVector(_tempA,d):_morphA.addScaledVector(_tempA.sub(t),d))}t.add(_morphA)}return t}raycast(e,t){const i=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),_sphere$6.copy(i.boundingSphere),_sphere$6.applyMatrix4(r),_ray$3.copy(e.ray).recast(e.near),!(_sphere$6.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$6,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(e.far-e.near)**2))&&(_inverseMatrix$3.copy(r).invert(),_ray$3.copy(e.ray).applyMatrix4(_inverseMatrix$3),!(i.boundingBox!==null&&_ray$3.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,_ray$3)))}_computeIntersections(e,t,i){let s;const r=this.geometry,o=this.material,a=r.index,h=r.attributes.position,c=r.attributes.uv,d=r.attributes.uv1,f=r.attributes.normal,_=r.groups,y=r.drawRange;if(a!==null)if(Array.isArray(o))for(let S=0,v=_.length;S<v;S++){const I=_[S],A=o[I.materialIndex],B=Math.max(I.start,y.start),G=Math.min(a.count,Math.min(I.start+I.count,y.start+y.count));for(let k=B,z=G;k<z;k+=3){const q=a.getX(k),T=a.getX(k+1),j=a.getX(k+2);s=checkGeometryIntersection(this,A,e,i,c,d,f,q,T,j),s&&(s.faceIndex=Math.floor(k/3),s.face.materialIndex=I.materialIndex,t.push(s))}}else{const S=Math.max(0,y.start),v=Math.min(a.count,y.start+y.count);for(let I=S,A=v;I<A;I+=3){const B=a.getX(I),G=a.getX(I+1),k=a.getX(I+2);s=checkGeometryIntersection(this,o,e,i,c,d,f,B,G,k),s&&(s.faceIndex=Math.floor(I/3),t.push(s))}}else if(h!==void 0)if(Array.isArray(o))for(let S=0,v=_.length;S<v;S++){const I=_[S],A=o[I.materialIndex],B=Math.max(I.start,y.start),G=Math.min(h.count,Math.min(I.start+I.count,y.start+y.count));for(let k=B,z=G;k<z;k+=3){const q=k,T=k+1,j=k+2;s=checkGeometryIntersection(this,A,e,i,c,d,f,q,T,j),s&&(s.faceIndex=Math.floor(k/3),s.face.materialIndex=I.materialIndex,t.push(s))}}else{const S=Math.max(0,y.start),v=Math.min(h.count,y.start+y.count);for(let I=S,A=v;I<A;I+=3){const B=I,G=I+1,k=I+2;s=checkGeometryIntersection(this,o,e,i,c,d,f,B,G,k),s&&(s.faceIndex=Math.floor(I/3),t.push(s))}}}}function checkIntersection$1(n,e,t,i,s,r,o,a){let h;if(e.side===BackSide?h=i.intersectTriangle(o,r,s,!0,a):h=i.intersectTriangle(s,r,o,e.side===FrontSide,a),h===null)return null;_intersectionPointWorld.copy(a),_intersectionPointWorld.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(_intersectionPointWorld);return c<t.near||c>t.far?null:{distance:c,point:_intersectionPointWorld.clone(),object:n}}function checkGeometryIntersection(n,e,t,i,s,r,o,a,h,c){n.getVertexPosition(a,_vA$1),n.getVertexPosition(h,_vB$1),n.getVertexPosition(c,_vC$1);const d=checkIntersection$1(n,e,t,i,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(d){const f=new Vector3$1;Triangle.getBarycoord(_intersectionPoint,_vA$1,_vB$1,_vC$1,f),s&&(d.uv=Triangle.getInterpolatedAttribute(s,a,h,c,f,new Vector2$1)),r&&(d.uv1=Triangle.getInterpolatedAttribute(r,a,h,c,f,new Vector2$1)),o&&(d.normal=Triangle.getInterpolatedAttribute(o,a,h,c,f,new Vector3$1),d.normal.dot(i.direction)>0&&d.normal.multiplyScalar(-1));const _={a,b:h,c,normal:new Vector3$1,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,_.normal),d.face=_,d.barycoord=f}return d}class BoxGeometry extends BufferGeometry{constructor(e=1,t=1,i=1,s=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:r,depthSegments:o};const a=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const h=[],c=[],d=[],f=[];let _=0,y=0;S("z","y","x",-1,-1,i,t,e,o,r,0),S("z","y","x",1,-1,i,t,-e,o,r,1),S("x","z","y",1,1,e,i,t,s,o,2),S("x","z","y",1,-1,e,i,-t,s,o,3),S("x","y","z",1,-1,e,t,i,s,r,4),S("x","y","z",-1,-1,e,t,-i,s,r,5),this.setIndex(h),this.setAttribute("position",new Float32BufferAttribute(c,3)),this.setAttribute("normal",new Float32BufferAttribute(d,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2));function S(v,I,A,B,G,k,z,q,T,j,te){const Se=k/T,be=z/j,Te=k/2,pe=z/2,ie=q/2,he=T+1,ge=j+1;let ue=0,de=0;const se=new Vector3$1;for(let l=0;l<ge;l++){const u=l*be-pe;for(let p=0;p<he;p++){const g=p*Se-Te;se[v]=g*B,se[I]=u*G,se[A]=ie,c.push(se.x,se.y,se.z),se[v]=0,se[I]=0,se[A]=q>0?1:-1,d.push(se.x,se.y,se.z),f.push(p/T),f.push(1-l/j),ue+=1}}for(let l=0;l<j;l++)for(let u=0;u<T;u++){const p=_+u+he*l,g=_+u+he*(l+1),C=_+(u+1)+he*(l+1),b=_+(u+1)+he*l;h.push(p,g,b),h.push(g,C,b),de+=6}a.addGroup(y,de,te),y+=de,_+=ue}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function cloneUniforms(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const s=n[t][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=s.clone():Array.isArray(s)?e[t][i]=s.slice():e[t][i]=s}}return e}function mergeUniforms(n){const e={};for(let t=0;t<n.length;t++){const i=cloneUniforms(n[t]);for(const s in i)e[s]=i[s]}return e}function cloneUniformsGroups(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function getUnlitUniformColorSpace(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ColorManagement$1.workingColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cloneUniforms(e.uniforms),this.uniformsGroups=cloneUniformsGroups(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?t.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[s]={type:"m4",value:o.toArray()}:t.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4$1,this.projectionMatrix=new Matrix4$1,this.projectionMatrixInverse=new Matrix4$1,this.coordinateSystem=WebGLCoordinateSystem$1,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const _v3$1=new Vector3$1,_minTarget=new Vector2$1,_maxTarget=new Vector2$1;class PerspectiveCamera extends Camera{constructor(e=50,t=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=RAD2DEG$1*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(DEG2RAD$1*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return RAD2DEG$1*2*Math.atan(Math.tan(DEG2RAD$1*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){_v3$1.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(_v3$1.x,_v3$1.y).multiplyScalar(-e/_v3$1.z),_v3$1.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(_v3$1.x,_v3$1.y).multiplyScalar(-e/_v3$1.z)}getViewSize(e,t){return this.getViewBounds(e,_minTarget,_maxTarget),t.subVectors(_maxTarget,_minTarget)}setViewOffset(e,t,i,s,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(DEG2RAD$1*.5*this.fov)/this.zoom,i=2*t,s=this.aspect*i,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const h=o.fullWidth,c=o.fullHeight;r+=o.offsetX*s/h,t-=o.offsetY*i/c,s*=o.width/h,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-i,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new PerspectiveCamera(fov,aspect,e,t);s.layers=this.layers,this.add(s);const r=new PerspectiveCamera(fov,aspect,e,t);r.layers=this.layers,this.add(r);const o=new PerspectiveCamera(fov,aspect,e,t);o.layers=this.layers,this.add(o);const a=new PerspectiveCamera(fov,aspect,e,t);a.layers=this.layers,this.add(a);const h=new PerspectiveCamera(fov,aspect,e,t);h.layers=this.layers,this.add(h);const c=new PerspectiveCamera(fov,aspect,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,s,r,o,a,h]=t;for(const c of t)this.remove(c);if(e===WebGLCoordinateSystem$1)i.up.set(0,1,0),i.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),h.up.set(0,1,0),h.lookAt(0,0,-1);else if(e===WebGPUCoordinateSystem$1)i.up.set(0,-1,0),i.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),h.up.set(0,-1,0),h.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,o,a,h,c,d]=this.children,f=e.getRenderTarget(),_=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),S=e.xr.enabled;e.xr.enabled=!1;const v=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,s),e.render(t,r),e.setRenderTarget(i,1,s),e.render(t,o),e.setRenderTarget(i,2,s),e.render(t,a),e.setRenderTarget(i,3,s),e.render(t,h),e.setRenderTarget(i,4,s),e.render(t,c),i.texture.generateMipmaps=v,e.setRenderTarget(i,5,s),e.render(t,d),e.setRenderTarget(f,_,y),e.xr.enabled=S,i.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(e=[],t=CubeReflectionMapping,i,s,r,o,a,h,c,d){super(e,t,i,s,r,o,a,h,c,d),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},s=[i,i,i,i,i,i];this.texture=new CubeTexture(s),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new BoxGeometry(5,5,5),r=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:BackSide,blending:NoBlending});r.uniforms.tEquirect.value=t;const o=new Mesh(s,r),a=t.minFilter;return t.minFilter===LinearMipmapLinearFilter&&(t.minFilter=LinearFilter),new CubeCamera(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,i=!0,s=!0){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,s);e.setRenderTarget(r)}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3$1,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3$1),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3$1,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3$1),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let s=null,r=null,o=null;const a=this._targetRay,h=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const v of e.hand.values()){const I=t.getJointPose(v,i),A=this._getHandJoint(c,v);I!==null&&(A.matrix.fromArray(I.transform.matrix),A.matrix.decompose(A.position,A.rotation,A.scale),A.matrixWorldNeedsUpdate=!0,A.jointRadius=I.radius),A.visible=I!==null}const d=c.joints["index-finger-tip"],f=c.joints["thumb-tip"],_=d.position.distanceTo(f.position),y=.02,S=.005;c.inputState.pinching&&_>y+S?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&_<=y-S&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else h!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(h.matrix.fromArray(r.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.matrixWorldNeedsUpdate=!0,r.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(r.linearVelocity)):h.hasLinearVelocity=!1,r.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(r.angularVelocity)):h.hasAngularVelocity=!1));a!==null&&(s=t.getPose(e.targetRaySpace,i),s===null&&r!==null&&(s=r),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return a!==null&&(a.visible=s!==null),h!==null&&(h.visible=r!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new Group;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Euler,this.environmentIntensity=1,this.environmentRotation=new Euler,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}let InterleavedBuffer$1=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=StaticDrawUsage$1,this.updateRanges=[],this.version=0,this.uuid=generateUUID$1()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[i+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID$1()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID$1()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};const _vector$7=new Vector3$1;let InterleavedBufferAttribute$1=class hn{constructor(e,t,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)_vector$7.fromBufferAttribute(this,t),_vector$7.applyMatrix4(e),this.setXYZ(t,_vector$7.x,_vector$7.y,_vector$7.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)_vector$7.fromBufferAttribute(this,t),_vector$7.applyNormalMatrix(e),this.setXYZ(t,_vector$7.x,_vector$7.y,_vector$7.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)_vector$7.fromBufferAttribute(this,t),_vector$7.transformDirection(e),this.setXYZ(t,_vector$7.x,_vector$7.y,_vector$7.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=denormalize$1(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=normalize$2(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=normalize$2(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=normalize$2(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=normalize$2(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=normalize$2(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=denormalize$1(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=denormalize$1(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=denormalize$1(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=denormalize$1(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=normalize$2(t,this.array),i=normalize$2(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=normalize$2(t,this.array),i=normalize$2(i,this.array),s=normalize$2(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=normalize$2(t,this.array),i=normalize$2(i,this.array),s=normalize$2(s,this.array),r=normalize$2(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new BufferAttribute$1(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new hn(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};const _basePosition=new Vector3$1,_skinIndex=new Vector4$1,_skinWeight=new Vector4$1,_vector3=new Vector3$1,_matrix4=new Matrix4$1,_vertex=new Vector3$1,_sphere$5=new Sphere,_inverseMatrix$2=new Matrix4$1,_ray$2=new Ray;class SkinnedMesh extends Mesh{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=AttachedBindMode,this.bindMatrix=new Matrix4$1,this.bindMatrixInverse=new Matrix4$1,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$5.copy(this.boundingSphere),_sphere$5.applyMatrix4(s),e.ray.intersectsSphere(_sphere$5)!==!1&&(_inverseMatrix$2.copy(s).invert(),_ray$2.copy(e.ray).applyMatrix4(_inverseMatrix$2),!(this.boundingBox!==null&&_ray$2.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,_ray$2)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Vector4$1,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===AttachedBindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===DetachedBindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,s=this.geometry;_skinIndex.fromBufferAttribute(s.attributes.skinIndex,e),_skinWeight.fromBufferAttribute(s.attributes.skinWeight,e),_basePosition.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=_skinWeight.getComponent(r);if(o!==0){const a=_skinIndex.getComponent(r);_matrix4.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(e=null,t=1,i=1,s,r,o,a,h,c=NearestFilter,d=NearestFilter,f,_){super(null,o,a,h,c,d,s,r,f,_),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4$1,_identityMatrix=new Matrix4$1;class Skeleton{constructor(e=[],t=[]){this.uuid=generateUUID$1(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new Matrix4$1)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Matrix4$1;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(a,t[r]),_offsetMatrix.toArray(i,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new DataTexture(t,e,e,RGBAFormat,FloatType$1);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,s=e.bones.length;i<s;i++){const r=e.bones[i];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new Bone),this.bones.push(o),this.boneInverses.push(new Matrix4$1().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const o=t[s];e.bones.push(o.uuid);const a=i[s];e.boneInverses.push(a.toArray())}return e}}class InstancedBufferAttribute extends BufferAttribute$1{constructor(e,t,i,s=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const _instanceLocalMatrix=new Matrix4$1,_instanceWorldMatrix=new Matrix4$1,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4$1,_mesh$1=new Mesh,_sphere$4=new Sphere;class InstancedMesh extends Mesh{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,_identity)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Box3),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,_instanceLocalMatrix),_box3.copy(e.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sphere),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,_instanceLocalMatrix),_sphere$4.copy(e.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$4)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,s=this.morphTexture.source.data.data,r=i.length+1,o=e*r+1;for(let a=0;a<i.length;a++)i[a]=s[o+a]}raycast(e,t){const i=this.matrixWorld,s=this.count;if(_mesh$1.geometry=this.geometry,_mesh$1.material=this.material,_mesh$1.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$4.copy(this.boundingSphere),_sphere$4.applyMatrix4(i),e.ray.intersectsSphere(_sphere$4)!==!1))for(let r=0;r<s;r++){this.getMatrixAt(r,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(i,_instanceLocalMatrix),_mesh$1.matrixWorld=_instanceWorldMatrix,_mesh$1.raycast(e,_instanceIntersects);for(let o=0,a=_instanceIntersects.length;o<a;o++){const h=_instanceIntersects[o];h.instanceId=r,h.object=this,t.push(h)}_instanceIntersects.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,s=i.length+1;this.morphTexture===null&&(this.morphTexture=new DataTexture(new Float32Array(s*this.count),s,this.count,RedFormat,FloatType$1));const r=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,h=s*e;r[h]=a,r.set(i,h+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const _vector1=new Vector3$1,_vector2$2=new Vector3$1,_normalMatrix=new Matrix3$1;class Plane{constructor(e=new Vector3$1(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=_vector1.subVectors(i,t).cross(_vector2$2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(_vector1),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||_normalMatrix.getNormalMatrix(e),s=this.coplanarPoint(_vector1).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _sphere$3=new Sphere,_defaultSpriteCenter=new Vector2$1(.5,.5),_vector$6=new Vector3$1;class Frustum{constructor(e=new Plane,t=new Plane,i=new Plane,s=new Plane,r=new Plane,o=new Plane){this.planes=[e,t,i,s,r,o]}set(e,t,i,s,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=WebGLCoordinateSystem$1,i=!1){const s=this.planes,r=e.elements,o=r[0],a=r[1],h=r[2],c=r[3],d=r[4],f=r[5],_=r[6],y=r[7],S=r[8],v=r[9],I=r[10],A=r[11],B=r[12],G=r[13],k=r[14],z=r[15];if(s[0].setComponents(c-o,y-d,A-S,z-B).normalize(),s[1].setComponents(c+o,y+d,A+S,z+B).normalize(),s[2].setComponents(c+a,y+f,A+v,z+G).normalize(),s[3].setComponents(c-a,y-f,A-v,z-G).normalize(),i)s[4].setComponents(h,_,I,k).normalize(),s[5].setComponents(c-h,y-_,A-I,z-k).normalize();else if(s[4].setComponents(c-h,y-_,A-I,z-k).normalize(),t===WebGLCoordinateSystem$1)s[5].setComponents(c+h,y+_,A+I,z+k).normalize();else if(t===WebGPUCoordinateSystem$1)s[5].setComponents(h,_,I,k).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),_sphere$3.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),_sphere$3.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(_sphere$3)}intersectsSprite(e){_sphere$3.center.set(0,0,0);const t=_defaultSpriteCenter.distanceTo(e.center);return _sphere$3.radius=.7071067811865476+t,_sphere$3.applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$3)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if(_vector$6.x=s.normal.x>0?e.max.x:e.min.x,_vector$6.y=s.normal.y>0?e.max.y:e.min.y,_vector$6.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class LineBasicMaterial extends Material{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color$1(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const _vStart=new Vector3$1,_vEnd=new Vector3$1,_inverseMatrix$1=new Matrix4$1,_ray$1=new Ray,_sphere$1=new Sphere,_intersectPointOnRay=new Vector3$1,_intersectPointOnSegment=new Vector3$1;class Line extends Object3D{constructor(e=new BufferGeometry,t=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let s=1,r=t.count;s<r;s++)_vStart.fromBufferAttribute(t,s-1),_vEnd.fromBufferAttribute(t,s),i[s]=i[s-1],i[s]+=_vStart.distanceTo(_vEnd);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),_sphere$1.copy(i.boundingSphere),_sphere$1.applyMatrix4(s),_sphere$1.radius+=r,e.ray.intersectsSphere(_sphere$1)===!1)return;_inverseMatrix$1.copy(s).invert(),_ray$1.copy(e.ray).applyMatrix4(_inverseMatrix$1);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),h=a*a,c=this.isLineSegments?2:1,d=i.index,_=i.attributes.position;if(d!==null){const y=Math.max(0,o.start),S=Math.min(d.count,o.start+o.count);for(let v=y,I=S-1;v<I;v+=c){const A=d.getX(v),B=d.getX(v+1),G=checkIntersection(this,e,_ray$1,h,A,B,v);G&&t.push(G)}if(this.isLineLoop){const v=d.getX(S-1),I=d.getX(y),A=checkIntersection(this,e,_ray$1,h,v,I,S-1);A&&t.push(A)}}else{const y=Math.max(0,o.start),S=Math.min(_.count,o.start+o.count);for(let v=y,I=S-1;v<I;v+=c){const A=checkIntersection(this,e,_ray$1,h,v,v+1,v);A&&t.push(A)}if(this.isLineLoop){const v=checkIntersection(this,e,_ray$1,h,S-1,y,S-1);v&&t.push(v)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function checkIntersection(n,e,t,i,s,r,o){const a=n.geometry.attributes.position;if(_vStart.fromBufferAttribute(a,s),_vEnd.fromBufferAttribute(a,r),t.distanceSqToSegment(_vStart,_vEnd,_intersectPointOnRay,_intersectPointOnSegment)>i)return;_intersectPointOnRay.applyMatrix4(n.matrixWorld);const c=e.ray.origin.distanceTo(_intersectPointOnRay);if(!(c<e.near||c>e.far))return{distance:c,point:_intersectPointOnSegment.clone().applyMatrix4(n.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:n}}const _start=new Vector3$1,_end=new Vector3$1;class LineSegments extends Line{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let s=0,r=t.count;s<r;s+=2)_start.fromBufferAttribute(t,s),_end.fromBufferAttribute(t,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color$1(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const _inverseMatrix=new Matrix4$1,_ray=new Ray,_sphere=new Sphere,_position$2=new Vector3$1;class Points extends Object3D{constructor(e=new BufferGeometry,t=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),_sphere.copy(i.boundingSphere),_sphere.applyMatrix4(s),_sphere.radius+=r,e.ray.intersectsSphere(_sphere)===!1)return;_inverseMatrix.copy(s).invert(),_ray.copy(e.ray).applyMatrix4(_inverseMatrix);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),h=a*a,c=i.index,f=i.attributes.position;if(c!==null){const _=Math.max(0,o.start),y=Math.min(c.count,o.start+o.count);for(let S=_,v=y;S<v;S++){const I=c.getX(S);_position$2.fromBufferAttribute(f,I),testPoint(_position$2,I,h,s,e,t,this)}}else{const _=Math.max(0,o.start),y=Math.min(f.count,o.start+o.count);for(let S=_,v=y;S<v;S++)_position$2.fromBufferAttribute(f,S),testPoint(_position$2,S,h,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function testPoint(n,e,t,i,s,r,o){const a=_ray.distanceSqToPoint(n);if(a<t){const h=new Vector3$1;_ray.closestPointToPoint(n,h),h.applyMatrix4(i);const c=s.ray.origin.distanceTo(h);if(c<s.near||c>s.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:h,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class DepthTexture extends Texture{constructor(e,t,i=UnsignedIntType,s,r,o,a=NearestFilter,h=NearestFilter,c,d=DepthFormat,f=1){if(d!==DepthFormat&&d!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const _={width:e,height:t,depth:f};super(_,s,r,o,a,h,d,i,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Source$1(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class ExternalTexture extends Texture{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class PlaneGeometry extends BufferGeometry{constructor(e=1,t=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const r=e/2,o=t/2,a=Math.floor(i),h=Math.floor(s),c=a+1,d=h+1,f=e/a,_=t/h,y=[],S=[],v=[],I=[];for(let A=0;A<d;A++){const B=A*_-o;for(let G=0;G<c;G++){const k=G*f-r;S.push(k,-B,0),v.push(0,0,1),I.push(G/a),I.push(1-A/h)}}for(let A=0;A<h;A++)for(let B=0;B<a;B++){const G=B+c*A,k=B+c*(A+1),z=B+1+c*(A+1),q=B+1+c*A;y.push(G,k,q),y.push(k,z,q)}this.setIndex(y),this.setAttribute("position",new Float32BufferAttribute(S,3)),this.setAttribute("normal",new Float32BufferAttribute(v,3)),this.setAttribute("uv",new Float32BufferAttribute(I,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)}}class MeshStandardMaterial extends Material{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Color$1(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$1(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2$1(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2$1(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp$3(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color$1(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color$1(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color$1(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class MeshDepthMaterial extends Material{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function convertArray(n,e){return!n||n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function isTypedArray(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function getKeyframeOrder(n){function e(s,r){return n[s]-n[r]}const t=n.length,i=new Array(t);for(let s=0;s!==t;++s)i[s]=s;return i.sort(e),i}function sortedArray(n,e,t){const i=n.length,s=new n.constructor(i);for(let r=0,o=0;o!==i;++r){const a=t[r]*e;for(let h=0;h!==e;++h)s[o++]=n[a+h]}return s}function flattenJSON(n,e,t,i){let s=1,r=n[0];for(;r!==void 0&&r[i]===void 0;)r=n[s++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(e.push(r.time),t.push(...o)),r=n[s++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=n[s++];while(r!==void 0);else do o=r[i],o!==void 0&&(e.push(r.time),t.push(o)),r=n[s++];while(r!==void 0)}class Interpolant{constructor(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],r=t[i-1];e:{t:{let o;i:{n:if(!(e<s)){for(let a=i+2;;){if(s===void 0){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=s,s=t[++i],e<s)break t}o=t.length;break i}if(!(e>=r)){const a=t[1];e<a&&(i=2,r=a);for(let h=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===h)break;if(s=r,r=t[--i-1],e>=r)break t}o=i,i=0;break i}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(s=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s;for(let o=0;o!==s;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(e,t,i,s){super(e,t,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(e,t,i){const s=this.parameterPositions;let r=e-2,o=e+1,a=s[r],h=s[o];if(a===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:r=e,a=2*t-i;break;case WrapAroundEnding:r=s.length-2,a=t+s[r]-s[r+1];break;default:r=e,a=i}if(h===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:o=e,h=2*i-t;break;case WrapAroundEnding:o=1,h=i+s[1]-s[0];break;default:o=e-1,h=t}const c=(i-t)*.5,d=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(h-i),this._offsetPrev=r*d,this._offsetNext=o*d}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,h=e*a,c=h-a,d=this._offsetPrev,f=this._offsetNext,_=this._weightPrev,y=this._weightNext,S=(i-t)/(s-t),v=S*S,I=v*S,A=-_*I+2*_*v-_*S,B=(1+_)*I+(-1.5-2*_)*v+(-.5+_)*S+1,G=(-1-y)*I+(1.5+y)*v+.5*S,k=y*I-y*v;for(let z=0;z!==a;++z)r[z]=A*o[d+z]+B*o[c+z]+G*o[h+z]+k*o[f+z];return r}}class LinearInterpolant extends Interpolant{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,h=e*a,c=h-a,d=(i-t)/(s-t),f=1-d;for(let _=0;_!==a;++_)r[_]=o[c+_]*f+o[h+_]*d;return r}}class DiscreteInterpolant extends Interpolant{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class KeyframeTrack{constructor(e,t,i,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=convertArray(t,this.TimeBufferType),this.values=convertArray(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:convertArray(e.times,Array),values:convertArray(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(i.interpolation=s)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this}trim(e,t){const i=this.times,s=i.length;let r=0,o=s-1;for(;r!==s&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=i.slice(r,o),this.values=this.values.slice(r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const h=i[a];if(typeof h=="number"&&isNaN(h)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,h),e=!1;break}if(o!==null&&o>h){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,h,o),e=!1;break}o=h}if(s!==void 0&&isTypedArray(s))for(let a=0,h=s.length;a!==h;++a){const c=s[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===InterpolateSmooth,r=e.length-1;let o=1;for(let a=1;a<r;++a){let h=!1;const c=e[a],d=e[a+1];if(c!==d&&(a!==1||c!==e[0]))if(s)h=!0;else{const f=a*i,_=f-i,y=f+i;for(let S=0;S!==i;++S){const v=t[f+S];if(v!==t[_+S]||v!==t[y+S]){h=!0;break}}}if(h){if(a!==o){e[o]=e[a];const f=a*i,_=o*i;for(let y=0;y!==i;++y)t[_+y]=t[f+y]}++o}}if(r>0){e[o]=e[r];for(let a=r*i,h=o*i,c=0;c!==i;++c)t[h+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,s=new i(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}KeyframeTrack.prototype.ValueTypeName="";KeyframeTrack.prototype.TimeBufferType=Float32Array;KeyframeTrack.prototype.ValueBufferType=Float32Array;KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{constructor(e,t,i){super(e,t,i)}}BooleanKeyframeTrack.prototype.ValueTypeName="bool";BooleanKeyframeTrack.prototype.ValueBufferType=Array;BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{constructor(e,t,i,s){super(e,t,i,s)}}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{constructor(e,t,i,s){super(e,t,i,s)}}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,h=(i-t)/(s-t);let c=e*a;for(let d=c+a;c!==d;c+=4)Quaternion$1.slerpFlat(r,0,o,c-a,o,c,h);return r}}class QuaternionKeyframeTrack extends KeyframeTrack{constructor(e,t,i,s){super(e,t,i,s)}InterpolantFactoryMethodLinear(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion";QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{constructor(e,t,i){super(e,t,i)}}StringKeyframeTrack.prototype.ValueTypeName="string";StringKeyframeTrack.prototype.ValueBufferType=Array;StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{constructor(e,t,i,s){super(e,t,i,s)}}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(e="",t=-1,i=[],s=NormalAnimationBlendMode){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=generateUUID$1(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(parseKeyframeTrack(i[o]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r.userData=JSON.parse(e.userData||"{}"),r}static toJSON(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let r=0,o=i.length;r!==o;++r)t.push(KeyframeTrack.toJSON(i[r]));return s}static CreateFromMorphTargetSequence(e,t,i,s){const r=t.length,o=[];for(let a=0;a<r;a++){let h=[],c=[];h.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const d=getKeyframeOrder(h);h=sortedArray(h,1,d),c=sortedArray(c,1,d),!s&&h[0]===0&&(h.push(r),c.push(c[0])),o.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[a].name+"]",h,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const s=e;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===t)return i[s];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const s={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,h=e.length;a<h;a++){const c=e[a],d=c.name.match(r);if(d&&d.length>1){const f=d[1];let _=s[f];_||(s[f]=_=[]),_.push(c)}}const o=[];for(const a in s)o.push(this.CreateFromMorphTargetSequence(a,s[a],t,i));return o}static parseAnimation(e,t){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(f,_,y,S,v){if(y.length!==0){const I=[],A=[];flattenJSON(y,I,A,S),I.length!==0&&v.push(new f(_,I,A))}},s=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let h=e.length||-1;const c=e.hierarchy||[];for(let f=0;f<c.length;f++){const _=c[f].keys;if(!(!_||_.length===0))if(_[0].morphTargets){const y={};let S;for(S=0;S<_.length;S++)if(_[S].morphTargets)for(let v=0;v<_[S].morphTargets.length;v++)y[_[S].morphTargets[v]]=-1;for(const v in y){const I=[],A=[];for(let B=0;B!==_[S].morphTargets.length;++B){const G=_[S];I.push(G.time),A.push(G.morphTarget===v?1:0)}s.push(new NumberKeyframeTrack(".morphTargetInfluence["+v+"]",I,A))}h=y.length*o}else{const y=".bones["+t[f].name+"]";i(VectorKeyframeTrack,y+".position",_,"pos",s),i(QuaternionKeyframeTrack,y+".quaternion",_,"rot",s),i(VectorKeyframeTrack,y+".scale",_,"scl",s)}}return s.length===0?null:new this(r,h,s,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,s=e.length;i!==s;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function parseKeyframeTrack(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=getTrackTypeForValueTypeName(n.type);if(n.times===void 0){const t=[],i=[];flattenJSON(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Cache={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class LoadingManager{constructor(e,t,i){const s=this;let r=!1,o=0,a=0,h;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.abortController=new AbortController,this.itemStart=function(d){a++,r===!1&&s.onStart!==void 0&&s.onStart(d,o,a),r=!0},this.itemEnd=function(d){o++,s.onProgress!==void 0&&s.onProgress(d,o,a),o===a&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(d){s.onError!==void 0&&s.onError(d)},this.resolveURL=function(d){return h?h(d):d},this.setURLModifier=function(d){return h=d,this},this.addHandler=function(d,f){return c.push(d,f),this},this.removeHandler=function(d){const f=c.indexOf(d);return f!==-1&&c.splice(f,2),this},this.getHandler=function(d){for(let f=0,_=c.length;f<_;f+=2){const y=c[f],S=c[f+1];if(y.global&&(y.lastIndex=0),y.test(d))return S}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(e){this.manager=e!==void 0?e:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(s,r){i.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(e,t){super(e),this.response=t}}class FileLoader extends Loader{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Cache.get(`file:${e}`);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(loading[e]!==void 0){loading[e].push({onLoad:t,onProgress:i,onError:s});return}loading[e]=[],loading[e].push({onLoad:t,onProgress:i,onError:s});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),a=this.mimeType,h=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const d=loading[e],f=c.body.getReader(),_=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),y=_?parseInt(_):0,S=y!==0;let v=0;const I=new ReadableStream({start(A){B();function B(){f.read().then(({done:G,value:k})=>{if(G)A.close();else{v+=k.byteLength;const z=new ProgressEvent("progress",{lengthComputable:S,loaded:v,total:y});for(let q=0,T=d.length;q<T;q++){const j=d[q];j.onProgress&&j.onProgress(z)}A.enqueue(k),B()}},G=>{A.error(G)})}}});return new Response(I)}else throw new HttpError(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(h){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(d=>new DOMParser().parseFromString(d,a));case"json":return c.json();default:if(a==="")return c.text();{const f=/charset="?([^;"\s]*)"?/i.exec(a),_=f&&f[1]?f[1].toLowerCase():void 0,y=new TextDecoder(_);return c.arrayBuffer().then(S=>y.decode(S))}}}).then(c=>{Cache.add(`file:${e}`,c);const d=loading[e];delete loading[e];for(let f=0,_=d.length;f<_;f++){const y=d[f];y.onLoad&&y.onLoad(c)}}).catch(c=>{const d=loading[e];if(d===void 0)throw this.manager.itemError(e),c;delete loading[e];for(let f=0,_=d.length;f<_;f++){const y=d[f];y.onError&&y.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}const _loading=new WeakMap;class ImageLoader extends Loader{constructor(e){super(e)}load(e,t,i,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Cache.get(`image:${e}`);if(o!==void 0){if(o.complete===!0)r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0);else{let f=_loading.get(o);f===void 0&&(f=[],_loading.set(o,f)),f.push({onLoad:t,onError:s})}return o}const a=createElementNS("img");function h(){d(),t&&t(this);const f=_loading.get(this)||[];for(let _=0;_<f.length;_++){const y=f[_];y.onLoad&&y.onLoad(this)}_loading.delete(this),r.manager.itemEnd(e)}function c(f){d(),s&&s(f),Cache.remove(`image:${e}`);const _=_loading.get(this)||[];for(let y=0;y<_.length;y++){const S=_[y];S.onError&&S.onError(f)}_loading.delete(this),r.manager.itemError(e),r.manager.itemEnd(e)}function d(){a.removeEventListener("load",h,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",h,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),Cache.add(`image:${e}`,a),r.manager.itemStart(e),a.src=e,a}}class TextureLoader extends Loader{constructor(e){super(e)}load(e,t,i,s){const r=new Texture,o=new ImageLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},i,s),r}}class Light extends Object3D{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Color$1(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}const _projScreenMatrix$1=new Matrix4$1,_lightPositionWorld$1=new Vector3$1,_lookTarget$1=new Vector3$1;class LightShadow{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2$1(512,512),this.mapType=UnsignedByteType,this.map=null,this.mapPass=null,this.matrix=new Matrix4$1,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2$1(1,1),this._viewportCount=1,this._viewports=[new Vector4$1(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(e.matrixWorld),t.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(_lookTarget$1),t.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1,t.coordinateSystem,t.reversedDepth),t.reversedDepth?i.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(_projScreenMatrix$1)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,i=RAD2DEG$1*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height*this.aspect,r=e.distance||t.far;(i!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class SpotLight extends Light{constructor(e,t,i=0,s=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=i,this.angle=s,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const _projScreenMatrix=new Matrix4$1,_lightPositionWorld=new Vector3$1,_lookTarget=new Vector3$1;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2$1(4,2),this._viewportCount=6,this._viewports=[new Vector4$1(2,1,1,1),new Vector4$1(0,1,1,1),new Vector4$1(3,1,1,1),new Vector4$1(1,1,1,1),new Vector4$1(3,0,1,1),new Vector4$1(1,0,1,1)],this._cubeDirections=[new Vector3$1(1,0,0),new Vector3$1(-1,0,0),new Vector3$1(0,0,1),new Vector3$1(0,0,-1),new Vector3$1(0,1,0),new Vector3$1(0,-1,0)],this._cubeUps=[new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,0,1),new Vector3$1(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,s=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(e.matrixWorld),i.position.copy(_lightPositionWorld),_lookTarget.copy(i.position),_lookTarget.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(_lookTarget),i.updateMatrixWorld(),s.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix,i.coordinateSystem,i.reversedDepth)}}class PointLight extends Light{constructor(e,t,i=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new PointLightShadow}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class OrthographicCamera extends Camera{constructor(e=-1,t=1,i=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-e,o=i+e,a=s+t,h=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=d*this.view.offsetY,h=a-d*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,h,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class AmbientLight extends Light{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class LoaderUtils{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}const _errorMap=new WeakMap;class ImageBitmapLoader extends Loader{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Cache.get(`image-bitmap:${e}`);if(o!==void 0){if(r.manager.itemStart(e),o.then){o.then(c=>{if(_errorMap.has(o)===!0)s&&s(_errorMap.get(o)),r.manager.itemError(e),r.manager.itemEnd(e);else return t&&t(c),r.manager.itemEnd(e),c});return}return setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,a.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const h=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return Cache.add(`image-bitmap:${e}`,c),t&&t(c),r.manager.itemEnd(e),c}).catch(function(c){s&&s(c),_errorMap.set(h,c),Cache.remove(`image-bitmap:${e}`),r.manager.itemError(e),r.manager.itemEnd(e)});Cache.add(`image-bitmap:${e}`,h),r.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class ArrayCamera extends PerspectiveCamera{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(e,t,i){const s=i||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class PropertyBinding{constructor(e,t,i){this.path=t,this.parsedPath=i||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,t,i):new PropertyBinding(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(e){const t=_trackRe.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=i.nodeName.substring(s+1);_supportedObjectNames.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===t||a.uuid===t)return a;const h=i(a.children);if(h)return h}return null},s=i(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)e[t++]=i[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=PropertyBinding.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let d=0;d<e.length;d++)if(e[d].name===c){c=d;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[s];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+s+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?a=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let h=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}h=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(h=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(h=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray];PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Spherical{constructor(e=1,t=0,i=0){this.radius=e,this.phi=t,this.theta=i}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=clamp$3(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(clamp$3(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Controls extends EventDispatcher$1{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function getByteLength(n,e,t,i){const s=getTextureTypeByteLength(i);switch(t){case AlphaFormat:return n*e;case RedFormat:return n*e/s.components*s.byteLength;case RedIntegerFormat:return n*e/s.components*s.byteLength;case RGFormat:return n*e*2/s.components*s.byteLength;case RGIntegerFormat:return n*e*2/s.components*s.byteLength;case RGBFormat:return n*e*3/s.components*s.byteLength;case RGBAFormat:return n*e*4/s.components*s.byteLength;case RGBAIntegerFormat:return n*e*4/s.components*s.byteLength;case RGB_S3TC_DXT1_Format:case RGBA_S3TC_DXT1_Format:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case RGBA_S3TC_DXT3_Format:case RGBA_S3TC_DXT5_Format:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case RGB_PVRTC_2BPPV1_Format:case RGBA_PVRTC_2BPPV1_Format:return Math.max(n,16)*Math.max(e,8)/4;case RGB_PVRTC_4BPPV1_Format:case RGBA_PVRTC_4BPPV1_Format:return Math.max(n,8)*Math.max(e,8)/2;case RGB_ETC1_Format:case RGB_ETC2_Format:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case RGBA_ETC2_EAC_Format:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case RGBA_ASTC_4x4_Format:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case RGBA_ASTC_5x4_Format:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case RGBA_ASTC_5x5_Format:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case RGBA_ASTC_6x5_Format:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case RGBA_ASTC_6x6_Format:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case RGBA_ASTC_8x5_Format:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case RGBA_ASTC_8x6_Format:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case RGBA_ASTC_8x8_Format:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case RGBA_ASTC_10x5_Format:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case RGBA_ASTC_10x6_Format:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case RGBA_ASTC_10x8_Format:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case RGBA_ASTC_10x10_Format:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case RGBA_ASTC_12x10_Format:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case RGBA_ASTC_12x12_Format:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case RGBA_BPTC_Format:case RGB_BPTC_SIGNED_Format:case RGB_BPTC_UNSIGNED_Format:return Math.ceil(n/4)*Math.ceil(e/4)*16;case RED_RGTC1_Format:case SIGNED_RED_RGTC1_Format:return Math.ceil(n/4)*Math.ceil(e/4)*8;case RED_GREEN_RGTC2_Format:case SIGNED_RED_GREEN_RGTC2_Format:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function getTextureTypeByteLength(n){switch(n){case UnsignedByteType:case ByteType:return{byteLength:1,components:1};case UnsignedShortType:case ShortType:case HalfFloatType:return{byteLength:2,components:1};case UnsignedShort4444Type:case UnsignedShort5551Type:return{byteLength:2,components:4};case UnsignedIntType:case IntType:case FloatType$1:return{byteLength:4,components:1};case UnsignedInt5999Type:case UnsignedInt101111Type:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);const version="9.0.0",pkg={version},serialDevices=[{vendorId:1027,productId:24577,name:"FT232R"},{vendorId:1155,productId:12886,name:"STM32 HID"},{vendorId:1155,productId:14158,name:"STM Nucleo"},{vendorId:1155,productId:22336,name:"STM VCP"},{vendorId:4292,productId:6e4,name:"CP210x"},{vendorId:4292,productId:60001,name:"CP210x"},{vendorId:4292,productId:60002,name:"CP210x"},{vendorId:11836,productId:22336,name:"AT32 VCP"}],webSerialDevices=serialDevices.map(({vendorId:n,productId:e})=>({usbVendorId:n,usbProductId:e}));async function*streamAsyncIterable(n,e){try{for(;e();)try{const{done:t,value:i}=await n.read();if(t)return;yield i}catch(t){console.warn("WebSerial Read error in streamAsyncIterable:",t);break}}finally{try{n?.locked&&n.releaseLock()}catch(t){console.warn(`${logHead} Error releasing reader lock:`,t)}}}const webSerial={events:new EventTarget,currentPort:null,ports:[],isConnected:!1,reader:null,writer:null,isReading:!1,id:1,connect:function(n,e){return new Promise(async t=>{if(this.isConnected){t({error:!0,errorMsg:"Already connected"});return}const i=this.ports.find(s=>s.device.name==n);if(!i){t({error:!0,errorMsg:`Unable to find port ${n}`});return}try{this.currentPort=i.port,await this.currentPort.open({baudRate:e.bitrate}),this.writer=this.currentPort.writable.getWriter(),this.reader=this.currentPort.readable.getReader(),this.currentPort.addEventListener("disconnect",this.onDisconnect),this.isReading=!0,this.isConnected=!0,this.readLoop(),t({error:!1,id:this.id++})}catch(s){t({error:!0,errorMsg:s})}})},onDisconnect:function(){this.close().then(()=>{this.events.dispatchEvent(new CustomEvent("close"))})},close:function(){return new Promise(async n=>{if(!this.isConnected){n({error:!1});return}if(this.isReading=!1,await new Promise(e=>setTimeout(e,50)),this.reader){try{await this.reader.cancel()}catch(e){console.warn(`Reader cancel error (can be ignored): ${e}`)}this.reader=null}if(this.writer){try{this.writer.releaseLock()}catch(e){console.warn(`Writer release error (can be ignored): ${e}`)}this.writer=null}if(this.currentPort){this.currentPort.removeEventListener("disconnect",this.onDisconnect);try{await this.currentPort.close()}catch(e){n({error:!0,msg:e.message})}this.currentPort=null}this.isConnected=!1,n({error:!1})})},send:function(n){return new Promise(async e=>{(!this.isConnected||!this.writer)&&e({error:!0,msg:"Port closed or inavlid state."});try{await this.writer.write(n),e({error:!1,bytesWritten:n.byteLength})}catch(t){e({error:!0,msg:`Serial write error: ${t}`})}})},readLoop:async function(){try{for await(let n of streamAsyncIterable(this.reader,()=>this.isReading))this.events.dispatchEvent(new CustomEvent("data",{detail:n}))}catch(n){this.events.dispatchEvent(new CustomEvent("error",{detail:n.message}))}},requestPermission:async function(){try{await navigator.serial.requestPort({filter:webSerialDevices})}catch(n){console.log(`User aborted serial port selction ${n.message}`)}},getDevices:async function(){try{const n=await navigator.serial.getPorts();return this.ports=[],n.map(e=>{const t=e.getInfo(),i=serialDevices.find(s=>s.productId==t.usbProductId&&s.vendorId==t.usbVendorId);return this.ports.push({device:i,port:e}),i.name})}catch(n){console.log(`Unable to list serial ports: ${n.message}`)}}},NodeShaderStage={VERTEX:"vertex"},NodeUpdateType={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},vectorComponents=["x","y","z","w"],_lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(_lut[n&255]+_lut[n>>8&255]+_lut[n>>16&255]+_lut[n>>24&255]+"-"+_lut[e&255]+_lut[e>>8&255]+"-"+_lut[e>>16&15|64]+_lut[e>>24&255]+"-"+_lut[t&63|128]+_lut[t>>8&255]+"-"+_lut[t>>16&255]+_lut[t>>24&255]+_lut[i&255]+_lut[i>>8&255]+_lut[i>>16&255]+_lut[i>>24&255]).toLowerCase()}function clamp$2(n,e,t){return Math.max(e,Math.min(t,n))}function euclideanModulo(n,e){return(n%e+e)%e}function mapLinear(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)}function inverseLerp(n,e,t){return n!==e?(t-n)/(e-n):0}function lerp$1(n,e,t){return(1-t)*n+t*e}function damp(n,e,t,i){return lerp$1(n,e,1-Math.exp(-t*i))}function pingpong(n,e=1){return e-Math.abs(euclideanModulo(n,e*2)-e)}function smoothstep$1(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function smootherstep(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function randInt(n,e){return n+Math.floor(Math.random()*(e-n+1))}function randFloat(n,e){return n+Math.random()*(e-n)}function randFloatSpread(n){return n*(.5-Math.random())}function seededRandom(n){n!==void 0&&(_seed=n);let e=_seed+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function degToRad(n){return n*DEG2RAD}function radToDeg(n){return n*RAD2DEG}function isPowerOfTwo(n){return(n&n-1)===0&&n!==0}function ceilPowerOfTwo(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function floorPowerOfTwo(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function setQuaternionFromProperEuler(n,e,t,i,s){const r=Math.cos,o=Math.sin,a=r(t/2),h=o(t/2),c=r((e+i)/2),d=o((e+i)/2),f=r((e-i)/2),_=o((e-i)/2),y=r((i-e)/2),S=o((i-e)/2);switch(s){case"XYX":n.set(a*d,h*f,h*_,a*c);break;case"YZY":n.set(h*_,a*d,h*f,a*c);break;case"ZXZ":n.set(h*f,h*_,a*d,a*c);break;case"XZX":n.set(a*d,h*S,h*y,a*c);break;case"YXY":n.set(h*y,a*d,h*S,a*c);break;case"ZYZ":n.set(h*S,h*y,a*d,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function denormalize(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function normalize$1(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD,RAD2DEG,generateUUID,clamp:clamp$2,euclideanModulo,mapLinear,inverseLerp,lerp:lerp$1,damp,pingpong,smoothstep:smoothstep$1,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize:normalize$1,denormalize},NoToneMapping=0,FloatType=1015,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",LinearTransfer="linear",SRGBTransfer="srgb",StaticDrawUsage=35044,WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;class Matrix3{constructor(e,t,i,s,r,o,a,h,c){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,o,a,h,c)}set(e,t,i,s,r,o,a,h,c){const d=this.elements;return d[0]=e,d[1]=s,d[2]=a,d[3]=t,d[4]=r,d[5]=h,d[6]=i,d[7]=o,d[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[3],h=i[6],c=i[1],d=i[4],f=i[7],_=i[2],y=i[5],S=i[8],v=s[0],I=s[3],A=s[6],B=s[1],G=s[4],k=s[7],z=s[2],q=s[5],T=s[8];return r[0]=o*v+a*B+h*z,r[3]=o*I+a*G+h*q,r[6]=o*A+a*k+h*T,r[1]=c*v+d*B+f*z,r[4]=c*I+d*G+f*q,r[7]=c*A+d*k+f*T,r[2]=_*v+y*B+S*z,r[5]=_*I+y*G+S*q,r[8]=_*A+y*k+S*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],c=e[7],d=e[8];return t*o*d-t*a*c-i*r*d+i*a*h+s*r*c-s*o*h}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],c=e[7],d=e[8],f=d*o-a*c,_=a*h-d*r,y=c*r-o*h,S=t*f+i*_+s*y;if(S===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/S;return e[0]=f*v,e[1]=(s*c-d*i)*v,e[2]=(a*i-s*o)*v,e[3]=_*v,e[4]=(d*t-s*h)*v,e[5]=(s*r-a*t)*v,e[6]=y*v,e[7]=(i*h-c*t)*v,e[8]=(o*t-i*r)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,r,o,a){const h=Math.cos(r),c=Math.sin(r);return this.set(i*h,i*c,-i*(h*o+c*a)+o+e,-s*c,s*h,-s*(-c*o+h*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(_m3.makeScale(e,t)),this}rotate(e){return this.premultiply(_m3.makeRotation(-e)),this}translate(e,t){return this.premultiply(_m3.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3,_cache={};function warnOnce(n){n in _cache||(_cache[n]=!0,console.warn(n))}const LINEAR_REC709_TO_XYZ=new Matrix3().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),XYZ_TO_LINEAR_REC709=new Matrix3().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function createColorManagement(){const n={enabled:!0,workingColorSpace:LinearSRGBColorSpace,spaces:{},convert:function(s,r,o){return this.enabled===!1||r===o||!r||!o||(this.spaces[r].transfer===SRGBTransfer&&(s.r=SRGBToLinear(s.r),s.g=SRGBToLinear(s.g),s.b=SRGBToLinear(s.b)),this.spaces[r].primaries!==this.spaces[o].primaries&&(s.applyMatrix3(this.spaces[r].toXYZ),s.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===SRGBTransfer&&(s.r=LinearToSRGB(s.r),s.g=LinearToSRGB(s.g),s.b=LinearToSRGB(s.b))),s},workingToColorSpace:function(s,r){return this.convert(s,this.workingColorSpace,r)},colorSpaceToWorking:function(s,r){return this.convert(s,r,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===NoColorSpace?LinearTransfer:this.spaces[s].transfer},getToneMappingMode:function(s){return this.spaces[s].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(s,r=this.workingColorSpace){return s.fromArray(this.spaces[r].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,r,o){return s.copy(this.spaces[r].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(s,r){return warnOnce("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(s,r)},toWorkingColorSpace:function(s,r){return warnOnce("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(s,r)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[LinearSRGBColorSpace]:{primaries:e,whitePoint:i,transfer:LinearTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:SRGBColorSpace},outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}},[SRGBColorSpace]:{primaries:e,whitePoint:i,transfer:SRGBTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}}}),n}const ColorManagement=createColorManagement();function SRGBToLinear(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function LinearToSRGB(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class Color{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=SRGBColorSpace){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ColorManagement.colorSpaceToWorking(this,t),this}setRGB(e,t,i,s=ColorManagement.workingColorSpace){return this.r=e,this.g=t,this.b=i,ColorManagement.colorSpaceToWorking(this,s),this}setHSL(e,t,i,s=ColorManagement.workingColorSpace){if(e=euclideanModulo(e,1),t=clamp$2(t,0,1),i=clamp$2(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=hue2rgb(o,r,e+1/3),this.g=hue2rgb(o,r,e),this.b=hue2rgb(o,r,e-1/3)}return ColorManagement.colorSpaceToWorking(this,s),this}setStyle(e,t=SRGBColorSpace){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=SRGBColorSpace){const i=_colorKeywords[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this}copyLinearToSRGB(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=SRGBColorSpace){return ColorManagement.workingToColorSpace(_color.copy(this),e),Math.round(clamp$2(_color.r*255,0,255))*65536+Math.round(clamp$2(_color.g*255,0,255))*256+Math.round(clamp$2(_color.b*255,0,255))}getHexString(e=SRGBColorSpace){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ColorManagement.workingColorSpace){ColorManagement.workingToColorSpace(_color.copy(this),t);const i=_color.r,s=_color.g,r=_color.b,o=Math.max(i,s,r),a=Math.min(i,s,r);let h,c;const d=(a+o)/2;if(a===o)h=0,c=0;else{const f=o-a;switch(c=d<=.5?f/(o+a):f/(2-o-a),o){case i:h=(s-r)/f+(s<r?6:0);break;case s:h=(r-i)/f+2;break;case r:h=(i-s)/f+4;break}h/=6}return e.h=h,e.s=c,e.l=d,e}getRGB(e,t=ColorManagement.workingColorSpace){return ColorManagement.workingToColorSpace(_color.copy(this),t),e.r=_color.r,e.g=_color.g,e.b=_color.b,e}getStyle(e=SRGBColorSpace){ColorManagement.workingToColorSpace(_color.copy(this),e);const t=_color.r,i=_color.g,s=_color.b;return e!==SRGBColorSpace?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(e,t,i){return this.getHSL(_hslA),this.setHSL(_hslA.h+e,_hslA.s+t,_hslA.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(_hslA),e.getHSL(_hslB);const i=lerp$1(_hslA.h,_hslB.h,t),s=lerp$1(_hslA.s,_hslB.s,t),r=lerp$1(_hslA.l,_hslB.l,t);return this.setHSL(i,s,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,s=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*s,this.g=r[1]*t+r[4]*i+r[7]*s,this.b=r[2]*t+r[5]*i+r[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color=new Color;Color.NAMES=_colorKeywords;class Matrix2{constructor(e,t,i,s){Matrix2.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,i,s)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let i=0;i<4;i++)this.elements[i]=e[i+t];return this}set(e,t,i,s){const r=this.elements;return r[0]=e,r[2]=t,r[1]=i,r[3]=s,this}}class Quaternion{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,r,o,a){let h=i[s+0],c=i[s+1],d=i[s+2],f=i[s+3];const _=r[o+0],y=r[o+1],S=r[o+2],v=r[o+3];if(a===0){e[t+0]=h,e[t+1]=c,e[t+2]=d,e[t+3]=f;return}if(a===1){e[t+0]=_,e[t+1]=y,e[t+2]=S,e[t+3]=v;return}if(f!==v||h!==_||c!==y||d!==S){let I=1-a;const A=h*_+c*y+d*S+f*v,B=A>=0?1:-1,G=1-A*A;if(G>Number.EPSILON){const z=Math.sqrt(G),q=Math.atan2(z,A*B);I=Math.sin(I*q)/z,a=Math.sin(a*q)/z}const k=a*B;if(h=h*I+_*k,c=c*I+y*k,d=d*I+S*k,f=f*I+v*k,I===1-a){const z=1/Math.sqrt(h*h+c*c+d*d+f*f);h*=z,c*=z,d*=z,f*=z}}e[t]=h,e[t+1]=c,e[t+2]=d,e[t+3]=f}static multiplyQuaternionsFlat(e,t,i,s,r,o){const a=i[s],h=i[s+1],c=i[s+2],d=i[s+3],f=r[o],_=r[o+1],y=r[o+2],S=r[o+3];return e[t]=a*S+d*f+h*y-c*_,e[t+1]=h*S+d*_+c*f-a*y,e[t+2]=c*S+d*y+a*_-h*f,e[t+3]=d*S-a*f-h*_-c*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,s=e._y,r=e._z,o=e._order,a=Math.cos,h=Math.sin,c=a(i/2),d=a(s/2),f=a(r/2),_=h(i/2),y=h(s/2),S=h(r/2);switch(o){case"XYZ":this._x=_*d*f+c*y*S,this._y=c*y*f-_*d*S,this._z=c*d*S+_*y*f,this._w=c*d*f-_*y*S;break;case"YXZ":this._x=_*d*f+c*y*S,this._y=c*y*f-_*d*S,this._z=c*d*S-_*y*f,this._w=c*d*f+_*y*S;break;case"ZXY":this._x=_*d*f-c*y*S,this._y=c*y*f+_*d*S,this._z=c*d*S+_*y*f,this._w=c*d*f-_*y*S;break;case"ZYX":this._x=_*d*f-c*y*S,this._y=c*y*f+_*d*S,this._z=c*d*S-_*y*f,this._w=c*d*f+_*y*S;break;case"YZX":this._x=_*d*f+c*y*S,this._y=c*y*f+_*d*S,this._z=c*d*S-_*y*f,this._w=c*d*f-_*y*S;break;case"XZY":this._x=_*d*f-c*y*S,this._y=c*y*f-_*d*S,this._z=c*d*S+_*y*f,this._w=c*d*f+_*y*S;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],r=t[8],o=t[1],a=t[5],h=t[9],c=t[2],d=t[6],f=t[10],_=i+a+f;if(_>0){const y=.5/Math.sqrt(_+1);this._w=.25/y,this._x=(d-h)*y,this._y=(r-c)*y,this._z=(o-s)*y}else if(i>a&&i>f){const y=2*Math.sqrt(1+i-a-f);this._w=(d-h)/y,this._x=.25*y,this._y=(s+o)/y,this._z=(r+c)/y}else if(a>f){const y=2*Math.sqrt(1+a-i-f);this._w=(r-c)/y,this._x=(s+o)/y,this._y=.25*y,this._z=(h+d)/y}else{const y=2*Math.sqrt(1+f-i-a);this._w=(o-s)/y,this._x=(r+c)/y,this._y=(h+d)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<1e-8?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(clamp$2(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,r=e._z,o=e._w,a=t._x,h=t._y,c=t._z,d=t._w;return this._x=i*d+o*a+s*c-r*h,this._y=s*d+o*h+r*a-i*c,this._z=r*d+o*c+i*h-s*a,this._w=o*d-i*a-s*h-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,s=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+s*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const h=1-a*a;if(h<=Number.EPSILON){const y=1-t;return this._w=y*o+t*this._w,this._x=y*i+t*this._x,this._y=y*s+t*this._y,this._z=y*r+t*this._z,this.normalize(),this}const c=Math.sqrt(h),d=Math.atan2(c,a),f=Math.sin((1-t)*d)/c,_=Math.sin(t*d)/c;return this._w=o*f+this._w*_,this._x=i*f+this._x*_,this._y=s*f+this._y*_,this._z=r*f+this._z*_,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(s*Math.sin(e),s*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Vector3{constructor(e=0,t=0,i=0){Vector3.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(_quaternion.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_quaternion.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*s,this.y=r[1]*t+r[4]*i+r[7]*s,this.z=r[2]*t+r[5]*i+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*s+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*s+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*s+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,r=e.x,o=e.y,a=e.z,h=e.w,c=2*(o*s-a*i),d=2*(a*t-r*s),f=2*(r*i-o*t);return this.x=t+h*c+o*f-a*d,this.y=i+h*d+a*c-r*f,this.z=s+h*f+r*d-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*s,this.y=r[1]*t+r[5]*i+r[9]*s,this.z=r[2]*t+r[6]*i+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=clamp$2(this.x,e.x,t.x),this.y=clamp$2(this.y,e.y,t.y),this.z=clamp$2(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=clamp$2(this.x,e,t),this.y=clamp$2(this.y,e,t),this.z=clamp$2(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(clamp$2(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,r=e.z,o=t.x,a=t.y,h=t.z;return this.x=s*h-r*a,this.y=r*o-i*h,this.z=i*a-s*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return _vector$2.copy(this).projectOnVector(e),this.sub(_vector$2)}reflect(e){return this.sub(_vector$2.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(clamp$2(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$2=new Vector3,_quaternion=new Quaternion;class Matrix4{constructor(e,t,i,s,r,o,a,h,c,d,f,_,y,S,v,I){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,o,a,h,c,d,f,_,y,S,v,I)}set(e,t,i,s,r,o,a,h,c,d,f,_,y,S,v,I){const A=this.elements;return A[0]=e,A[4]=t,A[8]=i,A[12]=s,A[1]=r,A[5]=o,A[9]=a,A[13]=h,A[2]=c,A[6]=d,A[10]=f,A[14]=_,A[3]=y,A[7]=S,A[11]=v,A[15]=I,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/_v1.setFromMatrixColumn(e,0).length(),r=1/_v1.setFromMatrixColumn(e,1).length(),o=1/_v1.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,s=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),h=Math.cos(s),c=Math.sin(s),d=Math.cos(r),f=Math.sin(r);if(e.order==="XYZ"){const _=o*d,y=o*f,S=a*d,v=a*f;t[0]=h*d,t[4]=-h*f,t[8]=c,t[1]=y+S*c,t[5]=_-v*c,t[9]=-a*h,t[2]=v-_*c,t[6]=S+y*c,t[10]=o*h}else if(e.order==="YXZ"){const _=h*d,y=h*f,S=c*d,v=c*f;t[0]=_+v*a,t[4]=S*a-y,t[8]=o*c,t[1]=o*f,t[5]=o*d,t[9]=-a,t[2]=y*a-S,t[6]=v+_*a,t[10]=o*h}else if(e.order==="ZXY"){const _=h*d,y=h*f,S=c*d,v=c*f;t[0]=_-v*a,t[4]=-o*f,t[8]=S+y*a,t[1]=y+S*a,t[5]=o*d,t[9]=v-_*a,t[2]=-o*c,t[6]=a,t[10]=o*h}else if(e.order==="ZYX"){const _=o*d,y=o*f,S=a*d,v=a*f;t[0]=h*d,t[4]=S*c-y,t[8]=_*c+v,t[1]=h*f,t[5]=v*c+_,t[9]=y*c-S,t[2]=-c,t[6]=a*h,t[10]=o*h}else if(e.order==="YZX"){const _=o*h,y=o*c,S=a*h,v=a*c;t[0]=h*d,t[4]=v-_*f,t[8]=S*f+y,t[1]=f,t[5]=o*d,t[9]=-a*d,t[2]=-c*d,t[6]=y*f+S,t[10]=_-v*f}else if(e.order==="XZY"){const _=o*h,y=o*c,S=a*h,v=a*c;t[0]=h*d,t[4]=-f,t[8]=c*d,t[1]=_*f+v,t[5]=o*d,t[9]=y*f-S,t[2]=S*f-y,t[6]=a*d,t[10]=v*f+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_zero,e,_one)}lookAt(e,t,i){const s=this.elements;return _z.subVectors(e,t),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(i,_z),_x.lengthSq()===0&&(Math.abs(i.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(i,_z)),_x.normalize(),_y.crossVectors(_z,_x),s[0]=_x.x,s[4]=_y.x,s[8]=_z.x,s[1]=_x.y,s[5]=_y.y,s[9]=_z.y,s[2]=_x.z,s[6]=_y.z,s[10]=_z.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[4],h=i[8],c=i[12],d=i[1],f=i[5],_=i[9],y=i[13],S=i[2],v=i[6],I=i[10],A=i[14],B=i[3],G=i[7],k=i[11],z=i[15],q=s[0],T=s[4],j=s[8],te=s[12],Se=s[1],be=s[5],Te=s[9],pe=s[13],ie=s[2],he=s[6],ge=s[10],ue=s[14],de=s[3],se=s[7],l=s[11],u=s[15];return r[0]=o*q+a*Se+h*ie+c*de,r[4]=o*T+a*be+h*he+c*se,r[8]=o*j+a*Te+h*ge+c*l,r[12]=o*te+a*pe+h*ue+c*u,r[1]=d*q+f*Se+_*ie+y*de,r[5]=d*T+f*be+_*he+y*se,r[9]=d*j+f*Te+_*ge+y*l,r[13]=d*te+f*pe+_*ue+y*u,r[2]=S*q+v*Se+I*ie+A*de,r[6]=S*T+v*be+I*he+A*se,r[10]=S*j+v*Te+I*ge+A*l,r[14]=S*te+v*pe+I*ue+A*u,r[3]=B*q+G*Se+k*ie+z*de,r[7]=B*T+G*be+k*he+z*se,r[11]=B*j+G*Te+k*ge+z*l,r[15]=B*te+G*pe+k*ue+z*u,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],r=e[12],o=e[1],a=e[5],h=e[9],c=e[13],d=e[2],f=e[6],_=e[10],y=e[14],S=e[3],v=e[7],I=e[11],A=e[15];return S*(+r*h*f-s*c*f-r*a*_+i*c*_+s*a*y-i*h*y)+v*(+t*h*y-t*c*_+r*o*_-s*o*y+s*c*d-r*h*d)+I*(+t*c*f-t*a*y-r*o*f+i*o*y+r*a*d-i*c*d)+A*(-s*a*d-t*h*f+t*a*_+s*o*f-i*o*_+i*h*d)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],c=e[7],d=e[8],f=e[9],_=e[10],y=e[11],S=e[12],v=e[13],I=e[14],A=e[15],B=f*I*c-v*_*c+v*h*y-a*I*y-f*h*A+a*_*A,G=S*_*c-d*I*c-S*h*y+o*I*y+d*h*A-o*_*A,k=d*v*c-S*f*c+S*a*y-o*v*y-d*a*A+o*f*A,z=S*f*h-d*v*h-S*a*_+o*v*_+d*a*I-o*f*I,q=t*B+i*G+s*k+r*z;if(q===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/q;return e[0]=B*T,e[1]=(v*_*r-f*I*r-v*s*y+i*I*y+f*s*A-i*_*A)*T,e[2]=(a*I*r-v*h*r+v*s*c-i*I*c-a*s*A+i*h*A)*T,e[3]=(f*h*r-a*_*r-f*s*c+i*_*c+a*s*y-i*h*y)*T,e[4]=G*T,e[5]=(d*I*r-S*_*r+S*s*y-t*I*y-d*s*A+t*_*A)*T,e[6]=(S*h*r-o*I*r-S*s*c+t*I*c+o*s*A-t*h*A)*T,e[7]=(o*_*r-d*h*r+d*s*c-t*_*c-o*s*y+t*h*y)*T,e[8]=k*T,e[9]=(S*f*r-d*v*r-S*i*y+t*v*y+d*i*A-t*f*A)*T,e[10]=(o*v*r-S*a*r+S*i*c-t*v*c-o*i*A+t*a*A)*T,e[11]=(d*a*r-o*f*r-d*i*c+t*f*c+o*i*y-t*a*y)*T,e[12]=z*T,e[13]=(d*v*s-S*f*s+S*i*_-t*v*_-d*i*I+t*f*I)*T,e[14]=(S*a*s-o*v*s-S*i*h+t*v*h+o*i*I-t*a*I)*T,e[15]=(o*f*s-d*a*s+d*i*h-t*f*h-o*i*_+t*a*_)*T,this}scale(e){const t=this.elements,i=e.x,s=e.y,r=e.z;return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),r=1-i,o=e.x,a=e.y,h=e.z,c=r*o,d=r*a;return this.set(c*o+i,c*a-s*h,c*h+s*a,0,c*a+s*h,d*a+i,d*h-s*o,0,c*h-s*a,d*h+s*o,r*h*h+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,r,o){return this.set(1,i,r,0,e,1,o,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,r=t._x,o=t._y,a=t._z,h=t._w,c=r+r,d=o+o,f=a+a,_=r*c,y=r*d,S=r*f,v=o*d,I=o*f,A=a*f,B=h*c,G=h*d,k=h*f,z=i.x,q=i.y,T=i.z;return s[0]=(1-(v+A))*z,s[1]=(y+k)*z,s[2]=(S-G)*z,s[3]=0,s[4]=(y-k)*q,s[5]=(1-(_+A))*q,s[6]=(I+B)*q,s[7]=0,s[8]=(S+G)*T,s[9]=(I-B)*T,s[10]=(1-(_+v))*T,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let r=_v1.set(s[0],s[1],s[2]).length();const o=_v1.set(s[4],s[5],s[6]).length(),a=_v1.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],_m1.copy(this);const c=1/r,d=1/o,f=1/a;return _m1.elements[0]*=c,_m1.elements[1]*=c,_m1.elements[2]*=c,_m1.elements[4]*=d,_m1.elements[5]*=d,_m1.elements[6]*=d,_m1.elements[8]*=f,_m1.elements[9]*=f,_m1.elements[10]*=f,t.setFromRotationMatrix(_m1),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,s,r,o,a=WebGLCoordinateSystem,h=!1){const c=this.elements,d=2*r/(t-e),f=2*r/(i-s),_=(t+e)/(t-e),y=(i+s)/(i-s);let S,v;if(h)S=r/(o-r),v=o*r/(o-r);else if(a===WebGLCoordinateSystem)S=-(o+r)/(o-r),v=-2*o*r/(o-r);else if(a===WebGPUCoordinateSystem)S=-o/(o-r),v=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=d,c[4]=0,c[8]=_,c[12]=0,c[1]=0,c[5]=f,c[9]=y,c[13]=0,c[2]=0,c[6]=0,c[10]=S,c[14]=v,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,i,s,r,o,a=WebGLCoordinateSystem,h=!1){const c=this.elements,d=2/(t-e),f=2/(i-s),_=-(t+e)/(t-e),y=-(i+s)/(i-s);let S,v;if(h)S=1/(o-r),v=o/(o-r);else if(a===WebGLCoordinateSystem)S=-2/(o-r),v=-(o+r)/(o-r);else if(a===WebGPUCoordinateSystem)S=-1/(o-r),v=-r/(o-r);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=d,c[4]=0,c[8]=0,c[12]=_,c[1]=0,c[5]=f,c[9]=0,c[13]=y,c[2]=0,c[6]=0,c[10]=S,c[14]=v,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const _v1=new Vector3,_m1=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3;class Vector2{constructor(e=0,t=0){Vector2.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=clamp$2(this.x,e.x,t.x),this.y=clamp$2(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=clamp$2(this.x,e,t),this.y=clamp$2(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(clamp$2(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(clamp$2(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*s+e.x,this.y=r*s+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Vector4{constructor(e=0,t=0,i=0,s=1){Vector4.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*s+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*s+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*s+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*s+o[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,r;const h=e.elements,c=h[0],d=h[4],f=h[8],_=h[1],y=h[5],S=h[9],v=h[2],I=h[6],A=h[10];if(Math.abs(d-_)<.01&&Math.abs(f-v)<.01&&Math.abs(S-I)<.01){if(Math.abs(d+_)<.1&&Math.abs(f+v)<.1&&Math.abs(S+I)<.1&&Math.abs(c+y+A-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const G=(c+1)/2,k=(y+1)/2,z=(A+1)/2,q=(d+_)/4,T=(f+v)/4,j=(S+I)/4;return G>k&&G>z?G<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(G),s=q/i,r=T/i):k>z?k<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(k),i=q/s,r=j/s):z<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(z),i=T/r,s=j/r),this.set(i,s,r,t),this}let B=Math.sqrt((I-S)*(I-S)+(f-v)*(f-v)+(_-d)*(_-d));return Math.abs(B)<.001&&(B=1),this.x=(I-S)/B,this.y=(f-v)/B,this.z=(_-d)/B,this.w=Math.acos((c+y+A-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=clamp$2(this.x,e.x,t.x),this.y=clamp$2(this.y,e.y,t.y),this.z=clamp$2(this.z,e.z,t.z),this.w=clamp$2(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=clamp$2(this.x,e,t),this.y=clamp$2(this.y,e,t),this.z=clamp$2(this.z,e,t),this.w=clamp$2(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(clamp$2(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}function cyrb53(n,e=0){let t=3735928559^e,i=1103547991^e;if(n instanceof Array)for(let s=0,r;s<n.length;s++)r=n[s],t=Math.imul(t^r,2654435761),i=Math.imul(i^r,1597334677);else for(let s=0,r;s<n.length;s++)r=n.charCodeAt(s),t=Math.imul(t^r,2654435761),i=Math.imul(i^r,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&i)+(t>>>0)}const hash$1=(...n)=>cyrb53(n);function getCacheKey$2(n,e=!1){const t=[];n.isNode===!0&&t.push(n.id);for(const{property:i,childNode:s}of getNodeChildren(n))t.push(cyrb53(i.slice(0,-4)),s.getCacheKey(e));return cyrb53(t)}function*getNodeChildren(n,e=!1){for(const t of Object.getOwnPropertyNames(n)){if(t.startsWith("_")===!0)continue;const i=n[t];if(Array.isArray(i)===!0)for(let s=0;s<i.length;s++){const r=i[s];r&&(r.isNode===!0||e&&typeof r.toJSON=="function")&&(yield{property:t,index:s,childNode:r})}else if(i&&i.isNode===!0)yield{property:t,childNode:i};else if(i&&Object.getPrototypeOf(i)===Object.prototype)for(const s in i){if(s.startsWith("_")===!0)continue;const r=i[s];r&&(r.isNode===!0||e&&typeof r.toJSON=="function")&&(yield{property:t,index:s,childNode:r})}}}function getValueType(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix2===!0?"mat2":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function getValueFromType(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new Color(...e):t==="vec2"?new Vector2(...e):t==="vec3"?new Vector3(...e):t==="vec4"?new Vector4(...e):t==="mat2"?new Matrix2(...e):t==="mat3"?new Matrix3(...e):t==="mat4"?new Matrix4(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?base64ToArrayBuffer(e[0]):null}function arrayBufferToBase64(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function base64ToArrayBuffer(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}class EventDispatcher{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i===void 0?!1:i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners;if(i===void 0)return;const s=i[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const i=t[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}}const _parentBuildStage={analyze:"setup",generate:"analyze"};let _nodeId=0;class Node extends EventDispatcher{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=NodeUpdateType.NONE,this.updateBeforeType=NodeUpdateType.NONE,this.updateAfterType=NodeUpdateType.NONE,this.uuid=MathUtils.generateUUID(),this.version=0,this.global=!1,this.parents=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:_nodeId++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this),this}onFrameUpdate(e){return this.onUpdate(e,NodeUpdateType.FRAME)}onRenderUpdate(e){return this.onUpdate(e,NodeUpdateType.RENDER)}onObjectUpdate(e){return this.onUpdate(e,NodeUpdateType.OBJECT)}onReference(e){return this.updateReference=e.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of getNodeChildren(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=hash$1(getCacheKey$2(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}getArrayCount(){return null}setup(e){const t=e.getNodeProperties(this);let i=0;for(const s of this.getChildren())t["node"+i++]=s;return t.outputNode||null}analyze(e,t=null){const i=e.increaseUsage(this);if(this.parents===!0){const s=e.getDataFromNode(this,"any");s.stages=s.stages||{},s.stages[e.shaderStage]=s.stages[e.shaderStage]||[],s.stages[e.shaderStage].push(t)}if(i===1){const s=e.getNodeProperties(this);for(const r of Object.values(s))r&&r.isNode===!0&&r.build(e,this)}}generate(e,t){const{outputNode:i}=e.getNodeProperties(this);if(i&&i.isNode===!0)return i.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const i=this.getShared(e);if(this!==i)return i.build(e,t);const s=e.getDataFromNode(this);s.buildStages=s.buildStages||{},s.buildStages[e.buildStage]=!0;const r=_parentBuildStage[e.buildStage];if(r&&s.buildStages[r]!==!0){const h=e.getBuildStage();e.setBuildStage(r),this.build(e),e.setBuildStage(h)}e.addNode(this),e.addChain(this);let o=null;const a=e.getBuildStage();if(a==="setup"){this.updateReference(e);const h=e.getNodeProperties(this);if(h.initialized!==!0){h.initialized=!0,h.outputNode=this.setup(e)||h.outputNode||null;for(const c of Object.values(h))if(c&&c.isNode===!0){if(c.parents===!0){const d=e.getNodeProperties(c);d.parents=d.parents||[],d.parents.push(this)}c.build(e)}}o=h.outputNode}else if(a==="analyze")this.analyze(e,t);else if(a==="generate"){if(this.generate.length===1){const c=this.getNodeType(e),d=e.getDataFromNode(this);o=d.snippet,o===void 0?d.generated===void 0?(d.generated=!0,o=this.generate(e)||"",d.snippet=o):(console.warn("THREE.Node: Recursion detected.",this),o="/* Recursion detected. */"):d.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),o=e.format(o,c,t)}else o=this.generate(e,t)||"";o===""&&t!==null&&t!=="void"&&t!=="OutputType"&&(console.error(`THREE.TSL: Invalid generated code, expected a "${t}".`),o=e.generateConst(t))}return e.removeChain(this),e.addSequentialNode(this),o}getSerializeChildren(){return getNodeChildren(this)}serialize(e){const t=this.getSerializeChildren(),i={};for(const{property:s,index:r,childNode:o}of t)r!==void 0?(i[s]===void 0&&(i[s]=Number.isInteger(r)?[]:{}),i[s][r]=o.toJSON(e.meta).uuid):i[s]=o.toJSON(e.meta).uuid;Object.keys(i).length>0&&(e.inputNodes=i)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const i in e.inputNodes)if(Array.isArray(e.inputNodes[i])){const s=[];for(const r of e.inputNodes[i])s.push(t[r]);this[i]=s}else if(typeof e.inputNodes[i]=="object"){const s={};for(const r in e.inputNodes[i]){const o=e.inputNodes[i][r];s[r]=t[o]}this[i]=s}else{const s=e.inputNodes[i];this[i]=t[s]}}}toJSON(e){const{uuid:t,type:i}=this,s=e===void 0||typeof e=="string";s&&(e={textures:{},images:{},nodes:{}});let r=e.nodes[t];r===void 0&&(r={uuid:t,type:i,meta:e,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},s!==!0&&(e.nodes[r.uuid]=r),this.serialize(r),delete r.meta);function o(a){const h=[];for(const c in a){const d=a[c];delete d.metadata,h.push(d)}return h}if(s){const a=o(e.textures),h=o(e.images),c=o(e.nodes);a.length>0&&(r.textures=a),h.length>0&&(r.images=h),c.length>0&&(r.nodes=c)}return r}}class ArrayElementNode extends Node{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),i=this.node.build(e),s=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${i}[ ${s} ]`}}class ConvertNode extends Node{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let i=null;for(const s of this.convertTo.split("|"))(i===null||e.getTypeLength(t)===e.getTypeLength(s))&&(i=s);return i}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const i=this.node,s=this.getNodeType(e),r=i.build(e,s);return e.format(r,s,t)}}class TempNode extends Node{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const s=e.getVectorType(this.getNodeType(e,t)),r=e.getDataFromNode(this);if(r.propertyName!==void 0)return e.format(r.propertyName,s,t);if(s!=="void"&&t!=="void"&&this.hasDependencies(e)){const o=super.build(e,s),a=e.getVarFromNode(this,null,s),h=e.getPropertyName(a);return e.addLineFlowCode(`${h} = ${o}`,this),r.snippet=o,r.propertyName=h,e.format(r.propertyName,s,t)}}return super.build(e,t)}}class JoinNode extends TempNode{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,i)=>t+e.getTypeLength(i.getNodeType(e)),0))}generate(e,t){const i=this.getNodeType(e),s=e.getTypeLength(i),r=this.nodes,o=e.getComponentType(i),a=[];let h=0;for(const d of r){if(h>=s){console.error(`THREE.TSL: Length of parameters exceeds maximum length of function '${i}()' type.`);break}let f=d.getNodeType(e),_=e.getTypeLength(f),y;if(h+_>s&&(console.error(`THREE.TSL: Length of '${i}()' data exceeds maximum length of output type.`),_=s-h,f=e.getTypeFromLength(_)),h+=_,y=d.build(e,f),e.getComponentType(f)!==o){const v=e.getTypeFromLength(_,o);y=e.format(y,f,v)}a.push(y)}const c=`${e.getType(i)}( ${a.join(", ")} )`;return e.format(c,i,t)}}const _stringVectorComponents=vectorComponents.join("");class SplitNode extends Node{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(vectorComponents.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}getScope(){return this.node.getScope()}generate(e,t){const i=this.node,s=e.getTypeLength(i.getNodeType(e));let r=null;if(s>1){let o=null;this.getVectorLength()>=s&&(o=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const h=i.build(e,o);this.components.length===s&&this.components===_stringVectorComponents.slice(0,this.components.length)?r=e.format(h,o,t):r=e.format(`${h}.${this.components}`,this.getNodeType(e),t)}else r=i.build(e,t);return r}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class SetNode extends TempNode{static get type(){return"SetNode"}constructor(e,t,i){super(),this.sourceNode=e,this.components=t,this.targetNode=i}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:i,targetNode:s}=this,r=this.getNodeType(e),o=e.getComponentType(s.getNodeType(e)),a=e.getTypeFromLength(i.length,o),h=s.build(e,a),c=t.build(e,r),d=e.getTypeLength(r),f=[];for(let _=0;_<d;_++){const y=vectorComponents[_];y===i[0]?(f.push(h),_+=i.length-1):f.push(c+"."+y)}return`${e.getType(r)}( ${f.join(", ")} )`}}class FlipNode extends TempNode{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:i}=this,s=this.getNodeType(e),r=i.build(e),o=e.getVarFromNode(this),a=e.getPropertyName(o);e.addLineFlowCode(a+" = "+r,this);const h=e.getTypeLength(s),c=[];let d=0;for(let f=0;f<h;f++){const _=vectorComponents[f];_===t[d]?(c.push("1.0 - "+(a+"."+_)),d++):c.push(a+"."+_)}return`${e.getType(s)}( ${c.join(", ")} )`}}class InputNode extends Node{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?getValueType(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=getValueType(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=arrayBufferToBase64(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?getValueFromType(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}const _regNum=/float|u?int/;class ConstNode extends InputNode{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const i=this.getNodeType(e);return _regNum.test(i)&&_regNum.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),i,t)}}class MemberNode extends Node{static get type(){return"MemberNode"}constructor(e,t){super(),this.structNode=e,this.property=t,this.isMemberNode=!0}hasMember(e){return this.structNode.isMemberNode&&this.structNode.hasMember(e)===!1?!1:this.structNode.getMemberType(e,this.property)!=="void"}getNodeType(e){return this.hasMember(e)===!1?"float":this.structNode.getMemberType(e,this.property)}getMemberType(e,t){if(this.hasMember(e)===!1)return"float";const i=this.getNodeType(e);return e.getStructTypeNode(i).getMemberType(e,t)}generate(e){if(this.hasMember(e)===!1){console.warn(`THREE.TSL: Member "${this.property}" does not exist in struct.`);const i=this.getNodeType(e);return e.generateConst(i)}return this.structNode.build(e)+"."+this.property}}const NodeElements=new Map;function addMethodChaining(n,e){if(NodeElements.has(n)){console.warn(`THREE.TSL: Redefinition of method chaining '${n}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${n} is not a function`);NodeElements.set(n,e),n!=="assign"&&(Node.prototype[n]=function(...t){return this.isStackNode?this.add(e(...t)):e(this,...t)},Node.prototype[n+"Assign"]=function(...t){return this.isStackNode?this.assign(t[0],e(...t)):this.assign(e(this,...t))})}const parseSwizzle=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),parseSwizzleAndSort=n=>parseSwizzle(n).split("").sort().join("");Node.prototype.assign=function(...n){if(this.isStackNode!==!0)return console.error("THREE.TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const e=NodeElements.get("assign");return this.add(e(...n))}};Node.prototype.toVarIntent=function(){return this};Node.prototype.get=function(n){return new MemberNode(this,n)};const proto={};function setProtoSwizzle(n,e,t){proto[n]=proto[e]=proto[t]={get(){this._cache=this._cache||{};let o=this._cache[n];return o===void 0&&(o=new SplitNode(this,n),this._cache[n]=o),o},set(o){this[n].assign(nodeObject(o))}};const i=n.toUpperCase(),s=e.toUpperCase(),r=t.toUpperCase();Node.prototype["set"+i]=Node.prototype["set"+s]=Node.prototype["set"+r]=function(o){const a=parseSwizzleAndSort(n);return new SetNode(this,a,nodeObject(o))},Node.prototype["flip"+i]=Node.prototype["flip"+s]=Node.prototype["flip"+r]=function(){const o=parseSwizzleAndSort(n);return new FlipNode(this,o)}}const swizzleA=["x","y","z","w"],swizzleB=["r","g","b","a"],swizzleC=["s","t","p","q"];for(let n=0;n<4;n++){let e=swizzleA[n],t=swizzleB[n],i=swizzleC[n];setProtoSwizzle(e,t,i);for(let s=0;s<4;s++){e=swizzleA[n]+swizzleA[s],t=swizzleB[n]+swizzleB[s],i=swizzleC[n]+swizzleC[s],setProtoSwizzle(e,t,i);for(let r=0;r<4;r++){e=swizzleA[n]+swizzleA[s]+swizzleA[r],t=swizzleB[n]+swizzleB[s]+swizzleB[r],i=swizzleC[n]+swizzleC[s]+swizzleC[r],setProtoSwizzle(e,t,i);for(let o=0;o<4;o++)e=swizzleA[n]+swizzleA[s]+swizzleA[r]+swizzleA[o],t=swizzleB[n]+swizzleB[s]+swizzleB[r]+swizzleB[o],i=swizzleC[n]+swizzleC[s]+swizzleC[r]+swizzleC[o],setProtoSwizzle(e,t,i)}}}for(let n=0;n<32;n++)proto[n]={get(){this._cache=this._cache||{};let e=this._cache[n];return e===void 0&&(e=new ArrayElementNode(this,new ConstNode(n,"uint")),this._cache[n]=e),e},set(e){this[n].assign(nodeObject(e))}};Object.defineProperties(Node.prototype,proto);const nodeBuilderFunctionsCacheMap=new WeakMap,ShaderNodeObject=function(n,e=null){const t=getValueType(n);return t==="node"?n:e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string"?nodeObject(getConstNode(n,e)):t==="shader"?n.isFn?n:Fn(n):n},ShaderNodeObjects=function(n,e=null){for(const t in n)n[t]=nodeObject(n[t],e);return n},ShaderNodeArray=function(n,e=null){const t=n.length;for(let i=0;i<t;i++)n[i]=nodeObject(n[i],e);return n},ShaderNodeProxy=function(n,e=null,t=null,i=null){function s(d){return i!==null?(d=nodeObject(Object.assign(d,i)),i.intent===!0&&(d=d.toVarIntent())):d=nodeObject(d),d}let r,o=e,a,h;function c(d){let f;return o?f=/[a-z]/i.test(o)?o+"()":o:f=n.type,a!==void 0&&d.length<a?(console.error(`THREE.TSL: "${f}" parameter length is less than minimum required.`),d.concat(new Array(a-d.length).fill(0))):h!==void 0&&d.length>h?(console.error(`THREE.TSL: "${f}" parameter length exceeds limit.`),d.slice(0,h)):d}return e===null?r=(...d)=>s(new n(...nodeArray(c(d)))):t!==null?(t=nodeObject(t),r=(...d)=>s(new n(e,...nodeArray(c(d)),t))):r=(...d)=>s(new n(e,...nodeArray(c(d)))),r.setParameterLength=(...d)=>(d.length===1?a=h=d[0]:d.length===2&&([a,h]=d),r),r.setName=d=>(o=d,r),r};class ShaderCallNodeInternal extends Node{constructor(e,t){super(),this.shaderNode=e,this.rawInputs=t,this.isShaderCallNodeInternal=!0}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,rawInputs:i}=this,s=e.getNodeProperties(t),r=e.getClosestSubBuild(t.subBuilds)||"",o=r||"default";if(s[o])return s[o];const a=e.subBuildFn;e.subBuildFn=r;let h=null;if(t.layout){let c=nodeBuilderFunctionsCacheMap.get(e.constructor);c===void 0&&(c=new WeakMap,nodeBuilderFunctionsCacheMap.set(e.constructor,c));let d=c.get(t);d===void 0&&(d=nodeObject(e.buildFunctionNode(t)),c.set(t,d)),e.addInclude(d);const f=i?getLayoutParameters(i):null;h=nodeObject(d.call(f))}else{const c=new Proxy(e,{get:(S,v,I)=>{let A;return Symbol.iterator===v?A=function*(){yield void 0}:A=Reflect.get(S,v,I),A}}),d=i?getProxyParameters(i):null,f=Array.isArray(i)?i.length>0:i!==null,_=t.jsFunc,y=f||_.length>1?_(d,c):_(c);h=nodeObject(y)}return e.subBuildFn=a,t.once&&(s[o]=h),h}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}getOutputNode(e){const t=e.getNodeProperties(this),i=e.getSubBuildOutput(this);return t[i]=t[i]||this.setupOutput(e),t[i].subBuild=e.getClosestSubBuild(this),t[i]}build(e,t=null){let i=null;const s=e.getBuildStage(),r=e.getNodeProperties(this),o=e.getSubBuildOutput(this),a=this.getOutputNode(e);if(s==="setup"){const h=e.getSubBuildProperty("initialized",this);if(r[h]!==!0&&(r[h]=!0,r[o]=this.getOutputNode(e),r[o].build(e),this.shaderNode.subBuilds))for(const c of e.chaining){const d=e.getDataFromNode(c,"any");d.subBuilds=d.subBuilds||new Set;for(const f of this.shaderNode.subBuilds)d.subBuilds.add(f)}i=r[o]}else s==="analyze"?a.build(e,t):s==="generate"&&(i=a.build(e,t)||"");return i}}function getLayoutParameters(n){let e;return nodeObjects(n),n[0]&&(n[0].isNode||Object.getPrototypeOf(n[0])!==Object.prototype)?e=[...n]:e=n[0],e}function getProxyParameters(n){let e=0;return nodeObjects(n),new Proxy(n,{get:(t,i,s)=>{let r;if(i==="length")return r=n.length,r;if(Symbol.iterator===i)r=function*(){for(const o of n)yield nodeObject(o)};else{if(n.length>0)if(Object.getPrototypeOf(n[0])===Object.prototype){const o=n[0];o[i]===void 0?r=o[e++]:r=Reflect.get(o,i,s)}else n[0]instanceof Node&&(n[i]===void 0?r=n[e++]:r=Reflect.get(n,i,s));else r=Reflect.get(t,i,s);r=nodeObject(r)}return r}})}class ShaderNodeInternal extends Node{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return nodeObject(new ShaderCallNodeInternal(this,e))}setup(){return this.call()}}const bools=[!1,!0],uints=[0,1,2,3],ints=[-1,-2],floats=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],boolsCacheMap=new Map;for(const n of bools)boolsCacheMap.set(n,new ConstNode(n));const uintsCacheMap=new Map;for(const n of uints)uintsCacheMap.set(n,new ConstNode(n,"uint"));const intsCacheMap=new Map([...uintsCacheMap].map(n=>new ConstNode(n.value,"int")));for(const n of ints)intsCacheMap.set(n,new ConstNode(n,"int"));const floatsCacheMap=new Map([...intsCacheMap].map(n=>new ConstNode(n.value)));for(const n of floats)floatsCacheMap.set(n,new ConstNode(n));for(const n of floats)floatsCacheMap.set(-n,new ConstNode(-n));const cacheMaps={bool:boolsCacheMap,uint:uintsCacheMap,ints:intsCacheMap,float:floatsCacheMap},constNodesCacheMap=new Map([...boolsCacheMap,...floatsCacheMap]),getConstNode=(n,e)=>constNodesCacheMap.has(n)?constNodesCacheMap.get(n):n.isNode===!0?n:new ConstNode(n,e),ConvertType=function(n,e=null){return(...t)=>{for(const s of t)if(s===void 0)return console.error(`THREE.TSL: Invalid parameter for the type "${n}".`),nodeObject(new ConstNode(0,n));if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(s=>{const r=typeof s;return r!=="object"&&r!=="function"}))&&(t=[getValueFromType(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return nodeObjectIntent(e.get(t[0]));if(t.length===1){const s=getConstNode(t[0],n);return s.nodeType===n?nodeObjectIntent(s):nodeObjectIntent(new ConvertNode(s,n))}const i=t.map(s=>getConstNode(s));return nodeObjectIntent(new JoinNode(i,n))}},getConstNodeType=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function ShaderNode(n,e){return new ShaderNodeInternal(n,e)}const nodeObject=(n,e=null)=>ShaderNodeObject(n,e),nodeObjectIntent=(n,e=null)=>nodeObject(n,e).toVarIntent(),nodeObjects=(n,e=null)=>new ShaderNodeObjects(n,e),nodeArray=(n,e=null)=>new ShaderNodeArray(n,e),nodeProxy=(n,e=null,t=null,i=null)=>new ShaderNodeProxy(n,e,t,i),nodeProxyIntent=(n,e=null,t=null,i={})=>new ShaderNodeProxy(n,e,t,{intent:!0,...i});let fnId=0;class FnNode extends Node{constructor(e,t=null){super();let i=null;t!==null&&(typeof t=="object"?i=t.return:(typeof t=="string"?i=t:console.error("THREE.TSL: Invalid layout type."),t=null)),this.shaderNode=new ShaderNode(e,i),t!==null&&this.setLayout(t),this.isFn=!0}setLayout(e){const t=this.shaderNode.nodeType;if(typeof e.inputs!="object"){const i={name:"fn"+fnId++,type:t,inputs:[]};for(const s in e)s!=="return"&&i.inputs.push({name:s,type:e[s]});e=i}return this.shaderNode.setLayout(e),this}getNodeType(e){return this.shaderNode.getNodeType(e)||"float"}call(...e){const t=this.shaderNode.call(e);return this.shaderNode.nodeType==="void"&&t.toStack(),t.toVarIntent()}once(e=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=e,this}generate(e){const t=this.getNodeType(e);return console.error('THREE.TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),e.generateConst(t)}}function Fn(n,e=null){const t=new FnNode(n,e);return new Proxy(()=>{},{apply(i,s,r){return t.call(...r)},get(i,s,r){return Reflect.get(t,s,r)},set(i,s,r,o){return Reflect.set(t,s,r,o)}})}function Stack(n){return n}addMethodChaining("toStack",Stack);const color=new ConvertType("color"),float=new ConvertType("float",cacheMaps.float),int=new ConvertType("int",cacheMaps.ints),uint=new ConvertType("uint",cacheMaps.uint),bool=new ConvertType("bool",cacheMaps.bool),vec2=new ConvertType("vec2"),ivec2=new ConvertType("ivec2"),uvec2=new ConvertType("uvec2"),bvec2=new ConvertType("bvec2"),vec3=new ConvertType("vec3"),ivec3=new ConvertType("ivec3"),uvec3=new ConvertType("uvec3"),bvec3=new ConvertType("bvec3"),vec4=new ConvertType("vec4"),ivec4=new ConvertType("ivec4"),uvec4=new ConvertType("uvec4"),bvec4=new ConvertType("bvec4"),mat2=new ConvertType("mat2"),mat3=new ConvertType("mat3"),mat4=new ConvertType("mat4");addMethodChaining("toColor",color);addMethodChaining("toFloat",float);addMethodChaining("toInt",int);addMethodChaining("toUint",uint);addMethodChaining("toBool",bool);addMethodChaining("toVec2",vec2);addMethodChaining("toIVec2",ivec2);addMethodChaining("toUVec2",uvec2);addMethodChaining("toBVec2",bvec2);addMethodChaining("toVec3",vec3);addMethodChaining("toIVec3",ivec3);addMethodChaining("toUVec3",uvec3);addMethodChaining("toBVec3",bvec3);addMethodChaining("toVec4",vec4);addMethodChaining("toIVec4",ivec4);addMethodChaining("toUVec4",uvec4);addMethodChaining("toBVec4",bvec4);addMethodChaining("toMat2",mat2);addMethodChaining("toMat3",mat3);addMethodChaining("toMat4",mat4);const element=nodeProxy(ArrayElementNode).setParameterLength(2),convert=(n,e)=>nodeObject(new ConvertNode(nodeObject(n),e));addMethodChaining("element",element);addMethodChaining("convert",convert);addMethodChaining("append",n=>(console.warn("THREE.TSL: .append() has been renamed to .toStack()."),n));class ArrayNode extends TempNode{static get type(){return"ArrayNode"}constructor(e,t,i=null){super(e),this.count=t,this.values=i,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const array=(...n)=>{let e;if(n.length===1){const t=n[0];e=new ArrayNode(null,t.length,t)}else{const t=n[0],i=n[1];e=new ArrayNode(t,i)}return nodeObject(e)};addMethodChaining("toArray",(n,e)=>array(Array(e).fill(n)));class UniformGroupNode extends Node{static get type(){return"UniformGroupNode"}constructor(e,t=!1,i=1){super("string"),this.name=e,this.shared=t,this.order=i,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const uniformGroup=n=>new UniformGroupNode(n),sharedUniformGroup=(n,e=0)=>new UniformGroupNode(n,!0,e),renderGroup=sharedUniformGroup("render"),objectGroup=uniformGroup("object");class UniformNode extends InputNode{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=objectGroup}setName(e){return this.name=e,this}label(e){return console.warn('THREE.TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){return e=e.bind(this),super.onUpdate(i=>{const s=e(i,this);s!==void 0&&(this.value=s)},t)}getInputType(e){let t=super.getInputType(e);return t==="bool"&&(t="uint"),t}generate(e,t){const i=this.getNodeType(e),s=this.getUniformHash(e);let r=e.getNodeFromHash(s);r===void 0&&(e.setHashNode(this,s),r=this);const o=r.getInputType(e),a=e.getUniformFromNode(r,o,e.shaderStage,this.name||e.context.nodeName),h=e.getPropertyName(a);e.context.nodeName!==void 0&&delete e.context.nodeName;let c=h;if(i==="bool"){const d=e.getDataFromNode(this);let f=d.propertyName;if(f===void 0){const _=e.getVarFromNode(this,null,"bool");f=e.getPropertyName(_),d.propertyName=f,c=e.format(h,o,i),e.addLineFlowCode(`${f} = ${c}`,this)}c=f}return e.format(c,i,t)}}const uniform=(n,e)=>{const t=getConstNodeType(e||n);return t===n&&(n=getValueFromType(t)),n=n&&n.isNode===!0?n.node&&n.node.value||n.value:n,nodeObject(new UniformNode(n,t))};class PropertyNode extends Node{static get type(){return"PropertyNode"}constructor(e,t=null,i=!1){super(e),this.name=t,this.varying=i,this.isPropertyNode=!0,this.global=!0}getHash(e){return this.name||super.getHash(e)}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const property=(n,e)=>nodeObject(new PropertyNode(n,e));class AssignNode extends TempNode{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const i=e.getTypeLength(t.node.getNodeType(e));return vectorComponents.join("").slice(0,i)!==t.components}return!1}setup(e){const{targetNode:t,sourceNode:i}=this,s=t.getScope(),r=e.getNodeProperties(s);r.assign=!0;const o=e.getNodeProperties(this);o.sourceNode=i,o.targetNode=t.context({assign:!0})}generate(e,t){const{targetNode:i,sourceNode:s}=e.getNodeProperties(this),r=this.needsSplitAssign(e),o=i.build(e),a=i.getNodeType(e),h=s.build(e,a),c=s.getNodeType(e),d=e.getDataFromNode(this);let f;if(d.initialized===!0)t!=="void"&&(f=o);else if(r){const _=e.getVarFromNode(this,null,a),y=e.getPropertyName(_);e.addLineFlowCode(`${y} = ${h}`,this);const S=i.node,I=S.node.context({assign:!0}).build(e);for(let A=0;A<S.components.length;A++){const B=S.components[A];e.addLineFlowCode(`${I}.${B} = ${y}[ ${A} ]`,this)}t!=="void"&&(f=o)}else f=`${o} = ${h}`,(t==="void"||c==="void")&&(e.addLineFlowCode(f,this),t!=="void"&&(f=o));return d.initialized=!0,e.format(f,a,t)}}const assign=nodeProxy(AssignNode).setParameterLength(2);addMethodChaining("assign",assign);class FunctionCallNode extends TempNode{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}getMemberType(e,t){return this.functionNode.getMemberType(e,t)}generate(e){const t=[],i=this.functionNode,s=i.getInputs(e),r=this.parameters,o=(h,c)=>{const d=c.type,f=d==="pointer";let _;return f?_="&"+h.build(e):_=h.build(e,d),_};if(Array.isArray(r)){if(r.length>s.length)console.error("THREE.TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),r.length=s.length;else if(r.length<s.length)for(console.error("THREE.TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");r.length<s.length;)r.push(float(0));for(let h=0;h<r.length;h++)t.push(o(r[h],s[h]))}else for(const h of s){const c=r[h.name];c!==void 0?t.push(o(c,h)):(console.error(`THREE.TSL: Input '${h.name}' not found in 'Fn()'.`),t.push(o(float(0),h)))}return`${i.build(e,"property")}( ${t.join(", ")} )`}}const call=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?nodeArray(e):nodeObjects(e[0]),nodeObject(new FunctionCallNode(nodeObject(n),e)));addMethodChaining("call",call);const _vectorOperators={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class OperatorNode extends TempNode{static get type(){return"OperatorNode"}constructor(e,t,i,...s){if(super(),s.length>0){let r=new OperatorNode(e,t,i);for(let o=0;o<s.length-1;o++)r=new OperatorNode(e,r,s[o]);t=r,i=s[s.length-1]}this.op=e,this.aNode=t,this.bNode=i,this.isOperatorNode=!0}getOperatorMethod(e,t){return e.getMethod(_vectorOperators[this.op],t)}getNodeType(e,t=null){const i=this.op,s=this.aNode,r=this.bNode,o=s.getNodeType(e),a=r?r.getNodeType(e):null;if(o==="void"||a==="void")return t||"void";if(i==="%")return o;if(i==="~"||i==="&"||i==="|"||i==="^"||i===">>"||i==="<<")return e.getIntegerType(o);if(i==="!"||i==="&&"||i==="||"||i==="^^")return"bool";if(i==="=="||i==="!="||i==="<"||i===">"||i==="<="||i===">="){const h=Math.max(e.getTypeLength(o),e.getTypeLength(a));return h>1?`bvec${h}`:"bool"}else{if(e.isMatrix(o)){if(a==="float")return o;if(e.isVector(a))return e.getVectorFromMatrix(o);if(e.isMatrix(a))return o}else if(e.isMatrix(a)){if(o==="float")return a;if(e.isVector(o))return e.getVectorFromMatrix(a)}return e.getTypeLength(a)>e.getTypeLength(o)?a:o}}generate(e,t){const i=this.op,{aNode:s,bNode:r}=this,o=this.getNodeType(e,t);let a=null,h=null;o!=="void"?(a=s.getNodeType(e),h=r?r.getNodeType(e):null,i==="<"||i===">"||i==="<="||i===">="||i==="=="||i==="!="?e.isVector(a)?h=a:e.isVector(h)?a=h:a!==h&&(a=h="float"):i===">>"||i==="<<"?(a=o,h=e.changeComponentType(h,"uint")):i==="%"?(a=o,h=e.isInteger(a)&&e.isInteger(h)?h:a):e.isMatrix(a)?h==="float"?h="float":e.isVector(h)?h=e.getVectorFromMatrix(a):e.isMatrix(h)||(a=h=o):e.isMatrix(h)?a==="float"?a="float":e.isVector(a)?a=e.getVectorFromMatrix(h):a=h=o:a=h=o):a=h=o;const c=s.build(e,a),d=r?r.build(e,h):null,f=e.getFunctionOperator(i);if(t!=="void"){const _=e.renderer.coordinateSystem===WebGLCoordinateSystem;if(i==="=="||i==="!="||i==="<"||i===">"||i==="<="||i===">=")return _?e.isVector(a)?e.format(`${this.getOperatorMethod(e,t)}( ${c}, ${d} )`,o,t):e.format(`( ${c} ${i} ${d} )`,o,t):e.format(`( ${c} ${i} ${d} )`,o,t);if(i==="%")return e.isInteger(h)?e.format(`( ${c} % ${d} )`,o,t):e.format(`${this.getOperatorMethod(e,o)}( ${c}, ${d} )`,o,t);if(i==="!"||i==="~")return e.format(`(${i}${c})`,a,t);if(f)return e.format(`${f}( ${c}, ${d} )`,o,t);if(e.isMatrix(a)&&h==="float")return e.format(`( ${d} ${i} ${c} )`,o,t);if(a==="float"&&e.isMatrix(h))return e.format(`${c} ${i} ${d}`,o,t);{let y=`( ${c} ${i} ${d} )`;return!_&&o==="bool"&&e.isVector(a)&&e.isVector(h)&&(y=`all${y}`),e.format(y,o,t)}}else if(a!=="void")return f?e.format(`${f}( ${c}, ${d} )`,o,t):e.isMatrix(a)&&h==="float"?e.format(`${d} ${i} ${c}`,o,t):e.format(`${c} ${i} ${d}`,o,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const add$3=nodeProxyIntent(OperatorNode,"+").setParameterLength(2,1/0).setName("add"),sub=nodeProxyIntent(OperatorNode,"-").setParameterLength(2,1/0).setName("sub"),mul=nodeProxyIntent(OperatorNode,"*").setParameterLength(2,1/0).setName("mul"),div=nodeProxyIntent(OperatorNode,"/").setParameterLength(2,1/0).setName("div"),mod=nodeProxyIntent(OperatorNode,"%").setParameterLength(2).setName("mod"),equal=nodeProxyIntent(OperatorNode,"==").setParameterLength(2).setName("equal"),notEqual=nodeProxyIntent(OperatorNode,"!=").setParameterLength(2).setName("notEqual"),lessThan=nodeProxyIntent(OperatorNode,"<").setParameterLength(2).setName("lessThan"),greaterThan=nodeProxyIntent(OperatorNode,">").setParameterLength(2).setName("greaterThan"),lessThanEqual=nodeProxyIntent(OperatorNode,"<=").setParameterLength(2).setName("lessThanEqual"),greaterThanEqual=nodeProxyIntent(OperatorNode,">=").setParameterLength(2).setName("greaterThanEqual"),and=nodeProxyIntent(OperatorNode,"&&").setParameterLength(2,1/0).setName("and"),or=nodeProxyIntent(OperatorNode,"||").setParameterLength(2,1/0).setName("or"),not=nodeProxyIntent(OperatorNode,"!").setParameterLength(1).setName("not"),xor=nodeProxyIntent(OperatorNode,"^^").setParameterLength(2).setName("xor"),bitAnd=nodeProxyIntent(OperatorNode,"&").setParameterLength(2).setName("bitAnd"),bitNot=nodeProxyIntent(OperatorNode,"~").setParameterLength(2).setName("bitNot"),bitOr=nodeProxyIntent(OperatorNode,"|").setParameterLength(2).setName("bitOr"),bitXor=nodeProxyIntent(OperatorNode,"^").setParameterLength(2).setName("bitXor"),shiftLeft=nodeProxyIntent(OperatorNode,"<<").setParameterLength(2).setName("shiftLeft"),shiftRight=nodeProxyIntent(OperatorNode,">>").setParameterLength(2).setName("shiftRight"),incrementBefore=Fn(([n])=>(n.addAssign(1),n)),decrementBefore=Fn(([n])=>(n.subAssign(1),n)),increment=Fn(([n])=>{const e=int(n).toConst();return n.addAssign(1),e}),decrement=Fn(([n])=>{const e=int(n).toConst();return n.subAssign(1),e});addMethodChaining("add",add$3);addMethodChaining("sub",sub);addMethodChaining("mul",mul);addMethodChaining("div",div);addMethodChaining("mod",mod);addMethodChaining("equal",equal);addMethodChaining("notEqual",notEqual);addMethodChaining("lessThan",lessThan);addMethodChaining("greaterThan",greaterThan);addMethodChaining("lessThanEqual",lessThanEqual);addMethodChaining("greaterThanEqual",greaterThanEqual);addMethodChaining("and",and);addMethodChaining("or",or);addMethodChaining("not",not);addMethodChaining("xor",xor);addMethodChaining("bitAnd",bitAnd);addMethodChaining("bitNot",bitNot);addMethodChaining("bitOr",bitOr);addMethodChaining("bitXor",bitXor);addMethodChaining("shiftLeft",shiftLeft);addMethodChaining("shiftRight",shiftRight);addMethodChaining("incrementBefore",incrementBefore);addMethodChaining("decrementBefore",decrementBefore);addMethodChaining("increment",increment);addMethodChaining("decrement",decrement);const modInt=(n,e)=>(console.warn('THREE.TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),mod(int(n),int(e)));addMethodChaining("modInt",modInt);class MathNode extends TempNode{static get type(){return"MathNode"}constructor(e,t,i=null,s=null){if(super(),(e===MathNode.MAX||e===MathNode.MIN)&&arguments.length>3){let r=new MathNode(e,t,i);for(let o=2;o<arguments.length-1;o++)r=new MathNode(e,r,arguments[o]);t=r,i=arguments[arguments.length-1],s=null}this.method=e,this.aNode=t,this.bNode=i,this.cNode=s,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),i=this.bNode?this.bNode.getNodeType(e):null,s=this.cNode?this.cNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),o=e.isMatrix(i)?0:e.getTypeLength(i),a=e.isMatrix(s)?0:e.getTypeLength(s);return r>o&&r>a?t:o>a?i:a>r?s:t}getNodeType(e){const t=this.method;return t===MathNode.LENGTH||t===MathNode.DISTANCE||t===MathNode.DOT?"float":t===MathNode.CROSS?"vec3":t===MathNode.ALL||t===MathNode.ANY?"bool":t===MathNode.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}setup(e){const{aNode:t,bNode:i,method:s}=this;let r=null;if(s===MathNode.ONE_MINUS)r=sub(1,t);else if(s===MathNode.RECIPROCAL)r=div(1,t);else if(s===MathNode.DIFFERENCE)r=abs(sub(t,i));else if(s===MathNode.TRANSFORM_DIRECTION){let o=t,a=i;e.isMatrix(o.getNodeType(e))?a=vec4(vec3(a),0):o=vec4(vec3(o),0);const h=mul(o,a).xyz;r=normalize(h)}return r!==null?r:super.setup(e)}generate(e,t){if(e.getNodeProperties(this).outputNode)return super.generate(e,t);let s=this.method;const r=this.getNodeType(e),o=this.getInputType(e),a=this.aNode,h=this.bNode,c=this.cNode,d=e.renderer.coordinateSystem;if(s===MathNode.NEGATE)return e.format("( - "+a.build(e,o)+" )",r,t);{const f=[];return s===MathNode.CROSS?f.push(a.build(e,r),h.build(e,r)):d===WebGLCoordinateSystem&&s===MathNode.STEP?f.push(a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":o),h.build(e,o)):d===WebGLCoordinateSystem&&(s===MathNode.MIN||s===MathNode.MAX)?f.push(a.build(e,o),h.build(e,e.getTypeLength(h.getNodeType(e))===1?"float":o)):s===MathNode.REFRACT?f.push(a.build(e,o),h.build(e,o),c.build(e,"float")):s===MathNode.MIX?f.push(a.build(e,o),h.build(e,o),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":o)):(d===WebGPUCoordinateSystem&&s===MathNode.ATAN&&h!==null&&(s="atan2"),e.shaderStage!=="fragment"&&(s===MathNode.DFDX||s===MathNode.DFDY)&&(console.warn(`THREE.TSL: '${s}' is not supported in the ${e.shaderStage} stage.`),s="/*"+s+"*/"),f.push(a.build(e,o)),h!==null&&f.push(h.build(e,o)),c!==null&&f.push(c.build(e,o))),e.format(`${e.getMethod(s,r)}( ${f.join(", ")} )`,r,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}MathNode.ALL="all";MathNode.ANY="any";MathNode.RADIANS="radians";MathNode.DEGREES="degrees";MathNode.EXP="exp";MathNode.EXP2="exp2";MathNode.LOG="log";MathNode.LOG2="log2";MathNode.SQRT="sqrt";MathNode.INVERSE_SQRT="inversesqrt";MathNode.FLOOR="floor";MathNode.CEIL="ceil";MathNode.NORMALIZE="normalize";MathNode.FRACT="fract";MathNode.SIN="sin";MathNode.COS="cos";MathNode.TAN="tan";MathNode.ASIN="asin";MathNode.ACOS="acos";MathNode.ATAN="atan";MathNode.ABS="abs";MathNode.SIGN="sign";MathNode.LENGTH="length";MathNode.NEGATE="negate";MathNode.ONE_MINUS="oneMinus";MathNode.DFDX="dFdx";MathNode.DFDY="dFdy";MathNode.ROUND="round";MathNode.RECIPROCAL="reciprocal";MathNode.TRUNC="trunc";MathNode.FWIDTH="fwidth";MathNode.TRANSPOSE="transpose";MathNode.DETERMINANT="determinant";MathNode.INVERSE="inverse";MathNode.EQUALS="equals";MathNode.MIN="min";MathNode.MAX="max";MathNode.STEP="step";MathNode.REFLECT="reflect";MathNode.DISTANCE="distance";MathNode.DIFFERENCE="difference";MathNode.DOT="dot";MathNode.CROSS="cross";MathNode.POW="pow";MathNode.TRANSFORM_DIRECTION="transformDirection";MathNode.MIX="mix";MathNode.CLAMP="clamp";MathNode.REFRACT="refract";MathNode.SMOOTHSTEP="smoothstep";MathNode.FACEFORWARD="faceforward";const PI=float(Math.PI),all$2=nodeProxyIntent(MathNode,MathNode.ALL).setParameterLength(1),any=nodeProxyIntent(MathNode,MathNode.ANY).setParameterLength(1),radians=nodeProxyIntent(MathNode,MathNode.RADIANS).setParameterLength(1),degrees=nodeProxyIntent(MathNode,MathNode.DEGREES).setParameterLength(1),exp=nodeProxyIntent(MathNode,MathNode.EXP).setParameterLength(1),exp2=nodeProxyIntent(MathNode,MathNode.EXP2).setParameterLength(1),log$1=nodeProxyIntent(MathNode,MathNode.LOG).setParameterLength(1),log2=nodeProxyIntent(MathNode,MathNode.LOG2).setParameterLength(1),sqrt=nodeProxyIntent(MathNode,MathNode.SQRT).setParameterLength(1),inverseSqrt=nodeProxyIntent(MathNode,MathNode.INVERSE_SQRT).setParameterLength(1),floor$1=nodeProxyIntent(MathNode,MathNode.FLOOR).setParameterLength(1),ceil$1=nodeProxyIntent(MathNode,MathNode.CEIL).setParameterLength(1),normalize=nodeProxyIntent(MathNode,MathNode.NORMALIZE).setParameterLength(1),fract=nodeProxyIntent(MathNode,MathNode.FRACT).setParameterLength(1),sin=nodeProxyIntent(MathNode,MathNode.SIN).setParameterLength(1),cos=nodeProxyIntent(MathNode,MathNode.COS).setParameterLength(1),tan=nodeProxyIntent(MathNode,MathNode.TAN).setParameterLength(1),asin=nodeProxyIntent(MathNode,MathNode.ASIN).setParameterLength(1),acos=nodeProxyIntent(MathNode,MathNode.ACOS).setParameterLength(1),atan=nodeProxyIntent(MathNode,MathNode.ATAN).setParameterLength(1,2),abs=nodeProxyIntent(MathNode,MathNode.ABS).setParameterLength(1),sign=nodeProxyIntent(MathNode,MathNode.SIGN).setParameterLength(1),length=nodeProxyIntent(MathNode,MathNode.LENGTH).setParameterLength(1),negate=nodeProxyIntent(MathNode,MathNode.NEGATE).setParameterLength(1),oneMinus=nodeProxyIntent(MathNode,MathNode.ONE_MINUS).setParameterLength(1),dFdx=nodeProxyIntent(MathNode,MathNode.DFDX).setParameterLength(1),dFdy=nodeProxyIntent(MathNode,MathNode.DFDY).setParameterLength(1),round$1=nodeProxyIntent(MathNode,MathNode.ROUND).setParameterLength(1),reciprocal=nodeProxyIntent(MathNode,MathNode.RECIPROCAL).setParameterLength(1),trunc=nodeProxyIntent(MathNode,MathNode.TRUNC).setParameterLength(1),fwidth=nodeProxyIntent(MathNode,MathNode.FWIDTH).setParameterLength(1),transpose=nodeProxyIntent(MathNode,MathNode.TRANSPOSE).setParameterLength(1),determinant$1=nodeProxyIntent(MathNode,MathNode.DETERMINANT).setParameterLength(1),inverse=nodeProxyIntent(MathNode,MathNode.INVERSE).setParameterLength(1),equals$3=(n,e)=>(console.warn('THREE.TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),equal(n,e)),min=nodeProxyIntent(MathNode,MathNode.MIN).setParameterLength(2,1/0),max=nodeProxyIntent(MathNode,MathNode.MAX).setParameterLength(2,1/0),step=nodeProxyIntent(MathNode,MathNode.STEP).setParameterLength(2),reflect=nodeProxyIntent(MathNode,MathNode.REFLECT).setParameterLength(2),distance=nodeProxyIntent(MathNode,MathNode.DISTANCE).setParameterLength(2),difference=nodeProxyIntent(MathNode,MathNode.DIFFERENCE).setParameterLength(2),dot=nodeProxyIntent(MathNode,MathNode.DOT).setParameterLength(2),cross=nodeProxyIntent(MathNode,MathNode.CROSS).setParameterLength(2),pow=nodeProxyIntent(MathNode,MathNode.POW).setParameterLength(2),pow2=n=>mul(n,n),pow3=n=>mul(n,n,n),pow4=n=>mul(n,n,n,n),transformDirection=nodeProxyIntent(MathNode,MathNode.TRANSFORM_DIRECTION).setParameterLength(2),cbrt=n=>mul(sign(n),pow(abs(n),1/3)),lengthSq=n=>dot(n,n),mix=nodeProxyIntent(MathNode,MathNode.MIX).setParameterLength(3),clamp$1=(n,e=0,t=1)=>nodeObject(new MathNode(MathNode.CLAMP,nodeObject(n),nodeObject(e),nodeObject(t))),saturate=n=>clamp$1(n),refract=nodeProxyIntent(MathNode,MathNode.REFRACT).setParameterLength(3),smoothstep=nodeProxyIntent(MathNode,MathNode.SMOOTHSTEP).setParameterLength(3),faceForward=nodeProxyIntent(MathNode,MathNode.FACEFORWARD).setParameterLength(3),rand=Fn(([n])=>{const i=43758.5453,s=dot(n.xy,vec2(12.9898,78.233)),r=mod(s,PI);return fract(sin(r).mul(i))}),mixElement=(n,e,t)=>mix(e,t,n),smoothstepElement=(n,e,t)=>smoothstep(e,t,n),stepElement=(n,e)=>step(e,n),atan2=(n,e)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),atan(n,e));addMethodChaining("all",all$2);addMethodChaining("any",any);addMethodChaining("equals",equals$3);addMethodChaining("radians",radians);addMethodChaining("degrees",degrees);addMethodChaining("exp",exp);addMethodChaining("exp2",exp2);addMethodChaining("log",log$1);addMethodChaining("log2",log2);addMethodChaining("sqrt",sqrt);addMethodChaining("inverseSqrt",inverseSqrt);addMethodChaining("floor",floor$1);addMethodChaining("ceil",ceil$1);addMethodChaining("normalize",normalize);addMethodChaining("fract",fract);addMethodChaining("sin",sin);addMethodChaining("cos",cos);addMethodChaining("tan",tan);addMethodChaining("asin",asin);addMethodChaining("acos",acos);addMethodChaining("atan",atan);addMethodChaining("abs",abs);addMethodChaining("sign",sign);addMethodChaining("length",length);addMethodChaining("lengthSq",lengthSq);addMethodChaining("negate",negate);addMethodChaining("oneMinus",oneMinus);addMethodChaining("dFdx",dFdx);addMethodChaining("dFdy",dFdy);addMethodChaining("round",round$1);addMethodChaining("reciprocal",reciprocal);addMethodChaining("trunc",trunc);addMethodChaining("fwidth",fwidth);addMethodChaining("atan2",atan2);addMethodChaining("min",min);addMethodChaining("max",max);addMethodChaining("step",stepElement);addMethodChaining("reflect",reflect);addMethodChaining("distance",distance);addMethodChaining("dot",dot);addMethodChaining("cross",cross);addMethodChaining("pow",pow);addMethodChaining("pow2",pow2);addMethodChaining("pow3",pow3);addMethodChaining("pow4",pow4);addMethodChaining("transformDirection",transformDirection);addMethodChaining("mix",mixElement);addMethodChaining("clamp",clamp$1);addMethodChaining("refract",refract);addMethodChaining("smoothstep",smoothstepElement);addMethodChaining("faceForward",faceForward);addMethodChaining("difference",difference);addMethodChaining("saturate",saturate);addMethodChaining("cbrt",cbrt);addMethodChaining("transpose",transpose);addMethodChaining("determinant",determinant$1);addMethodChaining("inverse",inverse);addMethodChaining("rand",rand);class ConditionalNode extends Node{static get type(){return"ConditionalNode"}constructor(e,t,i=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=i}getNodeType(e){const{ifNode:t,elseNode:i}=e.getNodeProperties(this);if(t===void 0)return e.flowBuildStage(this,"setup"),this.getNodeType(e);const s=t.getNodeType(e);if(i!==null){const r=i.getNodeType(e);if(e.getTypeLength(r)>e.getTypeLength(s))return r}return s}setup(e){const t=this.condNode.cache(),i=this.ifNode.cache(),s=this.elseNode?this.elseNode.cache():null,r=e.context.nodeBlock;e.getDataFromNode(i).parentNodeBlock=r,s!==null&&(e.getDataFromNode(s).parentNodeBlock=r);const o=e.context.uniformFlow,a=e.getNodeProperties(this);a.condNode=t,a.ifNode=o?i:i.context({nodeBlock:i}),a.elseNode=s?o?s:s.context({nodeBlock:s}):null}generate(e,t){const i=this.getNodeType(e),s=e.getDataFromNode(this);if(s.nodeProperty!==void 0)return s.nodeProperty;const{condNode:r,ifNode:o,elseNode:a}=e.getNodeProperties(this),h=e.currentFunctionNode,c=t!=="void",d=c?property(i).build(e):"";s.nodeProperty=d;const f=r.build(e,"bool");if(e.context.uniformFlow&&a!==null){const S=o.build(e,i),v=a.build(e,i),I=e.getTernary(f,S,v);return e.format(I,i,t)}e.addFlowCode(`
${e.tab}if ( ${f} ) {

`).addFlowTab();let y=o.build(e,i);if(y&&(c?y=d+" = "+y+";":(y="return "+y+";",h===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),y="// "+y))),e.removeFlowTab().addFlowCode(e.tab+"	"+y+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let S=a.build(e,i);S&&(c?S=d+" = "+S+";":(S="return "+S+";",h===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),S="// "+S))),e.removeFlowTab().addFlowCode(e.tab+"	"+S+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(d,i,t)}}const select=nodeProxy(ConditionalNode).setParameterLength(2,3);addMethodChaining("select",select);class ContextNode extends Node{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}analyze(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value}),this.node.build(e),e.setContext(t)}generate(e,t){const i=e.getContext();e.setContext({...e.context,...this.value});const s=this.node.build(e,t);return e.setContext(i),s}}const context=nodeProxy(ContextNode).setParameterLength(1,2),uniformFlow=n=>context(n,{uniformFlow:!0}),setName=(n,e)=>context(n,{nodeName:e});function label(n,e){return console.warn('THREE.TSL: "label()" has been deprecated. Use "setName()" instead.'),setName(n,e)}addMethodChaining("context",context);addMethodChaining("label",label);addMethodChaining("uniformFlow",uniformFlow);addMethodChaining("setName",setName);class VarNode extends Node{static get type(){return"VarNode"}constructor(e,t=null,i=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=i,this.parents=!0,this.intent=!1}setIntent(e){return this.intent=e,this}getIntent(){return this.intent}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}getArrayCount(e){return this.node.getArrayCount(e)}build(...e){return this.intent===!0&&e[0].getNodeProperties(this).assign!==!0?this.node.build(...e):super.build(...e)}generate(e){const{node:t,name:i,readOnly:s}=this,{renderer:r}=e,o=r.backend.isWebGPUBackend===!0;let a=!1,h=!1;s&&(a=e.isDeterministic(t),h=o?s:a);const c=e.getVectorType(this.getNodeType(e)),d=t.build(e,c),f=e.getVarFromNode(this,i,c,void 0,h),_=e.getPropertyName(f);let y=_;if(h)if(o)y=a?`const ${_}`:`let ${_}`;else{const S=t.getArrayCount(e);y=`const ${e.getVar(f.type,_,S)}`}return e.addLineFlowCode(`${y} = ${d}`,this),_}}const createVar=nodeProxy(VarNode),Var=(n,e=null)=>createVar(n,e).toStack(),Const=(n,e=null)=>createVar(n,e,!0).toStack(),VarIntent=n=>n;addMethodChaining("toVar",Var);addMethodChaining("toConst",Const);addMethodChaining("toVarIntent",VarIntent);class SubBuildNode extends Node{static get type(){return"SubBuild"}constructor(e,t,i=null){super(i),this.node=e,this.name=t,this.isSubBuildNode=!0}getNodeType(e){if(this.nodeType!==null)return this.nodeType;e.addSubBuild(this.name);const t=this.node.getNodeType(e);return e.removeSubBuild(),t}build(e,...t){e.addSubBuild(this.name);const i=this.node.build(e,...t);return e.removeSubBuild(),i}}const subBuild=(n,e,t=null)=>nodeObject(new SubBuildNode(nodeObject(n),e,t));class VaryingNode extends Node{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(e,t=null){return this.interpolationType=e,this.interpolationSampling=t,this}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let i=t.varying;if(i===void 0){const s=this.name,r=this.getNodeType(e),o=this.interpolationType,a=this.interpolationSampling;t.varying=i=e.getVaryingFromNode(this,s,r,o,a),t.node=subBuild(this.node,"VERTEX")}return i.needsInterpolation||(i.needsInterpolation=e.shaderStage==="fragment"),i}setup(e){this.setupVarying(e),e.flowNodeFromShaderStage(NodeShaderStage.VERTEX,this.node)}analyze(e){this.setupVarying(e),e.flowNodeFromShaderStage(NodeShaderStage.VERTEX,this.node)}generate(e){const t=e.getSubBuildProperty("property",e.currentStack),i=e.getNodeProperties(this),s=this.setupVarying(e);if(i[t]===void 0){const r=this.getNodeType(e),o=e.getPropertyName(s,NodeShaderStage.VERTEX);e.flowNodeFromShaderStage(NodeShaderStage.VERTEX,i.node,r,o),i[t]=o}return e.getPropertyName(s)}}const varying=nodeProxy(VaryingNode).setParameterLength(1,2),vertexStage=n=>varying(n);addMethodChaining("toVarying",varying);addMethodChaining("toVertexStage",vertexStage);addMethodChaining("varying",(...n)=>(console.warn("THREE.TSL: .varying() has been renamed to .toVarying()."),varying(...n)));addMethodChaining("vertexStage",(...n)=>(console.warn("THREE.TSL: .vertexStage() has been renamed to .toVertexStage()."),varying(...n)));const sRGBTransferEOTF=Fn(([n])=>{const e=n.mul(.9478672986).add(.0521327014).pow(2.4),t=n.mul(.0773993808),i=n.lessThanEqual(.04045);return mix(e,t,i)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),sRGBTransferOETF=Fn(([n])=>{const e=n.pow(.41666).mul(1.055).sub(.055),t=n.mul(12.92),i=n.lessThanEqual(.0031308);return mix(e,t,i)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),WORKING_COLOR_SPACE="WorkingColorSpace",OUTPUT_COLOR_SPACE="OutputColorSpace";class ColorSpaceNode extends TempNode{static get type(){return"ColorSpaceNode"}constructor(e,t,i){super("vec4"),this.colorNode=e,this.source=t,this.target=i}resolveColorSpace(e,t){return t===WORKING_COLOR_SPACE?ColorManagement.workingColorSpace:t===OUTPUT_COLOR_SPACE?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,i=this.resolveColorSpace(e,this.source),s=this.resolveColorSpace(e,this.target);let r=t;return ColorManagement.enabled===!1||i===s||!i||!s||(ColorManagement.getTransfer(i)===SRGBTransfer&&(r=vec4(sRGBTransferEOTF(r.rgb),r.a)),ColorManagement.getPrimaries(i)!==ColorManagement.getPrimaries(s)&&(r=vec4(mat3(ColorManagement._getMatrix(new Matrix3,i,s)).mul(r.rgb),r.a)),ColorManagement.getTransfer(s)===SRGBTransfer&&(r=vec4(sRGBTransferOETF(r.rgb),r.a))),r}}const workingToColorSpace=(n,e)=>nodeObject(new ColorSpaceNode(nodeObject(n),WORKING_COLOR_SPACE,e)),colorSpaceToWorking=(n,e)=>nodeObject(new ColorSpaceNode(nodeObject(n),e,WORKING_COLOR_SPACE));addMethodChaining("workingToColorSpace",workingToColorSpace);addMethodChaining("colorSpaceToWorking",colorSpaceToWorking);class ReferenceElementNode extends ArrayElementNode{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),i=this.referenceNode.getNodeType(),s=this.getNodeType();return e.format(t,i,s)}}class ReferenceBaseNode extends Node{static get type(){return"ReferenceBaseNode"}constructor(e,t,i=null,s=null){super(),this.property=e,this.uniformType=t,this.object=i,this.count=s,this.properties=e.split("."),this.reference=i,this.node=null,this.group=null,this.updateType=NodeUpdateType.OBJECT}setGroup(e){return this.group=e,this}element(e){return nodeObject(new ReferenceElementNode(this,nodeObject(e)))}setNodeType(e){const t=uniform(null,e);this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let i=e[t[0]];for(let s=1;s<t.length;s++)i=i[t[s]];return i}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}class RendererReferenceNode extends ReferenceBaseNode{static get type(){return"RendererReferenceNode"}constructor(e,t,i=null){super(e,t,i),this.renderer=i,this.setGroup(renderGroup)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const rendererReference=(n,e,t=null)=>nodeObject(new RendererReferenceNode(n,e,t));class ToneMappingNode extends TempNode{static get type(){return"ToneMappingNode"}constructor(e,t=toneMappingExposure,i=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=i}customCacheKey(){return hash$1(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,i=this.toneMapping;if(i===NoToneMapping)return t;let s=null;const r=e.renderer.library.getToneMappingFunction(i);return r!==null?s=vec4(r(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",i),s=t),s}}const toneMapping=(n,e,t)=>nodeObject(new ToneMappingNode(n,nodeObject(e),nodeObject(t))),toneMappingExposure=rendererReference("toneMappingExposure","float");addMethodChaining("toneMapping",(n,e,t)=>toneMapping(e,t,n));const _vector$1=new Vector3,_vector2=new Vector2;let _id=0;class BufferAttribute{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:_id++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=StaticDrawUsage,this.updateRanges=[],this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)_vector2.fromBufferAttribute(this,t),_vector2.applyMatrix3(e),this.setXY(t,_vector2.x,_vector2.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)_vector$1.fromBufferAttribute(this,t),_vector$1.applyMatrix3(e),this.setXYZ(t,_vector$1.x,_vector$1.y,_vector$1.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)_vector$1.fromBufferAttribute(this,t),_vector$1.applyMatrix4(e),this.setXYZ(t,_vector$1.x,_vector$1.y,_vector$1.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)_vector$1.fromBufferAttribute(this,t),_vector$1.applyNormalMatrix(e),this.setXYZ(t,_vector$1.x,_vector$1.y,_vector$1.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)_vector$1.fromBufferAttribute(this,t),_vector$1.transformDirection(e),this.setXYZ(t,_vector$1.x,_vector$1.y,_vector$1.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=denormalize(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=normalize$1(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=denormalize(t,this.array)),t}setX(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=denormalize(t,this.array)),t}setY(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=denormalize(t,this.array)),t}setZ(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=denormalize(t,this.array)),t}setW(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=normalize$1(t,this.array),i=normalize$1(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=normalize$1(t,this.array),i=normalize$1(i,this.array),s=normalize$1(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e*=this.itemSize,this.normalized&&(t=normalize$1(t,this.array),i=normalize$1(i,this.array),s=normalize$1(s,this.array),r=normalize$1(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==StaticDrawUsage&&(e.usage=this.usage),e}}const _vector=new Vector3;class InterleavedBufferAttribute{constructor(e,t,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)_vector.fromBufferAttribute(this,t),_vector.applyMatrix4(e),this.setXYZ(t,_vector.x,_vector.y,_vector.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)_vector.fromBufferAttribute(this,t),_vector.applyNormalMatrix(e),this.setXYZ(t,_vector.x,_vector.y,_vector.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)_vector.fromBufferAttribute(this,t),_vector.transformDirection(e),this.setXYZ(t,_vector.x,_vector.y,_vector.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=denormalize(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=normalize$1(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=denormalize(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=denormalize(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=denormalize(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=denormalize(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=normalize$1(t,this.array),i=normalize$1(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=normalize$1(t,this.array),i=normalize$1(i,this.array),s=normalize$1(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=normalize$1(t,this.array),i=normalize$1(i,this.array),s=normalize$1(s,this.array),r=normalize$1(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new BufferAttribute(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new InterleavedBufferAttribute(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class InterleavedBuffer{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=StaticDrawUsage,this.updateRanges=[],this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[i+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}class BufferAttributeNode extends InputNode{static get type(){return"BufferAttributeNode"}constructor(e,t=null,i=0,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=i,this.bufferOffset=s,this.usage=StaticDrawUsage,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),i=this.value,s=e.getTypeLength(t),r=this.bufferStride||s,o=this.bufferOffset,a=i.isInterleavedBuffer===!0?i:new InterleavedBuffer(i,r),h=new InterleavedBufferAttribute(a,s,o);a.setUsage(this.usage),this.attribute=h,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),i=e.getBufferAttributeFromNode(this,t),s=e.getPropertyName(i);let r=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=s,r=s):r=varying(this).build(e,t),r}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const bufferAttribute=(n,e=null,t=0,i=0)=>nodeObject(new BufferAttributeNode(n,e,t,i));addMethodChaining("toAttribute",n=>bufferAttribute(n.value));class ComputeNode extends Node{static get type(){return"ComputeNode"}constructor(e,t){super("void"),this.isComputeNode=!0,this.computeNode=e,this.workgroupSize=t,this.count=null,this.version=1,this.name="",this.updateBeforeType=NodeUpdateType.OBJECT,this.onInitFunction=null}setCount(e){return this.count=e,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(e){return this.name=e,this}label(e){return console.warn('THREE.TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(e)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.build(e);if(t){const i=e.getNodeProperties(this);i.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:i}=e;if(i==="compute"){const s=this.computeNode.build(e,"void");s!==""&&e.addLineFlowCode(s,this)}else{const r=e.getNodeProperties(this).outputComputeNode;if(r)return r.build(e,t)}}}const computeKernel=(n,e=[64])=>{(e.length===0||e.length>3)&&console.error("THREE.TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let t=0;t<e.length;t++){const i=e[t];(typeof i!="number"||i<=0||!Number.isInteger(i))&&console.error(`THREE.TSL: compute() workgroupSize element at index [ ${t} ] must be a positive integer`)}for(;e.length<3;)e.push(1);return nodeObject(new ComputeNode(nodeObject(n),e))},compute=(n,e,t)=>computeKernel(n,t).setCount(e);addMethodChaining("compute",compute);addMethodChaining("computeKernel",computeKernel);class CacheNode extends Node{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const s=this.node.getNodeType(e);return e.setCache(t),s}build(e,...t){const i=e.getCache(),s=e.getCacheFromNode(this,this.parent);e.setCache(s);const r=this.node.build(e,...t);return e.setCache(i),r}}const cache$2=(n,e)=>nodeObject(new CacheNode(nodeObject(n),e));addMethodChaining("cache",cache$2);class BypassNode extends Node{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const bypass=nodeProxy(BypassNode).setParameterLength(2);addMethodChaining("bypass",bypass);class RemapNode extends Node{static get type(){return"RemapNode"}constructor(e,t,i,s=float(0),r=float(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=i,this.outLowNode=s,this.outHighNode=r,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:i,outLowNode:s,outHighNode:r,doClamp:o}=this;let a=e.sub(t).div(i.sub(t));return o===!0&&(a=a.clamp()),a.mul(r.sub(s)).add(s)}}const remap=nodeProxy(RemapNode,null,null,{doClamp:!1}).setParameterLength(3,5),remapClamp=nodeProxy(RemapNode).setParameterLength(3,5);addMethodChaining("remap",remap);addMethodChaining("remapClamp",remapClamp);class ExpressionNode extends Node{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const i=this.getNodeType(e),s=this.snippet;if(i==="void")e.addLineFlowCode(s,this);else return e.format(s,i,t)}}const expression=nodeProxy(ExpressionNode).setParameterLength(1,2),Discard=n=>(n?select(n,expression("discard")):expression("discard")).toStack();addMethodChaining("discard",Discard);class RenderOutputNode extends TempNode{static get type(){return"RenderOutputNode"}constructor(e,t,i){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=i,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const i=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||NoToneMapping,s=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||NoColorSpace;return i!==NoToneMapping&&(t=t.toneMapping(i)),s!==NoColorSpace&&s!==ColorManagement.workingColorSpace&&(t=t.workingToColorSpace(s)),t}}const renderOutput=(n,e=null,t=null)=>nodeObject(new RenderOutputNode(nodeObject(n),e,t));addMethodChaining("renderOutput",renderOutput);class DebugNode extends TempNode{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,i=this.node.build(e),s="--- TSL debug - "+e.shaderStage+" shader ---",r="-".repeat(s.length);let o="";return o+="// #"+s+`#
`,o+=e.flow.code.replace(/^\t/mg,"")+`
`,o+="/* ... */ "+i+` /* ... */
`,o+="// #"+r+`#
`,t!==null?t(e,o):console.log(o),i}}const debug=(n,e=null)=>nodeObject(new DebugNode(nodeObject(n),e)).toStack();addMethodChaining("debug",debug);const webLocalStorage={get:function(n,e){const t=localStorage.getItem(n);if(t)try{const i=JSON.parse(t);return"value"in i?i.value:e}catch(i){return console.warn(`Inavlid value in local storage: Key ${n} - ${i.message}`),e}else return e},set:function(n,e){let t={};t.value=e;try{localStorage.setItem(n,JSON.stringify(t))}catch{console.warn(`Unable to store key ${n} to local storage`)}},delete:function(n){return localStorage.removeItem(n)}},usbBootloaders=[{vendorId:1155,productId:57105,name:"STM DFU"},{vendorId:11836,productId:57105,name:"AT32 DFU"}],bridge={isElectron:!1,serialEvents:new EventTarget,tcpEvents:new EventTarget,udpEvents:new EventTarget,bootloaderIds:usbBootloaders,init:function(){this.isElectron=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0,this.isElectron?(window.electronAPI.onSerialData(n=>this.serialEvents.dispatchEvent(new CustomEvent("data",{detail:n}))),window.electronAPI.serialClose(()=>this.serialEvents.dispatchEvent(new CustomEvent("close"))),window.electronAPI.onSerialError(n=>this.serialEvents.dispatchEvent(new CustomEvent("error",{detail:n}))),window.electronAPI.onTcpData(n=>this.tcpEvents.dispatchEvent(new CustomEvent("data",{detail:n}))),window.electronAPI.onTcpEnd(()=>this.tcpEvents.dispatchEvent(new CustomEvent("close"))),window.electronAPI.onTcpError(n=>this.tcpEvents.dispatchEvent(new CustomEvent("error",{detail:n}))),window.electronAPI.onUdpMessage(n=>this.udpEvents.dispatchEvent(new CustomEvent("data",{detail:n}))),window.electronAPI.onUdpError(n=>this.udpEvents.dispatchEvent(new CustomEvent("error",{detail:n})))):(webSerial.events.addEventListener("data",n=>this.serialEvents.dispatchEvent(new CustomEvent("data",{detail:n.detail}))),webSerial.events.addEventListener("close",()=>this.serialEvents.dispatchEvent(new CustomEvent("close"))),webSerial.events.addEventListener("error",n=>this.serialEvents.dispatchEvent(new CustomEvent("error",{detail:n.detail}))))},githubApiUrl:function(n){},getAppLocale:function(){return this.isElectron?window.electronAPI.appGetLocale():navigator.language},storeGet:function(n,e){return this.isElectron?window.electronAPI.storeGet(n,e):webLocalStorage.get(n,e)},storeSet:function(n,e){this.isElectron?window.electronAPI.storeSet(n,e):webLocalStorage.set(n,e)},storeDelete:function(n){this.isElectron?window.electronAPI.storeDelete(n):webLocalStorage.delete(n)},getAppVersion:function(){return this.isElectron?window.electronAPI.appGetVersion():pkg.version},serialConnect:function(n,e){return this.isElectron?window.electronAPI.serialConnect(n,e):webSerial.connect(n,e)},serialClose:function(){return this.isElectron?window.electronAPI.serialClose():webSerial.close()},serialSend:function(n){return this.isElectron?window.electronAPI.serialSend(n):webSerial.send(n)},tcpConnect:function(n,e,t,i){if(this.isElectron)return t.electronAPI.tcpConnect(n,e)},tcpClose:function(){if(this.isElectron)return window.electronAPI.tcpClose()},tcpSend:function(n){if(this.isElectron)return window.electronAPI.tcpSend(n)},udpConnect:function(n,e,t,i){if(this.isElectron)return t.electronAPI.udpConnect(n,e)},udpClose:function(){if(this.isElectron)return window.electronAPI.udpClose()},udpSend:function(n){if(this.isElectron)return window.electronAPI.udpSend(n)},listSerialDevices:async function(){return this.isElectron?window.electronAPI.listSerialDevices():webSerial.getDevices()},requestWebSerialPermission:async function(){if(!this.isElectron)return webSerial.requestPermission()}};var MSPCodes={MSP_API_VERSION:1,MSP_FC_VARIANT:2,MSP_FC_VERSION:3,MSP_BOARD_INFO:4,MSP_BUILD_INFO:5,MSP_INAV_PID:6,MSP_SET_INAV_PID:7,MSP_NAME:10,MSP_SET_NAME:11,MSP_NAV_POSHOLD:12,MSP_SET_NAV_POSHOLD:13,MSP_CALIBRATION_DATA:14,MSP_SET_CALIBRATION_DATA:15,MSP_WP_MISSION_LOAD:18,MSP_WP_MISSION_SAVE:19,MSP_WP_GETINFO:20,MSP_RTH_AND_LAND_CONFIG:21,MSP_SET_RTH_AND_LAND_CONFIG:22,MSP_FW_CONFIG:23,MSP_SET_FW_CONFIG:24,MSP_MODE_RANGES:34,MSP_SET_MODE_RANGE:35,MSP_FEATURE:36,MSP_SET_FEATURE:37,MSP_BOARD_ALIGNMENT:38,MSP_SET_BOARD_ALIGNMENT:39,MSP_CURRENT_METER_CONFIG:40,MSP_SET_CURRENT_METER_CONFIG:41,MSP_RX_CONFIG:44,MSP_SET_RX_CONFIG:45,MSP_LED_COLORS:46,MSP_SET_LED_COLORS:47,MSP_LED_STRIP_CONFIG:48,MSP_SET_LED_STRIP_CONFIG:49,MSP_ADJUSTMENT_RANGES:52,MSP_SET_ADJUSTMENT_RANGE:53,MSP_CF_SERIAL_CONFIG:54,MSP_SET_CF_SERIAL_CONFIG:55,MSP_SONAR:58,MSP_DATAFLASH_SUMMARY:70,MSP_DATAFLASH_READ:71,MSP_DATAFLASH_ERASE:72,MSP_LOOP_TIME:73,MSP_SET_LOOP_TIME:74,MSP_FAILSAFE_CONFIG:75,MSP_SET_FAILSAFE_CONFIG:76,MSP_SDCARD_SUMMARY:79,MSP_BLACKBOX_CONFIG:80,MSP_SET_BLACKBOX_CONFIG:81,MSP_OSD_CHAR_READ:86,MSP_OSD_CHAR_WRITE:87,MSP_VTX_CONFIG:88,MSP_SET_VTX_CONFIG:89,MSP_ADVANCED_CONFIG:90,MSP_SET_ADVANCED_CONFIG:91,MSP_FILTER_CONFIG:92,MSP_SET_FILTER_CONFIG:93,MSP_PID_ADVANCED:94,MSP_SET_PID_ADVANCED:95,MSP_SENSOR_CONFIG:96,MSP_SET_SENSOR_CONFIG:97,MSP_IDENT:100,MSP_STATUS:101,MSP_RAW_IMU:102,MSP_SERVO:103,MSP_MOTOR:104,MSP_RC:105,MSP_RAW_GPS:106,MSP_COMP_GPS:107,MSP_ATTITUDE:108,MSP_ALTITUDE:109,MSP_RC_TUNING:111,MSP_PID:112,MSP_ACTIVEBOXES:113,MSP_MOTOR_PINS:115,MSP_PIDNAMES:117,MSP_WP:118,MSP_BOXIDS:119,MSP_SERVO_CONFIGURATIONS:120,MSP_3D:124,MSP_RC_DEADBAND:125,MSP_SENSOR_ALIGNMENT:126,MSP_LED_STRIP_MODECOLOR:127,MSP_STATUS_EX:150,MSP_SENSOR_STATUS:151,MSP_SET_RAW_RC:200,MSP_SET_RAW_GPS:201,MSP_SET_PID:202,MSP_SET_BOX:203,MSP_SET_RC_TUNING:204,MSP_ACC_CALIBRATION:205,MSP_MAG_CALIBRATION:206,MSP_RESET_CONF:208,MSP_SET_WP:209,MSP_SELECT_SETTING:210,MSP_SET_HEAD:211,MSP_SET_MOTOR:214,MSP_SET_3D:217,MSP_SET_RC_DEADBAND:218,MSP_SET_RESET_CURR_PID:219,MSP_SET_SENSOR_ALIGNMENT:220,MSP_SET_LED_STRIP_MODECOLOR:221,MSP_RTC:246,MSP_SET_RTC:247,MSP_EEPROM_WRITE:250,MSP_DEBUGMSG:253,MSP_DEBUG:254,MSP_UID:160,MSP_ACC_TRIM:240,MSP_SET_ACC_TRIM:239,MSP_GPS_SV_INFO:164,MSP_GPSSTATISTICS:166,MSP_RX_MAP:64,MSP_SET_RX_MAP:65,MSP_BF_CONFIG:66,MSP_SET_BF_CONFIG:67,MSP_SET_REBOOT:68,MSP_BF_BUILD_INFO:69,MSPV2_SETTING:4099,MSPV2_SET_SETTING:4100,MSP2_COMMON_MOTOR_MIXER:4101,MSP2_COMMON_SET_MOTOR_MIXER:4102,MSP2_COMMON_SETTING_INFO:4103,MSP2_COMMON_PG_LIST:4104,MSP2_CF_SERIAL_CONFIG:4105,MSP2_SET_CF_SERIAL_CONFIG:4106,MSPV2_INAV_STATUS:8192,MSPV2_INAV_OPTICAL_FLOW:8193,MSPV2_INAV_ANALOG:8194,MSPV2_INAV_MISC:8195,MSPV2_INAV_SET_MISC:8196,MSPV2_INAV_BATTERY_CONFIG:8197,MSPV2_INAV_SET_BATTERY_CONFIG:8198,MSPV2_INAV_RATE_PROFILE:8199,MSPV2_INAV_SET_RATE_PROFILE:8200,MSPV2_INAV_AIR_SPEED:8201,MSPV2_INAV_OUTPUT_MAPPING:8202,MSP2_INAV_MC_BRAKING:8203,MSP2_INAV_SET_MC_BRAKING:8204,MSPV2_INAV_OUTPUT_MAPPING_EXT:8205,MSPV2_INAV_OUTPUT_MAPPING_EXT2:8461,MSP2_INAV_TIMER_OUTPUT_MODE:8206,MSP2_INAV_SET_TIMER_OUTPUT_MODE:8207,MSP2_INAV_MIXER:8208,MSP2_INAV_SET_MIXER:8209,MSP2_INAV_OSD_LAYOUTS:8210,MSP2_INAV_OSD_SET_LAYOUT_ITEM:8211,MSP2_INAV_OSD_ALARMS:8212,MSP2_INAV_OSD_SET_ALARMS:8213,MSP2_INAV_OSD_PREFERENCES:8214,MSP2_INAV_OSD_SET_PREFERENCES:8215,MSP2_INAV_SELECT_BATTERY_PROFILE:8216,MSP2_INAV_DEBUG:8217,MSP2_BLACKBOX_CONFIG:8218,MSP2_SET_BLACKBOX_CONFIG:8219,MSP2_INAV_TEMP_SENSOR_CONFIG:8220,MSP2_INAV_SET_TEMP_SENSOR_CONFIG:8221,MSP2_INAV_TEMPERATURES:8222,MSP2_INAV_SERVO_MIXER:8224,MSP2_INAV_SET_SERVO_MIXER:8225,MSP2_INAV_LOGIC_CONDITIONS:8226,MSP2_INAV_SET_LOGIC_CONDITIONS:8227,MSP2_INAV_GLOBAL_FUNCTIONS:8228,MSP2_INAV_SET_GLOBAL_FUNCTIONS:8229,MSP2_INAV_LOGIC_CONDITIONS_STATUS:8230,MSP2_INAV_GVAR_STATUS:8231,MSP2_INAV_PROGRAMMING_PID:8232,MSP2_INAV_SET_PROGRAMMING_PID:8233,MSP2_INAV_PROGRAMMING_PID_STATUS:8234,MSP2_PID:8240,MSP2_SET_PID:8241,MSP2_INAV_OPFLOW_CALIBRATION:8242,MSP2_INAV_FWUPDT_PREPARE:8243,MSP2_INAV_FWUPDT_STORE:8244,MSP2_INAV_FWUPDT_EXEC:8245,MSP2_INAV_FWUPDT_ROLLBACK_PREPARE:8246,MSP2_INAV_FWUPDT_ROLLBACK_EXEC:8247,MSP2_INAV_SAFEHOME:8248,MSP2_INAV_SET_SAFEHOME:8249,MSP2_INAV_LOGIC_CONDITIONS_SINGLE:8251,MSP2_INAV_LED_STRIP_CONFIG_EX:8264,MSP2_INAV_SET_LED_STRIP_CONFIG_EX:8265,MSP2_INAV_FW_APPROACH:8266,MSP2_INAV_SET_FW_APPROACH:8267,MSP2_INAV_GPS_UBLOX_COMMAND:8272,MSP2_INAV_RATE_DYNAMICS:8288,MSP2_INAV_SET_RATE_DYNAMICS:8289,MSP2_INAV_EZ_TUNE:8304,MSP2_INAV_EZ_TUNE_SET:8305,MSP2_INAV_SELECT_MIXER_PROFILE:8320,MSP2_ADSB_VEHICLE_LIST:8336,MSP2_INAV_CUSTOM_OSD_ELEMENTS:8448,MSP2_INAV_CUSTOM_OSD_ELEMENT:8449,MSP2_INAV_SET_CUSTOM_OSD_ELEMENTS:8450,MSP2_INAV_SERVO_CONFIG:8704,MSP2_INAV_SET_SERVO_CONFIG:8705,MSP2_INAV_GEOZONE:8720,MSP2_INAV_SET_GEOZONE:8721,MSP2_INAV_GEOZONE_VERTEX:8722,MSP2_INAV_SET_GEOZONE_VERTICE:8723},CONFIGURATOR={minfirmwareVersionAccepted:"9.0.0",maxFirmwareVersionAccepted:"10.0.0",connectionValid:!1,cliActive:!1,cliValid:!1,connection:!1},SimpleSmoothFilter=function(n,e){var t={};return t.value=n,t.smoothFactor=e,t.smoothFactor>=1&&(t.smoothFactor=.99),t.smoothFactor<=0&&(t.smoothFactor=0),t.apply=function(i){return t.value=i*(1-t.smoothFactor)+t.value*t.smoothFactor,t},t.get=function(){return t.value},t},eventFrequencyAnalyzer=(function(){var n={},e={},t=5e3;return n.data={},n.output={},e.analyze=function(){n.output={};for(var i in n.data)n.data.hasOwnProperty(i)&&(n.output[i]=n.data[i]/t*1e3);return n.data={},n.output},e.get=function(){return n.output},e.getRaw=function(){return n.data},e.put=function(i){n.data[i]?n.data[i]++:n.data[i]=1},e.setBufferPeriod=function(i){t=i,clearInterval(n.intervalHandler),n.intervalHandler=setInterval(e.analyze,t)},n.intervalHandler=setInterval(e.analyze,t),e})(),mspDeduplicationQueue=(function(){let n={},e={};return e.queue=[],n.put=function(t){e.queue.push(t)},n.remove=function(t){const i=e.queue.indexOf(t);i>-1&&e.queue.splice(i,1)},n.check=function(t){return e.queue.includes(t)},n.flush=function(){e.queue=[]},n.get=function(){return e.queue},n})(),mspQueue=(function(){var n={},e={};return e.handlerFrequency=100,e.balancerFrequency=20,e.loadFilter=new SimpleSmoothFilter(1,.85),e.roundtripFilter=new SimpleSmoothFilter(20,.95),e.hardwareRoundtripFilter=new SimpleSmoothFilter(10,.95),e.targetLoad=2,e.statusDropFactor=.75,e.currentLoad=0,e.removeCallback=null,e.putCallback=null,e.queue=[],e.softLock=!1,e.hardLock=!1,e.lockMethod="soft",e.queueLocked=!1,n.setremoveCallback=function(t){e.removeCallback=t},n.setPutCallback=function(t){e.putCallback=t},n.lock=function(){e.queueLocked=!0},n.unlock=function(){e.queueLocked=!1},n.setLockMethod=function(t){e.lockMethod=t},n.getLockMethod=function(){return e.lockMethod},n.setSoftLock=function(){e.softLock=new Date().getTime()},n.setHardLock=function(){e.hardLock=new Date().getTime()},n.freeSoftLock=function(){e.softLock=!1},n.freeHardLock=function(){e.hardLock=!1},n.isLocked=function(){return e.lockMethod==="soft"?e.softLock!==!1:e.hardLock!==!1},e.getTimeout=function(t){return t==MSPCodes.MSP_SET_REBOOT||t==MSPCodes.MSP_EEPROM_WRITE?5e3:CONFIGURATOR.connection.getTimeout()},n.executor=function(){if(eventFrequencyAnalyzer.put("execute"),e.loadFilter.apply(e.queue.length),n.isLocked()||CONFIGURATOR.connection===!1)return eventFrequencyAnalyzer.put("port in use"),!1;var t=e.get();t!==void 0&&(n.setSoftLock(),n.setHardLock(),t.timer=setTimeout(function(){console.log("MSP data request timed-out: "+t.code),mspDeduplicationQueue.remove(t.code),e.removeCallback(t.code),t.retryCounter>0&&(t.retryCounter--,n.put(t))},e.getTimeout(t.code)),t.sentOn===null&&(t.sentOn=new Date().getTime()),e.putCallback(t),eventFrequencyAnalyzer.put("message sent"),CONFIGURATOR.connection.send(t.messageBody,function(i){i.bytesSent==t.messageBody.byteLength&&(t.onSend&&t.onSend(),n.freeSoftLock())}))},e.get=function(){return e.queue.shift()},n.flush=function(){e.queue=[]},n.put=function(t){return mspDeduplicationQueue.check(t.code)?(eventFrequencyAnalyzer.put("MSP Duplicate "+t.code),!1):e.queueLocked===!0?!1:(mspDeduplicationQueue.put(t.code),e.queue.push(t),!0)},n.getLength=function(){return e.queue.length},n.getLoad=function(){return e.loadFilter.get()},n.getRoundtrip=function(){return e.roundtripFilter.get()},n.putRoundtrip=function(t){e.roundtripFilter.apply(t)},n.getHardwareRoundtrip=function(){return e.hardwareRoundtripFilter.get()},n.putHardwareRoundtrip=function(t){e.hardwareRoundtripFilter.apply(t)},n.balancer=function(){e.currentLoad=e.loadFilter.get();var t=new Date().getTime(),i=n.getHardwareRoundtrip()*3;i>5e3&&(i=5e3),i<1e3&&(i=1e3),e.softLock!==!1&&t-e.softLock>i&&(n.freeSoftLock(),eventFrequencyAnalyzer.put("force free soft lock")),e.hardLock!==!1&&t-e.hardLock>i&&(console.log("Force free hard lock"),n.freeHardLock(),eventFrequencyAnalyzer.put("force free hard lock"))},n.getIntervalPrediction=function(t,i){var s=1e3/t*i,r=1e3/n.getRoundtrip()*.8;return s<r?t:1e3/r*i},n.getQueue=function(){return e.queue},setInterval(n.executor,Math.round(1e3/e.handlerFrequency)),setInterval(n.balancer,Math.round(1e3/e.balancerFrequency)),n})(),timeout=(function(){var n={},e={};return n.timeouts=[],e.add=function(t,i,s){var r={name:t,timer:null,timeout:s};return r.timer=setTimeout(function(){i();var o=n.timeouts.indexOf(r);o>-1&&n.timeouts.splice(o,1)},s),n.timeouts.push(r),r},e.remove=function(t){for(var i=0;i<n.timeouts.length;i++)if(n.timeouts[i].name==t)return clearTimeout(n.timeouts[i].timer),n.timeouts.splice(i,1),!0;return!1},e.killAll=function(){for(var t=0,i=0;i<n.timeouts.length;i++)clearTimeout(n.timeouts[i].timer),t++;return n.timeouts=[],t},e})(),MspMessageClass=function(){var n={};return n.code=null,n.messageBody=null,n.onFinish=null,n.onSend=null,n.timer=!1,n.createdOn=new Date().getTime(),n.sentOn=null,n.retryCounter=5,n},MSP={SDCARD_STATE_NOT_PRESENT:0,SDCARD_STATE_FATAL:1,SDCARD_STATE_CARD_INIT:2,SDCARD_STATE_FS_INIT:3,SDCARD_STATE_READY:4,symbols:{BEGIN:36,PROTO_V1:77,PROTO_V2:88,FROM_MWC:62,TO_MWC:60,UNSUPPORTED:33},constants:{PROTOCOL_V1:1,PROTOCOL_V2:2,JUMBO_FRAME_MIN_SIZE:255},decoder_states:{IDLE:0,PROTO_IDENTIFIER:1,DIRECTION_V1:2,DIRECTION_V2:3,FLAG_V2:4,PAYLOAD_LENGTH_V1:5,PAYLOAD_LENGTH_JUMBO_LOW:6,PAYLOAD_LENGTH_JUMBO_HIGH:7,PAYLOAD_LENGTH_V2_LOW:8,PAYLOAD_LENGTH_V2_HIGH:9,CODE_V1:10,CODE_JUMBO_V1:11,CODE_V2_LOW:12,CODE_V2_HIGH:13,PAYLOAD_V1:14,PAYLOAD_V2:15,CHECKSUM_V1:16,CHECKSUM_V2:17},protocolVersion:2,state:0,message_direction:1,code:0,message_length_expected:0,message_length_received:0,message_buffer:null,message_buffer_uint8_view:null,message_checksum:0,callbacks:[],packet_error:0,unsupported:0,ledDirectionLetters:["n","e","s","w","u","d"],ledFunctionLetters:["i","w","f","a","t","r","c","g","s","b","l"],ledBaseFunctionLetters:["c","f","a","l","s","g","r","h"],ledOverlayLetters:["t","o","b","n","i","w","e"],last_received_timestamp:null,analog_last_received_timestamp:null,lastFrameReceivedMs:0,processData:null,init(){mspQueue.setPutCallback(this.putCallback),mspQueue.setremoveCallback(this.removeCallback)},setProcessData(n){this.processData=n},read:function(n){for(var e=new Uint8Array(n.data),t=0;t<e.length;t++)switch(this.state){case this.decoder_states.IDLE:e[t]==this.symbols.BEGIN&&(this.state=this.decoder_states.PROTO_IDENTIFIER);break;case this.decoder_states.PROTO_IDENTIFIER:switch(e[t]){case this.symbols.PROTO_V1:this.state=this.decoder_states.DIRECTION_V1;break;case this.symbols.PROTO_V2:this.state=this.decoder_states.DIRECTION_V2;break;default:console.log("Unknown protocol char "+String.fromCharCode(e[t])),this.state=this.decoder_states.IDLE}break;case this.decoder_states.DIRECTION_V1:case this.decoder_states.DIRECTION_V2:switch(this.unsupported=0,e[t]){case this.symbols.FROM_MWC:this.message_direction=1;break;case this.symbols.TO_MWC:this.message_direction=0;break;case this.symbols.UNSUPPORTED:this.unsupported=1;break}this.state=this.state==this.decoder_states.DIRECTION_V1?this.decoder_states.PAYLOAD_LENGTH_V1:this.decoder_states.FLAG_V2;break;case this.decoder_states.FLAG_V2:this.state=this.decoder_states.CODE_V2_LOW;break;case this.decoder_states.PAYLOAD_LENGTH_V1:this.message_length_expected=e[t],this.message_length_expected==this.constants.JUMBO_FRAME_MIN_SIZE?this.state=this.decoder_states.CODE_JUMBO_V1:(this._initialize_read_buffer(),this.state=this.decoder_states.CODE_V1);break;case this.decoder_states.PAYLOAD_LENGTH_V2_LOW:this.message_length_expected=e[t],this.state=this.decoder_states.PAYLOAD_LENGTH_V2_HIGH;break;case this.decoder_states.PAYLOAD_LENGTH_V2_HIGH:this.message_length_expected|=e[t]<<8,this._initialize_read_buffer(),this.state=this.message_length_expected>0?this.decoder_states.PAYLOAD_V2:this.state=this.decoder_states.CHECKSUM_V2;break;case this.decoder_states.CODE_V1:case this.decoder_states.CODE_JUMBO_V1:this.code=e[t],this.message_length_expected>0?this.state==this.decoder_states.CODE_JUMBO_V1?this.state=this.decoder_states.PAYLOAD_LENGTH_JUMBO_LOW:this.state=this.decoder_states.PAYLOAD_V1:this.state=this.decoder_states.CHECKSUM_V1;break;case this.decoder_states.CODE_V2_LOW:this.code=e[t],this.state=this.decoder_states.CODE_V2_HIGH;break;case this.decoder_states.CODE_V2_HIGH:this.code|=e[t]<<8,this.state=this.decoder_states.PAYLOAD_LENGTH_V2_LOW;break;case this.decoder_states.PAYLOAD_LENGTH_JUMBO_LOW:this.message_length_expected=e[t],this.state=this.decoder_states.PAYLOAD_LENGTH_JUMBO_HIGH;break;case this.decoder_states.PAYLOAD_LENGTH_JUMBO_HIGH:this.message_length_expected|=e[t]<<8,this._initialize_read_buffer(),this.state=this.decoder_states.PAYLOAD_V1;break;case this.decoder_states.PAYLOAD_V1:case this.decoder_states.PAYLOAD_V2:this.message_buffer_uint8_view[this.message_length_received]=e[t],this.message_length_received++,this.message_length_received>=this.message_length_expected&&(this.state=this.state==this.decoder_states.PAYLOAD_V1?this.decoder_states.CHECKSUM_V1:this.decoder_states.CHECKSUM_V2);break;case this.decoder_states.CHECKSUM_V1:this.message_length_expected>=this.constants.JUMBO_FRAME_MIN_SIZE?this.message_checksum=this.constants.JUMBO_FRAME_MIN_SIZE:this.message_checksum=this.message_length_expected,this.message_checksum^=this.code,this.message_length_expected>=this.constants.JUMBO_FRAME_MIN_SIZE&&(this.message_checksum^=this.message_length_expected&255,this.message_checksum^=(this.message_length_expected&65280)>>8);for(var i=0;i<this.message_length_received;i++)this.message_checksum^=this.message_buffer_uint8_view[i];this._dispatch_message(e[t]);break;case this.decoder_states.CHECKSUM_V2:this.message_checksum=0,this.message_checksum=this._crc8_dvb_s2(this.message_checksum,0),this.message_checksum=this._crc8_dvb_s2(this.message_checksum,this.code&255),this.message_checksum=this._crc8_dvb_s2(this.message_checksum,(this.code&65280)>>8),this.message_checksum=this._crc8_dvb_s2(this.message_checksum,this.message_length_expected&255),this.message_checksum=this._crc8_dvb_s2(this.message_checksum,(this.message_length_expected&65280)>>8);for(var i=0;i<this.message_length_received;i++)this.message_checksum=this._crc8_dvb_s2(this.message_checksum,this.message_buffer_uint8_view[i]);this._dispatch_message(e[t]);break;default:mspQueue.freeHardLock(),console.log("Unknown state detected: "+this.state)}this.last_received_timestamp=Date.now()},_initialize_read_buffer(){this.message_buffer=new ArrayBuffer(this.message_length_expected),this.message_buffer_uint8_view=new Uint8Array(this.message_buffer)},_dispatch_message(n){this.message_checksum==n?(this.processData(this),this.lastFrameReceivedMs=Date.now()):(console.log("code: "+this.code+" - crc failed"),this.packet_error++,$("span.packet-error").html(this.packet_error)),timeout.add("delayedFreeHardLock",function(){mspQueue.freeHardLock()},10),this.message_length_received=0,this.state=this.decoder_states.IDLE},putCallback(n){MSP.callbacks.push(n)},removeCallback(n){for(var e in this.callbacks)MSP.callbacks.hasOwnProperty(e)&&this.callbacks[e].code==n&&(clearTimeout(this.callbacks[e].timer),MSP.callbacks.splice(e,1))},send_message(n,e,t,i,s){var r=e&&e.length?e.length:0,o,a,h,c;switch(eventFrequencyAnalyzer.put("MPS "+n),s||(s=this.protocolVersion),s){case this.constants.PROTOCOL_V1:o=r+6,a=new ArrayBuffer(o),h=new Uint8Array(a),h[0]=this.symbols.BEGIN,h[1]=this.symbols.PROTO_V1,h[2]=this.symbols.TO_MWC,h[3]=r,h[4]=n,c=h[3]^h[4];for(let f=0;f<r;f++)h[f+5]=e[f],c^=e[f];h[o-1]=c;break;case this.constants.PROTOCOL_V2:o=r+9,a=new ArrayBuffer(o),h=new Uint8Array(a),h[0]=this.symbols.BEGIN,h[1]=this.symbols.PROTO_V2,h[2]=this.symbols.TO_MWC,h[3]=0,h[4]=n&255,h[5]=(n&65280)>>8,h[6]=r&255,h[7]=(r&65280)>>8;for(let f=0;f<r;f++)h[8+f]=e[f];c=0;for(let f=3;f<o-1;f++)c=this._crc8_dvb_s2(c,h[f]);h[o-1]=c;break;default:throw"Invalid MSP protocol version "+s}var d=new MspMessageClass;return d.code=n,d.messageBody=a,d.onFinish=i,d.onSend=t,(n==MSPCodes.MSP_SET_REBOOT||n==MSPCodes.MSP_EEPROM_WRITE)&&(d.retryCounter=10),mspQueue.put(d),!0},_crc8_dvb_s2(n,e){n^=e;for(var t=0;t<8;++t)n&128?n=n<<1&255^213:n=n<<1&255;return n},promise(n,e,t){var i=this;return new Promise(function(s){i.send_message(n,e,!1,function(r){s(r)},t)})},callbacks_cleanup(){for(var n=0;n<this.callbacks.length;n++)clearInterval(this.callbacks[n].timer);this.callbacks=[]},disconnect_cleanup(){this.state=0,this.packet_error=0,this.callbacks_cleanup()},isReceiving:function(){return Date.now()-this.lastFrameReceivedMs<5e3},wasEverReceiving:function(){return this.lastFrameReceivedMs>0}},ServoMixRule=function(n,e,t,i,s){var r={};return r.getTarget=function(){return n},r.setTarget=function(o){n=o},r.getInput=function(){return e},r.setInput=function(o){e=o},r.getRate=function(){return t},r.setRate=function(o){t=o},r.getSpeed=function(){return i},r.setSpeed=function(o){i=o},r.isUsed=function(){return t!==0},r.getConditionId=function(){return s??-1},r.setConditionId=function(o){s=o},r},ServoMixerRuleCollection=function(){let n={},e=[],t=[],i=16;return n.setServoCount=function(s){i=s},n.getServoCount=function(){return i},n.getServoRulesCount=function(){return n.getServoCount()*2},n.put=function(s){e.length<n.getServoRulesCount()?e.push(s):t.push(s)},n.get=function(){return e},n.drop=function(s){e[s].setRate(0),n.cleanup()},n.flush=function(){e=[],t=[]},n.cleanup=function(){var s=[],r=[];e.forEach(function(o){o.isUsed()&&s.push(o)}),t.forEach(function(o){o.isUsed()&&r.push(o)}),e=s,t=r},n.inflate=function(){for(;n.hasFreeSlots();)n.put(new ServoMixRule(0,0,0,0))},n.hasFreeSlots=function(){return e.length<n.getServoRulesCount()},n.isServoConfigured=function(s){for(let r in e)if(e.hasOwnProperty(r)){let o=e[r];if(o.getTarget()==s&&o.isUsed())return!0}for(let r in t)if(t.hasOwnProperty(r)){let o=t[r];if(o.getTarget()==s&&o.isUsed())return!0}return!1},n.getServoMixRuleFromTarget=function(s){let r=null;for(let o in e)if(e.hasOwnProperty(o)&&e[o].getTarget()==s){r=e[o];break}return r},n.getNumberOfConfiguredServos=function(){let s=0;for(let r=0;r<n.getServoCount();r++)n.isServoConfigured(r)&&s++;return s},n.getUsedServoIndexes=function(){let s=[];for(let a in e)if(e.hasOwnProperty(a)){let h=e[a];s.push(h.getTarget())}for(let a in t)if(t.hasOwnProperty(a)){let h=t[a];s.push(h.getTarget())}let r=Math.min(...s),o=Math.max(...s);return Array.from({length:o-r+1},(a,h)=>r+h)},n.getNextUnusedIndex=function(){let s=0;for(let r in e)if(e.hasOwnProperty(r)){let o=e[r].getTarget();o>s&&(s=o)}return s+1},n};function constrain(n,e,t){return n<e?e:n>t?t:n}function zeroPad(n,e){for(n=""+n;n.length<e;)n="0"+n;return n}function generateFilename(n,e,t){var i=new Date,s=e;return n&&(n.flightControllerIdentifier&&(s=n.flightControllerIdentifier+"_"+n.flightControllerVersion+"_"+s),n.name&&n.name.trim()!==""&&(s=s+"_"+n.name.trim().replace(" ","_"))),s=s+"_"+i.getFullYear()+zeroPad(i.getMonth()+1,2)+zeroPad(i.getDate(),2)+"_"+zeroPad(i.getHours(),2)+zeroPad(i.getMinutes(),2)+zeroPad(i.getSeconds(),2),s+"."+t}function scaleRangeInt(n,e,t,i,s){let r=(s-i)*(n-e),o=t-e;return Math.round(r/o+i)}function distanceOnLine(n,e,t){var i=e[0]-n[0],s=e[1]-n[1],r=Math.sqrt(i*i+s*s);i/=r,s/=r;var o=n[0]+i*(r+t),a=n[1]+s*(r+t);return[o,a]}function wrap_360(n){return n>=360&&(n-=360),n<0&&(n+=360),n}function rad2Deg(n){return n*(180/Math.PI)}function deg2Rad(n){return n*(Math.PI/180)}function calculate_new_cooridatnes(n,e,t){var i=deg2Rad(n.lat),s=deg2Rad(n.lon);e=deg2Rad(e);var r=t/6371e5,o=Math.asin(Math.sin(i)*Math.cos(r)+Math.cos(i)*Math.sin(r)*Math.cos(e)),a=s+Math.atan2(Math.sin(e)*Math.sin(r)*Math.cos(i),Math.cos(r)-Math.sin(i)*Math.sin(i));return{lat:rad2Deg(o),lon:rad2Deg(a)}}var MotorMixRule=function(n,e,t,i){var s={};return s.fromMsp=function(r,o,a,h){n=Math.round((r/1e3-2)*1e3)/1e3,e=Math.round((o/1e3-2)*1e3)/1e3,t=Math.round((a/1e3-2)*1e3)/1e3,i=Math.round((h/1e3-2)*1e3)/1e3},s.isUsed=function(){return n!==0},s.getThrottle=function(){return constrain(parseFloat(n,10),-2,2)},s.getThrottleForMsp=function(){return(s.getThrottle()+2)*1e3},s.setThrottle=function(r){n=r},s.getRoll=function(){return constrain(parseFloat(e,10),-2,2)},s.getRollForMsp=function(){return(s.getRoll()+2)*1e3},s.setRoll=function(r){e=r},s.getPitch=function(){return constrain(parseFloat(t,10),-2,2)},s.getPitchForMsp=function(){return(s.getPitch()+2)*1e3},s.setPitch=function(r){t=r},s.getYaw=function(){return constrain(parseFloat(i,10),-2,2)},s.getYawForMsp=function(){return(s.getYaw()+2)*1e3},s.setYaw=function(r){i=r},s},MotorMixerRuleCollection=function(){let n={},e=[],t=[],i=8;return n.setMotorCount=function(s){i=s},n.getMotorCount=function(){return i},n.put=function(s){e.length<n.getMotorCount()?e.push(s):t.push(s)},n.get=function(){return e},n.drop=function(s){e[s].setThrottle(0),n.cleanup()},n.flush=function(){e=[],t=[]},n.cleanup=function(){var s=[],r=[];e.forEach(function(o){o.isUsed()&&s.push(o)}),t.forEach(function(o){o.isUsed()&&r.push(o)}),e=s,t=r},n.inflate=function(){for(;n.hasFreeSlots();)n.put(new MotorMixRule(0,0,0,0))},n.hasFreeSlots=function(){return e.length<n.getMotorCount()},n.getNumberOfConfiguredMotors=function(){return e.length>t.length?e.length:t.length},n},LogicConditionsCollection=function(){let n={},e=[],t,i=64;return n.getMaxLogicConditionCount=function(){return i},n.put=function(s){e.push(s)},n.get=function(){return e},n.flush=function(){e=[]},n.getCount=function(){return e.length},n.isEnabled=function(s){return e[s].getEnabled()},n.open=function(){n.render(),t.show()},n.render=function(){let s=t.find(".logic__table");s.find("tbody tr").remove();for(let r in n.get())n.get().hasOwnProperty(r)&&n.get()[r].render(r,s)},n.onSave=function(){let s=new MSPChainerClass;s.setChain([mspHelper.sendLogicConditions,mspHelper.saveToEeprom]),s.execute()},n.onClose=function(){t.hide()},n.init=function(s){t=s,t.find(".logic__save").on("click",n.onSave),t.find(".logic__close").on("click",n.onClose)},n.update=function(s){let r=t.find(".logic__table");for(let o in n.get())n.get().hasOwnProperty(o)&&n.get()[o].update(o,s.get(o),r)},n};let LogicConditionsStatus=function(){let n={},e=[];return n.set=function(t,i){e[t]=i},n.get=function(t){return typeof e[t]<"u"?e[t]:null},n.getAll=function(){return e},n};var GlobalVariablesStatus=function(){let n={},e=[];return n.set=function(t,i){e[t]=i},n.get=function(t){return typeof e[t]<"u"?e[t]:null},n.getAll=function(){return e},n.update=function(t){for(let i in n.getAll())n.getAll().hasOwnProperty(i)&&t.find("[data-gvar-index="+i+"]").html(n.get(i))},n.init=function(t){let i=n.getAll().length,s=t.find(".gvar__wrapper:first").prop("outerHTML");t.find(".gvar__wrapper").remove();for(let r=0;r<i;r++){t.append(s);let o=t.find(".gvar__wrapper:last");o.find("h2").html("GVAR "+r),o.find("label").attr("data-gvar-index",r),o.find("label").html("0")}t.find(".gvar__wrapper").css("width",100/i+"%")},n},ProgrammingPidCollection=function(){let n={},e=[],t;return n.put=function(i){e.push(i)},n.get=function(){return e},n.flush=function(){e=[]},n.getCount=function(){return e.length},n.open=function(){n.render(),t.show()},n.init=function(i){t=i},n.render=function(){let i=t.find(".pid__table");i.find("tbody tr").remove();for(let s in n.get())n.get().hasOwnProperty(s)&&n.get()[s].render(s,i)},n.update=function(i){let s=t.find(".pid__table");for(let r in n.get())n.get().hasOwnProperty(r)&&n.get()[r].update(r,i.get(r),s)},n},ProgrammingPidStatus=function(){let n={},e=[];return n.set=function(t,i){e[t]=i},n.get=function(t){return typeof e[t]<"u"?e[t]:null},n.getAll=function(){return e},n.update=function(t){},n.init=function(t){},n};function clamp(n,e,t){return Math.min(Math.max(n,e),t)}function squaredSegmentDistance(n,e,t,i,s,r){const o=s-t,a=r-i;if(o!==0||a!==0){const h=((n-t)*o+(e-i)*a)/(o*o+a*a);h>1?(t=s,i=r):h>0&&(t+=o*h,i+=a*h)}return squaredDistance(n,e,t,i)}function squaredDistance(n,e,t,i){const s=t-n,r=i-e;return s*s+r*r}function solveLinearSystem(n){const e=n.length;for(let i=0;i<e;i++){let s=i,r=Math.abs(n[i][i]);for(let a=i+1;a<e;a++){const h=Math.abs(n[a][i]);h>r&&(r=h,s=a)}if(r===0)return null;const o=n[s];n[s]=n[i],n[i]=o;for(let a=i+1;a<e;a++){const h=-n[a][i]/n[i][i];for(let c=i;c<e+1;c++)i==c?n[a][c]=0:n[a][c]+=h*n[i][c]}}const t=new Array(e);for(let i=e-1;i>=0;i--){t[i]=n[i][e]/n[i][i];for(let s=i-1;s>=0;s--)n[s][e]-=n[s][i]*t[i]}return t}function toDegrees(n){return n*180/Math.PI}function toRadians(n){return n*Math.PI/180}function modulo(n,e){const t=n%e;return t*e<0?t+e:t}function lerp(n,e,t){return n+t*(e-n)}function toFixed(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}function round(n,e){return Math.round(toFixed(n,e))}function floor(n,e){return Math.floor(toFixed(n,e))}function ceil(n,e){return Math.ceil(toFixed(n,e))}function wrap(n,e,t){if(n>=e&&n<t)return n;const i=t-e;return((n-e)%i+i)%i+e}const DEFAULT_RADIUS=63710088e-1;function getDistance(n,e,t){t=t||DEFAULT_RADIUS;const i=toRadians(n[1]),s=toRadians(e[1]),r=(s-i)/2,o=toRadians(e[0]-n[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(s);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function getLengthInternal(n,e){let t=0;for(let i=0,s=n.length;i<s-1;++i)t+=getDistance(n[i],n[i+1],e);return t}function getLength(n,e){e=e||{};const t=e.radius||DEFAULT_RADIUS,i=e.projection||"EPSG:3857",s=n.getType();s!=="GeometryCollection"&&(n=n.clone().transform(i,"EPSG:4326"));let r=0,o,a,h,c,d,f;switch(s){case"Point":case"MultiPoint":break;case"LineString":case"LinearRing":{o=n.getCoordinates(),r=getLengthInternal(o,t);break}case"MultiLineString":case"Polygon":{for(o=n.getCoordinates(),h=0,c=o.length;h<c;++h)r+=getLengthInternal(o[h],t);break}case"MultiPolygon":{for(o=n.getCoordinates(),h=0,c=o.length;h<c;++h)for(a=o[h],d=0,f=a.length;d<f;++d)r+=getLengthInternal(a[d],t);break}case"GeometryCollection":{const _=n.getGeometries();for(h=0,c=_.length;h<c;++h)r+=getLength(_[h],e);break}default:throw new Error("Unsupported geometry type: "+s)}return r}const Relationship={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function boundingExtent(n){const e=createEmpty();for(let t=0,i=n.length;t<i;++t)extendCoordinate(e,n[t]);return e}function buffer(n,e,t){return t?(t[0]=n[0]-e,t[1]=n[1]-e,t[2]=n[2]+e,t[3]=n[3]+e,t):[n[0]-e,n[1]-e,n[2]+e,n[3]+e]}function clone(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n.slice()}function closestSquaredDistanceXY(n,e,t){let i,s;return e<n[0]?i=n[0]-e:n[2]<e?i=e-n[2]:i=0,t<n[1]?s=n[1]-t:n[3]<t?s=t-n[3]:s=0,i*i+s*s}function containsCoordinate(n,e){return containsXY(n,e[0],e[1])}function containsExtent(n,e){return n[0]<=e[0]&&e[2]<=n[2]&&n[1]<=e[1]&&e[3]<=n[3]}function containsXY(n,e,t){return n[0]<=e&&e<=n[2]&&n[1]<=t&&t<=n[3]}function coordinateRelationship(n,e){const t=n[0],i=n[1],s=n[2],r=n[3],o=e[0],a=e[1];let h=Relationship.UNKNOWN;return o<t?h=h|Relationship.LEFT:o>s&&(h=h|Relationship.RIGHT),a<i?h=h|Relationship.BELOW:a>r&&(h=h|Relationship.ABOVE),h===Relationship.UNKNOWN&&(h=Relationship.INTERSECTING),h}function createEmpty(){return[1/0,1/0,-1/0,-1/0]}function createOrUpdate$2(n,e,t,i,s){return s?(s[0]=n,s[1]=e,s[2]=t,s[3]=i,s):[n,e,t,i]}function createOrUpdateEmpty(n){return createOrUpdate$2(1/0,1/0,-1/0,-1/0,n)}function createOrUpdateFromCoordinate(n,e){const t=n[0],i=n[1];return createOrUpdate$2(t,i,t,i,e)}function createOrUpdateFromFlatCoordinates(n,e,t,i,s){const r=createOrUpdateEmpty(s);return extendFlatCoordinates(r,n,e,t,i)}function equals$2(n,e){return n[0]==e[0]&&n[2]==e[2]&&n[1]==e[1]&&n[3]==e[3]}function extend$2(n,e){return e[0]<n[0]&&(n[0]=e[0]),e[2]>n[2]&&(n[2]=e[2]),e[1]<n[1]&&(n[1]=e[1]),e[3]>n[3]&&(n[3]=e[3]),n}function extendCoordinate(n,e){e[0]<n[0]&&(n[0]=e[0]),e[0]>n[2]&&(n[2]=e[0]),e[1]<n[1]&&(n[1]=e[1]),e[1]>n[3]&&(n[3]=e[1])}function extendFlatCoordinates(n,e,t,i,s){for(;t<i;t+=s)extendXY(n,e[t],e[t+1]);return n}function extendXY(n,e,t){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}function forEachCorner(n,e){let t;return t=e(getBottomLeft(n)),t||(t=e(getBottomRight(n)),t)||(t=e(getTopRight(n)),t)||(t=e(getTopLeft(n)),t)?t:!1}function getArea(n){let e=0;return isEmpty$1(n)||(e=getWidth(n)*getHeight(n)),e}function getBottomLeft(n){return[n[0],n[1]]}function getBottomRight(n){return[n[2],n[1]]}function getCenter(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function getCorner(n,e){let t;if(e==="bottom-left")t=getBottomLeft(n);else if(e==="bottom-right")t=getBottomRight(n);else if(e==="top-left")t=getTopLeft(n);else if(e==="top-right")t=getTopRight(n);else throw new Error("Invalid corner");return t}function getForViewAndSize(n,e,t,i,s){const[r,o,a,h,c,d,f,_]=getRotatedViewport(n,e,t,i);return createOrUpdate$2(Math.min(r,a,c,f),Math.min(o,h,d,_),Math.max(r,a,c,f),Math.max(o,h,d,_),s)}function getRotatedViewport(n,e,t,i){const s=e*i[0]/2,r=e*i[1]/2,o=Math.cos(t),a=Math.sin(t),h=s*o,c=s*a,d=r*o,f=r*a,_=n[0],y=n[1];return[_-h+f,y-c-d,_-h-f,y-c+d,_+h-f,y+c+d,_+h+f,y+c-d,_-h+f,y-c-d]}function getHeight(n){return n[3]-n[1]}function getIntersection(n,e,t){const i=t||createEmpty();return intersects$1(n,e)?(n[0]>e[0]?i[0]=n[0]:i[0]=e[0],n[1]>e[1]?i[1]=n[1]:i[1]=e[1],n[2]<e[2]?i[2]=n[2]:i[2]=e[2],n[3]<e[3]?i[3]=n[3]:i[3]=e[3]):createOrUpdateEmpty(i),i}function getTopLeft(n){return[n[0],n[3]]}function getTopRight(n){return[n[2],n[3]]}function getWidth(n){return n[2]-n[0]}function intersects$1(n,e){return n[0]<=e[2]&&n[2]>=e[0]&&n[1]<=e[3]&&n[3]>=e[1]}function isEmpty$1(n){return n[2]<n[0]||n[3]<n[1]}function returnOrUpdate(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n}function intersectsSegment(n,e,t){let i=!1;const s=coordinateRelationship(n,e),r=coordinateRelationship(n,t);if(s===Relationship.INTERSECTING||r===Relationship.INTERSECTING)i=!0;else{const o=n[0],a=n[1],h=n[2],c=n[3],d=e[0],f=e[1],_=t[0],y=t[1],S=(y-f)/(_-d);let v,I;r&Relationship.ABOVE&&!(s&Relationship.ABOVE)&&(v=_-(y-c)/S,i=v>=o&&v<=h),!i&&r&Relationship.RIGHT&&!(s&Relationship.RIGHT)&&(I=y-(_-h)*S,i=I>=a&&I<=c),!i&&r&Relationship.BELOW&&!(s&Relationship.BELOW)&&(v=_-(y-a)/S,i=v>=o&&v<=h),!i&&r&Relationship.LEFT&&!(s&Relationship.LEFT)&&(I=y-(_-o)*S,i=I>=a&&I<=c)}return i}function wrapX$2(n,e){const t=e.getExtent(),i=getCenter(n);if(e.canWrapX()&&(i[0]<t[0]||i[0]>=t[2])){const s=getWidth(t),o=Math.floor((i[0]-t[0])/s)*s;n[0]-=o,n[2]-=o}return n}function wrapAndSliceX(n,e,t){if(e.canWrapX()){const i=e.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[i[0],n[1],i[2],n[3]]];wrapX$2(n,e);const s=getWidth(i);if(getWidth(n)>s&&!t)return[[i[0],n[1],i[2],n[3]]];if(n[0]<i[0])return[[n[0]+s,n[1],i[2],n[3]],[i[0],n[1],n[2],n[3]]];if(n[2]>i[2])return[[n[0],n[1],i[2],n[3]],[i[0],n[1],n[2]-s,n[3]]]}return[n]}function abstract(){throw new Error("Unimplemented abstract method.")}let uidCounter_=0;function getUid(n){return n.ol_uid||(n.ol_uid=String(++uidCounter_))}const ObjectEventType={PROPERTYCHANGE:"propertychange"},EventType={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class Disposable{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function binarySearch(n,e,t){let i,s;t=t||ascending;let r=0,o=n.length,a=!1;for(;r<o;)i=r+(o-r>>1),s=+t(n[i],e),s<0?r=i+1:(o=i,a=!s);return a?r:~r}function ascending(n,e){return n>e?1:n<e?-1:0}function descending(n,e){return n<e?1:n>e?-1:0}function linearFindNearest(n,e,t){if(n[0]<=e)return 0;const i=n.length;if(e<=n[i-1])return i-1;if(typeof t=="function"){for(let s=1;s<i;++s){const r=n[s];if(r===e)return s;if(r<e)return t(e,n[s-1],r)>0?s-1:s}return i-1}if(t>0){for(let s=1;s<i;++s)if(n[s]<e)return s-1;return i-1}if(t<0){for(let s=1;s<i;++s)if(n[s]<=e)return s;return i-1}for(let s=1;s<i;++s){if(n[s]==e)return s;if(n[s]<e)return n[s-1]-e<e-n[s]?s-1:s}return i-1}function reverseSubArray(n,e,t){for(;e<t;){const i=n[e];n[e]=n[t],n[t]=i,++e,--t}}function extend$1(n,e){const t=Array.isArray(e)?e:[e],i=t.length;for(let s=0;s<i;s++)n[n.length]=t[s]}function equals$1(n,e){const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function isSorted(n,e,t){const i=e||ascending;return n.every(function(s,r){if(r===0)return!0;const o=i(n[r-1],s);return!(o>0||o===0)})}function TRUE(){return!0}function FALSE(){return!1}function VOID(){}function memoizeOne(n){let e,t,i;return function(){const s=Array.prototype.slice.call(arguments);return(!t||this!==i||!equals$1(s,t))&&(i=this,t=s,e=n.apply(this,arguments)),e}}function toPromise(n){function e(){let t;try{t=n()}catch(i){return Promise.reject(i)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function clear(n){for(const e in n)delete n[e]}function isEmpty(n){let e;for(e in n)return!1;return!e}class BaseEvent{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class Target extends Disposable{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),s=i[e]||(i[e]=[]);s.includes(t)||s.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,s=this.listeners_&&this.listeners_[i];if(!s)return;const r=t?new BaseEvent(e):e;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let h;for(let c=0,d=s.length;c<d;++c)if("handleEvent"in s[c]?h=s[c].handleEvent(r):h=s[c].call(this,r),h===!1||r.propagationStopped){h=!1;break}if(--o[i]===0){let c=a[i];for(delete a[i];c--;)this.removeEventListener(i,VOID);delete o[i]}return h}disposeInternal(){this.listeners_&&clear(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const i=this.listeners_[e];if(!i)return;const s=i.indexOf(t);s!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[s]=VOID,++this.pendingRemovals_[e]):(i.splice(s,1),i.length===0&&delete this.listeners_[e]))}}function listen(n,e,t,i,s){if(s){const o=t;t=function(a){return n.removeEventListener(e,t),o.call(i??this,a)}}else i&&i!==n&&(t=t.bind(i));const r={target:n,type:e,listener:t};return n.addEventListener(e,t),r}function listenOnce(n,e,t,i){return listen(n,e,t,i,!0)}function unlistenByKey(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),clear(n))}class Observable extends Target{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(EventType.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=listen(this,e[r],t);return s}return listen(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const s=e.length;i=new Array(s);for(let r=0;r<s;++r)i[r]=listenOnce(this,e[r],t)}else i=listenOnce(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)unByKey(i);else if(Array.isArray(e))for(let s=0,r=e.length;s<r;++s)this.removeEventListener(e[s],t);else this.removeEventListener(e,t)}}Observable.prototype.on;Observable.prototype.once;Observable.prototype.un;function unByKey(n){if(Array.isArray(n))for(let e=0,t=n.length;e<t;++e)unlistenByKey(n[e]);else unlistenByKey(n)}class ObjectEvent extends BaseEvent{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class BaseObject extends Observable{constructor(e){super(),this.on,this.once,this.un,getUid(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new ObjectEvent(i,e,t)),i=ObjectEventType.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new ObjectEvent(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const s=this.values_||(this.values_={});if(i)s[e]=t;else{const r=s[e];s[e]=t,r!==t&&this.notify(e,r)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],isEmpty(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}function warn(...n){console.warn(...n)}function add$2(n,e){return n[0]+=+e[0],n[1]+=+e[1],n}function equals(n,e){let t=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=e[i]){t=!1;break}return t}function rotate$1(n,e){const t=Math.cos(e),i=Math.sin(e),s=n[0]*t-n[1]*i,r=n[1]*t+n[0]*i;return n[0]=s,n[1]=r,n}function scale$2(n,e){return n[0]*=e,n[1]*=e,n}function wrapX$1(n,e){if(e.canWrapX()){const t=getWidth(e.getExtent()),i=getWorldsAway(n,e,t);i&&(n[0]-=i*t)}return n}function getWorldsAway(n,e,t){const i=e.getExtent();let s=0;return e.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(t=t||getWidth(i),s=Math.floor((n[0]-i[0])/t)),s}const METERS_PER_UNIT$1={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Projection{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||METERS_PER_UNIT$1[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const RADIUS$1=6378137,HALF_SIZE=Math.PI*RADIUS$1,EXTENT$1=[-HALF_SIZE,-HALF_SIZE,HALF_SIZE,HALF_SIZE],WORLD_EXTENT=[-180,-85,180,85],MAX_SAFE_Y=RADIUS$1*Math.log(Math.tan(Math.PI/2));class EPSG3857Projection extends Projection{constructor(e){super({code:e,units:"m",extent:EXTENT$1,global:!0,worldExtent:WORLD_EXTENT,getPointResolution:function(t,i){return t/Math.cosh(i[1]/RADIUS$1)}})}}const PROJECTIONS$1=[new EPSG3857Projection("EPSG:3857"),new EPSG3857Projection("EPSG:102100"),new EPSG3857Projection("EPSG:102113"),new EPSG3857Projection("EPSG:900913"),new EPSG3857Projection("http://www.opengis.net/def/crs/EPSG/0/3857"),new EPSG3857Projection("http://www.opengis.net/gml/srs/epsg.xml#3857")];function fromEPSG4326(n,e,t,i){const s=n.length;t=t>1?t:2,i=i??t,e===void 0&&(t>2?e=n.slice():e=new Array(s));for(let r=0;r<s;r+=i){e[r]=HALF_SIZE*n[r]/180;let o=RADIUS$1*Math.log(Math.tan(Math.PI*(+n[r+1]+90)/360));o>MAX_SAFE_Y?o=MAX_SAFE_Y:o<-MAX_SAFE_Y&&(o=-MAX_SAFE_Y),e[r+1]=o}return e}function toEPSG4326(n,e,t,i){const s=n.length;t=t>1?t:2,i=i??t,e===void 0&&(t>2?e=n.slice():e=new Array(s));for(let r=0;r<s;r+=i)e[r]=180*n[r]/HALF_SIZE,e[r+1]=360*Math.atan(Math.exp(n[r+1]/RADIUS$1))/Math.PI-90;return e}const RADIUS=6378137,EXTENT=[-180,-90,180,90],METERS_PER_UNIT=Math.PI*RADIUS/180;class EPSG4326Projection extends Projection{constructor(e,t){super({code:e,units:"degrees",extent:EXTENT,axisOrientation:t,global:!0,metersPerUnit:METERS_PER_UNIT,worldExtent:EXTENT})}}const PROJECTIONS=[new EPSG4326Projection("CRS:84"),new EPSG4326Projection("EPSG:4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:OGC:1.3:CRS84"),new EPSG4326Projection("urn:ogc:def:crs:OGC:2:84"),new EPSG4326Projection("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new EPSG4326Projection("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new EPSG4326Projection("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let cache$1={};function get$4(n){return cache$1[n]||cache$1[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function add$1(n,e){cache$1[n]=e}let transforms={};function add(n,e,t){const i=n.getCode(),s=e.getCode();i in transforms||(transforms[i]={}),transforms[i][s]=t}function get$3(n,e){return n in transforms&&e in transforms[n]?transforms[n][e]:null}const K0=.9996,E=.00669438,E2=E*E,E3=E2*E,E_P2=E/(1-E),SQRT_E=Math.sqrt(1-E),_E=(1-SQRT_E)/(1+SQRT_E),_E2=_E*_E,_E3=_E2*_E,_E4=_E3*_E,_E5=_E4*_E,M1=1-E/4-3*E2/64-5*E3/256,M2=3*E/8+3*E2/32+45*E3/1024,M3=15*E2/256+45*E3/1024,M4=35*E3/3072,P2=3/2*_E-27/32*_E3+269/512*_E5,P3=21/16*_E2-55/32*_E4,P4=151/96*_E3-417/128*_E5,P5=1097/512*_E4,R=6378137;function toLonLat$1(n,e,t){const i=n-5e5,o=(t.north?e:e-1e7)/K0/(R*M1),a=o+P2*Math.sin(2*o)+P3*Math.sin(4*o)+P4*Math.sin(6*o)+P5*Math.sin(8*o),h=Math.sin(a),c=h*h,d=Math.cos(a),f=h/d,_=f*f,y=_*_,S=1-E*c,v=Math.sqrt(1-E*c),I=R/v,A=(1-E)/S,B=E_P2*d**2,G=B*B,k=i/(I*K0),z=k*k,q=z*k,T=q*k,j=T*k,te=j*k,Se=a-f/A*(z/2-T/24*(5+3*_+10*B-4*G-9*E_P2))+te/720*(61+90*_+298*B+45*y-252*E_P2-3*G);let be=(k-q/6*(1+2*_+B)+j/120*(5-2*B+28*_-3*G+8*E_P2+24*y))/d;return be=wrap(be+toRadians(zoneToCentralLongitude(t.number)),-Math.PI,Math.PI),[toDegrees(be),toDegrees(Se)]}const MIN_LATITUDE=-80,MAX_LATITUDE=84,MIN_LONGITUDE=-180,MAX_LONGITUDE=180;function fromLonLat$1(n,e,t){n=wrap(n,MIN_LONGITUDE,MAX_LONGITUDE),e<MIN_LATITUDE?e=MIN_LATITUDE:e>MAX_LATITUDE&&(e=MAX_LATITUDE);const i=toRadians(e),s=Math.sin(i),r=Math.cos(i),o=s/r,a=o*o,h=a*a,c=toRadians(n),d=zoneToCentralLongitude(t.number),f=toRadians(d),_=R/Math.sqrt(1-E*s**2),y=E_P2*r**2,S=r*wrap(c-f,-Math.PI,Math.PI),v=S*S,I=v*S,A=I*S,B=A*S,G=B*S,k=R*(M1*i-M2*Math.sin(2*i)+M3*Math.sin(4*i)-M4*Math.sin(6*i)),z=K0*_*(S+I/6*(1-a+y)+B/120*(5-18*a+h+72*y-58*E_P2))+5e5;let q=K0*(k+_*o*(v/2+A/24*(5-a+9*y+4*y**2)+G/720*(61-58*a+h+600*y-330*E_P2)));return t.north||(q+=1e7),[z,q]}function zoneToCentralLongitude(n){return(n-1)*6-180+3}const epsgRegExes=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function zoneFromCode(n){let e=0;for(const s of epsgRegExes){const r=n.match(s);if(r){e=parseInt(r[1]);break}}if(!e)return null;let t=0,i=!1;return e>32700&&e<32761?t=e-32700:e>32600&&e<32661&&(i=!0,t=e-32600),t?{number:t,north:i}:null}function makeTransformFunction(n,e){return function(t,i,s,r){const o=t.length;s=s>1?s:2,r=r??s,i||(s>2?i=t.slice():i=new Array(o));for(let a=0;a<o;a+=r){const h=t[a],c=t[a+1],d=n(h,c,e);i[a]=d[0],i[a+1]=d[1]}return i}}function makeProjection(n){return zoneFromCode(n)?new Projection({code:n,units:"m"}):null}function makeTransforms(n){const e=zoneFromCode(n.getCode());return e?{forward:makeTransformFunction(fromLonLat$1,e),inverse:makeTransformFunction(toLonLat$1,e)}:null}const transformFactories=[makeTransforms],projectionFactories=[makeProjection];let showCoordinateWarning=!0;function disableCoordinateWarning(n){showCoordinateWarning=!1}function cloneTransform(n,e){if(e!==void 0){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];e=e}else e=n.slice();return e}function addProjection(n){add$1(n.getCode(),n),add(n,n,cloneTransform)}function addProjections(n){n.forEach(addProjection)}function get$2(n){if(typeof n!="string")return n;const e=get$4(n);if(e)return e;for(const t of projectionFactories){const i=t(n);if(i)return i}return null}function getPointResolution(n,e,t,i){n=get$2(n);let s;const r=n.getPointResolutionFunc();if(r)s=r(e,t);else{const o=n.getUnits();if(o=="degrees"&&!i||i=="degrees")s=e;else{const a=getTransformFromProjections(n,get$2("EPSG:4326"));if(!a&&o!=="degrees")s=e*n.getMetersPerUnit();else{let c=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];c=a(c,c,2);const d=getDistance(c.slice(0,2),c.slice(2,4)),f=getDistance(c.slice(4,6),c.slice(6,8));s=(d+f)/2}const h=n.getMetersPerUnit();h!==void 0&&(s/=h)}}return s}function addEquivalentProjections(n){addProjections(n),n.forEach(function(e){n.forEach(function(t){e!==t&&add(e,t,cloneTransform)})})}function addEquivalentTransforms(n,e,t,i){n.forEach(function(s){e.forEach(function(r){add(s,r,t),add(r,s,i)})})}function createProjection(n,e){return n?typeof n=="string"?get$2(n):n:get$2(e)}function createTransformFromCoordinateTransform(n){return(function(e,t,i,s){const r=e.length;i=i!==void 0?i:2,s=s??i,t=t!==void 0?t:new Array(r);for(let o=0;o<r;o+=s){const a=n(e.slice(o,o+i)),h=a.length;for(let c=0,d=s;c<d;++c)t[o+c]=c>=h?e[o+c]:a[c]}return t})}function fromLonLat(n,e){return disableCoordinateWarning(),transform(n,"EPSG:4326","EPSG:3857")}function toLonLat(n,e){const t=transform(n,"EPSG:3857","EPSG:4326"),i=t[0];return(i<-180||i>180)&&(t[0]=modulo(i+180,360)-180),t}function equivalent$1(n,e){if(n===e)return!0;const t=n.getUnits()===e.getUnits();return(n.getCode()===e.getCode()||getTransformFromProjections(n,e)===cloneTransform)&&t}function getTransformFromProjections(n,e){const t=n.getCode(),i=e.getCode();let s=get$3(t,i);if(s)return s;let r=null,o=null;for(const h of transformFactories)r||(r=h(n)),o||(o=h(e));if(!r&&!o)return null;const a="EPSG:4326";if(o)if(r)s=composeTransformFuncs(r.inverse,o.forward);else{const h=get$3(t,a);h&&(s=composeTransformFuncs(h,o.forward))}else{const h=get$3(a,i);h&&(s=composeTransformFuncs(r.inverse,h))}return s&&(addProjection(n),addProjection(e),add(n,e,s)),s}function composeTransformFuncs(n,e){return function(t,i,s,r){return i=n(t,i,s,r),e(i,i,s,r)}}function getTransform(n,e){const t=get$2(n),i=get$2(e);return getTransformFromProjections(t,i)}function transform(n,e,t){const i=getTransform(e,t);if(!i){const s=get$2(e).getCode(),r=get$2(t).getCode();throw new Error(`No transform available between ${s} and ${r}`)}return i(n,void 0,n.length)}function toUserCoordinate(n,e){return n}function fromUserCoordinate(n,e){return showCoordinateWarning&&!equals(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(showCoordinateWarning=!1,warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function toUserExtent(n,e){return n}function fromUserExtent(n,e){return n}function addCommon(){addEquivalentProjections(PROJECTIONS$1),addEquivalentProjections(PROJECTIONS),addEquivalentTransforms(PROJECTIONS,PROJECTIONS$1,fromEPSG4326,toEPSG4326)}addCommon();function assert(n,e){if(!n)throw new Error(e)}new Array(6);function create(){return[1,0,0,1,0,0]}function setFromArray(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n}function apply(n,e){const t=e[0],i=e[1];return e[0]=n[0]*t+n[2]*i+n[4],e[1]=n[1]*t+n[3]*i+n[5],e}function compose(n,e,t,i,s,r,o,a){const h=Math.sin(r),c=Math.cos(r);return n[0]=i*c,n[1]=s*h,n[2]=-i*h,n[3]=s*c,n[4]=o*i*c-a*i*h+e,n[5]=o*s*h+a*s*c+t,n}function makeInverse(n,e){const t=determinant(e);assert(t!==0,"Transformation matrix cannot be inverted");const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5];return n[0]=o/t,n[1]=-s/t,n[2]=-r/t,n[3]=i/t,n[4]=(r*h-o*a)/t,n[5]=-(i*h-s*a)/t,n}function determinant(n){return n[0]*n[3]-n[1]*n[2]}const matrixPrecision=[1e5,1e5,1e5,1e5,2,2];function toString$1(n){return"matrix("+n.join(", ")+")"}function fromString$1(n){return n.substring(7,n.length-1).split(",").map(parseFloat)}function equivalent(n,e){const t=fromString$1(n),i=fromString$1(e);for(let s=0;s<6;++s)if(Math.round((t[s]-i[s])*matrixPrecision[s])!==0)return!1;return!0}function transform2D(n,e,t,i,s,r,o){r=r||[],o=o||2;let a=0;for(let h=e;h<t;h+=i){const c=n[h],d=n[h+1];r[a++]=s[0]*c+s[2]*d+s[4],r[a++]=s[1]*c+s[3]*d+s[5];for(let f=2;f<o;f++)r[a++]=n[h+f]}return r&&r.length!=a&&(r.length=a),r}function rotate(n,e,t,i,s,r,o){o=o||[];const a=Math.cos(s),h=Math.sin(s),c=r[0],d=r[1];let f=0;for(let _=e;_<t;_+=i){const y=n[_]-c,S=n[_+1]-d;o[f++]=c+y*a-S*h,o[f++]=d+y*h+S*a;for(let v=_+2;v<_+i;++v)o[f++]=n[v]}return o&&o.length!=f&&(o.length=f),o}function scale$1(n,e,t,i,s,r,o,a){a=a||[];const h=o[0],c=o[1];let d=0;for(let f=e;f<t;f+=i){const _=n[f]-h,y=n[f+1]-c;a[d++]=h+s*_,a[d++]=c+r*y;for(let S=f+2;S<f+i;++S)a[d++]=n[S]}return a&&a.length!=d&&(a.length=d),a}function translate(n,e,t,i,s,r,o){o=o||[];let a=0;for(let h=e;h<t;h+=i){o[a++]=n[h]+s,o[a++]=n[h+1]+r;for(let c=h+2;c<h+i;++c)o[a++]=n[c]}return o&&o.length!=a&&(o.length=a),o}const tmpTransform$1=create(),tmpPoint=[NaN,NaN];class Geometry extends BaseObject{constructor(){super(),this.extent_=createEmpty(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=memoizeOne((e,t,i)=>{if(!i)return this.getSimplifiedGeometry(t);const s=this.clone();return s.applyTransform(i),s.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return abstract()}closestPointXY(e,t,i,s){return abstract()}containsXY(e,t){return this.closestPointXY(e,t,tmpPoint,Number.MIN_VALUE)===0}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return abstract()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&createOrUpdateEmpty(t),this.extentRevision_=this.getRevision()}return returnOrUpdate(this.extent_,e)}rotate(e,t){abstract()}scale(e,t,i){abstract()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return abstract()}getType(){return abstract()}applyTransform(e){abstract()}intersectsExtent(e){return abstract()}translate(e,t){abstract()}transform(e,t){const i=get$2(e),s=i.getUnits()=="tile-pixels"?function(r,o,a){const h=i.getExtent(),c=i.getWorldExtent(),d=getHeight(c)/getHeight(h);compose(tmpTransform$1,c[0],c[3],d,-d,0,0,0);const f=transform2D(r,0,r.length,a,tmpTransform$1,o),_=getTransform(i,t);return _?_(f,f,a):f}:getTransform(i,t);return this.applyTransform(s),this}}class SimpleGeometry extends Geometry{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return abstract()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=getStrideForLayout(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){abstract()}setLayout(e,t,i){let s;if(e)s=getStrideForLayout(e);else{for(let r=0;r<i;++r){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}s=t.length,e=getLayoutForStride(s)}this.layout=e,this.stride=s}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const s=this.getStride();rotate(i,0,i.length,s,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=getCenter(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();scale$1(s,0,s.length,r,e,t,i,s),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const s=this.getStride();translate(i,0,i.length,s,e,t,i),this.changed()}}}function getLayoutForStride(n){let e;return n==2?e="XY":n==3?e="XYZ":n==4&&(e="XYZM"),e}function getStrideForLayout(n){let e;return n=="XY"?e=2:n=="XYZ"||n=="XYM"?e=3:n=="XYZM"&&(e=4),e}function transformGeom2D(n,e,t){const i=n.getFlatCoordinates();if(!i)return null;const s=n.getStride();return transform2D(i,0,i.length,s,e,t)}function deflateCoordinate(n,e,t,i){for(let s=0,r=t.length;s<r;++s)n[e++]=t[s];return e}function deflateCoordinates(n,e,t,i){for(let s=0,r=t.length;s<r;++s){const o=t[s];for(let a=0;a<i;++a)n[e++]=o[a]}return e}function deflateCoordinatesArray(n,e,t,i,s){s=s||[];let r=0;for(let o=0,a=t.length;o<a;++o){const h=deflateCoordinates(n,e,t[o],i);s[r++]=h,e=h}return s.length=r,s}function linearRing(n,e,t,i){let s=0;const r=n[t-i],o=n[t-i+1];let a=0,h=0;for(;e<t;e+=i){const c=n[e]-r,d=n[e+1]-o;s+=h*c-a*d,a=c,h=d}return s/2}function linearRings(n,e,t,i){let s=0;for(let r=0,o=t.length;r<o;++r){const a=t[r];s+=linearRing(n,e,a,i),e=a}return s}function assignClosest(n,e,t,i,s,r,o){const a=n[e],h=n[e+1],c=n[t]-a,d=n[t+1]-h;let f;if(c===0&&d===0)f=e;else{const _=((s-a)*c+(r-h)*d)/(c*c+d*d);if(_>1)f=t;else if(_>0){for(let y=0;y<i;++y)o[y]=lerp(n[e+y],n[t+y],_);o.length=i;return}else f=e}for(let _=0;_<i;++_)o[_]=n[f+_];o.length=i}function maxSquaredDelta(n,e,t,i,s){let r=n[e],o=n[e+1];for(e+=i;e<t;e+=i){const a=n[e],h=n[e+1],c=squaredDistance(r,o,a,h);c>s&&(s=c),r=a,o=h}return s}function arrayMaxSquaredDelta(n,e,t,i,s){for(let r=0,o=t.length;r<o;++r){const a=t[r];s=maxSquaredDelta(n,e,a,i,s),e=a}return s}function assignClosestPoint(n,e,t,i,s,r,o,a,h,c,d){if(e==t)return c;let f,_;if(s===0){if(_=squaredDistance(o,a,n[e],n[e+1]),_<c){for(f=0;f<i;++f)h[f]=n[e+f];return h.length=i,_}return c}d=d||[NaN,NaN];let y=e+i;for(;y<t;)if(assignClosest(n,y-i,y,i,o,a,d),_=squaredDistance(o,a,d[0],d[1]),_<c){for(c=_,f=0;f<i;++f)h[f]=d[f];h.length=i,y+=i}else y+=i*Math.max((Math.sqrt(_)-Math.sqrt(c))/s|0,1);if(r&&(assignClosest(n,t-i,e,i,o,a,d),_=squaredDistance(o,a,d[0],d[1]),_<c)){for(c=_,f=0;f<i;++f)h[f]=d[f];h.length=i}return c}function assignClosestArrayPoint(n,e,t,i,s,r,o,a,h,c,d){d=d||[NaN,NaN];for(let f=0,_=t.length;f<_;++f){const y=t[f];c=assignClosestPoint(n,e,y,i,s,r,o,a,h,c,d),e=y}return c}function inflateCoordinates(n,e,t,i,s){s=s!==void 0?s:[];let r=0;for(let o=e;o<t;o+=i)s[r++]=n.slice(o,o+i);return s.length=r,s}function inflateCoordinatesArray(n,e,t,i,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=t.length;o<a;++o){const h=t[o];s[r++]=inflateCoordinates(n,e,h,i,s[r]),e=h}return s.length=r,s}function inflateMultiCoordinatesArray(n,e,t,i,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=t.length;o<a;++o){const h=t[o];s[r++]=h.length===1&&h[0]===e?[]:inflateCoordinatesArray(n,e,h,i,s[r]),e=h[h.length-1]}return s.length=r,s}function douglasPeucker(n,e,t,i,s,r,o){const a=(t-e)/i;if(a<3){for(;e<t;e+=i)r[o++]=n[e],r[o++]=n[e+1];return o}const h=new Array(a);h[0]=1,h[a-1]=1;const c=[e,t-i];let d=0;for(;c.length>0;){const f=c.pop(),_=c.pop();let y=0;const S=n[_],v=n[_+1],I=n[f],A=n[f+1];for(let B=_+i;B<f;B+=i){const G=n[B],k=n[B+1],z=squaredSegmentDistance(G,k,S,v,I,A);z>y&&(d=B,y=z)}y>s&&(h[(d-e)/i]=1,_+i<d&&c.push(_,d),d+i<f&&c.push(d,f))}for(let f=0;f<a;++f)h[f]&&(r[o++]=n[e+f*i],r[o++]=n[e+f*i+1]);return o}function douglasPeuckerArray(n,e,t,i,s,r,o,a){for(let h=0,c=t.length;h<c;++h){const d=t[h];o=douglasPeucker(n,e,d,i,s,r,o),a.push(o),e=d}return o}function snap(n,e){return e*Math.round(n/e)}function quantize(n,e,t,i,s,r,o){if(e==t)return o;let a=snap(n[e],s),h=snap(n[e+1],s);e+=i,r[o++]=a,r[o++]=h;let c,d;do if(c=snap(n[e],s),d=snap(n[e+1],s),e+=i,e==t)return r[o++]=c,r[o++]=d,o;while(c==a&&d==h);for(;e<t;){const f=snap(n[e],s),_=snap(n[e+1],s);if(e+=i,f==c&&_==d)continue;const y=c-a,S=d-h,v=f-a,I=_-h;if(y*I==S*v&&(y<0&&v<y||y==v||y>0&&v>y)&&(S<0&&I<S||S==I||S>0&&I>S)){c=f,d=_;continue}r[o++]=c,r[o++]=d,a=c,h=d,c=f,d=_}return r[o++]=c,r[o++]=d,o}function quantizeArray(n,e,t,i,s,r,o,a){for(let h=0,c=t.length;h<c;++h){const d=t[h];o=quantize(n,e,d,i,s,r,o),a.push(o),e=d}return o}class LinearRing extends SimpleGeometry{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new LinearRing(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,i,s){return s<closestSquaredDistanceXY(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,i,s))}getArea(){return linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new LinearRing(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,e,this.stride),this.changed()}}function interpolatePoint(n,e,t,i,s,r,o){let a,h;const c=(t-e)/i;if(c===1)a=e;else if(c===2)a=e,h=s;else if(c!==0){let d=n[e],f=n[e+1],_=0;const y=[0];for(let I=e+i;I<t;I+=i){const A=n[I],B=n[I+1];_+=Math.sqrt((A-d)*(A-d)+(B-f)*(B-f)),y.push(_),d=A,f=B}const S=s*_,v=binarySearch(y,S);v<0?(h=(S-y[-v-2])/(y[-v-1]-y[-v-2]),a=e+(-v-2)*i):a=e+v*i}o=o>1?o:2,r=r||new Array(o);for(let d=0;d<o;++d)r[d]=a===void 0?NaN:h===void 0?n[a+d]:lerp(n[a+d],n[a+i+d],h);return r}function lineStringCoordinateAtM(n,e,t,i,s,r){if(t==e)return null;let o;if(s<n[e+i-1])return r?(o=n.slice(e,e+i),o[i-1]=s,o):null;if(n[t-1]<s)return r?(o=n.slice(t-i,t),o[i-1]=s,o):null;if(s==n[e+i-1])return n.slice(e,e+i);let a=e/i,h=t/i;for(;a<h;){const _=a+h>>1;s<n[(_+1)*i-1]?h=_:a=_+1}const c=n[a*i-1];if(s==c)return n.slice((a-1)*i,(a-1)*i+i);const d=n[(a+1)*i-1],f=(s-c)/(d-c);o=[];for(let _=0;_<i-1;++_)o.push(lerp(n[(a-1)*i+_],n[a*i+_],f));return o.push(s),o}function linearRingContainsExtent(n,e,t,i,s){return!forEachCorner(s,function(o){return!linearRingContainsXY(n,e,t,i,o[0],o[1])})}function linearRingContainsXY(n,e,t,i,s,r){let o=0,a=n[t-i],h=n[t-i+1];for(;e<t;e+=i){const c=n[e],d=n[e+1];h<=r?d>r&&(c-a)*(r-h)-(s-a)*(d-h)>0&&o++:d<=r&&(c-a)*(r-h)-(s-a)*(d-h)<0&&o--,a=c,h=d}return o!==0}function linearRingsContainsXY(n,e,t,i,s,r){if(t.length===0||!linearRingContainsXY(n,e,t[0],i,s,r))return!1;for(let o=1,a=t.length;o<a;++o)if(linearRingContainsXY(n,t[o-1],t[o],i,s,r))return!1;return!0}function forEach(n,e,t,i,s){let r;for(e+=i;e<t;e+=i)if(r=s(n.slice(e-i,e),n.slice(e,e+i)),r)return r;return!1}function intersectsLineString(n,e,t,i,s,r){return r=r??extendFlatCoordinates(createEmpty(),n,e,t,i),intersects$1(s,r)?r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:forEach(n,e,t,i,function(o,a){return intersectsSegment(s,o,a)}):!1}function intersectsLinearRing(n,e,t,i,s){return!!(intersectsLineString(n,e,t,i,s)||linearRingContainsXY(n,e,t,i,s[0],s[1])||linearRingContainsXY(n,e,t,i,s[0],s[3])||linearRingContainsXY(n,e,t,i,s[2],s[1])||linearRingContainsXY(n,e,t,i,s[2],s[3]))}function intersectsLinearRingArray(n,e,t,i,s){if(!intersectsLinearRing(n,e,t[0],i,s))return!1;if(t.length===1)return!0;for(let r=1,o=t.length;r<o;++r)if(linearRingContainsExtent(n,t[r-1],t[r],i,s)&&!intersectsLineString(n,t[r-1],t[r],i,s))return!1;return!0}function lineStringLength(n,e,t,i){let s=n[e],r=n[e+1],o=0;for(let a=e+i;a<t;a+=i){const h=n[a],c=n[a+1];o+=Math.sqrt((h-s)*(h-s)+(c-r)*(c-r)),s=h,r=c}return o}class LineString extends SimpleGeometry{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){extend$1(this.flatCoordinates,e),this.changed()}clone(){const e=new LineString(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){return s<closestSquaredDistanceXY(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,s))}forEachSegment(e){return forEach(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,lineStringCoordinateAtM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return interpolatePoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return lineStringLength(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new LineString(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return intersectsLineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,this.getExtent())}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,e,this.stride),this.changed()}}class Point extends SimpleGeometry{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new Point(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){const r=this.flatCoordinates,o=squaredDistance(e,t,r[0],r[1]);if(o<s){const a=this.stride;for(let h=0;h<a;++h)i[h]=r[h];return i.length=a,o}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return createOrUpdateFromCoordinate(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return containsXY(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinate(this.flatCoordinates,0,e,this.stride),this.changed()}}function getInteriorPointOfArray(n,e,t,i,s,r,o){let a,h,c,d,f,_,y;const S=s[r+1],v=[];for(let B=0,G=t.length;B<G;++B){const k=t[B];for(d=n[k-i],_=n[k-i+1],a=e;a<k;a+=i)f=n[a],y=n[a+1],(S<=_&&y<=S||_<=S&&S<=y)&&(c=(S-_)/(y-_)*(f-d)+d,v.push(c)),d=f,_=y}let I=NaN,A=-1/0;for(v.sort(ascending),d=v[0],a=1,h=v.length;a<h;++a){f=v[a];const B=Math.abs(f-d);B>A&&(c=(d+f)/2,linearRingsContainsXY(n,e,t,i,c,S)&&(I=c,A=B)),d=f}return isNaN(I)&&(I=s[r]),o?(o.push(I,S,A),o):[I,S,A]}function getInteriorPointsOfMultiArray(n,e,t,i,s){let r=[];for(let o=0,a=t.length;o<a;++o){const h=t[o];r=getInteriorPointOfArray(n,e,h,i,s,2*o,r),e=h[h.length-1]}return r}function coordinates(n,e,t,i){for(;e<t-i;){for(let s=0;s<i;++s){const r=n[e+s];n[e+s]=n[t-i+s],n[t-i+s]=r}e+=i,t-=i}}function linearRingIsClockwise(n,e,t,i){let s=0,r=n[t-i],o=n[t-i+1];for(;e<t;e+=i){const a=n[e],h=n[e+1];s+=(a-r)*(h+o),r=a,o=h}return s===0?void 0:s>0}function linearRingsAreOriented(n,e,t,i,s){s=s!==void 0?s:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],h=linearRingIsClockwise(n,e,a,i);if(r===0){if(s&&h||!s&&!h)return!1}else if(s&&!h||!s&&h)return!1;e=a}return!0}function orientLinearRings(n,e,t,i,s){s=s!==void 0?s:!1;for(let r=0,o=t.length;r<o;++r){const a=t[r],h=linearRingIsClockwise(n,e,a,i);(r===0?s&&h||!s&&!h:s&&!h||!s&&h)&&coordinates(n,e,a,i),e=a}return e}function inflateEnds(n,e){const t=[];let i=0,s=0,r;for(let o=0,a=e.length;o<a;++o){const h=e[o],c=linearRingIsClockwise(n,i,h,2);if(r===void 0&&(r=c),c===r)t.push(e.slice(s,o+1));else{if(t.length===0)continue;t[t.length-1].push(e[s])}s=o+1,i=h}return t}class Polygon extends SimpleGeometry{constructor(e,t,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&i?(this.setFlatCoordinates(t,e),this.ends_=i):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?extend$1(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new Polygon(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,s){return s<closestSquaredDistanceXY(this.getExtent(),e,t)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,i,s))}containsXY(e,t){return linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),orientLinearRings(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,inflateCoordinatesArray(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=getCenter(this.getExtent());this.flatInteriorPoint_=getInteriorPointOfArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Point(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new LinearRing(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,i=this.ends_,s=[];let r=0;for(let o=0,a=i.length;o<a;++o){const h=i[o],c=new LinearRing(t.slice(r,h),e);s.push(c),r=h}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;linearRingsAreOriented(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=quantizeArray(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,i),new Polygon(t,"XY",i)}getType(){return"Polygon"}intersectsExtent(e){return intersectsLinearRingArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=deflateCoordinatesArray(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function fromExtent(n){if(isEmpty$1(n))throw new Error("Cannot create polygon from empty extent");const e=n[0],t=n[1],i=n[2],s=n[3],r=[e,t,e,s,i,s,i,t,e,t];return new Polygon(r,"XY",[r.length])}function linearRingss(n,e,t,i){const s=[];let r=createEmpty();for(let o=0,a=t.length;o<a;++o){const h=t[o];r=createOrUpdateFromFlatCoordinates(n,e,h[0],i),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=h[h.length-1]}return s}const MWNP={};MWNP.WPTYPE={WAYPOINT:1,POSHOLD_UNLIM:2,POSHOLD_TIME:3,RTH:4,SET_POI:5,JUMP:6,SET_HEAD:7,LAND:8};MWNP.P3={ALT_TYPE:0,USER_ACTION_1:1,USER_ACTION_2:2,USER_ACTION_3:3,USER_ACTION_4:4};MWNP.WPTYPE.REV=swap$1(MWNP.WPTYPE);function swap$1(n){let e={};for(let t in n)e[n[t]]=t;return e}let Waypoint=function(n,e,t,i,s=0,r=0,o=0,a=0,h=0,c=!0,d=!1,f="",_=0){var y={};let S="undefined",v="undefined",I="undefined";return y.getNumber=function(){return n},y.setNumber=function(A){n=A},y.getLayerNumber=function(){return S},y.setLayerNumber=function(A){S=A},y.getPoiNumber=function(){return I},y.setPoiNumber=function(A){I=A},y.isUsed=function(){return c},y.setUsed=function(A){c=A},y.isAttached=function(){return d},y.setAttached=function(A){d=A},y.getLon=function(){return i},y.getLonMap=function(){return i/1e7},y.setLon=function(A){i=A},y.getLat=function(){return t},y.getLatMap=function(){return t/1e7},y.setLat=function(A){t=A},y.getAction=function(){return e},y.setAction=function(A){e=A},y.getAlt=function(){return s},y.setAlt=function(A){s=A},y.getP1=function(){return r},y.setP1=function(A){r=A},y.getP2=function(){return o},y.setP2=function(A){o=A},y.getP3=function(){return a},y.setP3=function(A){a=A},y.getEndMission=function(){return h},y.setEndMission=function(A){h=A},y.getAttachedId=function(){return f},y.setAttachedId=function(A){f=A},y.getAttachedNumber=function(){return v},y.setAttachedNumber=function(A){v=A},y.setMultiMissionIdx=function(A){_=A},y.getMultiMissionIdx=function(){return _},y.getElevation=async function(A){let B="N/A";const k=await(await fetch("https://api.opentopodata.org/v1/aster30m?locations="+y.getLatMap()+","+y.getLonMap())).json();return k.status=="OK"&&k.results[0].elevation!=null&&(B=k.results[0].elevation),B},y};var BitHelper=(function(){var n={};return n.highByte=function(e){return e>>8},n.lowByte=function(e){return 255&e},n.specificByte=function(e,t){return 255&e>>8*t},n.bit_check=function(e,t){return(1<<t&e)!=0},n.bit_set=function(e,t){return e|1<<t},n.bit_clear=function(e,t){return e&~(1<<t)},n})();let WaypointCollection=function(){let n={},e=[],t=120,i=0,s=0,r=0,o={};return n.getMaxWaypoints=function(){return t},n.setMaxWaypoints=function(a){t=a},n.getValidMission=function(){return i},n.setValidMission=function(a){i=a},n.getCountBusyPoints=function(){return s},n.setCountBusyPoints=function(a){s=a},n.getVersion=function(){return r},n.setVersion=function(a){r=a},n.getCenter=function(){return o},n.setCenter=function(a){o=a},n.setCenterZoom=function(a){o.zoom=a},n.setCenterLon=function(a){o.lon=a},n.setCenterLat=function(a){o.lat=a},n.put=function(a){e.push(a)},n.get=function(){return e},n.isEmpty=function(){return e.length==0},n.flush=function(){e=[]},n.reinit=function(){e=[],t=120,i=0,s=0,r=0,o={}},n.getWaypoint=function(a){for(let h in e)if(e.hasOwnProperty(h)){let c=e[h];if(c.getNumber()==a)return c}},n.updateWaypoint=function(a){a.isUsed()&&(e[a.getNumber()]=a)},n.dropWaypoint=function(a){n.getWaypoint(a.getNumber()).setUsed(!1);let h=a.getNumber();e.forEach(function(c){c.getNumber()>=h&&c.setNumber(c.getNumber()-1),c.getAction()==MWNP.WPTYPE.JUMP&&c.getP1()>=h&&c.setP1(c.getP1()-1)}),e.splice(h,1)},n.insertWaypoint=function(a,h){e.forEach(function(c){c.getNumber()>=h&&c.setNumber(c.getNumber()+1),c.getAction()==MWNP.WPTYPE.JUMP&&c.getP1()>=h&&c.setP1(c.getP1()+1)}),e.splice(h,0,a)},n.drop=function(a){n.getWaypoint(a).setUsed(!1);var h=[];let c=0;e.forEach(function(d){d.isUsed()&&(d.setNumber(c),h.push(d),c++)}),e=h},n.update=function(a=!0,h=!1,c=!1){let d=0,f=0,_=0;e.forEach(function(y){y.isUsed()&&(h&&!c?(y.setNumber(y.getNumber()-1),y.getAction()==MWNP.WPTYPE.JUMP&&y.setP1(y.getP1()-1)):h&&c&&(y.setNumber(y.getNumber()+1),y.getAction()==MWNP.WPTYPE.JUMP&&y.setP1(y.getP1()+1)),[MWNP.WPTYPE.JUMP,MWNP.WPTYPE.SET_HEAD,MWNP.WPTYPE.RTH].includes(y.getAction())?(y.setAttachedId(d),y.setAttachedNumber(f),y.setAttached(!0),f++):(d=y.getNumber(),y.setLayerNumber(_),f=0,_++),a&&(y.getNumber()==n.get().length-1?y.setEndMission(165):y.getNumber()==n.get().length-2&&y.getEndMission()==165&&y.setEndMission(0)))})},n.getNonAttachedList=function(){let a=[];return e.forEach(function(h){h.isAttached()||a.push(h)}),a},n.getAttachedList=function(){let a=[];return e.forEach(function(h){h.isAttached()&&a.push(h)}),a},n.getAttachedFromWaypoint=function(a){let h=[];return e.forEach(function(c){c.isAttached()&&c.getAttachedId()==a.getNumber()&&h.push(c)}),h},n.addAttachedFromWaypoint=function(a){let h=0,c=n.getAttachedFromWaypoint(a);c!="undefined"&&c.length!=0&&(h=c.length);let d=new Waypoint(a.getNumber()+h+1,MWNP.WPTYPE.JUMP,0,0);d.setAttached(!0),d.setAttachedId(a.getNumber()),n.insertWaypoint(d,a.getNumber()+h+1),n.update()},n.dropAttachedFromWaypoint=function(a,h){e.forEach(function(c){c.isAttached()&&c.getAttachedId()==a.getNumber()&&c.getAttachedNumber()==h&&(n.dropWaypoint(c),n.update())})},n.extractBuffer=function(a){let h=[],c=n.getWaypoint(a);return h.push(c.getNumber()),h.push(c.getAction()),h.push(BitHelper.specificByte(c.getLat(),0)),h.push(BitHelper.specificByte(c.getLat(),1)),h.push(BitHelper.specificByte(c.getLat(),2)),h.push(BitHelper.specificByte(c.getLat(),3)),h.push(BitHelper.specificByte(c.getLon(),0)),h.push(BitHelper.specificByte(c.getLon(),1)),h.push(BitHelper.specificByte(c.getLon(),2)),h.push(BitHelper.specificByte(c.getLon(),3)),h.push(BitHelper.specificByte(c.getAlt(),0)),h.push(BitHelper.specificByte(c.getAlt(),1)),h.push(BitHelper.specificByte(c.getAlt(),2)),h.push(BitHelper.specificByte(c.getAlt(),3)),h.push(BitHelper.lowByte(c.getP1())),h.push(BitHelper.highByte(c.getP1())),h.push(BitHelper.lowByte(c.getP2())),h.push(BitHelper.highByte(c.getP2())),h.push(BitHelper.lowByte(c.getP3())),h.push(BitHelper.highByte(c.getP3())),h.push(c.getEndMission()),h},n.missionDisplayDebug=function(){e&&e.length!=0&&e.forEach(function(a){console.log("NÂ° : ",a.getNumber(),"Action : ",a.getAction(),"Lon : ",a.getLon(),"Lat : ",a.getLat(),"Alt : ",a.getAlt(),"P1 : ",a.getP1(),"P2 : ",a.getP2(),"P3 : ",a.getP3(),"EndMission : ",a.getEndMission())})},n.copy=function(a){a.get().forEach(function(h){n.put(h)}),n.setMaxWaypoints(a.getMaxWaypoints()),n.setValidMission(a.getValidMission()),n.setCountBusyPoints(a.getCountBusyPoints()),n.setVersion(a.getVersion()),n.setCenter(a.getCenter())},n.convertJumpNumberToWaypoint=function(a){let h=0;return n.getNonAttachedList().forEach(function(c){c.getLayerNumber()==a&&(h=c.getNumber())}),h},n.convertWaypointToJumpNumber=function(a){let h=0;return n.getNonAttachedList().forEach(function(c){c.getNumber()==a&&(h=c.getLayerNumber())}),h},n.isJumpTargetAttached=function(a){let h=[];return e.forEach(function(c){c.getAction()==MWNP.WPTYPE.JUMP&&c.getP1()==a.getNumber()&&h.push(c.getNumber())}),h.length!=0&&h!="undefined"},n.getPoiList=function(){let a=[];return e.forEach(function(h){h.getAction()==MWNP.WPTYPE.SET_POI&&a.push(h.getNumber())}),a},n.getPoint2Measure=function(a=!1){let h=[],c=[],d=[],f=[],_={},y=0,S=0,v=!0;for(;v;){if(y>e[e.length-1].getNumber()){v=!1;break}if([MWNP.WPTYPE.WAYPOINT,MWNP.WPTYPE.POSHOLD_TIME,MWNP.WPTYPE.LAND].includes(n.getWaypoint(y).getAction())){a?h.push([n.getWaypoint(y).getLatMap(),n.getWaypoint(y).getLonMap()]):h.push(fromLonLat([n.getWaypoint(y).getLonMap(),n.getWaypoint(y).getLatMap()])),c.push(n.getWaypoint(y).getAlt()),d.push(n.getWaypoint(y).getLayerNumber()+1);let I=n.getWaypoint(y).getP3()&1;f.push(I),y++}else n.getWaypoint(y).getAction()==MWNP.WPTYPE.JUMP?(Object.keys(_).includes(String(n.getWaypoint(y).getNumber()))||(_[n.getWaypoint(y).getNumber()]={nStart:n.getWaypoint(y).getP1(),nLoop:n.getWaypoint(y).getP2(),n:0}),Object.keys(_).includes(String(n.getWaypoint(y).getNumber()))&&(_[n.getWaypoint(y).getNumber()].nLoop==-1&&(_[n.getWaypoint(y).getNumber()].nLoop=1,S=-1),_[n.getWaypoint(y).getNumber()].n>=_[n.getWaypoint(y).getNumber()].nLoop||_[n.getWaypoint(y).getNumber()].nLoop==0?(_[n.getWaypoint(y).getNumber()].n=0,y++):(_[n.getWaypoint(y).getNumber()].n=_[n.getWaypoint(y).getNumber()].n+1,y=_[n.getWaypoint(y).getNumber()].nStart))):y++}return[S,h,c,d,f]},n.getDistance=function(a){let h=[];const[c,d,f,_,y]=n.getPoint2Measure();if(c==-1&&a)return[-1];{const S=(I=>A=>I+=A)(0);let v=[];return d.forEach(function(I){v!="undefined"&&v!=[]&&h.push(getLength(new LineString([v,I]))),v=I}),h.map(S)}},n.getElevation=async function(a){const[h,c,d,f,_]=n.getPoint2Measure(!0);let y=n.getDistance(!0),S=y.length>=1?y[y.length-1].toFixed(1):0,v,I,A;I=99,A=60,c.length<=2?v=1:Math.trunc(S/A)<=I&&c.length>2?v=Math.trunc(S/A):v=I;let B="N/A",G="";c.forEach(function(T){G+=T+"|"});const z=await(await fetch("https://api.opentopodata.org/v1/aster30m?locations="+G+"&samples="+String(v+1))).json();if(z.status=="OK"){B=[];for(var q=0;q<z.results.length;q++)z.results[q].elevation==null?B[q]=0:B[q]=z.results[q].elevation}return[y,S,v,B,d,f,_]},n};var OutputMappingCollection=function(){let n={},e=[],t={};const i=["#8ecae6","#2a9d8f","#e9c46a","#f4a261","#e76f51","#ef476f","#ffc300"];n.TIMER_OUTPUT_MODE_AUTO=0,n.TIMER_OUTPUT_MODE_MOTORS=1,n.TIMER_OUTPUT_MODE_SERVOS=2,n.TIMER_OUTPUT_MODE_LED=3,n.flushTimerOverrides=function(){t={}},n.setTimerOverride=function(v,I){t[v]=I},n.getTimerOverride=function(v){return t[v]},n.getTimerColor=function(v){let I=n.getUsedTimerIds().indexOf(String(v));return i[I%i.length]},n.isLedPin=function(v){return e[v].specialLabels==1},n.getOutputTimerColor=function(v){let I=n.getTimerId(v);return n.getTimerColor(I)},n.getUsedTimerIds=function(v){let I={},A=n.getOutputCount();for(let B=0;B<A;++B){let G=n.getTimerId(B);I[G]=1}return Object.keys(I).sort((B,G)=>B-G)};function f(v,I,A){let B=[],G=I,k=A;for(let z=0;z<e.length;z++)B[z]=null,k>0&&BitHelper.bit_check(e[z].usageFlags,24)?(console.log(z+": LED"),B[z]=2):k>0&&BitHelper.bit_check(e[z].usageFlags,3)?(console.log(z+": SERVO"),k--,B[z]=1):G>0&&BitHelper.bit_check(e[z].usageFlags,2)&&(console.log(z+": MOTOR"),G--,B[z]=0);return B}n.getOutputTable=function(v,I,A){let B=1,G=0,k=f(v,I,A.length),z=[],q=_();console.log("Offset: "+q);for(let T=0;T<n.getOutputCount();T++){let j=k[T+q];j===null?z[T]="-":j==0?(z[T]="Motor "+B,B++):j==1?(z[T]="Servo "+A[G],G++):j==2&&(z[T]="Led")}return z},n.flush=function(){e=[]},n.put=function(v){e.push(v)},n.getOutputCount=function(){let v=0;for(let I=0;I<e.length;I++){let A=e[I].usageFlags;(BitHelper.bit_check(A,2)||BitHelper.bit_check(A,3)||BitHelper.bit_check(A,24))&&v++}return v};function _(){for(let v=0;v<e.length;v++)if(BitHelper.bit_check(e[v].usageFlags,2)||BitHelper.bit_check(e[v].usageFlags,3)||BitHelper.bit_check(e[v].usageFlags,24))return v;return 0}function y(v){return e[v].timerId}function S(v,I){let A=_(),B=0;for(let G=A;G<e.length;G++)if(BitHelper.bit_check(e[G].usageFlags,I)){if(B==v)return G-A+1;B++}return null}return n.getTimerId=function(v){return y(v)},n.getFwServoOutput=function(v){return S(v,3)},n.getMrServoOutput=function(v){return S(v,3)},n},SafehomeCollection=function(){let n={},e=[],t=8;return n.setMaxSafehomeCount=function(i){t=i},n.getMaxSafehomeCount=function(){return t},n.put=function(i){i.setNumber(e.length),e.push(i)},n.get=function(){return e},n.clean=function(i){e[i].cleanup()},n.flush=function(){e=[]},n.isEmpty=()=>e.length==0,n.safehomeCount=()=>e.length,n.drop=i=>{e.forEach(s=>{s.getNumber()>=i&&s.setNumber(s.getNumber()-1)}),e.splice(i,1)},n.insert=(i,s)=>{e.forEach(r=>{r.getNumber()>=s&&r.setNumber(r.getNumber()+1)}),e.splice(s,0,i)},n.updateSafehome=function(i){e[i.getNumber()]=i},n.extractBuffer=function(i){let s=[],r=e[i];return i<n.safehomeCount()?(s.push(r.getNumber()),s.push(1),s.push(BitHelper.specificByte(r.getLat(),0)),s.push(BitHelper.specificByte(r.getLat(),1)),s.push(BitHelper.specificByte(r.getLat(),2)),s.push(BitHelper.specificByte(r.getLat(),3)),s.push(BitHelper.specificByte(r.getLon(),0)),s.push(BitHelper.specificByte(r.getLon(),1)),s.push(BitHelper.specificByte(r.getLon(),2)),s.push(BitHelper.specificByte(r.getLon(),3))):(s=Array(10).fill(0),s[0]=i),s},n.safehomeDisplayDebug=function(){e&&e.length!=0&&e.forEach(function(i){console.log("NÂ° : ",i.getNumber(),"Enabled : ",i.getEnabled(),"Lon : ",i.getLon(),"Lat : ",i.getLat())})},n};let FwApproachCollection=function(){let n={},e=[],t=17;return n.setMaxFwApproachCount=function(i){t=i},n.getMaxFwApproachCount=function(){return t},n.put=function(i){i.setNumber(e.length),e.push(i)},n.get=function(){return e},n.clean=function(i){e[i].cleanup()},n.flush=function(){e=[]},n.isEmpty=()=>e.length==0,n.fwApproachCount=()=>e.length,n.drop=i=>{e.forEach(s=>{s.getNumber()>=i&&s.setNumber(s.getNumber()-1)}),e.splice(i,1)},n.insert=(i,s)=>{e.forEach(r=>{r.getNumber()>=s&&r.setNumber(r.getNumber()+1)}),e.splice(s,0,i)},n.updateFwApproach=function(i){e[i.getNumber()]=i},n.extractBuffer=function(i){let s=[],r=e[i];return i<n.fwApproachCount()?(s.push(r.getNumber()),s.push(BitHelper.specificByte(r.getApproachAltAsl(),0)),s.push(BitHelper.specificByte(r.getApproachAltAsl(),1)),s.push(BitHelper.specificByte(r.getApproachAltAsl(),2)),s.push(BitHelper.specificByte(r.getApproachAltAsl(),3)),s.push(BitHelper.specificByte(r.getLandAltAsl(),0)),s.push(BitHelper.specificByte(r.getLandAltAsl(),1)),s.push(BitHelper.specificByte(r.getLandAltAsl(),2)),s.push(BitHelper.specificByte(r.getLandAltAsl(),3)),s.push(r.getApproachDirection()),s.push(BitHelper.specificByte(r.getLandHeading1(),0)),s.push(BitHelper.specificByte(r.getLandHeading1(),1)),s.push(BitHelper.specificByte(r.getLandHeading2(),0)),s.push(BitHelper.specificByte(r.getLandHeading2(),1)),s.push(r.getIsSeaLevelRef())):(s=Array(15).fill(0),s[0]=safehomeId),s},n};const GeozoneType=Object.freeze({EXCULSIVE:0,INCLUSIVE:1}),GeozoneShapes=Object.freeze({CIRCULAR:0,POLYGON:1}),GeozoneFenceAction=Object.freeze({NONE:0,AVOID:1,POSHOLD:2,RTH:3});let GeozoneVertex=function(n,e,t){return self={},self.setNumber=i=>{n=i},self.getNumber=()=>n,self.setLat=i=>{e=i},self.getLat=()=>e,self.setLon=i=>{t=i},self.getLon=()=>t,self.getLatMap=()=>e/1e7,self.getLonMap=()=>t/1e7,self},Geozone=function(n,e,t,i,s,r,o,a,h=0){var c={};return c.setNumber=d=>{h=d},c.getNumber=()=>h,c.setType=d=>{n=d},c.getType=()=>n,c.setShape=d=>{e=d},c.getShape=()=>e,c.setMinAltitude=d=>{isNaN(d)?t=d:t=parseInt(d)},c.getMinAltitude=()=>t,c.setMaxAltitude=d=>{isNaN(d)?i=d:i=parseInt(d)},c.getMaxAltitude=()=>i,c.setSealevelRef=d=>{s=d},c.getSealevelRef=()=>s,c.setRadius=d=>{r=d},c.getRadius=()=>r,c.setFenceAction=d=>{o=d},c.getFenceAction=()=>o,c.getFirstVertex=()=>a[0],c.getLastVertex=()=>a[a.length-1],c.getVerticesCount=()=>a.length,c.getVertex=d=>a[d],c.setVertex=(d,f)=>{a[d]=f},c.getVertices=()=>a,c.setVertices=d=>{a=d},c.getVerticesCount=()=>a.length,c.insertVertex=(d,f)=>{a.forEach(_=>{_.getNumber()>=d&&_.setNumber(_.getNumber()+1)}),a.splice(d,0,f)},c.dropVertex=d=>{a.forEach(f=>{f.getNumber()>=d&&f.setNumber(f.getNumber()-1)}),a.splice(d,1)},c.resetVertices=()=>{a=[]},c.isCounterClockwise=()=>{if(e==GeozoneShapes.CIRCULAR)return!0;let d=0;for(let f=0;f<a.length;f++){const _=a[f].getLat(),y=a[f].getLon(),S=a[(f+1)%a.length],v=S.getLat(),I=S.getLon();d+=_*I-y*v}return d<0},c.isComplex=()=>{if(e==GeozoneShapes.CIRCULAR)return!1;function d(y,S,v,I){const A=S.x-y.x,B=-(I.x-v.x),G=v.x-y.x,k=S.y-y.y,z=-(I.y-v.y),q=v.y-y.y,T=A*z-B*k;if(T==0)return!1;const j=(G*z-B*q)/T,te=(A*q-G*k)/T;return j==0&&te==0?!1:!(j<=0||j>=1||te<=0||te>=1)}for(var f=0;f<a.length;f++){const y={x:a[f].getLat(),y:a[f].getLon()},S=a[(f+1)%a.length],v={x:S.getLat(),y:S.getLon()};for(var _=f+2;_<a.length;_++){const I={x:a[_].getLat(),y:a[_].getLon()},A=a[(_+1)%a.length],B={x:A.getLat(),y:A.getLon()};if(d(y,v,I,B))return!0}}return!1},c.getElevationFromServer=async function(d,f,_){let y="N/A";const v=await(await fetch("https://api.opentopodata.org/v1/aster30m?locations="+f+","+d)).json();return v.status=="OK"&&v.results[0].elevation!=null&&(y=v.results[0].elevation),y},c},GeozoneCollection=function(){let n={},e=[],t=126,i=63;return n.getMaxVertices=()=>t,n.getMaxZones=()=>i,n.put=s=>{s.setNumber(e.length),e.push(s)},n.get=()=>e,n.at=s=>e[s],n.isEmpty=()=>e.length==0,n.flush=()=>{e=[]},n.first=()=>n.isEmpty()?null:e[0],n.last=()=>n.isEmpty()?null:e[e.length-1],n.updateGeozone=s=>{e[s.getNumber()]=s},n.geozoneCount=()=>e.length,n.getUsedVerticesCount=()=>{let s=0;return e.forEach(r=>{r.getShape()==GeozoneShapes.POLYGON?s+=r.getVerticesCount():s+=2}),s},n.drop=s=>{e.forEach(r=>{r.getNumber()>=s&&r.setNumber(r.getNumber()-1)}),e.splice(s,1)},n.insert=(s,r)=>{e.forEach(o=>{o.getNumber()>=r&&o.setNumber(o.getNumber()+1)}),e.splice(r,0,s)},n.extractBufferVertices=(s,r)=>{let o=[];if(s<n.geozoneCount()){let a=e[s];if(r<a.getVerticesCount()){o.push(s);let h=a.getVertex(r);o.push(h.getNumber()),o.push(BitHelper.specificByte(h.getLat(),0)),o.push(BitHelper.specificByte(h.getLat(),1)),o.push(BitHelper.specificByte(h.getLat(),2)),o.push(BitHelper.specificByte(h.getLat(),3)),o.push(BitHelper.specificByte(h.getLon(),0)),o.push(BitHelper.specificByte(h.getLon(),1)),o.push(BitHelper.specificByte(h.getLon(),2)),o.push(BitHelper.specificByte(h.getLon(),3)),a.getShape()==GeozoneShapes.CIRCULAR&&(o.push(BitHelper.specificByte(a.getRadius(),0)),o.push(BitHelper.specificByte(a.getRadius(),1)),o.push(BitHelper.specificByte(a.getRadius(),2)),o.push(BitHelper.specificByte(a.getRadius(),3)))}}return o.length==0&&(o=[0,0,0,0,0,0,0,0,0,0]),o},n.extractBufferZone=s=>{let r=[];if(s<n.geozoneCount()){let o=e[s];r.push(o.getNumber()),r.push(o.getType()),r.push(o.getShape()),r.push(BitHelper.specificByte(o.getMinAltitude(),0)),r.push(BitHelper.specificByte(o.getMinAltitude(),1)),r.push(BitHelper.specificByte(o.getMinAltitude(),2)),r.push(BitHelper.specificByte(o.getMinAltitude(),3)),r.push(BitHelper.specificByte(o.getMaxAltitude(),0)),r.push(BitHelper.specificByte(o.getMaxAltitude(),1)),r.push(BitHelper.specificByte(o.getMaxAltitude(),2)),r.push(BitHelper.specificByte(o.getMaxAltitude(),3)),r.push(o.getSealevelRef()),r.push(o.getFenceAction()),o.getShape()==GeozoneShapes.CIRCULAR?r.push(2):r.push(o.getVerticesCount())}else r=[s,0,0,0,0,0,0,0,0,0,0,0,0,0];return r},n};const SERVO={ELEVATOR:1,ELEVON_1:1,ELEVON_2:2,FLAPPERON_1:2,FLAPPERON_2:3,RUDDER:4},INPUT={STABILIZED_ROLL:0,STABILIZED_PITCH:1,STABILIZED_YAW:2,STABILIZED_THROTTLE:3,RC_ROLL:4,RC_PITCH:5,RC_YAW:6},STABILIZED={ROLL_POSITIVE:23,ROLL_NEGATIVE:24,PITCH_POSITIVE:25,PITCH_NEGATIVE:26,YAW_POSITIVE:27,YAW_NEGATIVE:28},PLATFORM={MULTIROTOR:0,AIRPLANE:1,HELICOPTER:2,TRICOPTER:3,ROVER:4,BOAT:5},mixerList=[{id:1,name:"Tricopter",model:"tricopter",image:"tri",enabled:!0,legacy:!0,platform:PLATFORM.TRICOPTER,motorMixer:[new MotorMixRule(1,0,1.333333,0),new MotorMixRule(1,-1,-.666667,0),new MotorMixRule(1,1,-.666667,0)],servoMixer:[new ServoMixRule(SERVO.RUDDER,INPUT.STABILIZED_YAW,100,0)]},{id:3,name:"Quad X",model:"quad_x",image:"quad_x",enabled:!0,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[new MotorMixRule(1,-1,1,-1),new MotorMixRule(1,-1,-1,1),new MotorMixRule(1,1,1,1),new MotorMixRule(1,1,-1,-1)],servoMixer:[]},{id:2,name:"Quad +",model:"quad_x",image:"quad_p",enabled:!0,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[new MotorMixRule(1,0,1,-1),new MotorMixRule(1,-1,0,1),new MotorMixRule(1,1,0,1),new MotorMixRule(1,0,-1,-1)],servoMixer:[]},{id:4,name:"Bicopter",model:"custom",image:"bicopter",enabled:!1,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[],servoMixer:[]},{id:6,name:"Y6",model:"y6",image:"y6",enabled:!0,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[new MotorMixRule(1,0,1.333333,1),new MotorMixRule(1,-1,-.666667,-1),new MotorMixRule(1,1,-.666667,-1),new MotorMixRule(1,0,1.333333,-1),new MotorMixRule(1,-1,-.666667,1),new MotorMixRule(1,1,-.666667,1)],servoMixer:[]},{id:7,name:"Hex +",model:"hex_plus",image:"hex_p",enabled:!0,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[new MotorMixRule(1,-.866025,.5,1),new MotorMixRule(1,-.866025,-.5,-1),new MotorMixRule(1,.866025,.5,1),new MotorMixRule(1,.866025,-.5,-1),new MotorMixRule(1,0,-1,1),new MotorMixRule(1,0,1,-1)],servoMixer:[]},{id:9,name:"Y4",model:"y4",image:"y4",enabled:!0,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[new MotorMixRule(1,0,1,-1),new MotorMixRule(1,-1,-1,0),new MotorMixRule(1,0,1,1),new MotorMixRule(1,1,-1,0)],servoMixer:[]},{id:10,name:"Hex X",model:"hex_x",image:"hex_x",enabled:!0,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[new MotorMixRule(1,-.5,.866025,1),new MotorMixRule(1,-.5,-.866025,1),new MotorMixRule(1,.5,.866025,-1),new MotorMixRule(1,.5,-.866025,-1),new MotorMixRule(1,-1,0,-1),new MotorMixRule(1,1,0,1)],servoMixer:[]},{id:11,name:"Octo X8",model:"custom",image:"octo_x8",enabled:!0,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[new MotorMixRule(1,-1,1,-1),new MotorMixRule(1,-1,-1,1),new MotorMixRule(1,1,1,1),new MotorMixRule(1,1,-1,-1),new MotorMixRule(1,-1,1,1),new MotorMixRule(1,-1,-1,-1),new MotorMixRule(1,1,1,-1),new MotorMixRule(1,1,-1,1)],servoMixer:[]},{id:12,name:"Octo Flat +",model:"custom",image:"octo_flat_p",enabled:!0,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[new MotorMixRule(1,.707107,-.707107,1),new MotorMixRule(1,-.707107,-.707107,1),new MotorMixRule(1,-.707107,.707107,1),new MotorMixRule(1,.707107,.707107,1),new MotorMixRule(1,0,-1,-1),new MotorMixRule(1,-1,0,-1),new MotorMixRule(1,0,1,-1),new MotorMixRule(1,1,0,-1)],servoMixer:[]},{id:13,name:"Octo Flat X",model:"custom",image:"octo_flat_x",enabled:!0,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[new MotorMixRule(1,1,-.414178,1),new MotorMixRule(1,-.414178,-1,1),new MotorMixRule(1,-1,.414178,1),new MotorMixRule(1,.414178,1,1),new MotorMixRule(1,.414178,-1,-1),new MotorMixRule(1,-1,-.414178,-1),new MotorMixRule(1,-.414178,1,-1),new MotorMixRule(1,1,.414178,-1)],servoMixer:[]},{id:17,name:"V-tail Quad",model:"quad_vtail",image:"vtail_quad",enabled:!0,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[new MotorMixRule(1,-.58,.58,1),new MotorMixRule(1,-.46,-.39,-.5),new MotorMixRule(1,.58,.58,-1),new MotorMixRule(1,.46,-.39,.5)],servoMixer:[]},{id:18,name:"Hex H",model:"custom",image:"custom",enabled:!0,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[new MotorMixRule(1,-1,1,-1),new MotorMixRule(1,-1,-1,1),new MotorMixRule(1,1,1,1),new MotorMixRule(1,1,-1,-1),new MotorMixRule(1,0,0,0),new MotorMixRule(1,0,0,0)],servoMixer:[]},{id:20,name:"Dualcopter",model:"custom",image:"custom",enabled:!1,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[],servoMixer:[]},{id:21,name:"Singlecopter",model:"custom",image:"custom",enabled:!1,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[],servoMixer:[]},{id:22,name:"A-tail Quad",model:"quad_atail",image:"atail_quad",enabled:!0,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[new MotorMixRule(1,0,1,1),new MotorMixRule(1,-1,-1,0),new MotorMixRule(1,0,1,-1),new MotorMixRule(1,1,-1,-0)],servoMixer:[]},{id:23,name:"Custom",model:"custom",image:"custom",enabled:!1,legacy:!0,platform:PLATFORM.MULTIROTOR,motorMixer:[],servoMixer:[]},{id:25,name:"Custom Tricopter",model:"custom",image:"custom",enabled:!1,legacy:!0,platform:PLATFORM.TRICOPTER,motorMixer:[],servoMixer:[]},{id:8,name:"Flying Wing",model:"flying_wing",image:"flying_wing",imageOutputsNumbers:[{input:INPUT.STABILIZED_ROLL,top:123,left:18,colour:"#ff0000"},{input:INPUT.STABILIZED_ROLL,top:123,left:134,colour:"#00e000"},{input:INPUT.STABILIZED_THROTTLE,top:93,left:71,colour:"#000000"}],enabled:!0,legacy:!0,platform:PLATFORM.AIRPLANE,motorStopOnLow:!0,motorMixer:[new MotorMixRule(1,0,0,0)],servoMixer:[new ServoMixRule(SERVO.ELEVON_1,INPUT.STABILIZED_ROLL,50,0),new ServoMixRule(SERVO.ELEVON_1,INPUT.STABILIZED_PITCH,50,0),new ServoMixRule(SERVO.ELEVON_2,INPUT.STABILIZED_ROLL,-50,0),new ServoMixRule(SERVO.ELEVON_2,INPUT.STABILIZED_PITCH,50,0)]},{id:27,name:"Flying Wing with differential thrust",model:"flying_wing",image:"flying_wing",imageOutputsNumbers:[{input:INPUT.STABILIZED_ROLL,top:123,left:18,colour:"#ff0000"},{input:INPUT.STABILIZED_ROLL,top:123,left:134,colour:"#00e000"},{input:INPUT.STABILIZED_THROTTLE,top:93,left:71,colour:"#000000"}],enabled:!0,legacy:!1,platform:PLATFORM.AIRPLANE,motorStopOnLow:!0,motorMixer:[new MotorMixRule(1,0,0,.1),new MotorMixRule(1,0,0,-.1)],servoMixer:[new ServoMixRule(SERVO.ELEVON_1,INPUT.STABILIZED_ROLL,50,0),new ServoMixRule(SERVO.ELEVON_1,INPUT.STABILIZED_PITCH,50,0),new ServoMixRule(SERVO.ELEVON_2,INPUT.STABILIZED_ROLL,-50,0),new ServoMixRule(SERVO.ELEVON_2,INPUT.STABILIZED_PITCH,50,0)]},{id:14,name:"Airplane",model:"twin_plane",image:"airplane",imageOutputsNumbers:[{input:INPUT.STABILIZED_PITCH,top:151,left:126,colour:"#ff7f00"},{input:INPUT.STABILIZED_ROLL,top:96,left:18,colour:"#ff0000"},{input:INPUT.STABILIZED_ROLL,top:96,left:134,colour:"#00e000"},{input:INPUT.STABILIZED_YAW,top:126,left:52,colour:"#00a6ff"},{input:INPUT.STABILIZED_THROTTLE,top:5,left:71,colour:"#000000"}],enabled:!0,legacy:!0,platform:PLATFORM.AIRPLANE,motorStopOnLow:!0,hasFlaps:!0,motorMixer:[new MotorMixRule(1,0,0,0)],servoMixer:[new ServoMixRule(SERVO.ELEVATOR,INPUT.STABILIZED_PITCH,100,0),new ServoMixRule(SERVO.FLAPPERON_1,INPUT.STABILIZED_ROLL,100,0),new ServoMixRule(SERVO.FLAPPERON_2,INPUT.STABILIZED_ROLL,100,0),new ServoMixRule(SERVO.RUDDER,INPUT.STABILIZED_YAW,100,0)]},{id:26,name:"Airplane with differential thrust",model:"twin_plane",image:"airplane",imageOutputsNumbers:[{input:INPUT.STABILIZED_PITCH,top:151,left:126,colour:"#ff7f00"},{input:INPUT.STABILIZED_ROLL,top:96,left:18,colour:"#ff0000"},{input:INPUT.STABILIZED_ROLL,top:96,left:134,colour:"#00e000"},{input:INPUT.STABILIZED_YAW,top:126,left:52,colour:"#00a6ff"},{input:INPUT.STABILIZED_THROTTLE,top:5,left:71,colour:"#000000"}],enabled:!0,legacy:!1,platform:PLATFORM.AIRPLANE,motorStopOnLow:!0,hasFlaps:!0,motorMixer:[new MotorMixRule(1,0,0,.3),new MotorMixRule(1,0,0,-.3)],servoMixer:[new ServoMixRule(SERVO.ELEVATOR,INPUT.STABILIZED_PITCH,100,0),new ServoMixRule(SERVO.FLAPPERON_1,INPUT.STABILIZED_ROLL,100,0),new ServoMixRule(SERVO.FLAPPERON_2,INPUT.STABILIZED_ROLL,100,0),new ServoMixRule(SERVO.RUDDER,INPUT.STABILIZED_YAW,100,0)]},{id:28,name:"Airplane V-tail",model:"vtail_plane",image:"airplane_vtail",imageOutputsNumbers:[{input:INPUT.STABILIZED_ROLL,top:96,left:18,colour:"#ff0000"},{input:INPUT.STABILIZED_ROLL,top:96,left:134,colour:"#00e000"},{input:INPUT.STABILIZED_PITCH,top:154,left:20,colour:"#ff7f00"},{input:INPUT.STABILIZED_PITCH,top:154,left:132,colour:"#00a6ff"},{input:INPUT.STABILIZED_THROTTLE,top:5,left:71,colour:"#000000"}],enabled:!0,legacy:!1,platform:PLATFORM.AIRPLANE,motorStopOnLow:!0,hasFlaps:!0,motorMixer:[new MotorMixRule(1,0,0,0)],servoMixer:[new ServoMixRule(1,INPUT.STABILIZED_ROLL,100,0),new ServoMixRule(2,INPUT.STABILIZED_ROLL,100,0),new ServoMixRule(3,INPUT.STABILIZED_PITCH,50,0),new ServoMixRule(3,INPUT.STABILIZED_YAW,-50,0),new ServoMixRule(4,INPUT.STABILIZED_PITCH,-50,0),new ServoMixRule(4,INPUT.STABILIZED_YAW,-50,0)]},{id:34,name:"Airplane V-tail with differential thrust",model:"vtail_plane",image:"airplane_vtail",imageOutputsNumbers:[{input:INPUT.STABILIZED_ROLL,top:96,left:18,colour:"#ff0000"},{input:INPUT.STABILIZED_ROLL,top:96,left:134,colour:"#00e000"},{input:INPUT.STABILIZED_PITCH,top:154,left:20,colour:"#ff7f00"},{input:INPUT.STABILIZED_PITCH,top:154,left:132,colour:"#00a6ff"},{input:INPUT.STABILIZED_THROTTLE,top:5,left:71,colour:"#000000"}],enabled:!0,legacy:!1,platform:PLATFORM.AIRPLANE,motorStopOnLow:!0,hasFlaps:!0,motorMixer:[new MotorMixRule(1,0,0,.3),new MotorMixRule(1,0,0,-.3)],servoMixer:[new ServoMixRule(1,INPUT.STABILIZED_ROLL,100,0),new ServoMixRule(2,INPUT.STABILIZED_ROLL,100,0),new ServoMixRule(3,INPUT.STABILIZED_PITCH,50,0),new ServoMixRule(3,INPUT.STABILIZED_YAW,-50,0),new ServoMixRule(4,INPUT.STABILIZED_PITCH,-50,0),new ServoMixRule(4,INPUT.STABILIZED_YAW,-50,0)]},{id:29,name:"Airplane V-tail (single aileron servo)",model:"vtail_single_servo_plane",image:"airplane_vtail_single",imageOutputsNumbers:[{input:INPUT.STABILIZED_ROLL,top:96,left:18,colour:"#ff7f00"},{input:INPUT.STABILIZED_PITCH,top:154,left:20,colour:"#ff0000"},{input:INPUT.STABILIZED_PITCH,top:154,left:132,colour:"#00e000"},{input:INPUT.STABILIZED_THROTTLE,top:5,left:71,colour:"#000000"}],enabled:!0,legacy:!1,platform:PLATFORM.AIRPLANE,motorStopOnLow:!0,motorMixer:[new MotorMixRule(1,0,0,0)],servoMixer:[new ServoMixRule(1,INPUT.STABILIZED_ROLL,100,0),new ServoMixRule(2,INPUT.STABILIZED_PITCH,50,0),new ServoMixRule(2,INPUT.STABILIZED_YAW,-50,0),new ServoMixRule(3,INPUT.STABILIZED_PITCH,-50,0),new ServoMixRule(3,INPUT.STABILIZED_YAW,-50,0)]},{id:30,name:"Airplane without rudder",model:"rudderless_plane",image:"airplane_norudder",imageOutputsNumbers:[{input:INPUT.STABILIZED_PITCH,top:151,left:126,colour:"#ff7f00"},{input:INPUT.STABILIZED_ROLL,top:96,left:18,colour:"#ff0000"},{input:INPUT.STABILIZED_ROLL,top:96,left:134,colour:"#00e000"},{input:INPUT.STABILIZED_THROTTLE,top:5,left:71,colour:"#000000"}],enabled:!0,legacy:!1,platform:PLATFORM.AIRPLANE,hasFlaps:!0,motorStopOnLow:!0,motorMixer:[new MotorMixRule(1,0,0,0)],servoMixer:[new ServoMixRule(SERVO.ELEVATOR,INPUT.STABILIZED_PITCH,100,0),new ServoMixRule(SERVO.FLAPPERON_1,INPUT.STABILIZED_ROLL,100,0),new ServoMixRule(SERVO.FLAPPERON_2,INPUT.STABILIZED_ROLL,100,0)]},{id:24,name:"Custom Airplane",model:"twin_plane",image:"airplane",imageOutputsNumbers:[{input:INPUT.STABILIZED_PITCH,top:151,left:126,colour:"#ff7f00"},{input:INPUT.STABILIZED_ROLL,top:96,left:18,colour:"#ff0000"},{input:INPUT.STABILIZED_ROLL,top:96,left:134,colour:"#00e000"},{input:INPUT.STABILIZED_YAW,top:126,left:52,colour:"#00a6ff"},{input:INPUT.STABILIZED_THROTTLE,top:5,left:71,colour:"#000000"}],enabled:!1,legacy:!0,platform:PLATFORM.AIRPLANE,motorStopOnLow:!0,motorMixer:[],servoMixer:[]},{id:15,name:"Heli 120",model:"custom",image:"custom",enabled:!1,legacy:!0,platform:PLATFORM.HELICOPTER,motorMixer:[],servoMixer:[]},{id:16,name:"Heli 90",model:"custom",image:"custom",enabled:!1,legacy:!0,platform:PLATFORM.HELICOPTER,motorMixer:[],servoMixer:[]},{id:31,name:"Rover",model:"custom",image:"custom",enabled:!0,legacy:!1,platform:PLATFORM.ROVER,motorMixer:[new MotorMixRule(1,0,0,0)],servoMixer:[new ServoMixRule(3,INPUT.STABILIZED_YAW,100,0)]},{id:32,name:"Boat",model:"custom",image:"custom",enabled:!0,legacy:!1,platform:PLATFORM.BOAT,motorMixer:[new MotorMixRule(1,0,0,0)],servoMixer:[new ServoMixRule(3,INPUT.STABILIZED_YAW,100,0)]}],platformList=[{id:0,name:"Multirotor",enabled:!0,flapsPossible:!1},{id:1,name:"Airplane",enabled:!0,flapsPossible:!0},{id:2,name:"Helicopter",enabled:!1,flapsPossible:!1},{id:3,name:"Tricopter",enabled:!0,flapsPossible:!1},{id:4,name:"Rover",enabled:!0,flapsPossible:!1},{id:5,name:"Boat",enabled:!0,flapsPossible:!1}];var mixer=(function(n){let e={};return e.getLegacyList=function(){let t=[];for(const i in n)if(n.hasOwnProperty(i)){let s=n[i];s.legacy&&t.push(s)}return t},e.getList=function(){let t=[];for(const i in n)if(n.hasOwnProperty(i)){let s=n[i];s.enabled&&t.push(s)}return t},e.getById=function(t){for(const i in n)if(n.hasOwnProperty(i)){let s=n[i];if(s.id===t)return s}return!1},e.getByPlatform=function(t){let i=[];for(const s in n)if(n.hasOwnProperty(s)){let r=n[s];r.platform===t&&r.enabled&&i.push(r)}return i},e.loadServoRules=function(t,i){t.SERVO_RULES.flush();for(const s in i.servoMixer)if(i.servoMixer.hasOwnProperty(s)){const r=i.servoMixer[s];t.SERVO_RULES.put(new ServoMixRule(r.getTarget(),r.getInput(),r.getRate(),r.getSpeed()))}},e.loadMotorRules=function(t,i){t.MOTOR_RULES.flush();for(const s in i.motorMixer)if(i.motorMixer.hasOwnProperty(s)){const r=i.motorMixer[s];t.MOTOR_RULES.put(new MotorMixRule(r.getThrottle(),r.getRoll(),r.getPitch(),r.getYaw()))}},e.countSurfaceType=function(t,i){let s=0;for(const r in t.servoMixer)t.servoMixer.hasOwnProperty(r)&&t.servoMixer[r].getInput()===i&&s++;return s},e})(mixerList),platform=(function(n){let e={};return e.getList=function(){let t=[];for(const i in n)if(n.hasOwnProperty(i)){let s=n[i];s.enabled&&t.push(s)}return t},e.getById=function(t){for(const i in n)if(n.hasOwnProperty(i)){let s=n[i];if(s.id===t)return s}return!1},e})(platformList),VTX=(function(){var n={};return n.DEV_SMARTAUDIO=3,n.DEV_TRAMP=4,n.DEV_MSP=6,n.DEV_UNKNOWN=255,n.BANDS=[{code:1,name:"Boscam A"},{code:2,name:"Boscam B"},{code:3,name:"Boscam E"},{code:4,name:"Fatshark"},{code:5,name:"Raceband"}],n.BAND_MIN=1,n.BAND_MAX=5,n.CHANNEL_MIN=1,n.CHANNEL_MAX=8,n.getMinPower=function(e){return e==n.DEV_MSP?0:1},n.getMaxPower=function(e){return e==n.DEV_SMARTAUDIO||e==n.DEV_TRAMP?8:e==n.DEV_MSP?4:3},n.LOW_POWER_DISARM_MIN=0,n.LOW_POWER_DISARM_MAX=2,n.MAX_FREQUENCY_MHZ=5999,n})(),FLIGHT_MODES=[{boxId:0,boxName:"ARM",permanentId:0},{boxId:1,boxName:"ANGLE",permanentId:1},{boxId:2,boxName:"HORIZON",permanentId:2},{boxId:3,boxName:"NAV ALTHOLD",permanentId:3},{boxId:4,boxName:"HEADING HOLD",permanentId:5},{boxId:5,boxName:"HEADFREE",permanentId:6},{boxId:6,boxName:"HEADADJ",permanentId:7},{boxId:7,boxName:"CAMSTAB",permanentId:8},{boxId:8,boxName:"NAV RTH",permanentId:10},{boxId:9,boxName:"NAV POSHOLD",permanentId:11},{boxId:10,boxName:"MANUAL",permanentId:12},{boxId:11,boxName:"BEEPER",permanentId:13},{boxId:12,boxName:"LEDS OFF",permanentId:15},{boxId:13,boxName:"LIGHTS",permanentId:16},{boxId:15,boxName:"OSD OFF",permanentId:19},{boxId:16,boxName:"TELEMETRY",permanentId:20},{boxId:28,boxName:"AUTO TUNE",permanentId:21},{boxId:17,boxName:"BLACKBOX",permanentId:26},{boxId:18,boxName:"FAILSAFE",permanentId:27},{boxId:19,boxName:"NAV WP",permanentId:28},{boxId:20,boxName:"AIR MODE",permanentId:29},{boxId:21,boxName:"HOME RESET",permanentId:30},{boxId:22,boxName:"GCS NAV",permanentId:31},{boxId:39,boxName:"FPV ANGLE MIX",permanentId:32},{boxId:24,boxName:"SURFACE",permanentId:33},{boxId:25,boxName:"FLAPERON",permanentId:34},{boxId:26,boxName:"TURN ASSIST",permanentId:35},{boxId:14,boxName:"NAV LAUNCH",permanentId:36},{boxId:27,boxName:"SERVO AUTOTRIM",permanentId:37},{boxId:23,boxName:"KILLSWITCH",permanentId:38},{boxId:29,boxName:"CAMERA CONTROL 1",permanentId:39},{boxId:30,boxName:"CAMERA CONTROL 2",permanentId:40},{boxId:31,boxName:"CAMERA CONTROL 3",permanentId:41},{boxId:32,boxName:"OSD ALT 1",permanentId:42},{boxId:33,boxName:"OSD ALT 2",permanentId:43},{boxId:34,boxName:"OSD ALT 3",permanentId:44},{boxId:35,boxName:"NAV COURSE HOLD",permanentId:45},{boxId:36,boxName:"MC BRAKING",permanentId:46},{boxId:37,boxName:"USER1",permanentId:47},{boxId:38,boxName:"USER2",permanentId:48},{boxId:48,boxName:"USER3",permanentId:57},{boxId:49,boxName:"USER4",permanentId:58},{boxId:40,boxName:"LOITER CHANGE",permanentId:49},{boxId:41,boxName:"MSP RC OVERRIDE",permanentId:50},{boxId:42,boxName:"PREARM",permanentId:51},{boxId:43,boxName:"TURTLE",permanentId:52},{boxId:44,boxName:"NAV CRUISE",permanentId:53},{boxId:45,boxName:"AUTO LEVEL TRIM",permanentId:54},{boxId:46,boxName:"WP PLANNER",permanentId:55},{boxId:47,boxName:"SOARING",permanentId:56},{boxId:50,boxName:"MISSION CHANGE",permanentId:59},{boxId:51,boxName:"BEEPER MUTE",permanentId:60},{boxId:52,boxName:"MULTI FUNCTION",permanentId:61},{boxId:53,boxName:"MIXER PROFILE 2",permanentId:62},{boxId:54,boxName:"MIXER TRANSITION",permanentId:63},{boxId:55,boxName:"ANGLE HOLD",permanentId:64},{boxId:56,boxName:"GIMBAL LEVEL TILT",permanentId:65},{boxId:57,boxName:"GIMBAL LEVEL ROLL",permanentId:66},{boxId:58,boxName:"GIMBAL CENTER",permanentId:67},{boxId:59,boxName:"GIMBAL HEADTRACKER",permanentId:68}],FC={CONFIG:null,LED_STRIP:null,LED_COLORS:null,LED_MODE_COLORS:null,PID:null,PID_names:null,PIDs:null,RC_MAP:null,RC:null,RC_tuning:null,AUX_CONFIG:[],AUX_CONFIG_IDS:[],MODE_RANGES:null,ADJUSTMENT_RANGES:null,SERVO_CONFIG:null,SERVO_RULES:null,MOTOR_RULES:null,LOGIC_CONDITIONS:null,LOGIC_CONDITIONS_STATUS:null,GLOBAL_FUNCTIONS:null,GLOBAL_VARIABLES_STATUS:null,PROGRAMMING_PID:null,PROGRAMMING_PID_STATUS:null,SERIAL_CONFIG:null,SENSOR_DATA:null,MOTOR_DATA:null,SERVO_DATA:null,GPS_DATA:null,ADSB_VEHICLES:null,MISSION_PLANNER:null,ANALOG:null,ARMING_CONFIG:null,FC_CONFIG:null,MISC:null,REVERSIBLE_MOTORS:null,DATAFLASH:null,SDCARD:null,BLACKBOX:null,RC_deadband:null,SENSOR_ALIGNMENT:null,RX_CONFIG:null,FAILSAFE_CONFIG:null,RXFAIL_CONFIG:null,VTX_CONFIG:null,ADVANCED_CONFIG:null,INAV_PID_CONFIG:null,PID_ADVANCED:null,FILTER_CONFIG:null,SENSOR_STATUS:null,SENSOR_CONFIG:null,NAV_POSHOLD:null,CALIBRATION_DATA:null,POSITION_ESTIMATOR:null,RTH_AND_LAND_CONFIG:null,FW_CONFIG:null,DEBUG_TRACE:null,MIXER_CONFIG:null,BATTERY_CONFIG:null,OUTPUT_MAPPING:null,BRAKING_CONFIG:null,SAFEHOMES:null,BOARD_ALIGNMENT:null,CURRENT_METER_CONFIG:null,FEATURES:null,RATE_DYNAMICS:null,EZ_TUNE:null,FLIGHT_MODES:null,GEOZONES:null,restartRequired:!1,MAX_SERVO_RATE:125,MIN_SERVO_RATE:0,isAirplane:function(){return this.MIXER_CONFIG.platformType==PLATFORM.AIRPLANE},isMultirotor:function(){return this.MIXER_CONFIG.platformType==PLATFORM.MULTIROTOR||this.MIXER_CONFIG.platformType==PLATFORM.TRICOPTER},isRpyFfComponentUsed:function(){return!0},isRpyDComponentUsed:function(){return!0},resetState:function(){this.SENSOR_STATUS={isHardwareHealthy:0,gyroHwStatus:0,accHwStatus:0,magHwStatus:0,baroHwStatus:0,gpsHwStatus:0,rangeHwStatus:0,speedHwStatus:0,flowHwStatus:0},this.SENSOR_CONFIG={accelerometer:0,barometer:0,magnetometer:0,pitot:0,rangefinder:0,opflow:0},this.CONFIG={apiVersion:"0.0.0",flightControllerIdentifier:"",flightControllerVersion:"",version:0,buildInfo:"",multiType:0,msp_version:0,capability:0,cycleTime:0,i2cError:0,activeSensors:0,mode:[],mixer_profile:-1,profile:-1,battery_profile:-1,uid:[0,0,0],accelerometerTrims:[0,0],armingFlags:0,name:""},this.BOARD_ALIGNMENT={roll:0,pitch:0,yaw:0},this.CURRENT_METER_CONFIG={scale:0,offset:0,type:0,capacity:0},this.LED_STRIP=[],this.LED_COLORS=[],this.LED_MODE_COLORS=[],this.FEATURES=0,this.PID={},this.PID_names=[],this.PIDs=[],this.RC_MAP=[],this.RC={active_channels:0,channels:new Array(32)},this.RC_tuning={RC_RATE:0,RC_EXPO:0,roll_pitch_rate:0,roll_rate:0,pitch_rate:0,yaw_rate:0,dynamic_THR_PID:0,throttle_MID:0,throttle_EXPO:0,dynamic_THR_breakpoint:0,RC_YAW_EXPO:0,manual_RC_EXPO:0,manual_RC_YAW_EXPO:0,manual_roll_rate:0,manual_pitch_rate:0,manual_yaw_rate:0},this.generateAuxConfig=function(){console.log("Generating AUX_CONFIG"),this.AUX_CONFIG=[];for(let n=0;n<this.AUX_CONFIG_IDS.length;n++){let e=FLIGHT_MODES.find(t=>t.permanentId===this.AUX_CONFIG_IDS[n]);e&&this.AUX_CONFIG.push(e.boxName)}},this.MODE_RANGES=[],this.ADJUSTMENT_RANGES=[],this.SERVO_CONFIG=[],this.SERVO_RULES=new ServoMixerRuleCollection,this.MOTOR_RULES=new MotorMixerRuleCollection,this.LOGIC_CONDITIONS=new LogicConditionsCollection,this.LOGIC_CONDITIONS_STATUS=new LogicConditionsStatus,this.GLOBAL_VARIABLES_STATUS=new GlobalVariablesStatus,this.PROGRAMMING_PID=new ProgrammingPidCollection,this.PROGRAMMING_PID_STATUS=new ProgrammingPidStatus,this.MIXER_CONFIG={yawMotorDirection:0,yawJumpPreventionLimit:0,motorStopOnLow:!1,platformType:-1,hasFlaps:!1,appliedMixerPreset:-1,numberOfMotors:0,numberOfServos:0},this.SERIAL_CONFIG={ports:[],mspBaudRate:0,gpsBaudRate:0,gpsPassthroughBaudRate:0,cliBaudRate:0},this.SENSOR_DATA={gyroscope:[0,0,0],accelerometer:[0,0,0],magnetometer:[0,0,0],altitude:0,barometer:0,sonar:0,air_speed:0,kinematics:[0,0,0],temperature:[0,0,0,0,0,0,0,0],debug:[0,0,0,0]},this.MOTOR_DATA=new Array(8),this.SERVO_DATA=new Array(16),this.GPS_DATA={fix:0,numSat:0,lat:0,lon:0,alt:0,speed:0,ground_course:0,distanceToHome:0,ditectionToHome:0,update:0,hdop:0,eph:0,epv:0,messageDt:0,errors:0,timeouts:0,packetCount:0},this.ADSB_VEHICLES={vehiclesCount:0,callsignLength:0,vehiclePacketCount:0,heartbeatPacketCount:0,vehicles:[]},this.MISSION_PLANNER=new WaypointCollection,this.ANALOG={voltage:0,mAhdrawn:0,mWhdrawn:0,rssi:0,amperage:0,power:0,cell_count:0,battery_percentage:0,battery_full_when_plugged_in:!1,use_capacity_thresholds:!1,battery_remaining_capacity:0,battery_flags:0},this.FC_CONFIG={loopTime:0},this.MISC={midrc:0,minthrottle:0,maxthrottle:0,mincommand:0,failsafe_throttle:0,gps_type:0,sensors_baudrate:0,gps_ubx_sbas:0,multiwiicurrentoutput:0,rssi_channel:0,placeholder2:0,mag_declination:0,battery_cells:0,vbatscale:0,vbatdetectcellvoltage:0,vbatmincellvoltage:0,vbatmaxcellvoltage:0,vbatwarningcellvoltage:0,battery_capacity:0,battery_capacity_warning:0,battery_capacity_critical:0,battery_capacity_unit:"mAh"},this.BATTERY_CONFIG={vbatscale:0,vbatdetectcellvoltage:0,vbatmincellvoltage:0,vbatmaxcellvoltage:0,vbatwarningcellvoltage:0,current_offset:0,current_scale:0,capacity:0,capacity_warning:0,capacity_critical:0,capacity_unit:0},this.VTX_CONFIG={device_type:VTX.DEV_UNKNOWN,band:0,channel:1,power:0,pitmode:0,low_power_disarm:0},this.ADVANCED_CONFIG={gyroSyncDenominator:null,pidProcessDenom:null,useUnsyncedPwm:null,motorPwmProtocol:null,motorPwmRate:null,servoPwmRate:null,gyroSync:null},this.FILTER_CONFIG={gyroSoftLpfHz:null,dtermLpfHz:null,yawLpfHz:null,gyroNotchHz1:null,gyroNotchCutoff1:null,dtermNotchHz:null,dtermNotchCutoff:null,gyroNotchHz2:null,gyroNotchCutoff2:null,accNotchHz:null,accNotchCutoff:null,gyroStage2LowpassHz:null},this.PID_ADVANCED={rollPitchItermIgnoreRate:null,yawItermIgnoreRate:null,yawPLimit:null,axisAccelerationLimitRollPitch:null,axisAccelerationLimitYaw:null,dtermSetpointWeight:null,pidSumLimit:null},this.INAV_PID_CONFIG={asynchronousMode:null,accelerometerTaskFrequency:null,attitudeTaskFrequency:null,magHoldRateLimit:null,magHoldErrorLpfFrequency:null,yawJumpPreventionLimit:null,gyroscopeLpf:null,accSoftLpfHz:null},this.NAV_POSHOLD={userControlMode:null,maxSpeed:null,maxClimbRate:null,maxManualSpeed:null,maxManualClimbRate:null,maxBankAngle:null,useThrottleMidForAlthold:null,hoverThrottle:null},this.CALIBRATION_DATA={acc:{Pos0:null,Pos1:null,Pos2:null,Pos3:null,Pos4:null,Pos5:null},accZero:{X:null,Y:null,Z:null},accGain:{X:null,Y:null,Z:null},magZero:{X:null,Y:null,Z:null},opflow:{Scale:null},magGain:{X:null,Y:null,Z:null}},this.RTH_AND_LAND_CONFIG={minRthDistance:null,rthClimbFirst:null,rthClimbIgnoreEmergency:null,rthTailFirst:null,rthAllowLanding:null,rthAltControlMode:null,rthAbortThreshold:null,rthAltitude:null,landDescentRate:null,landSlowdownMinAlt:null,landSlowdownMaxAlt:null,emergencyDescentRate:null},this.REVERSIBLE_MOTORS={deadband_low:0,deadband_high:0,neutral:0,deadband_throttle:0},this.DATAFLASH={ready:!1,supported:!1,sectors:0,totalSize:0,usedSize:0},this.SDCARD={supported:!1,state:0,filesystemLastError:0,freeSizeKB:0,totalSizeKB:0},this.BLACKBOX={supported:!1,blackboxDevice:0,blackboxRateNum:1,blackboxRateDenom:1},this.RC_deadband={deadband:0,yaw_deadband:0,alt_hold_deadband:0},this.SENSOR_ALIGNMENT={align_gyro:0,align_acc:0,align_mag:0,align_opflow:0},this.RX_CONFIG={receiver_type:0,serialrx_provider:0,maxcheck:0,midrc:0,mincheck:0,spektrum_sat_bind:0,rx_min_usec:0,rx_max_usec:0,spirx_protocol:0,spirx_id:0,spirx_channel_count:0},this.POSITION_ESTIMATOR={w_z_baro_p:null,w_z_gps_p:null,w_z_gps_v:null,w_xy_gps_p:null,w_xy_gps_v:null,gps_min_sats:null,use_gps_velned:null},this.FAILSAFE_CONFIG={failsafe_delay:0,failsafe_off_delay:0,failsafe_throttle:0,failsafe_kill_switch:0,failsafe_throttle_low_delay:0,failsafe_procedure:0,failsafe_recovery_delay:0,failsafe_fw_roll_angle:0,failsafe_fw_pitch_angle:0,failsafe_fw_yaw_rate:0,failsafe_stick_motion_threshold:0,failsafe_min_distance:0,failsafe_min_distance_procedure:0},this.FW_CONFIG={cruiseThrottle:null,minThrottle:null,maxThrottle:null,maxBankAngle:null,maxClimbAngle:null,maxDiveAngle:null,pitchToThrottle:null,loiterRadius:null},this.BRAKING_CONFIG={speedThreshold:null,disengageSpeed:null,timeout:null,boostFactor:null,boostTimeout:null,boostSpeedThreshold:null,boostDisengageSpeed:null,bankAngle:null},this.RXFAIL_CONFIG=[],this.OUTPUT_MAPPING=new OutputMappingCollection,this.SAFEHOMES=new SafehomeCollection,this.RATE_DYNAMICS={sensitivityCenter:null,sensitivityEnd:null,correctionCenter:null,correctionEnd:null,weightCenter:null,weightEnd:null},this.EZ_TUNE={enabled:null,filterHz:null,axisRatio:null,response:null,damping:null,stability:null,aggressiveness:null,rate:null,expo:null,snappiness:null},this.FW_APPROACH=new FwApproachCollection,this.GEOZONES=new GeozoneCollection,this.OSD_CUSTOM_ELEMENTS={settings:{customElementsCount:0,customElementTextSize:0,customElementParts:0},items:[]}},getOutputUsages:function(){return{ANY:0,MC_MOTOR:4,MC_SERVO:8,FW_MOTOR:32,FW_SERVO:64,LED:1<<24}},getFeatures:function(){var n=[{bit:1,group:"batteryVoltage",name:"VBAT"},{bit:6,group:"other",name:"SOFTSERIAL",haveTip:!0,showNameInTip:!0},{bit:7,group:"other",name:"GPS",haveTip:!0},{bit:10,group:"other",name:"TELEMETRY",showNameInTip:!0},{bit:11,group:"batteryCurrent",name:"CURRENT_METER"},{bit:12,group:"other",name:"REVERSIBLE_MOTORS",showNameInTip:!0},{bit:15,group:"other",name:"RSSI_ADC",haveTip:!0,showNameInTip:!0},{bit:16,group:"other",name:"LED_STRIP",showNameInTip:!0},{bit:17,group:"other",name:"DASHBOARD",showNameInTip:!0},{bit:19,group:"other",name:"BLACKBOX",haveTip:!0,showNameInTip:!0},{bit:28,group:"other",name:"PWM_OUTPUT_ENABLE",haveTip:!0},{bit:26,group:"other",name:"SOFTSPI"},{bit:29,group:"other",name:"OSD",haveTip:!1,showNameInTip:!1},{bit:22,group:"other",name:"AIRMODE",haveTip:!1,showNameInTip:!1},{bit:30,group:"other",name:"FW_LAUNCH",haveTip:!1,showNameInTip:!1},{bit:2,group:"other",name:"TX_PROF_SEL",haveTip:!1,showNameInTip:!1},{bit:0,group:"other",name:"THR_VBAT_COMP",haveTip:!0,showNameInTip:!0},{bit:3,group:"other",name:"BAT_PROFILE_AUTOSWITCH",haveTip:!0,showNameInTip:!0},{bit:31,group:"other",name:"FW_AUTOTRIM",haveTip:!0,showNameInTip:!0},{bit:4,group:"other",name:"GEOZONE",haveTip:!0,showNameInTip:!0}];return n.reverse()},isFeatureEnabled:function(n,e){e===void 0&&(e=this.getFeatures());for(var t=0;t<e.length;t++)if(e[t].name==n&&BitHelper.bit_check(this.FEATURES,e[t].bit))return!0;return!1},isMotorOutputEnabled:function(){return this.isFeatureEnabled("PWM_OUTPUT_ENABLE",this.getFeatures())},getGpsProtocols:function(){return["UBLOX","MSP","FAKE"]},getGpsBaudRates:function(){return["115200","57600","38400","19200","9600"]},getGpsSbasProviders:function(){return["Autodetect","European EGNOS","North American WAAS","Japanese MSAS","Indian GAGAN","SouthPAN (AU/NZ)","Disabled"]},getSensorAlignments:function(){return["CW 0Â°","CW 90Â°","CW 180Â°","CW 270Â°","CW 0Â° flip","CW 90Â° flip","CW 180Â° flip","CW 270Â° flip"]},getEscProtocols:function(){return{0:{name:"STANDARD",message:null,defaultRate:400,rates:{50:"50Hz",400:"400Hz"}},1:{name:"ONESHOT125",message:null,defaultRate:1e3,rates:{1e3:"1kHz",2e3:"2kHz"}},2:{name:"MULTISHOT",message:null,defaultRate:2e3,rates:{1e3:"1kHz",2e3:"2kHz"}},3:{name:"BRUSHED",message:null,defaultRate:8e3,rates:{8e3:"8kHz",16e3:"16kHz",32e3:"32kHz"}},4:{name:"DSHOT150",message:null,defaultRate:4e3,rates:{4e3:"4kHz"}},5:{name:"DSHOT300",message:null,defaultRate:8e3,rates:{8e3:"8kHz"}},6:{name:"DSHOT600",message:null,defaultRate:16e3,rates:{16e3:"16kHz"}}}},getServoRates:function(){return{50:"50Hz",60:"60Hz",100:"100Hz",160:"160Hz",330:"330Hz"}},getAsyncModes:function(){return["Disabled","Gyro","All"]},getAccelerometerTaskFrequencies:function(){return{100:"100Hz",200:"200Hz",250:"250Hz",500:"500Hz",750:"750Hz",1e3:"1kHz"}},getAttitudeTaskFrequencies:function(){return{100:"100Hz",200:"200Hz",250:"250Hz",500:"500Hz",750:"750Hz",1e3:"1kHz"}},getOsdDisabledFields:function(){return[]},getArmingFlags:function(){return{0:"OK_TO_ARM",1:"PREVENT_ARMING",2:"ARMED",3:"WAS_EVER_ARMED",8:"BLOCKED_UAV_NOT_LEVEL",9:"BLOCKED_SENSORS_CALIBRATING",10:"BLOCKED_SYSTEM_OVERLOADED",11:"BLOCKED_NAVIGATION_SAFETY",12:"BLOCKED_COMPASS_NOT_CALIBRATED",13:"BLOCKED_ACCELEROMETER_NOT_CALIBRATED",14:null,15:"BLOCKED_HARDWARE_FAILURE",26:"BLOCKED_INVALID_SETTING"}},getArmingBlockingFlags:function(){var n=this.getArmingFlags(),e={};for(var t in n)n.hasOwnProperty(t)&&parseInt(t,10)>=8&&n[t]!==null&&(e[t]=n[t]);return e},getAccelerometerCalibrated:function(){var n=!0,e=FC.getArmingFlags();return this.CALIBRATION_DATA.accGain.X===4096&&this.CALIBRATION_DATA.accGain.Y===4096&&this.CALIBRATION_DATA.accGain.Z===4096&&this.CALIBRATION_DATA.accZero.X===0&&this.CALIBRATION_DATA.accZero.Y===0&&this.CALIBRATION_DATA.accZero.Z===0&&(n=!1),n&&e.hasOwnProperty(13)&&BitHelper.bit_check(this.CONFIG.armingFlags,13)&&(n=!1),n},getUserControlMode:function(){return["Attitude","Cruise"]},getPidNames:function(){return["Roll","Pitch","Yaw","Position Z","Position XY","Velocity XY","Surface","Level","Heading Hold","Velocity Z","Nav Heading"]},getRthAltControlMode:function(){return["Current","Extra","Fixed","Max","At least","At least, linear descent"]},getRthAllowLanding:function(){return["Never","Always","Only on failsafe"]},getFailsafeProcedure:function(){return{0:"Land",1:"Drop",2:"RTH",3:"Do Nothing"}},getRcMapLetters:function(){return["A","E","R","T"]},isRcMapValid:function(n){var e=n.split(""),t=[];if(n.length!=FC.getRcMapLetters().length)return!1;for(var i=0;i<n.length;i++){if(FC.getRcMapLetters().indexOf(e[i])<0)return!1;if(t.indexOf(e[i])<0)t.push(e[i]);else return!1}return!0},getServoMixInputNames:function(){return["Stabilized Roll","Stabilized Pitch","Stabilized Yaw","Stabilized Throttle","RC Roll","RC Pitch","RC Yaw","RC Throttle","RC Channel 5","RC Channel 6","RC Channel 7","RC Channel 8","Gimbal Pitch","Gimbal Roll","Flaperon Mode","RC Channel 9","RC Channel 10","RC Channel 11","RC Channel 12","RC Channel 13","RC Channel 14","RC Channel 15","RC Channel 16","Stabilized Roll+","Stabilized Roll-","Stabilized Pitch+","Stabilized Pitch-","Stabilized Yaw+","Stabilized Yaw-","MAX","GVAR 0","GVAR 1","GVAR 2","GVAR 3","GVAR 4","GVAR 5","GVAR 6","GVAR 7","Mixer Transition","Head Tracker Pan","Head Tracker Tilt","Head Tracker Roll","RC Channel 17","RC Channel 18","RC Channel 19","RC Channel 20","RC Channel 21","RC Channel 22","RC Channel 23","RC Channel 24","RC Channel 25","RC Channel 26","RC Channel 27","RC Channel 28","RC Channel 29","RC Channel 30","RC Channel 31","RC Channel 32","RC Channel 33","RC Channel 34"]},getServoMixInputName:function(n){return this.getServoMixInputNames()[n]},getModeId:function(n){for(var e=0;e<FC.AUX_CONFIG.length;e++)if(FC.AUX_CONFIG[e]==n)return e;return-1},isModeBitSet:function(n){return BitHelper.bit_check(this.CONFIG.mode[Math.trunc(n/32)],n%32)},isModeEnabled:function(n){return this.isModeBitSet(this.getModeId(n))},getBatteryProfileParameters:function(){return["bat_cells","vbat_cell_detect_voltage","vbat_max_cell_voltage","vbat_min_cell_voltage","vbat_warning_cell_voltage","battery_capacity","battery_capacity_warning","battery_capacity_critical","battery_capacity_unit","use_control_profile","throttle_scale","throttle_idle","turtle_mode_power_factor","failsafe_throttle","nav_mc_hover_thr","nav_fw_cruise_thr","nav_fw_min_thr","nav_fw_max_thr","nav_fw_pitch2thr","nav_fw_launch_thr","nav_fw_launch_idle_thr","limit_cont_current","limit_burst_current","limit_burst_current_time","limit_burst_current_falldown_time","limit_cont_power","limit_burst_power","limit_burst_power_time","limit_burst_power_falldown_time"]},isBatteryProfileParameter:function(n){return $.inArray(n,this.getBatteryProfileParameters())!=-1},getControlProfileParameters:function(){return["mc_p_pitch","mc_i_pitch","mc_d_pitch","mc_cd_pitch","mc_p_roll","mc_i_roll","mc_d_roll","mc_cd_roll","mc_p_yaw","mc_i_yaw","mc_d_yaw","mc_cd_yaw","mc_p_level","mc_i_level","mc_d_level","fw_p_pitch","fw_i_pitch","fw_d_pitch","fw_ff_pitch","fw_p_roll","fw_i_roll","fw_d_roll","fw_ff_roll","fw_p_yaw","fw_i_yaw","fw_d_yaw","fw_ff_yaw","fw_p_level","fw_i_level","fw_d_level","max_angle_inclination_rll","max_angle_inclination_pit","dterm_lpf_hz","dterm_lpf_type","yaw_lpf_hz","fw_iterm_throw_limit","fw_reference_airspeed","fw_turn_assist_yaw_gain","fw_turn_assist_pitch_gain","fw_iterm_limit_stick_position","fw_yaw_iterm_freeze_bank_angle","pidsum_limit","pidsum_limit_yaw","iterm_windup","rate_accel_limit_roll_pitch","rate_accel_limit_yaw","heading_hold_rate_limit","nav_mc_pos_z_p","nav_mc_vel_z_p","nav_mc_vel_z_i","nav_mc_vel_z_d","nav_mc_pos_xy_p","nav_mc_vel_xy_p","nav_mc_vel_xy_i","nav_mc_vel_xy_d","nav_mc_vel_xy_ff","nav_mc_heading_p","nav_mc_vel_xy_dterm_lpf_hz","nav_mc_vel_xy_dterm_attenuation","nav_mc_vel_xy_dterm_attenuation_start","nav_mc_vel_xy_dterm_attenuation_end","nav_fw_pos_z_p","nav_fw_pos_z_i","nav_fw_pos_z_d","nav_fw_pos_xy_p","nav_fw_pos_xy_i","nav_fw_pos_xy_d","nav_fw_heading_p","nav_fw_pos_hdg_p","nav_fw_pos_hdg_i","nav_fw_pos_hdg_d","nav_fw_pos_hdg_pidsum_limit","mc_iterm_relax","mc_iterm_relax_cutoff","d_boost_min","d_boost_max","d_boost_max_at_acceleration","d_boost_gyro_delta_lpf_hz","antigravity_gain","antigravity_accelerator","antigravity_cutoff_lpf_hz","pid_type","mc_cd_lpf_hz","fw_level_pitch_trim","smith_predictor_strength","smith_predictor_delay","smith_predictor_lpf_hz","fw_level_pitch_gain","thr_mid","thr_expo","tpa_rate","tpa_breakpoint","fw_tpa_time_constant","rc_expo","rc_yaw_expo","roll_rate","pitch_rate","yaw_rate","manual_rc_expo","manual_rc_yaw_expo","manual_roll_rate","manual_pitch_rate","manual_yaw_rate","fpv_mix_degrees","rate_dynamics_center_sensitivity","rate_dynamics_end_sensitivity","rate_dynamics_center_correction","rate_dynamics_end_correction","rate_dynamics_center_weight","rate_dynamics_end_weight"]},isControlProfileParameter:function(n){return $.inArray(n,this.getControlProfileParameters())!=-1}},interval=(function(){var n={},e={};return n.intervals=[],e.add=function(t,i,s,r){e.remove(t);var o={name:t,timer:null,code:i,interval:s,fired:0,paused:!1};return r==!0&&(i(),o.fired++),o.timer=setInterval(function(){i(),o.fired++},s),n.intervals.push(o),o},e.remove=function(t){for(var i=0;i<n.intervals.length;i++)if(n.intervals[i].name==t)return clearInterval(n.intervals[i].timer),n.intervals.splice(i,1),!0;return!1},e.pause=function(t){for(var i=0;i<n.intervals.length;i++)if(n.intervals[i].name==t)return clearInterval(n.intervals[i].timer),n.intervals[i].paused=!0,!0;return!1},e.resume=function(t){for(var i=0;i<n.intervals.length;i++)if(n.intervals[i].name==t&&n.intervals[i].paused){var s=n.intervals[i];return s.timer=setInterval(function(){s.code(),s.fired++},s.interval),s.paused=!1,!0}return!1},e.killAll=function(t){var i=0;console.log("Killing all intervals except: "+t);for(var s=n.intervals.length-1;s>=0;s--){var r=!1;t&&t.forEach(function(o){n.intervals[s].name==o&&(r=!0)}),r||(clearInterval(n.intervals[s].timer),n.intervals.splice(s,1),i++)}return i},e.list=function(){return n.intervals},e})();const __variableDynamicImportRuntimeHelper=(n,e,t)=>{const i=n[e];return i?typeof i=="function"?i():Promise.resolve(i):new Promise((s,r)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(r.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})},isString=n=>typeof n=="string",defer=()=>{let n,e;const t=new Promise((i,s)=>{n=i,e=s});return t.resolve=n,t.reject=e,t},makeString=n=>n==null?"":""+n,copy=(n,e,t)=>{n.forEach(i=>{e[i]&&(t[i]=e[i])})},lastOfPathSeparatorRegExp=/###/g,cleanKey=n=>n&&n.indexOf("###")>-1?n.replace(lastOfPathSeparatorRegExp,"."):n,canNotTraverseDeeper=n=>!n||isString(n),getLastOfPath=(n,e,t)=>{const i=isString(e)?e.split("."):e;let s=0;for(;s<i.length-1;){if(canNotTraverseDeeper(n))return{};const r=cleanKey(i[s]);!n[r]&&t&&(n[r]=new t),Object.prototype.hasOwnProperty.call(n,r)?n=n[r]:n={},++s}return canNotTraverseDeeper(n)?{}:{obj:n,k:cleanKey(i[s])}},setPath=(n,e,t)=>{const{obj:i,k:s}=getLastOfPath(n,e,Object);if(i!==void 0||e.length===1){i[s]=t;return}let r=e[e.length-1],o=e.slice(0,e.length-1),a=getLastOfPath(n,o,Object);for(;a.obj===void 0&&o.length;)r=`${o[o.length-1]}.${r}`,o=o.slice(0,o.length-1),a=getLastOfPath(n,o,Object),a?.obj&&typeof a.obj[`${a.k}.${r}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${r}`]=t},pushPath=(n,e,t,i)=>{const{obj:s,k:r}=getLastOfPath(n,e,Object);s[r]=s[r]||[],s[r].push(t)},getPath=(n,e)=>{const{obj:t,k:i}=getLastOfPath(n,e);if(t&&Object.prototype.hasOwnProperty.call(t,i))return t[i]},getPathWithDefaults=(n,e,t)=>{const i=getPath(n,t);return i!==void 0?i:getPath(e,t)},deepExtend=(n,e,t)=>{for(const i in e)i!=="__proto__"&&i!=="constructor"&&(i in n?isString(n[i])||n[i]instanceof String||isString(e[i])||e[i]instanceof String?t&&(n[i]=e[i]):deepExtend(n[i],e[i],t):n[i]=e[i]);return n},regexEscape=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var _entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const escape=n=>isString(n)?n.replace(/[&<>"'\/]/g,e=>_entityMap[e]):n;class RegExpCache{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const i=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,i),this.regExpQueue.push(e),i}}const chars=[" ",",","?","!",";"],looksLikeObjectPathRegExpCache=new RegExpCache(20),looksLikeObjectPath=(n,e,t)=>{e=e||"",t=t||"";const i=chars.filter(o=>e.indexOf(o)<0&&t.indexOf(o)<0);if(i.length===0)return!0;const s=looksLikeObjectPathRegExpCache.getRegExp(`(${i.map(o=>o==="?"?"\\?":o).join("|")})`);let r=!s.test(n);if(!r){const o=n.indexOf(t);o>0&&!s.test(n.substring(0,o))&&(r=!0)}return r},deepFind=(n,e,t=".")=>{if(!n)return;if(n[e])return Object.prototype.hasOwnProperty.call(n,e)?n[e]:void 0;const i=e.split(t);let s=n;for(let r=0;r<i.length;){if(!s||typeof s!="object")return;let o,a="";for(let h=r;h<i.length;++h)if(h!==r&&(a+=t),a+=i[h],o=s[a],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&h<i.length-1)continue;r+=h-r+1;break}s=o}return s},getCleanedCode=n=>n?.replace("_","-"),consoleLogger={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,e){console?.[n]?.apply?.(console,e)}};class Logger{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||consoleLogger,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,i,s){return s&&!this.debug?null:(isString(e[0])&&(e[0]=`${i}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new Logger(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new Logger(this.logger,e)}}var baseLogger=new Logger;class EventEmitter{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(i=>{this.observers[i]||(this.observers[i]=new Map);const s=this.observers[i].get(t)||0;this.observers[i].set(t,s+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e,...t){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([s,r])=>{for(let o=0;o<r;o++)s(...t)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([s,r])=>{for(let o=0;o<r;o++)s.apply(s,[e,...t])})}}class ResourceStore extends EventEmitter{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,i,s={}){const r=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,o=s.ignoreJSONStructure!==void 0?s.ignoreJSONStructure:this.options.ignoreJSONStructure;let a;e.indexOf(".")>-1?a=e.split("."):(a=[e,t],i&&(Array.isArray(i)?a.push(...i):isString(i)&&r?a.push(...i.split(r)):a.push(i)));const h=getPath(this.data,a);return!h&&!t&&!i&&e.indexOf(".")>-1&&(e=a[0],t=a[1],i=a.slice(2).join(".")),h||!o||!isString(i)?h:deepFind(this.data?.[e]?.[t],i,r)}addResource(e,t,i,s,r={silent:!1}){const o=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let a=[e,t];i&&(a=a.concat(o?i.split(o):i)),e.indexOf(".")>-1&&(a=e.split("."),s=t,t=a[1]),this.addNamespaces(t),setPath(this.data,a,s),r.silent||this.emit("added",e,t,i,s)}addResources(e,t,i,s={silent:!1}){for(const r in i)(isString(i[r])||Array.isArray(i[r]))&&this.addResource(e,t,r,i[r],{silent:!0});s.silent||this.emit("added",e,t,i)}addResourceBundle(e,t,i,s,r,o={silent:!1,skipCopy:!1}){let a=[e,t];e.indexOf(".")>-1&&(a=e.split("."),s=i,i=t,t=a[1]),this.addNamespaces(t);let h=getPath(this.data,a)||{};o.skipCopy||(i=JSON.parse(JSON.stringify(i))),s?deepExtend(h,i,r):h={...h,...i},setPath(this.data,a,h),o.silent||this.emit("added",e,t,i)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(s=>t[s]&&Object.keys(t[s]).length>0)}toJSON(){return this.data}}var postProcessor={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,e,t,i,s){return n.forEach(r=>{e=this.processors[r]?.process(e,t,i,s)??e}),e}};const PATH_KEY=Symbol("i18next/PATH_KEY");function createProxy(){const n=[],e=Object.create(null);let t;return e.get=(i,s)=>(t?.revoke?.(),s===PATH_KEY?n:(n.push(s),t=Proxy.revocable(i,e),t.proxy)),Proxy.revocable(Object.create(null),e).proxy}function keysFromSelector(n,e){const{[PATH_KEY]:t}=n(createProxy());return t.join(e?.keySeparator??".")}const checkedLoadedFor={},shouldHandleAsObject=n=>!isString(n)&&typeof n!="boolean"&&typeof n!="number";class Translator extends EventEmitter{constructor(e,t={}){super(),copy(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=baseLogger.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const i={...t};return e==null?!1:this.resolve(e,i)?.res!==void 0}extractFromKey(e,t){let i=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;i===void 0&&(i=":");const s=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let r=t.ns||this.options.defaultNS||[];const o=i&&e.indexOf(i)>-1,a=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!looksLikeObjectPath(e,i,s);if(o&&!a){const h=e.match(this.interpolator.nestingRegexp);if(h&&h.length>0)return{key:e,namespaces:isString(r)?[r]:r};const c=e.split(i);(i!==s||i===s&&this.options.ns.indexOf(c[0])>-1)&&(r=c.shift()),e=c.join(s)}return{key:e,namespaces:isString(r)?[r]:r}}translate(e,t,i){let s=typeof t=="object"?{...t}:t;if(typeof s!="object"&&this.options.overloadTranslationOptionHandler&&(s=this.options.overloadTranslationOptionHandler(arguments)),typeof s=="object"&&(s={...s}),s||(s={}),e==null)return"";typeof e=="function"&&(e=keysFromSelector(e,{...this.options,...s})),Array.isArray(e)||(e=[String(e)]);const r=s.returnDetails!==void 0?s.returnDetails:this.options.returnDetails,o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,{key:a,namespaces:h}=this.extractFromKey(e[e.length-1],s),c=h[h.length-1];let d=s.nsSeparator!==void 0?s.nsSeparator:this.options.nsSeparator;d===void 0&&(d=":");const f=s.lng||this.language,_=s.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(f?.toLowerCase()==="cimode")return _?r?{res:`${c}${d}${a}`,usedKey:a,exactUsedKey:a,usedLng:f,usedNS:c,usedParams:this.getUsedParamsDetails(s)}:`${c}${d}${a}`:r?{res:a,usedKey:a,exactUsedKey:a,usedLng:f,usedNS:c,usedParams:this.getUsedParamsDetails(s)}:a;const y=this.resolve(e,s);let S=y?.res;const v=y?.usedKey||a,I=y?.exactUsedKey||a,A=["[object Number]","[object Function]","[object RegExp]"],B=s.joinArrays!==void 0?s.joinArrays:this.options.joinArrays,G=!this.i18nFormat||this.i18nFormat.handleAsObject,k=s.count!==void 0&&!isString(s.count),z=Translator.hasDefaultValue(s),q=k?this.pluralResolver.getSuffix(f,s.count,s):"",T=s.ordinal&&k?this.pluralResolver.getSuffix(f,s.count,{ordinal:!1}):"",j=k&&!s.ordinal&&s.count===0,te=j&&s[`defaultValue${this.options.pluralSeparator}zero`]||s[`defaultValue${q}`]||s[`defaultValue${T}`]||s.defaultValue;let Se=S;G&&!S&&z&&(Se=te);const be=shouldHandleAsObject(Se),Te=Object.prototype.toString.apply(Se);if(G&&Se&&be&&A.indexOf(Te)<0&&!(isString(B)&&Array.isArray(Se))){if(!s.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const pe=this.options.returnedObjectHandler?this.options.returnedObjectHandler(v,Se,{...s,ns:h}):`key '${a} (${this.language})' returned an object instead of string.`;return r?(y.res=pe,y.usedParams=this.getUsedParamsDetails(s),y):pe}if(o){const pe=Array.isArray(Se),ie=pe?[]:{},he=pe?I:v;for(const ge in Se)if(Object.prototype.hasOwnProperty.call(Se,ge)){const ue=`${he}${o}${ge}`;z&&!S?ie[ge]=this.translate(ue,{...s,defaultValue:shouldHandleAsObject(te)?te[ge]:void 0,joinArrays:!1,ns:h}):ie[ge]=this.translate(ue,{...s,joinArrays:!1,ns:h}),ie[ge]===ue&&(ie[ge]=Se[ge])}S=ie}}else if(G&&isString(B)&&Array.isArray(S))S=S.join(B),S&&(S=this.extendTranslation(S,e,s,i));else{let pe=!1,ie=!1;!this.isValidLookup(S)&&z&&(pe=!0,S=te),this.isValidLookup(S)||(ie=!0,S=a);const ge=(s.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&ie?void 0:S,ue=z&&te!==S&&this.options.updateMissing;if(ie||pe||ue){if(this.logger.log(ue?"updateKey":"missingKey",f,c,a,ue?te:S),o){const u=this.resolve(a,{...s,keySeparator:!1});u&&u.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let de=[];const se=this.languageUtils.getFallbackCodes(this.options.fallbackLng,s.lng||this.language);if(this.options.saveMissingTo==="fallback"&&se&&se[0])for(let u=0;u<se.length;u++)de.push(se[u]);else this.options.saveMissingTo==="all"?de=this.languageUtils.toResolveHierarchy(s.lng||this.language):de.push(s.lng||this.language);const l=(u,p,g)=>{const C=z&&g!==S?g:ge;this.options.missingKeyHandler?this.options.missingKeyHandler(u,c,p,C,ue,s):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(u,c,p,C,ue,s),this.emit("missingKey",u,c,p,S)};this.options.saveMissing&&(this.options.saveMissingPlurals&&k?de.forEach(u=>{const p=this.pluralResolver.getSuffixes(u,s);j&&s[`defaultValue${this.options.pluralSeparator}zero`]&&p.indexOf(`${this.options.pluralSeparator}zero`)<0&&p.push(`${this.options.pluralSeparator}zero`),p.forEach(g=>{l([u],a+g,s[`defaultValue${g}`]||te)})}):l(de,a,te))}S=this.extendTranslation(S,e,s,y,i),ie&&S===a&&this.options.appendNamespaceToMissingKey&&(S=`${c}${d}${a}`),(ie||pe)&&this.options.parseMissingKeyHandler&&(S=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${c}${d}${a}`:a,pe?S:void 0,s))}return r?(y.res=S,y.usedParams=this.getUsedParamsDetails(s),y):S}extendTranslation(e,t,i,s,r){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...i},i.lng||this.language||s.usedLng,s.usedNS,s.usedKey,{resolved:s});else if(!i.skipInterpolation){i.interpolation&&this.interpolator.init({...i,interpolation:{...this.options.interpolation,...i.interpolation}});const h=isString(e)&&(i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let c;if(h){const f=e.match(this.interpolator.nestingRegexp);c=f&&f.length}let d=i.replace&&!isString(i.replace)?i.replace:i;if(this.options.interpolation.defaultVariables&&(d={...this.options.interpolation.defaultVariables,...d}),e=this.interpolator.interpolate(e,d,i.lng||this.language||s.usedLng,i),h){const f=e.match(this.interpolator.nestingRegexp),_=f&&f.length;c<_&&(i.nest=!1)}!i.lng&&s&&s.res&&(i.lng=this.language||s.usedLng),i.nest!==!1&&(e=this.interpolator.nest(e,(...f)=>r?.[0]===f[0]&&!i.context?(this.logger.warn(`It seems you are nesting recursively key: ${f[0]} in key: ${t[0]}`),null):this.translate(...f,t),i)),i.interpolation&&this.interpolator.reset()}const o=i.postProcess||this.options.postProcess,a=isString(o)?[o]:o;return e!=null&&a?.length&&i.applyPostProcessor!==!1&&(e=postProcessor.handle(a,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...s,usedParams:this.getUsedParamsDetails(i)},...i}:i,this)),e}resolve(e,t={}){let i,s,r,o,a;return isString(e)&&(e=[e]),e.forEach(h=>{if(this.isValidLookup(i))return;const c=this.extractFromKey(h,t),d=c.key;s=d;let f=c.namespaces;this.options.fallbackNS&&(f=f.concat(this.options.fallbackNS));const _=t.count!==void 0&&!isString(t.count),y=_&&!t.ordinal&&t.count===0,S=t.context!==void 0&&(isString(t.context)||typeof t.context=="number")&&t.context!=="",v=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);f.forEach(I=>{this.isValidLookup(i)||(a=I,!checkedLoadedFor[`${v[0]}-${I}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(a)&&(checkedLoadedFor[`${v[0]}-${I}`]=!0,this.logger.warn(`key "${s}" for languages "${v.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),v.forEach(A=>{if(this.isValidLookup(i))return;o=A;const B=[d];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(B,d,A,I,t);else{let k;_&&(k=this.pluralResolver.getSuffix(A,t.count,t));const z=`${this.options.pluralSeparator}zero`,q=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(_&&(t.ordinal&&k.indexOf(q)===0&&B.push(d+k.replace(q,this.options.pluralSeparator)),B.push(d+k),y&&B.push(d+z)),S){const T=`${d}${this.options.contextSeparator||"_"}${t.context}`;B.push(T),_&&(t.ordinal&&k.indexOf(q)===0&&B.push(T+k.replace(q,this.options.pluralSeparator)),B.push(T+k),y&&B.push(T+z))}}let G;for(;G=B.pop();)this.isValidLookup(i)||(r=G,i=this.getResource(A,I,G,t))}))})}),{res:i,usedKey:s,exactUsedKey:r,usedLng:o,usedNS:a}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,i,s={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,i,s):this.resourceStore.getResource(e,t,i,s)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],i=e.replace&&!isString(e.replace);let s=i?e.replace:e;if(i&&typeof e.count<"u"&&(s.count=e.count),this.options.interpolation.defaultVariables&&(s={...this.options.interpolation.defaultVariables,...s}),!i){s={...s};for(const r of t)delete s[r]}return s}static hasDefaultValue(e){const t="defaultValue";for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&t===i.substring(0,t.length)&&e[i]!==void 0)return!0;return!1}}class LanguageUtil{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=baseLogger.create("languageUtils")}getScriptPartFromCode(e){if(e=getCleanedCode(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=getCleanedCode(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(isString(e)&&e.indexOf("-")>-1){let t;try{t=Intl.getCanonicalLocales(e)[0]}catch{}return t&&this.options.lowerCaseLng&&(t=t.toLowerCase()),t||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(i=>{if(t)return;const s=this.formatLanguageCode(i);(!this.options.supportedLngs||this.isSupportedCode(s))&&(t=s)}),!t&&this.options.supportedLngs&&e.forEach(i=>{if(t)return;const s=this.getScriptPartFromCode(i);if(this.isSupportedCode(s))return t=s;const r=this.getLanguagePartFromCode(i);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(o=>{if(o===r)return o;if(!(o.indexOf("-")<0&&r.indexOf("-")<0)&&(o.indexOf("-")>0&&r.indexOf("-")<0&&o.substring(0,o.indexOf("-"))===r||o.indexOf(r)===0&&r.length>1))return o})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),isString(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let i=e[t];return i||(i=e[this.getScriptPartFromCode(t)]),i||(i=e[this.formatLanguageCode(t)]),i||(i=e[this.getLanguagePartFromCode(t)]),i||(i=e.default),i||[]}toResolveHierarchy(e,t){const i=this.getFallbackCodes((t===!1?[]:t)||this.options.fallbackLng||[],e),s=[],r=o=>{o&&(this.isSupportedCode(o)?s.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return isString(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&r(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&r(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&r(this.getLanguagePartFromCode(e))):isString(e)&&r(this.formatLanguageCode(e)),i.forEach(o=>{s.indexOf(o)<0&&r(this.formatLanguageCode(o))}),s}}const suffixesOrder={zero:0,one:1,two:2,few:3,many:4,other:5},dummyRule={select:n=>n===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class PluralResolver{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=baseLogger.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const i=getCleanedCode(e==="dev"?"en":e),s=t.ordinal?"ordinal":"cardinal",r=JSON.stringify({cleanedCode:i,type:s});if(r in this.pluralRulesCache)return this.pluralRulesCache[r];let o;try{o=new Intl.PluralRules(i,{type:s})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),dummyRule;if(!e.match(/-|_/))return dummyRule;const h=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(h,t)}return this.pluralRulesCache[r]=o,o}needsPlural(e,t={}){let i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,i={}){return this.getSuffixes(e,i).map(s=>`${t}${s}`)}getSuffixes(e,t={}){let i=this.getRule(e,t);return i||(i=this.getRule("dev",t)),i?i.resolvedOptions().pluralCategories.sort((s,r)=>suffixesOrder[s]-suffixesOrder[r]).map(s=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${s}`):[]}getSuffix(e,t,i={}){const s=this.getRule(e,i);return s?`${this.options.prepend}${i.ordinal?`ordinal${this.options.prepend}`:""}${s.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,i))}}const deepFindWithDefaults=(n,e,t,i=".",s=!0)=>{let r=getPathWithDefaults(n,e,t);return!r&&s&&isString(t)&&(r=deepFind(n,t,i),r===void 0&&(r=deepFind(e,t,i))),r},regexSafe=n=>n.replace(/\$/g,"$$$$");class Interpolator{constructor(e={}){this.logger=baseLogger.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(t=>t),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:i,useRawValueToEscape:s,prefix:r,prefixEscaped:o,suffix:a,suffixEscaped:h,formatSeparator:c,unescapeSuffix:d,unescapePrefix:f,nestingPrefix:_,nestingPrefixEscaped:y,nestingSuffix:S,nestingSuffixEscaped:v,nestingOptionsSeparator:I,maxReplaces:A,alwaysFormat:B}=e.interpolation;this.escape=t!==void 0?t:escape,this.escapeValue=i!==void 0?i:!0,this.useRawValueToEscape=s!==void 0?s:!1,this.prefix=r?regexEscape(r):o||"{{",this.suffix=a?regexEscape(a):h||"}}",this.formatSeparator=c||",",this.unescapePrefix=d?"":f||"-",this.unescapeSuffix=this.unescapePrefix?"":d||"",this.nestingPrefix=_?regexEscape(_):y||regexEscape("$t("),this.nestingSuffix=S?regexEscape(S):v||regexEscape(")"),this.nestingOptionsSeparator=I||",",this.maxReplaces=A||1e3,this.alwaysFormat=B!==void 0?B:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,i)=>t?.source===i?(t.lastIndex=0,t):new RegExp(i,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,t,i,s){let r,o,a;const h=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=y=>{if(y.indexOf(this.formatSeparator)<0){const A=deepFindWithDefaults(t,h,y,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(A,void 0,i,{...s,...t,interpolationkey:y}):A}const S=y.split(this.formatSeparator),v=S.shift().trim(),I=S.join(this.formatSeparator).trim();return this.format(deepFindWithDefaults(t,h,v,this.options.keySeparator,this.options.ignoreJSONStructure),I,i,{...s,...t,interpolationkey:v})};this.resetRegExp();const d=s?.missingInterpolationHandler||this.options.missingInterpolationHandler,f=s?.interpolation?.skipOnVariables!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:y=>regexSafe(y)},{regex:this.regexp,safeValue:y=>this.escapeValue?regexSafe(this.escape(y)):regexSafe(y)}].forEach(y=>{for(a=0;r=y.regex.exec(e);){const S=r[1].trim();if(o=c(S),o===void 0)if(typeof d=="function"){const I=d(e,r,s);o=isString(I)?I:""}else if(s&&Object.prototype.hasOwnProperty.call(s,S))o="";else if(f){o=r[0];continue}else this.logger.warn(`missed to pass in variable ${S} for interpolating ${e}`),o="";else!isString(o)&&!this.useRawValueToEscape&&(o=makeString(o));const v=y.safeValue(o);if(e=e.replace(r[0],v),f?(y.regex.lastIndex+=o.length,y.regex.lastIndex-=r[0].length):y.regex.lastIndex=0,a++,a>=this.maxReplaces)break}}),e}nest(e,t,i={}){let s,r,o;const a=(h,c)=>{const d=this.nestingOptionsSeparator;if(h.indexOf(d)<0)return h;const f=h.split(new RegExp(`${d}[ ]*{`));let _=`{${f[1]}`;h=f[0],_=this.interpolate(_,o);const y=_.match(/'/g),S=_.match(/"/g);((y?.length??0)%2===0&&!S||S.length%2!==0)&&(_=_.replace(/'/g,'"'));try{o=JSON.parse(_),c&&(o={...c,...o})}catch(v){return this.logger.warn(`failed parsing options string in nesting for key ${h}`,v),`${h}${d}${_}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,h};for(;s=this.nestingRegexp.exec(e);){let h=[];o={...i},o=o.replace&&!isString(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;const c=/{.*}/.test(s[1])?s[1].lastIndexOf("}")+1:s[1].indexOf(this.formatSeparator);if(c!==-1&&(h=s[1].slice(c).split(this.formatSeparator).map(d=>d.trim()).filter(Boolean),s[1]=s[1].slice(0,c)),r=t(a.call(this,s[1].trim(),o),o),r&&s[0]===e&&!isString(r))return r;isString(r)||(r=makeString(r)),r||(this.logger.warn(`missed to resolve ${s[1]} for nesting ${e}`),r=""),h.length&&(r=h.reduce((d,f)=>this.format(d,f,i.lng,{...i,interpolationkey:s[1].trim()}),r.trim())),e=e.replace(s[0],r),this.regexp.lastIndex=0}return e}}const parseFormatStr=n=>{let e=n.toLowerCase().trim();const t={};if(n.indexOf("(")>-1){const i=n.split("(");e=i[0].toLowerCase().trim();const s=i[1].substring(0,i[1].length-1);e==="currency"&&s.indexOf(":")<0?t.currency||(t.currency=s.trim()):e==="relativetime"&&s.indexOf(":")<0?t.range||(t.range=s.trim()):s.split(";").forEach(o=>{if(o){const[a,...h]=o.split(":"),c=h.join(":").trim().replace(/^'+|'+$/g,""),d=a.trim();t[d]||(t[d]=c),c==="false"&&(t[d]=!1),c==="true"&&(t[d]=!0),isNaN(c)||(t[d]=parseInt(c,10))}})}return{formatName:e,formatOptions:t}},createCachedFormatter=n=>{const e={};return(t,i,s)=>{let r=s;s&&s.interpolationkey&&s.formatParams&&s.formatParams[s.interpolationkey]&&s[s.interpolationkey]&&(r={...r,[s.interpolationkey]:void 0});const o=i+JSON.stringify(r);let a=e[o];return a||(a=n(getCleanedCode(i),s),e[o]=a),a(t)}},createNonCachedFormatter=n=>(e,t,i)=>n(getCleanedCode(t),i)(e);class Formatter{constructor(e={}){this.logger=baseLogger.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const i=t.cacheInBuiltFormats?createCachedFormatter:createNonCachedFormatter;this.formats={number:i((s,r)=>{const o=new Intl.NumberFormat(s,{...r});return a=>o.format(a)}),currency:i((s,r)=>{const o=new Intl.NumberFormat(s,{...r,style:"currency"});return a=>o.format(a)}),datetime:i((s,r)=>{const o=new Intl.DateTimeFormat(s,{...r});return a=>o.format(a)}),relativetime:i((s,r)=>{const o=new Intl.RelativeTimeFormat(s,{...r});return a=>o.format(a,r.range||"day")}),list:i((s,r)=>{const o=new Intl.ListFormat(s,{...r});return a=>o.format(a)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=createCachedFormatter(t)}format(e,t,i,s={}){const r=t.split(this.formatSeparator);if(r.length>1&&r[0].indexOf("(")>1&&r[0].indexOf(")")<0&&r.find(a=>a.indexOf(")")>-1)){const a=r.findIndex(h=>h.indexOf(")")>-1);r[0]=[r[0],...r.splice(1,a)].join(this.formatSeparator)}return r.reduce((a,h)=>{const{formatName:c,formatOptions:d}=parseFormatStr(h);if(this.formats[c]){let f=a;try{const _=s?.formatParams?.[s.interpolationkey]||{},y=_.locale||_.lng||s.locale||s.lng||i;f=this.formats[c](a,y,{...d,...s,..._})}catch(_){this.logger.warn(_)}return f}else this.logger.warn(`there was no format function for ${c}`);return a},e)}}const removePending=(n,e)=>{n.pending[e]!==void 0&&(delete n.pending[e],n.pendingCount--)};class Connector extends EventEmitter{constructor(e,t,i,s={}){super(),this.backend=e,this.store=t,this.services=i,this.languageUtils=i.languageUtils,this.options=s,this.logger=baseLogger.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=s.maxParallelReads||10,this.readingCalls=0,this.maxRetries=s.maxRetries>=0?s.maxRetries:5,this.retryTimeout=s.retryTimeout>=1?s.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(i,s.backend,s)}queueLoad(e,t,i,s){const r={},o={},a={},h={};return e.forEach(c=>{let d=!0;t.forEach(f=>{const _=`${c}|${f}`;!i.reload&&this.store.hasResourceBundle(c,f)?this.state[_]=2:this.state[_]<0||(this.state[_]===1?o[_]===void 0&&(o[_]=!0):(this.state[_]=1,d=!1,o[_]===void 0&&(o[_]=!0),r[_]===void 0&&(r[_]=!0),h[f]===void 0&&(h[f]=!0)))}),d||(a[c]=!0)}),(Object.keys(r).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:s}),{toLoad:Object.keys(r),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(h)}}loaded(e,t,i){const s=e.split("|"),r=s[0],o=s[1];t&&this.emit("failedLoading",r,o,t),!t&&i&&this.store.addResourceBundle(r,o,i,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&i&&(this.state[e]=0);const a={};this.queue.forEach(h=>{pushPath(h.loaded,[r],o),removePending(h,e),t&&h.errors.push(t),h.pendingCount===0&&!h.done&&(Object.keys(h.loaded).forEach(c=>{a[c]||(a[c]={});const d=h.loaded[c];d.length&&d.forEach(f=>{a[c][f]===void 0&&(a[c][f]=!0)})}),h.done=!0,h.errors.length?h.callback(h.errors):h.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(h=>!h.done)}read(e,t,i,s=0,r=this.retryTimeout,o){if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:i,tried:s,wait:r,callback:o});return}this.readingCalls++;const a=(c,d)=>{if(this.readingCalls--,this.waitingReads.length>0){const f=this.waitingReads.shift();this.read(f.lng,f.ns,f.fcName,f.tried,f.wait,f.callback)}if(c&&d&&s<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,i,s+1,r*2,o)},r);return}o(c,d)},h=this.backend[i].bind(this.backend);if(h.length===2){try{const c=h(e,t);c&&typeof c.then=="function"?c.then(d=>a(null,d)).catch(a):a(null,c)}catch(c){a(c)}return}return h(e,t,a)}prepareLoading(e,t,i={},s){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),s&&s();isString(e)&&(e=this.languageUtils.toResolveHierarchy(e)),isString(t)&&(t=[t]);const r=this.queueLoad(e,t,i,s);if(!r.toLoad.length)return r.pending.length||s(),null;r.toLoad.forEach(o=>{this.loadOne(o)})}load(e,t,i){this.prepareLoading(e,t,{},i)}reload(e,t,i){this.prepareLoading(e,t,{reload:!0},i)}loadOne(e,t=""){const i=e.split("|"),s=i[0],r=i[1];this.read(s,r,"read",void 0,void 0,(o,a)=>{o&&this.logger.warn(`${t}loading namespace ${r} for language ${s} failed`,o),!o&&a&&this.logger.log(`${t}loaded namespace ${r} for language ${s}`,a),this.loaded(e,o,a)})}saveMissing(e,t,i,s,r,o={},a=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${i}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(i==null||i==="")){if(this.backend?.create){const h={...o,isUpdate:r},c=this.backend.create.bind(this.backend);if(c.length<6)try{let d;c.length===5?d=c(e,t,i,s,h):d=c(e,t,i,s),d&&typeof d.then=="function"?d.then(f=>a(null,f)).catch(a):a(null,d)}catch(d){a(d)}else c(e,t,i,s,a,h)}!e||!e[0]||this.store.addResource(e[0],t,i,s)}}}const get$1=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let e={};if(typeof n[1]=="object"&&(e=n[1]),isString(n[1])&&(e.defaultValue=n[1]),isString(n[2])&&(e.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const t=n[3]||n[2];Object.keys(t).forEach(i=>{e[i]=t[i]})}return e},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),transformOptions=n=>(isString(n.ns)&&(n.ns=[n.ns]),isString(n.fallbackLng)&&(n.fallbackLng=[n.fallbackLng]),isString(n.fallbackNS)&&(n.fallbackNS=[n.fallbackNS]),n.supportedLngs?.indexOf?.("cimode")<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),typeof n.initImmediate=="boolean"&&(n.initAsync=n.initImmediate),n),noop=()=>{},bindMemberFunctions=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(t=>{typeof n[t]=="function"&&(n[t]=n[t].bind(n))})};class I18n extends EventEmitter{constructor(e={},t){if(super(),this.options=transformOptions(e),this.services={},this.logger=baseLogger,this.modules={external:[]},bindMemberFunctions(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,typeof e=="function"&&(t=e,e={}),e.defaultNS==null&&e.ns&&(isString(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const i=get$1();this.options={...i,...this.options,...transformOptions(e)},this.options.interpolation={...i.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator);const s=c=>c?typeof c=="function"?new c:c:null;if(!this.options.isClone){this.modules.logger?baseLogger.init(s(this.modules.logger),this.options):baseLogger.init(null,this.options);let c;this.modules.formatter?c=this.modules.formatter:c=Formatter;const d=new LanguageUtil(this.options);this.store=new ResourceStore(this.options.resources,this.options);const f=this.services;f.logger=baseLogger,f.resourceStore=this.store,f.languageUtils=d,f.pluralResolver=new PluralResolver(d,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==i.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),c&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(f.formatter=s(c),f.formatter.init&&f.formatter.init(f,this.options),this.options.interpolation.format=f.formatter.format.bind(f.formatter)),f.interpolator=new Interpolator(this.options),f.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},f.backendConnector=new Connector(s(this.modules.backend),f.resourceStore,f,this.options),f.backendConnector.on("*",(y,...S)=>{this.emit(y,...S)}),this.modules.languageDetector&&(f.languageDetector=s(this.modules.languageDetector),f.languageDetector.init&&f.languageDetector.init(f,this.options.detection,this.options)),this.modules.i18nFormat&&(f.i18nFormat=s(this.modules.i18nFormat),f.i18nFormat.init&&f.i18nFormat.init(this)),this.translator=new Translator(this.services,this.options),this.translator.on("*",(y,...S)=>{this.emit(y,...S)}),this.modules.external.forEach(y=>{y.init&&y.init(this)})}if(this.format=this.options.interpolation.format,t||(t=noop),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const c=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);c.length>0&&c[0]!=="dev"&&(this.options.lng=c[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(c=>{this[c]=(...d)=>this.store[c](...d)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(c=>{this[c]=(...d)=>(this.store[c](...d),this)});const a=defer(),h=()=>{const c=(d,f)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),a.resolve(f),t(d,f)};if(this.languages&&!this.isInitialized)return c(null,this.t.bind(this));this.changeLanguage(this.options.lng,c)};return this.options.resources||!this.options.initAsync?h():setTimeout(h,0),a}loadResources(e,t=noop){let i=t;const s=isString(e)?e:this.language;if(typeof e=="function"&&(i=e),!this.options.resources||this.options.partialBundledLanguages){if(s?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return i();const r=[],o=a=>{if(!a||a==="cimode")return;this.services.languageUtils.toResolveHierarchy(a).forEach(c=>{c!=="cimode"&&r.indexOf(c)<0&&r.push(c)})};s?o(s):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(h=>o(h)),this.options.preload?.forEach?.(a=>o(a)),this.services.backendConnector.load(r,this.options.ns,a=>{!a&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),i(a)})}else i(null)}reloadResources(e,t,i){const s=defer();return typeof e=="function"&&(i=e,e=void 0),typeof t=="function"&&(i=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),i||(i=noop),this.services.backendConnector.reload(e,t,r=>{s.resolve(),i(r)}),s}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&postProcessor.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let t=0;t<this.languages.length;t++){const i=this.languages[t];if(!(["cimode","dev"].indexOf(i)>-1)&&this.store.hasLanguageSomeTranslations(i)){this.resolvedLanguage=i;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const i=defer();this.emit("languageChanging",e);const s=a=>{this.language=a,this.languages=this.services.languageUtils.toResolveHierarchy(a),this.resolvedLanguage=void 0,this.setResolvedLanguage(a)},r=(a,h)=>{h?this.isLanguageChangingTo===e&&(s(h),this.translator.changeLanguage(h),this.isLanguageChangingTo=void 0,this.emit("languageChanged",h),this.logger.log("languageChanged",h)):this.isLanguageChangingTo=void 0,i.resolve((...c)=>this.t(...c)),t&&t(a,(...c)=>this.t(...c))},o=a=>{!e&&!a&&this.services.languageDetector&&(a=[]);const h=isString(a)?a:a&&a[0],c=this.store.hasLanguageSomeTranslations(h)?h:this.services.languageUtils.getBestMatchFromCodes(isString(a)?[a]:a);c&&(this.language||s(c),this.translator.language||this.translator.changeLanguage(c),this.services.languageDetector?.cacheUserLanguage?.(c)),this.loadResources(c,d=>{r(d,c)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?o(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e),i}getFixedT(e,t,i){const s=(r,o,...a)=>{let h;typeof o!="object"?h=this.options.overloadTranslationOptionHandler([r,o].concat(a)):h={...o},h.lng=h.lng||s.lng,h.lngs=h.lngs||s.lngs,h.ns=h.ns||s.ns,h.keyPrefix!==""&&(h.keyPrefix=h.keyPrefix||i||s.keyPrefix);const c=this.options.keySeparator||".";let d;return h.keyPrefix&&Array.isArray(r)?d=r.map(f=>(typeof f=="function"&&(f=keysFromSelector(f,{...this.options,...o})),`${h.keyPrefix}${c}${f}`)):(typeof r=="function"&&(r=keysFromSelector(r,{...this.options,...o})),d=h.keyPrefix?`${h.keyPrefix}${c}${r}`:r),this.t(d,h)};return isString(e)?s.lng=e:s.lngs=e,s.ns=t,s.keyPrefix=i,s}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const i=t.lng||this.resolvedLanguage||this.languages[0],s=this.options?this.options.fallbackLng:!1,r=this.languages[this.languages.length-1];if(i.toLowerCase()==="cimode")return!0;const o=(a,h)=>{const c=this.services.backendConnector.state[`${a}|${h}`];return c===-1||c===0||c===2};if(t.precheck){const a=t.precheck(this,o);if(a!==void 0)return a}return!!(this.hasResourceBundle(i,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(i,e)&&(!s||o(r,e)))}loadNamespaces(e,t){const i=defer();return this.options.ns?(isString(e)&&(e=[e]),e.forEach(s=>{this.options.ns.indexOf(s)<0&&this.options.ns.push(s)}),this.loadResources(s=>{i.resolve(),t&&t(s)}),i):(t&&t(),Promise.resolve())}loadLanguages(e,t){const i=defer();isString(e)&&(e=[e]);const s=this.options.preload||[],r=e.filter(o=>s.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return r.length?(this.options.preload=s.concat(r),this.loadResources(o=>{i.resolve(),t&&t(o)}),i):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const s=new Intl.Locale(e);if(s&&s.getTextInfo){const r=s.getTextInfo();if(r&&r.direction)return r.direction}}catch{}const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],i=this.services?.languageUtils||new LanguageUtil(get$1());return e.toLowerCase().indexOf("-latn")>1?"ltr":t.indexOf(i.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){return new I18n(e,t)}cloneInstance(e={},t=noop){const i=e.forkResourceStore;i&&delete e.forkResourceStore;const s={...this.options,...e,isClone:!0},r=new I18n(s);if((e.debug!==void 0||e.prefix!==void 0)&&(r.logger=r.logger.clone(e)),["store","services","language"].forEach(a=>{r[a]=this[a]}),r.services={...this.services},r.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},i){const a=Object.keys(this.store.data).reduce((h,c)=>(h[c]={...this.store.data[c]},h[c]=Object.keys(h[c]).reduce((d,f)=>(d[f]={...h[c][f]},d),h[c]),h),{});r.store=new ResourceStore(a,s),r.services.resourceStore=r.store}return r.translator=new Translator(r.services,s),r.translator.on("*",(a,...h)=>{r.emit(a,...h)}),r.init(s,t),r.translator.options=s,r.translator.backendConnector.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const instance=I18n.createInstance();instance.createInstance=I18n.createInstance;instance.createInstance;instance.dir;instance.init;instance.loadResources;instance.reloadResources;instance.use;instance.changeLanguage;instance.getFixedT;instance.t;instance.exists;instance.setDefaultNamespace;instance.hasLoadedNamespace;instance.loadNamespaces;instance.loadLanguages;const availableLanguages=["en","ja","uk","zh_CN"],i18n={};i18n.loadMessages=async function(n){var e={};for(const i of n){var t=(await __variableDynamicImportRuntimeHelper(Object.assign({"../locale/en/messages.json":()=>__vitePreload(()=>import("./messages-uznDVuH9.js"),[],import.meta.url),"../locale/ja/messages.json":()=>__vitePreload(()=>import("./messages-CBhabLz1.js"),[],import.meta.url),"../locale/uk/messages.json":()=>__vitePreload(()=>import("./messages-BpFvgzmS.js"),[],import.meta.url),"../locale/zh_CN/messages.json":()=>__vitePreload(()=>import("./messages-BB-0a0Ch.js"),[],import.meta.url)}),`../locale/${i}/messages.json`,4)).default;e[i]={messages:this.parseInputFile(t)}}return e};i18n.init=function(n){const e=bridge.getAppLocale(),t=bridge.storeGet("userLanguage",e);this.loadMessages(availableLanguages).then(i=>{instance.init({lng:t,getAsync:!1,debug:!0,ns:["messages"],defaultNS:["messages"],fallbackLng:"en",resources:i},function(s){if(s)console.error(`Error loading i18n: ${s}`);else{console.log("i18n system loaded");const r=i18n.getMessage(`language_${i18n.getValidLocale("DEFAULT")}`);instance.addResourceBundle("en","messages",{detectedLanguage:r},!0,!0),instance.on("languageChanged",function(){i18n.localize(!0)})}n&&n()})})};i18n.parseInputFile=function(n){const e=/\$([1-9])/g,t=n.replace(e,"{{$1}}"),i=/\$t\(([^\)]*).message\)/g,s=t.replace(i,"$t($1)"),r=JSON.parse(s);return Object.entries(r).forEach(([o,a])=>{r[o]=a.message}),r};i18n.getValidLocale=function(n){let e=n;return e==="DEFAULT"&&(e=bridge.getAppLocale(),console.log(`Detected locale ${e}`)),e};i18n.getMessage=function(n,e){let t;if(!instance.exists(n))return!1;if(e===void 0||e.constructor!==Array&&e instanceof Object)t=e;else{let i=e;i.constructor!==Array&&(i=[e]),t={},i.forEach(function(s,r){t[r+1]=s})}return instance.t(n,t)};i18n.getCurrentLanguage=function(){return instance.resolvedLanguage};i18n.getLanguages=function(){return availableLanguages};i18n.changeLanguage=function(n){bridge.storeSet("userLanguage",n),instance.changeLanguage(i18n.getValidLocale(n))};i18n.localize=function(n=!1){let e=0;const t=function(i){return e++,i18n.getMessage(i)};return n?($("[i18n]").each(function(){const i=$(this);i.html(t(i.attr("i18n")))}),$("[data-i18n]").each(function(){const i=$(this),s=t(i.data("i18n"));i.html(s),i.attr("title")!==""&&i.attr("title",s)}),$("[i18n_title]").each(function(){const i=$(this);i.attr("title",t(i.attr("i18n_title")))}),$("[data-i18n_title]").each(function(){const i=$(this);i.attr("title",t(i.data("i18n_title")))}),$("[i18n_label]").each(function(){const i=$(this);i.attr("label",t(i.attr("i18n_label")))}),$("[data-i18n_label]").each(function(){const i=$(this);i.attr("label",t(i.data("i18n_label")))}),$("[i18n_value]").each(function(){const i=$(this);i.val(t(i.attr("i18n_value")))}),$("[i18n_placeholder]").each(function(){const i=$(this);i.attr("placeholder",t(i.attr("i18n_placeholder")))}),$("[i18n_lang]").each(function(){const i=$(this);i.attr("lang",t(i.attr("i18n_lang")))})):($("[i18n]:not(.i18n-replaced)").each(function(){const i=$(this);i.html(t(i.attr("i18n"))),i.addClass("i18n-replaced")}),$("[data-i18n]:not(.i18n-replaced)").each(function(){const i=$(this),s=t(i.data("i18n"));i.html(s),i.addClass("i18n-replaced"),i.attr("title")!==""&&i.attr("title",s)}),$("[i18n_title]:not(.i18n_title-replaced)").each(function(){const i=$(this);i.attr("title",t(i.attr("i18n_title"))),i.addClass("i18n_title-replaced")}),$("[data-i18n_title]:not(.i18n_title-replaced)").each(function(){const i=$(this);i.attr("title",t(i.data("i18n_title"))),i.addClass("i18n_title-replaced")}),$("[i18n_label]:not(.i18n_label-replaced)").each(function(){const i=$(this);i.attr("label",t(i.attr("i18n_label"))),i.addClass("i18n_label-replaced")}),$("[data-i18n_label]:not(.i18n_label-replaced)").each(function(){const i=$(this);i.attr("label",t(i.data("i18n_label"))),i.addClass("i18n_label-replaced")}),$("[i18n_value]:not(.i18n_value-replaced)").each(function(){const i=$(this);i.val(t(i.attr("i18n_value"))),i.addClass("i18n_value-replaced")}),$("[i18n_placeholder]:not(.i18n_placeholder-replaced)").each(function(){const i=$(this);i.attr("placeholder",t(i.attr("i18n_placeholder"))),i.addClass("i18n_placeholder-replaced")}),$("[i18n_lang]:not(.i18n_lang-replaced)").each(function(){const i=$(this);i.attr("lang",t(i.attr("i18n_lang"))),i.addClass("i18n_lang-replaced")})),e};var TABS={},GUI_control$1=function(){this.connecting_to=!1,this.connected_to=!1,this.connect_lock=!1,this.active_tab,this.tab_switch_in_progress=!1,this.operating_system,this.defaultAllowedTabsWhenDisconnected=["landing","firmware_flasher","mission_control","sitl","help"],this.defaultAllowedTabsWhenConnected=["failsafe","adjustments","auxiliary","cli","configuration","gps","magnetometer","led_strip","logging","onboard_logging","outputs","pid_tuning","ports","receiver","sensors","calibration","setup","osd","profiles","advanced_tuning","mission_control","mixer","programming","ez_tune","search"],this.allowedTabs=this.defaultAllowedTabsWhenDisconnected,this.PROFILES_CHANGED={CONTROL:1,BATTERY:2,MIXER:4},navigator.appVersion.indexOf("Win")!=-1?this.operating_system="Windows":navigator.appVersion.indexOf("Mac")!=-1?this.operating_system="MacOS":navigator.appVersion.indexOf("CrOS")!=-1?this.operating_system="ChromeOS":navigator.appVersion.indexOf("Linux")!=-1?this.operating_system="Linux":navigator.appVersion.indexOf("X11")!=-1?this.operating_system="UNIX":this.operating_system="Unknown"};GUI_control$1.prototype.log=function(n){var e=$("div#log"),t=new Date,i=t.getFullYear(),s=t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,r=t.getDate()<10?"0"+t.getDate():t.getDate(),o=(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds()),a="{0}-{1}-{2} {3}".format(i,s,r," @ "+o);$("div.wrapper",e).append("<p>"+a+" -- "+n+"</p>"),e.scrollTop($("div.wrapper",e).height())};GUI_control$1.prototype.tab_switch_cleanup=function(n){MSP.callbacks_cleanup(),mspDeduplicationQueue.flush(),interval.killAll(["global_data_refresh","msp-load-update","ltm-connection-check"]),this.active_tab?TABS[this.active_tab].cleanup(n):n()};GUI_control$1.prototype.switchery=function(){$(".togglesmall").each(function(n,e){$(e).wrapAll('<label class="ios7-switch" style="font-size: 12px"/>'),$(e).after("<span></span>"),$(e).removeClass("togglesmall")}),$(".toggle").each(function(n,e){$(e).wrapAll('<label class="ios7-switch" style="font-size: 17px"/>'),$(e).after("<span></span>"),$(e).removeClass("toggle")}),$(".togglemedium").each(function(n,e){$(e).wrapAll('<label class="ios7-switch" style="font-size: 15px"/>'),$(e).after("<span></span>"),$(e).removeClass("togglemedium")})};GUI_control$1.prototype.content_ready=function(n){const e=$("#content").removeClass("loading");this.switchery();const t=$("div#content .tab_title").first(),i=$("<div>").addClass("cf_doc_version_bt");$("<a>").attr("href","https://github.com/iNavFlight/inav/wiki").attr("target","_blank").attr("id","button-documentation").html(i18n.getMessage("documentation")).appendTo(i),i.insertAfter(t),$(document).ready(function(r){r("cf_tip").each(function(){log(this)}),r(".cf_tip").each(function(){r(this).jBox("Tooltip",{delayOpen:100,delayClose:100,position:{x:"right",y:"center"},outside:"x"})})});const s=e.data("empty")?0:400;$("#content .data-loading:first").fadeOut(s,function(){$(this).remove()}),n&&n()};GUI_control$1.prototype.updateStatusBar=function(){for(var n={ARMED:4,SIMULATOR_MODE:16,ARMING_DISABLED_GEOZONE:64,ARMING_DISABLED_FAILSAFE_SYSTEM:128,ARMING_DISABLED_NOT_LEVEL:256,ARMING_DISABLED_SENSORS_CALIBRATING:512,ARMING_DISABLED_SYSTEM_OVERLOADED:1024,ARMING_DISABLED_NAVIGATION_UNSAFE:2048,ARMING_DISABLED_COMPASS_NOT_CALIBRATED:4096,ARMING_DISABLED_ACCELEROMETER_NOT_CALIBRATED:8192,ARMING_DISABLED_ARM_SWITCH:16384,ARMING_DISABLED_HARDWARE_FAILURE:32768,ARMING_DISABLED_BOXFAILSAFE:65536,ARMING_DISABLED_RC_LINK:262144,ARMING_DISABLED_THROTTLE:524288,ARMING_DISABLED_CLI:1048576,ARMING_DISABLED_CMS_MENU:2097152,ARMING_DISABLED_OSD_MENU:4194304,ARMING_DISABLED_ROLLPITCH_NOT_CENTERED:8388608,ARMING_DISABLED_SERVO_AUTOTRIM:16777216,ARMING_DISABLED_OOM:33554432,ARMING_DISABLED_INVALID_SETTING:67108864,ARMING_DISABLED_PWM_OUTPUT_ERROR:134217728,ARMING_DISABLED_NO_PREARM:268435456,ARMING_DISABLED_DSHOT_BEEPER:536870912,ARMING_DISABLED_LANDING_DETECTED:1073741824},e=[],t=0;t<32;t++){var i=1<<t;Object.values(n).includes(i)&&i&FC.CONFIG.armingFlags&&e.push(Object.keys(n)[Object.values(n).indexOf(i)])}$("span.i2c-error").text(FC.CONFIG.i2cError),$("span.cycle-time").text(FC.CONFIG.cycleTime),$("span.cpu-load").text(i18n.getMessage("statusbar_cpu_load",[FC.CONFIG.cpuload])),$("span.arming-flags").text(e.length?e.join(", "):"-")};GUI_control$1.prototype.updateProfileChange=function(n){$("#mixerprofilechange").val(FC.CONFIG.mixer_profile),$("#profilechange").val(FC.CONFIG.profile),$("#batteryprofilechange").val(FC.CONFIG.battery_profile),n>0&&(n&GUI.PROFILES_CHANGED.CONTROL&&GUI.log(i18n.getMessage("pidTuning_LoadedProfile",[FC.CONFIG.profile+1])),n&GUI.PROFILES_CHANGED.MIXER&&GUI.log(i18n.getMessage("loadedMixerProfile",[FC.CONFIG.mixer_profile+1])),n&GUI.PROFILES_CHANGED.BATTERY&&GUI.log(i18n.getMessage("loadedBatteryProfile",[FC.CONFIG.battery_profile+1])),GUI.updateActivatedTab())};GUI_control$1.prototype.fillSelect=function(n,e,t,i){i==null&&(i=""),n.find("*").remove();for(var s in e)e.hasOwnProperty(s)&&n.append('<option value="'+s+'">'+e[s]+"</option>");t!=null&&n.find('[value="'+t+'"]').length==0&&n.append('<option value="'+t+'">'+t+i+"</option>")};GUI_control$1.prototype.simpleBind=function(){$("input[data-simple-bind]").not('[data-simple-binded="true"]').each(function(){var n=$(this),e=n.data("simple-bind").split(".");e.length!==2||window[e[0]][e[1]]===void 0||(n.on("change",function(){window[e[0]][e[1]]=$(this).val()}),n.val(window[e[0]][e[1]]),n.attr("data-simple-binded",!0))})};GUI_control$1.prototype.load=function(n,e){const t=$("#content").addClass("loading");$(n).appendTo(t),e&&e()};GUI_control$1.prototype.renderOperandValue=function(n,e,t,i,s){switch(n.find(".logic_element__operand--value").remove(),e.type){case"value":n.append('<input type="number" class="logic_element__operand--value" data-operand="'+t+'" step="'+e.step+'" min="'+e.min+'" max="'+e.max+'" value="'+i+'" />');break;case"range":case"dictionary":n.append('<select class="logic_element__operand--value" data-operand="'+t+'"></select>');let r=n.find(".logic_element__operand--value");if(e.type=="range")for(let o=e.range[0];o<=e.range[1];o++)r.append('<option value="'+o+'">'+o+"</option>");else if(e.type=="dictionary"){let o=[];for(let a in e.values)e.values.hasOwnProperty(a)&&(o[parseInt(a,10)]={id:parseInt(a,10),name:e.values[a]});o.sort((a,h)=>{let c=a.name.toLowerCase(),d=h.name.toLowerCase();return c<d?-1:1}),o.forEach(a=>{r.append('<option value="'+a.id+'">'+a.name+"</option>")})}r.val(i);break}n.find(".logic_element__operand--value").on("change",s)};GUI_control$1.prototype.renderLogicConditionSelect=function(n,e,t,i,s,r){let o=n.append('<select class="mix-rule-condition">').find("select"),a=e.getCount(),h="";s&&o.append('<option value="-1">Always</option>');for(let c=0;c<a;c++)(!r||c===t||e.isEnabled(c))&&(h="<option",c===t&&!e.isEnabled(c)&&(h+=' class="lc_disabled"'),h+=' value="'+c+'">Logic Condition '+c+" </option>",o.append(h));o.val(t).on("change",i)};GUI_control$1.prototype.sliderize=function(n,e,t,i){let s,r,o;n.data("normal-max")?(s=i*2,o=Math.round(s*.8),r=t*2):(s=i,r=t,o=s);let a=$('<input type="range" min="'+r+'" max="'+s+'" value="'+e+'"/>');n.data("step")&&a.attr("step",n.data("step")),a.css({display:"block","flex-grow":100,"margin-left":"1em","margin-right":"1em"}),n.attr("min",t),n.attr("max",i),n.val(parseInt(e)),n.css({width:"auto","min-width":"75px"}),n.parent().css({display:"flex",width:"100%"}),a.insertAfter(n),n.parent().find(".helpicon").css({top:"5px",left:"-10px"}),a.on("input",function(){let h=$(this).val(),c=parseInt(n.data("normal-max"));c&&(h<=o?h=scaleRangeInt(h,r,o,t,c):h=scaleRangeInt(h,o+1,s,c+1,i)),n.val(h),n.trigger("updated")}),n.on("change",function(){let h=$(this).val(),c,d=parseInt(n.data("normal-max"));d?h<=d?c=scaleRangeInt(h,t,d,r,o):c=scaleRangeInt(h,d+1,i,o+1,s):c=h,a.val(c),n.trigger("updated")}),n.trigger("change")};GUI_control$1.prototype.update_dataflash_global=function(){function n(t){if(t<1024)return t+"B";var i=t/1024;if(i<1024)return Math.round(i)+"kB";var s=i/1024;return s.toFixed(1)+"MB"}var e=FC.DATAFLASH.totalSize>0;e?($(".noflash_global").css({display:"none"}),$(".dataflash-contents_global").css({display:"block"}),$(".dataflash-free_global").css({width:100-(FC.DATAFLASH.totalSize-FC.DATAFLASH.usedSize)/FC.DATAFLASH.totalSize*100+"%",display:"block"}),$(".dataflash-free_global div").html(i18n.getMessage("sensorDataFlashFreeSpace")+n(FC.DATAFLASH.totalSize-FC.DATAFLASH.usedSize))):($(".noflash_global").css({display:"block"}),$(".dataflash-contents_global").css({display:"none"}))};var GUI=new GUI_control$1;const UnitType={none:"none",OSD:"OSD",imperial:"imperial",metric:"metric"};var globalSettings={unitType:null,osdUnits:null,mapProviderType:null,proxyURL:null,proxyLayer:null,showProfileParameters:null,docsTreeLocation:"master",configuratorTreeLocation:"master",cliAutocomplete:!0,assistnowApiKey:null,assistnowOfflineData:[],assistnowOfflineDate:0,store:null,saveAssistnowData:function(){this.bridge.storeSet("assistnow_offline_data",this.assistnowOfflineData),this.bridge.storeSet("assistnow_offline_date",this.assistnowOfflineDate)}},re={exports:{}},constants,hasRequiredConstants;function requireConstants(){if(hasRequiredConstants)return constants;hasRequiredConstants=1;const n="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,i=16,s=e-6;return constants={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:i,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:n,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},constants}var debug_1,hasRequiredDebug;function requireDebug(){if(hasRequiredDebug)return debug_1;hasRequiredDebug=1;var n={};return debug_1=typeof process=="object"&&n&&n.NODE_DEBUG&&/\bsemver\b/i.test(n.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},debug_1}var hasRequiredRe;function requireRe(){return hasRequiredRe||(hasRequiredRe=1,(function(n,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:s}=requireConstants(),r=requireDebug();e=n.exports={};const o=e.re=[],a=e.safeRe=[],h=e.src=[],c=e.safeSrc=[],d=e.t={};let f=0;const _="[a-zA-Z0-9-]",y=[["\\s",1],["\\d",s],[_,i]],S=I=>{for(const[A,B]of y)I=I.split(`${A}*`).join(`${A}{0,${B}}`).split(`${A}+`).join(`${A}{1,${B}}`);return I},v=(I,A,B)=>{const G=S(A),k=f++;r(I,k,A),d[I]=k,h[k]=A,c[k]=G,o[k]=new RegExp(A,B?"g":void 0),a[k]=new RegExp(G,B?"g":void 0)};v("NUMERICIDENTIFIER","0|[1-9]\\d*"),v("NUMERICIDENTIFIERLOOSE","\\d+"),v("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${_}*`),v("MAINVERSION",`(${h[d.NUMERICIDENTIFIER]})\\.(${h[d.NUMERICIDENTIFIER]})\\.(${h[d.NUMERICIDENTIFIER]})`),v("MAINVERSIONLOOSE",`(${h[d.NUMERICIDENTIFIERLOOSE]})\\.(${h[d.NUMERICIDENTIFIERLOOSE]})\\.(${h[d.NUMERICIDENTIFIERLOOSE]})`),v("PRERELEASEIDENTIFIER",`(?:${h[d.NONNUMERICIDENTIFIER]}|${h[d.NUMERICIDENTIFIER]})`),v("PRERELEASEIDENTIFIERLOOSE",`(?:${h[d.NONNUMERICIDENTIFIER]}|${h[d.NUMERICIDENTIFIERLOOSE]})`),v("PRERELEASE",`(?:-(${h[d.PRERELEASEIDENTIFIER]}(?:\\.${h[d.PRERELEASEIDENTIFIER]})*))`),v("PRERELEASELOOSE",`(?:-?(${h[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${h[d.PRERELEASEIDENTIFIERLOOSE]})*))`),v("BUILDIDENTIFIER",`${_}+`),v("BUILD",`(?:\\+(${h[d.BUILDIDENTIFIER]}(?:\\.${h[d.BUILDIDENTIFIER]})*))`),v("FULLPLAIN",`v?${h[d.MAINVERSION]}${h[d.PRERELEASE]}?${h[d.BUILD]}?`),v("FULL",`^${h[d.FULLPLAIN]}$`),v("LOOSEPLAIN",`[v=\\s]*${h[d.MAINVERSIONLOOSE]}${h[d.PRERELEASELOOSE]}?${h[d.BUILD]}?`),v("LOOSE",`^${h[d.LOOSEPLAIN]}$`),v("GTLT","((?:<|>)?=?)"),v("XRANGEIDENTIFIERLOOSE",`${h[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),v("XRANGEIDENTIFIER",`${h[d.NUMERICIDENTIFIER]}|x|X|\\*`),v("XRANGEPLAIN",`[v=\\s]*(${h[d.XRANGEIDENTIFIER]})(?:\\.(${h[d.XRANGEIDENTIFIER]})(?:\\.(${h[d.XRANGEIDENTIFIER]})(?:${h[d.PRERELEASE]})?${h[d.BUILD]}?)?)?`),v("XRANGEPLAINLOOSE",`[v=\\s]*(${h[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${h[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${h[d.XRANGEIDENTIFIERLOOSE]})(?:${h[d.PRERELEASELOOSE]})?${h[d.BUILD]}?)?)?`),v("XRANGE",`^${h[d.GTLT]}\\s*${h[d.XRANGEPLAIN]}$`),v("XRANGELOOSE",`^${h[d.GTLT]}\\s*${h[d.XRANGEPLAINLOOSE]}$`),v("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),v("COERCE",`${h[d.COERCEPLAIN]}(?:$|[^\\d])`),v("COERCEFULL",h[d.COERCEPLAIN]+`(?:${h[d.PRERELEASE]})?(?:${h[d.BUILD]})?(?:$|[^\\d])`),v("COERCERTL",h[d.COERCE],!0),v("COERCERTLFULL",h[d.COERCEFULL],!0),v("LONETILDE","(?:~>?)"),v("TILDETRIM",`(\\s*)${h[d.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",v("TILDE",`^${h[d.LONETILDE]}${h[d.XRANGEPLAIN]}$`),v("TILDELOOSE",`^${h[d.LONETILDE]}${h[d.XRANGEPLAINLOOSE]}$`),v("LONECARET","(?:\\^)"),v("CARETTRIM",`(\\s*)${h[d.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",v("CARET",`^${h[d.LONECARET]}${h[d.XRANGEPLAIN]}$`),v("CARETLOOSE",`^${h[d.LONECARET]}${h[d.XRANGEPLAINLOOSE]}$`),v("COMPARATORLOOSE",`^${h[d.GTLT]}\\s*(${h[d.LOOSEPLAIN]})$|^$`),v("COMPARATOR",`^${h[d.GTLT]}\\s*(${h[d.FULLPLAIN]})$|^$`),v("COMPARATORTRIM",`(\\s*)${h[d.GTLT]}\\s*(${h[d.LOOSEPLAIN]}|${h[d.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",v("HYPHENRANGE",`^\\s*(${h[d.XRANGEPLAIN]})\\s+-\\s+(${h[d.XRANGEPLAIN]})\\s*$`),v("HYPHENRANGELOOSE",`^\\s*(${h[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${h[d.XRANGEPLAINLOOSE]})\\s*$`),v("STAR","(<|>)?=?\\s*\\*"),v("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),v("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(re,re.exports)),re.exports}var parseOptions_1,hasRequiredParseOptions;function requireParseOptions(){if(hasRequiredParseOptions)return parseOptions_1;hasRequiredParseOptions=1;const n=Object.freeze({loose:!0}),e=Object.freeze({});return parseOptions_1=i=>i?typeof i!="object"?n:i:e,parseOptions_1}var identifiers,hasRequiredIdentifiers;function requireIdentifiers(){if(hasRequiredIdentifiers)return identifiers;hasRequiredIdentifiers=1;const n=/^[0-9]+$/,e=(i,s)=>{const r=n.test(i),o=n.test(s);return r&&o&&(i=+i,s=+s),i===s?0:r&&!o?-1:o&&!r?1:i<s?-1:1};return identifiers={compareIdentifiers:e,rcompareIdentifiers:(i,s)=>e(s,i)},identifiers}var semver$2,hasRequiredSemver$1;function requireSemver$1(){if(hasRequiredSemver$1)return semver$2;hasRequiredSemver$1=1;const n=requireDebug(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=requireConstants(),{safeRe:i,t:s}=requireRe(),r=requireParseOptions(),{compareIdentifiers:o}=requireIdentifiers();class a{constructor(c,d){if(d=r(d),c instanceof a){if(c.loose===!!d.loose&&c.includePrerelease===!!d.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>e)throw new TypeError(`version is longer than ${e} characters`);n("SemVer",c,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const f=c.trim().match(d.loose?i[s.LOOSE]:i[s.FULL]);if(!f)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(_=>{if(/^[0-9]+$/.test(_)){const y=+_;if(y>=0&&y<t)return y}return _}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(n("SemVer.compare",this.version,this.options,c),!(c instanceof a)){if(typeof c=="string"&&c===this.version)return 0;c=new a(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof a||(c=new a(c,this.options)),o(this.major,c.major)||o(this.minor,c.minor)||o(this.patch,c.patch)}comparePre(c){if(c instanceof a||(c=new a(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let d=0;do{const f=this.prerelease[d],_=c.prerelease[d];if(n("prerelease compare",d,f,_),f===void 0&&_===void 0)return 0;if(_===void 0)return 1;if(f===void 0)return-1;if(f===_)continue;return o(f,_)}while(++d)}compareBuild(c){c instanceof a||(c=new a(c,this.options));let d=0;do{const f=this.build[d],_=c.build[d];if(n("build compare",d,f,_),f===void 0&&_===void 0)return 0;if(_===void 0)return 1;if(f===void 0)return-1;if(f===_)continue;return o(f,_)}while(++d)}inc(c,d,f){if(c.startsWith("pre")){if(!d&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(d){const _=`-${d}`.match(this.options.loose?i[s.PRERELEASELOOSE]:i[s.PRERELEASE]);if(!_||_[1]!==d)throw new Error(`invalid identifier: ${d}`)}}switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,f),this.inc("pre",d,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,f),this.inc("pre",d,f);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const _=Number(f)?1:0;if(this.prerelease.length===0)this.prerelease=[_];else{let y=this.prerelease.length;for(;--y>=0;)typeof this.prerelease[y]=="number"&&(this.prerelease[y]++,y=-2);if(y===-1){if(d===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(_)}}if(d){let y=[d,_];f===!1&&(y=[d]),o(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=y):this.prerelease=y}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return semver$2=a,semver$2}var parse_1,hasRequiredParse;function requireParse(){if(hasRequiredParse)return parse_1;hasRequiredParse=1;const n=requireSemver$1();return parse_1=(t,i,s=!1)=>{if(t instanceof n)return t;try{return new n(t,i)}catch(r){if(!s)return null;throw r}},parse_1}var valid_1,hasRequiredValid$1;function requireValid$1(){if(hasRequiredValid$1)return valid_1;hasRequiredValid$1=1;const n=requireParse();return valid_1=(t,i)=>{const s=n(t,i);return s?s.version:null},valid_1}var clean_1,hasRequiredClean;function requireClean(){if(hasRequiredClean)return clean_1;hasRequiredClean=1;const n=requireParse();return clean_1=(t,i)=>{const s=n(t.trim().replace(/^[=v]+/,""),i);return s?s.version:null},clean_1}var inc_1,hasRequiredInc;function requireInc(){if(hasRequiredInc)return inc_1;hasRequiredInc=1;const n=requireSemver$1();return inc_1=(t,i,s,r,o)=>{typeof s=="string"&&(o=r,r=s,s=void 0);try{return new n(t instanceof n?t.version:t,s).inc(i,r,o).version}catch{return null}},inc_1}var diff_1,hasRequiredDiff;function requireDiff(){if(hasRequiredDiff)return diff_1;hasRequiredDiff=1;const n=requireParse();return diff_1=(t,i)=>{const s=n(t,null,!0),r=n(i,null,!0),o=s.compare(r);if(o===0)return null;const a=o>0,h=a?s:r,c=a?r:s,d=!!h.prerelease.length;if(!!c.prerelease.length&&!d){if(!c.patch&&!c.minor)return"major";if(c.compareMain(h)===0)return c.minor&&!c.patch?"minor":"patch"}const _=d?"pre":"";return s.major!==r.major?_+"major":s.minor!==r.minor?_+"minor":s.patch!==r.patch?_+"patch":"prerelease"},diff_1}var major_1,hasRequiredMajor;function requireMajor(){if(hasRequiredMajor)return major_1;hasRequiredMajor=1;const n=requireSemver$1();return major_1=(t,i)=>new n(t,i).major,major_1}var minor_1,hasRequiredMinor;function requireMinor(){if(hasRequiredMinor)return minor_1;hasRequiredMinor=1;const n=requireSemver$1();return minor_1=(t,i)=>new n(t,i).minor,minor_1}var patch_1,hasRequiredPatch;function requirePatch(){if(hasRequiredPatch)return patch_1;hasRequiredPatch=1;const n=requireSemver$1();return patch_1=(t,i)=>new n(t,i).patch,patch_1}var prerelease_1,hasRequiredPrerelease;function requirePrerelease(){if(hasRequiredPrerelease)return prerelease_1;hasRequiredPrerelease=1;const n=requireParse();return prerelease_1=(t,i)=>{const s=n(t,i);return s&&s.prerelease.length?s.prerelease:null},prerelease_1}var compare_1,hasRequiredCompare;function requireCompare(){if(hasRequiredCompare)return compare_1;hasRequiredCompare=1;const n=requireSemver$1();return compare_1=(t,i,s)=>new n(t,s).compare(new n(i,s)),compare_1}var rcompare_1,hasRequiredRcompare;function requireRcompare(){if(hasRequiredRcompare)return rcompare_1;hasRequiredRcompare=1;const n=requireCompare();return rcompare_1=(t,i,s)=>n(i,t,s),rcompare_1}var compareLoose_1,hasRequiredCompareLoose;function requireCompareLoose(){if(hasRequiredCompareLoose)return compareLoose_1;hasRequiredCompareLoose=1;const n=requireCompare();return compareLoose_1=(t,i)=>n(t,i,!0),compareLoose_1}var compareBuild_1,hasRequiredCompareBuild;function requireCompareBuild(){if(hasRequiredCompareBuild)return compareBuild_1;hasRequiredCompareBuild=1;const n=requireSemver$1();return compareBuild_1=(t,i,s)=>{const r=new n(t,s),o=new n(i,s);return r.compare(o)||r.compareBuild(o)},compareBuild_1}var sort_1,hasRequiredSort;function requireSort(){if(hasRequiredSort)return sort_1;hasRequiredSort=1;const n=requireCompareBuild();return sort_1=(t,i)=>t.sort((s,r)=>n(s,r,i)),sort_1}var rsort_1,hasRequiredRsort;function requireRsort(){if(hasRequiredRsort)return rsort_1;hasRequiredRsort=1;const n=requireCompareBuild();return rsort_1=(t,i)=>t.sort((s,r)=>n(r,s,i)),rsort_1}var gt_1,hasRequiredGt;function requireGt(){if(hasRequiredGt)return gt_1;hasRequiredGt=1;const n=requireCompare();return gt_1=(t,i,s)=>n(t,i,s)>0,gt_1}var lt_1,hasRequiredLt;function requireLt(){if(hasRequiredLt)return lt_1;hasRequiredLt=1;const n=requireCompare();return lt_1=(t,i,s)=>n(t,i,s)<0,lt_1}var eq_1,hasRequiredEq;function requireEq(){if(hasRequiredEq)return eq_1;hasRequiredEq=1;const n=requireCompare();return eq_1=(t,i,s)=>n(t,i,s)===0,eq_1}var neq_1,hasRequiredNeq;function requireNeq(){if(hasRequiredNeq)return neq_1;hasRequiredNeq=1;const n=requireCompare();return neq_1=(t,i,s)=>n(t,i,s)!==0,neq_1}var gte_1,hasRequiredGte;function requireGte(){if(hasRequiredGte)return gte_1;hasRequiredGte=1;const n=requireCompare();return gte_1=(t,i,s)=>n(t,i,s)>=0,gte_1}var lte_1,hasRequiredLte;function requireLte(){if(hasRequiredLte)return lte_1;hasRequiredLte=1;const n=requireCompare();return lte_1=(t,i,s)=>n(t,i,s)<=0,lte_1}var cmp_1,hasRequiredCmp;function requireCmp(){if(hasRequiredCmp)return cmp_1;hasRequiredCmp=1;const n=requireEq(),e=requireNeq(),t=requireGt(),i=requireGte(),s=requireLt(),r=requireLte();return cmp_1=(a,h,c,d)=>{switch(h){case"===":return typeof a=="object"&&(a=a.version),typeof c=="object"&&(c=c.version),a===c;case"!==":return typeof a=="object"&&(a=a.version),typeof c=="object"&&(c=c.version),a!==c;case"":case"=":case"==":return n(a,c,d);case"!=":return e(a,c,d);case">":return t(a,c,d);case">=":return i(a,c,d);case"<":return s(a,c,d);case"<=":return r(a,c,d);default:throw new TypeError(`Invalid operator: ${h}`)}},cmp_1}var coerce_1,hasRequiredCoerce;function requireCoerce(){if(hasRequiredCoerce)return coerce_1;hasRequiredCoerce=1;const n=requireSemver$1(),e=requireParse(),{safeRe:t,t:i}=requireRe();return coerce_1=(r,o)=>{if(r instanceof n)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;o=o||{};let a=null;if(!o.rtl)a=r.match(o.includePrerelease?t[i.COERCEFULL]:t[i.COERCE]);else{const y=o.includePrerelease?t[i.COERCERTLFULL]:t[i.COERCERTL];let S;for(;(S=y.exec(r))&&(!a||a.index+a[0].length!==r.length);)(!a||S.index+S[0].length!==a.index+a[0].length)&&(a=S),y.lastIndex=S.index+S[1].length+S[2].length;y.lastIndex=-1}if(a===null)return null;const h=a[2],c=a[3]||"0",d=a[4]||"0",f=o.includePrerelease&&a[5]?`-${a[5]}`:"",_=o.includePrerelease&&a[6]?`+${a[6]}`:"";return e(`${h}.${c}.${d}${f}${_}`,o)},coerce_1}var lrucache,hasRequiredLrucache;function requireLrucache(){if(hasRequiredLrucache)return lrucache;hasRequiredLrucache=1;class n{constructor(){this.max=1e3,this.map=new Map}get(t){const i=this.map.get(t);if(i!==void 0)return this.map.delete(t),this.map.set(t,i),i}delete(t){return this.map.delete(t)}set(t,i){if(!this.delete(t)&&i!==void 0){if(this.map.size>=this.max){const r=this.map.keys().next().value;this.delete(r)}this.map.set(t,i)}return this}}return lrucache=n,lrucache}var range,hasRequiredRange;function requireRange(){if(hasRequiredRange)return range;hasRequiredRange=1;const n=/\s+/g;class e{constructor(he,ge){if(ge=s(ge),he instanceof e)return he.loose===!!ge.loose&&he.includePrerelease===!!ge.includePrerelease?he:new e(he.raw,ge);if(he instanceof r)return this.raw=he.value,this.set=[[he]],this.formatted=void 0,this;if(this.options=ge,this.loose=!!ge.loose,this.includePrerelease=!!ge.includePrerelease,this.raw=he.trim().replace(n," "),this.set=this.raw.split("||").map(ue=>this.parseRange(ue.trim())).filter(ue=>ue.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const ue=this.set[0];if(this.set=this.set.filter(de=>!v(de[0])),this.set.length===0)this.set=[ue];else if(this.set.length>1){for(const de of this.set)if(de.length===1&&I(de[0])){this.set=[de];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let he=0;he<this.set.length;he++){he>0&&(this.formatted+="||");const ge=this.set[he];for(let ue=0;ue<ge.length;ue++)ue>0&&(this.formatted+=" "),this.formatted+=ge[ue].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(he){const ue=((this.options.includePrerelease&&y)|(this.options.loose&&S))+":"+he,de=i.get(ue);if(de)return de;const se=this.options.loose,l=se?h[c.HYPHENRANGELOOSE]:h[c.HYPHENRANGE];he=he.replace(l,Te(this.options.includePrerelease)),o("hyphen replace",he),he=he.replace(h[c.COMPARATORTRIM],d),o("comparator trim",he),he=he.replace(h[c.TILDETRIM],f),o("tilde trim",he),he=he.replace(h[c.CARETTRIM],_),o("caret trim",he);let u=he.split(" ").map(b=>B(b,this.options)).join(" ").split(/\s+/).map(b=>be(b,this.options));se&&(u=u.filter(b=>(o("loose invalid filter",b,this.options),!!b.match(h[c.COMPARATORLOOSE])))),o("range list",u);const p=new Map,g=u.map(b=>new r(b,this.options));for(const b of g){if(v(b))return[b];p.set(b.value,b)}p.size>1&&p.has("")&&p.delete("");const C=[...p.values()];return i.set(ue,C),C}intersects(he,ge){if(!(he instanceof e))throw new TypeError("a Range is required");return this.set.some(ue=>A(ue,ge)&&he.set.some(de=>A(de,ge)&&ue.every(se=>de.every(l=>se.intersects(l,ge)))))}test(he){if(!he)return!1;if(typeof he=="string")try{he=new a(he,this.options)}catch{return!1}for(let ge=0;ge<this.set.length;ge++)if(pe(this.set[ge],he,this.options))return!0;return!1}}range=e;const t=requireLrucache(),i=new t,s=requireParseOptions(),r=requireComparator(),o=requireDebug(),a=requireSemver$1(),{safeRe:h,t:c,comparatorTrimReplace:d,tildeTrimReplace:f,caretTrimReplace:_}=requireRe(),{FLAG_INCLUDE_PRERELEASE:y,FLAG_LOOSE:S}=requireConstants(),v=ie=>ie.value==="<0.0.0-0",I=ie=>ie.value==="",A=(ie,he)=>{let ge=!0;const ue=ie.slice();let de=ue.pop();for(;ge&&ue.length;)ge=ue.every(se=>de.intersects(se,he)),de=ue.pop();return ge},B=(ie,he)=>(o("comp",ie,he),ie=q(ie,he),o("caret",ie),ie=k(ie,he),o("tildes",ie),ie=j(ie,he),o("xrange",ie),ie=Se(ie,he),o("stars",ie),ie),G=ie=>!ie||ie.toLowerCase()==="x"||ie==="*",k=(ie,he)=>ie.trim().split(/\s+/).map(ge=>z(ge,he)).join(" "),z=(ie,he)=>{const ge=he.loose?h[c.TILDELOOSE]:h[c.TILDE];return ie.replace(ge,(ue,de,se,l,u)=>{o("tilde",ie,ue,de,se,l,u);let p;return G(de)?p="":G(se)?p=`>=${de}.0.0 <${+de+1}.0.0-0`:G(l)?p=`>=${de}.${se}.0 <${de}.${+se+1}.0-0`:u?(o("replaceTilde pr",u),p=`>=${de}.${se}.${l}-${u} <${de}.${+se+1}.0-0`):p=`>=${de}.${se}.${l} <${de}.${+se+1}.0-0`,o("tilde return",p),p})},q=(ie,he)=>ie.trim().split(/\s+/).map(ge=>T(ge,he)).join(" "),T=(ie,he)=>{o("caret",ie,he);const ge=he.loose?h[c.CARETLOOSE]:h[c.CARET],ue=he.includePrerelease?"-0":"";return ie.replace(ge,(de,se,l,u,p)=>{o("caret",ie,de,se,l,u,p);let g;return G(se)?g="":G(l)?g=`>=${se}.0.0${ue} <${+se+1}.0.0-0`:G(u)?se==="0"?g=`>=${se}.${l}.0${ue} <${se}.${+l+1}.0-0`:g=`>=${se}.${l}.0${ue} <${+se+1}.0.0-0`:p?(o("replaceCaret pr",p),se==="0"?l==="0"?g=`>=${se}.${l}.${u}-${p} <${se}.${l}.${+u+1}-0`:g=`>=${se}.${l}.${u}-${p} <${se}.${+l+1}.0-0`:g=`>=${se}.${l}.${u}-${p} <${+se+1}.0.0-0`):(o("no pr"),se==="0"?l==="0"?g=`>=${se}.${l}.${u}${ue} <${se}.${l}.${+u+1}-0`:g=`>=${se}.${l}.${u}${ue} <${se}.${+l+1}.0-0`:g=`>=${se}.${l}.${u} <${+se+1}.0.0-0`),o("caret return",g),g})},j=(ie,he)=>(o("replaceXRanges",ie,he),ie.split(/\s+/).map(ge=>te(ge,he)).join(" ")),te=(ie,he)=>{ie=ie.trim();const ge=he.loose?h[c.XRANGELOOSE]:h[c.XRANGE];return ie.replace(ge,(ue,de,se,l,u,p)=>{o("xRange",ie,ue,de,se,l,u,p);const g=G(se),C=g||G(l),b=C||G(u),P=b;return de==="="&&P&&(de=""),p=he.includePrerelease?"-0":"",g?de===">"||de==="<"?ue="<0.0.0-0":ue="*":de&&P?(C&&(l=0),u=0,de===">"?(de=">=",C?(se=+se+1,l=0,u=0):(l=+l+1,u=0)):de==="<="&&(de="<",C?se=+se+1:l=+l+1),de==="<"&&(p="-0"),ue=`${de+se}.${l}.${u}${p}`):C?ue=`>=${se}.0.0${p} <${+se+1}.0.0-0`:b&&(ue=`>=${se}.${l}.0${p} <${se}.${+l+1}.0-0`),o("xRange return",ue),ue})},Se=(ie,he)=>(o("replaceStars",ie,he),ie.trim().replace(h[c.STAR],"")),be=(ie,he)=>(o("replaceGTE0",ie,he),ie.trim().replace(h[he.includePrerelease?c.GTE0PRE:c.GTE0],"")),Te=ie=>(he,ge,ue,de,se,l,u,p,g,C,b,P)=>(G(ue)?ge="":G(de)?ge=`>=${ue}.0.0${ie?"-0":""}`:G(se)?ge=`>=${ue}.${de}.0${ie?"-0":""}`:l?ge=`>=${ge}`:ge=`>=${ge}${ie?"-0":""}`,G(g)?p="":G(C)?p=`<${+g+1}.0.0-0`:G(b)?p=`<${g}.${+C+1}.0-0`:P?p=`<=${g}.${C}.${b}-${P}`:ie?p=`<${g}.${C}.${+b+1}-0`:p=`<=${p}`,`${ge} ${p}`.trim()),pe=(ie,he,ge)=>{for(let ue=0;ue<ie.length;ue++)if(!ie[ue].test(he))return!1;if(he.prerelease.length&&!ge.includePrerelease){for(let ue=0;ue<ie.length;ue++)if(o(ie[ue].semver),ie[ue].semver!==r.ANY&&ie[ue].semver.prerelease.length>0){const de=ie[ue].semver;if(de.major===he.major&&de.minor===he.minor&&de.patch===he.patch)return!0}return!1}return!0};return range}var comparator,hasRequiredComparator;function requireComparator(){if(hasRequiredComparator)return comparator;hasRequiredComparator=1;const n=Symbol("SemVer ANY");class e{static get ANY(){return n}constructor(d,f){if(f=t(f),d instanceof e){if(d.loose===!!f.loose)return d;d=d.value}d=d.trim().split(/\s+/).join(" "),o("comparator",d,f),this.options=f,this.loose=!!f.loose,this.parse(d),this.semver===n?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(d){const f=this.options.loose?i[s.COMPARATORLOOSE]:i[s.COMPARATOR],_=d.match(f);if(!_)throw new TypeError(`Invalid comparator: ${d}`);this.operator=_[1]!==void 0?_[1]:"",this.operator==="="&&(this.operator=""),_[2]?this.semver=new a(_[2],this.options.loose):this.semver=n}toString(){return this.value}test(d){if(o("Comparator.test",d,this.options.loose),this.semver===n||d===n)return!0;if(typeof d=="string")try{d=new a(d,this.options)}catch{return!1}return r(d,this.operator,this.semver,this.options)}intersects(d,f){if(!(d instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new h(d.value,f).test(this.value):d.operator===""?d.value===""?!0:new h(this.value,f).test(d.semver):(f=t(f),f.includePrerelease&&(this.value==="<0.0.0-0"||d.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||d.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&d.operator.startsWith(">")||this.operator.startsWith("<")&&d.operator.startsWith("<")||this.semver.version===d.semver.version&&this.operator.includes("=")&&d.operator.includes("=")||r(this.semver,"<",d.semver,f)&&this.operator.startsWith(">")&&d.operator.startsWith("<")||r(this.semver,">",d.semver,f)&&this.operator.startsWith("<")&&d.operator.startsWith(">")))}}comparator=e;const t=requireParseOptions(),{safeRe:i,t:s}=requireRe(),r=requireCmp(),o=requireDebug(),a=requireSemver$1(),h=requireRange();return comparator}var satisfies_1,hasRequiredSatisfies;function requireSatisfies(){if(hasRequiredSatisfies)return satisfies_1;hasRequiredSatisfies=1;const n=requireRange();return satisfies_1=(t,i,s)=>{try{i=new n(i,s)}catch{return!1}return i.test(t)},satisfies_1}var toComparators_1,hasRequiredToComparators;function requireToComparators(){if(hasRequiredToComparators)return toComparators_1;hasRequiredToComparators=1;const n=requireRange();return toComparators_1=(t,i)=>new n(t,i).set.map(s=>s.map(r=>r.value).join(" ").trim().split(" ")),toComparators_1}var maxSatisfying_1,hasRequiredMaxSatisfying;function requireMaxSatisfying(){if(hasRequiredMaxSatisfying)return maxSatisfying_1;hasRequiredMaxSatisfying=1;const n=requireSemver$1(),e=requireRange();return maxSatisfying_1=(i,s,r)=>{let o=null,a=null,h=null;try{h=new e(s,r)}catch{return null}return i.forEach(c=>{h.test(c)&&(!o||a.compare(c)===-1)&&(o=c,a=new n(o,r))}),o},maxSatisfying_1}var minSatisfying_1,hasRequiredMinSatisfying;function requireMinSatisfying(){if(hasRequiredMinSatisfying)return minSatisfying_1;hasRequiredMinSatisfying=1;const n=requireSemver$1(),e=requireRange();return minSatisfying_1=(i,s,r)=>{let o=null,a=null,h=null;try{h=new e(s,r)}catch{return null}return i.forEach(c=>{h.test(c)&&(!o||a.compare(c)===1)&&(o=c,a=new n(o,r))}),o},minSatisfying_1}var minVersion_1,hasRequiredMinVersion;function requireMinVersion(){if(hasRequiredMinVersion)return minVersion_1;hasRequiredMinVersion=1;const n=requireSemver$1(),e=requireRange(),t=requireGt();return minVersion_1=(s,r)=>{s=new e(s,r);let o=new n("0.0.0");if(s.test(o)||(o=new n("0.0.0-0"),s.test(o)))return o;o=null;for(let a=0;a<s.set.length;++a){const h=s.set[a];let c=null;h.forEach(d=>{const f=new n(d.semver.version);switch(d.operator){case">":f.prerelease.length===0?f.patch++:f.prerelease.push(0),f.raw=f.format();case"":case">=":(!c||t(f,c))&&(c=f);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${d.operator}`)}}),c&&(!o||t(o,c))&&(o=c)}return o&&s.test(o)?o:null},minVersion_1}var valid,hasRequiredValid;function requireValid(){if(hasRequiredValid)return valid;hasRequiredValid=1;const n=requireRange();return valid=(t,i)=>{try{return new n(t,i).range||"*"}catch{return null}},valid}var outside_1,hasRequiredOutside;function requireOutside(){if(hasRequiredOutside)return outside_1;hasRequiredOutside=1;const n=requireSemver$1(),e=requireComparator(),{ANY:t}=e,i=requireRange(),s=requireSatisfies(),r=requireGt(),o=requireLt(),a=requireLte(),h=requireGte();return outside_1=(d,f,_,y)=>{d=new n(d,y),f=new i(f,y);let S,v,I,A,B;switch(_){case">":S=r,v=a,I=o,A=">",B=">=";break;case"<":S=o,v=h,I=r,A="<",B="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(d,f,y))return!1;for(let G=0;G<f.set.length;++G){const k=f.set[G];let z=null,q=null;if(k.forEach(T=>{T.semver===t&&(T=new e(">=0.0.0")),z=z||T,q=q||T,S(T.semver,z.semver,y)?z=T:I(T.semver,q.semver,y)&&(q=T)}),z.operator===A||z.operator===B||(!q.operator||q.operator===A)&&v(d,q.semver))return!1;if(q.operator===B&&I(d,q.semver))return!1}return!0},outside_1}var gtr_1,hasRequiredGtr;function requireGtr(){if(hasRequiredGtr)return gtr_1;hasRequiredGtr=1;const n=requireOutside();return gtr_1=(t,i,s)=>n(t,i,">",s),gtr_1}var ltr_1,hasRequiredLtr;function requireLtr(){if(hasRequiredLtr)return ltr_1;hasRequiredLtr=1;const n=requireOutside();return ltr_1=(t,i,s)=>n(t,i,"<",s),ltr_1}var intersects_1,hasRequiredIntersects;function requireIntersects(){if(hasRequiredIntersects)return intersects_1;hasRequiredIntersects=1;const n=requireRange();return intersects_1=(t,i,s)=>(t=new n(t,s),i=new n(i,s),t.intersects(i,s)),intersects_1}var simplify,hasRequiredSimplify;function requireSimplify(){if(hasRequiredSimplify)return simplify;hasRequiredSimplify=1;const n=requireSatisfies(),e=requireCompare();return simplify=(t,i,s)=>{const r=[];let o=null,a=null;const h=t.sort((_,y)=>e(_,y,s));for(const _ of h)n(_,i,s)?(a=_,o||(o=_)):(a&&r.push([o,a]),a=null,o=null);o&&r.push([o,null]);const c=[];for(const[_,y]of r)_===y?c.push(_):!y&&_===h[0]?c.push("*"):y?_===h[0]?c.push(`<=${y}`):c.push(`${_} - ${y}`):c.push(`>=${_}`);const d=c.join(" || "),f=typeof i.raw=="string"?i.raw:String(i);return d.length<f.length?d:i},simplify}var subset_1,hasRequiredSubset;function requireSubset(){if(hasRequiredSubset)return subset_1;hasRequiredSubset=1;const n=requireRange(),e=requireComparator(),{ANY:t}=e,i=requireSatisfies(),s=requireCompare(),r=(f,_,y={})=>{if(f===_)return!0;f=new n(f,y),_=new n(_,y);let S=!1;e:for(const v of f.set){for(const I of _.set){const A=h(v,I,y);if(S=S||A!==null,A)continue e}if(S)return!1}return!0},o=[new e(">=0.0.0-0")],a=[new e(">=0.0.0")],h=(f,_,y)=>{if(f===_)return!0;if(f.length===1&&f[0].semver===t){if(_.length===1&&_[0].semver===t)return!0;y.includePrerelease?f=o:f=a}if(_.length===1&&_[0].semver===t){if(y.includePrerelease)return!0;_=a}const S=new Set;let v,I;for(const j of f)j.operator===">"||j.operator===">="?v=c(v,j,y):j.operator==="<"||j.operator==="<="?I=d(I,j,y):S.add(j.semver);if(S.size>1)return null;let A;if(v&&I){if(A=s(v.semver,I.semver,y),A>0)return null;if(A===0&&(v.operator!==">="||I.operator!=="<="))return null}for(const j of S){if(v&&!i(j,String(v),y)||I&&!i(j,String(I),y))return null;for(const te of _)if(!i(j,String(te),y))return!1;return!0}let B,G,k,z,q=I&&!y.includePrerelease&&I.semver.prerelease.length?I.semver:!1,T=v&&!y.includePrerelease&&v.semver.prerelease.length?v.semver:!1;q&&q.prerelease.length===1&&I.operator==="<"&&q.prerelease[0]===0&&(q=!1);for(const j of _){if(z=z||j.operator===">"||j.operator===">=",k=k||j.operator==="<"||j.operator==="<=",v){if(T&&j.semver.prerelease&&j.semver.prerelease.length&&j.semver.major===T.major&&j.semver.minor===T.minor&&j.semver.patch===T.patch&&(T=!1),j.operator===">"||j.operator===">="){if(B=c(v,j,y),B===j&&B!==v)return!1}else if(v.operator===">="&&!i(v.semver,String(j),y))return!1}if(I){if(q&&j.semver.prerelease&&j.semver.prerelease.length&&j.semver.major===q.major&&j.semver.minor===q.minor&&j.semver.patch===q.patch&&(q=!1),j.operator==="<"||j.operator==="<="){if(G=d(I,j,y),G===j&&G!==I)return!1}else if(I.operator==="<="&&!i(I.semver,String(j),y))return!1}if(!j.operator&&(I||v)&&A!==0)return!1}return!(v&&k&&!I&&A!==0||I&&z&&!v&&A!==0||T||q)},c=(f,_,y)=>{if(!f)return _;const S=s(f.semver,_.semver,y);return S>0?f:S<0||_.operator===">"&&f.operator===">="?_:f},d=(f,_,y)=>{if(!f)return _;const S=s(f.semver,_.semver,y);return S<0?f:S>0||_.operator==="<"&&f.operator==="<="?_:f};return subset_1=r,subset_1}var semver$1,hasRequiredSemver;function requireSemver(){if(hasRequiredSemver)return semver$1;hasRequiredSemver=1;const n=requireRe(),e=requireConstants(),t=requireSemver$1(),i=requireIdentifiers(),s=requireParse(),r=requireValid$1(),o=requireClean(),a=requireInc(),h=requireDiff(),c=requireMajor(),d=requireMinor(),f=requirePatch(),_=requirePrerelease(),y=requireCompare(),S=requireRcompare(),v=requireCompareLoose(),I=requireCompareBuild(),A=requireSort(),B=requireRsort(),G=requireGt(),k=requireLt(),z=requireEq(),q=requireNeq(),T=requireGte(),j=requireLte(),te=requireCmp(),Se=requireCoerce(),be=requireComparator(),Te=requireRange(),pe=requireSatisfies(),ie=requireToComparators(),he=requireMaxSatisfying(),ge=requireMinSatisfying(),ue=requireMinVersion(),de=requireValid(),se=requireOutside(),l=requireGtr(),u=requireLtr(),p=requireIntersects(),g=requireSimplify(),C=requireSubset();return semver$1={parse:s,valid:r,clean:o,inc:a,diff:h,major:c,minor:d,patch:f,prerelease:_,compare:y,rcompare:S,compareLoose:v,compareBuild:I,sort:A,rsort:B,gt:G,lt:k,eq:z,neq:q,gte:T,lte:j,cmp:te,coerce:Se,Comparator:be,Range:Te,satisfies:pe,toComparators:ie,maxSatisfying:he,minSatisfying:ge,minVersion:ue,validRange:de,outside:se,gtr:l,ltr:u,intersects:p,simplifyRange:g,subset:C,SemVer:t,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:i.compareIdentifiers,rcompareIdentifiers:i.rcompareIdentifiers},semver$1}var semverExports=requireSemver();const semver=getDefaultExportFromCjs(semverExports);Number.prototype.clamp=function(n,e){return Math.min(Math.max(this,n),e)};String.prototype.format=function(){var n=arguments;return this.replace(/\{(\d+)\}/g,function(e,t){return n[t]!==void 0?n[t]:"{"+(t-n.length)+"}"})};Array.prototype.push8=function(n){return this.push(255&n),this};Array.prototype.push16=function(n){return this.push(255&n),this.push(n>>8),this};Array.prototype.push32=function(n){return this.push8(n).push8(n>>8).push8(n>>16).push8(n>>24),this};DataView.prototype.offset=0;DataView.prototype.readU8=function(){return this.byteLength>=this.offset+1?this.getUint8(this.offset++):null};DataView.prototype.readU16=function(){return this.byteLength>=this.offset+2?this.readU8()+this.readU8()*256:null};DataView.prototype.readU32=function(){return this.byteLength>=this.offset+4?this.readU16()+this.readU16()*65536:null};DataView.prototype.read8=function(){return this.byteLength>=this.offset+1?this.getInt8(this.offset++,1):null};DataView.prototype.read16=function(){return this.offset+=2,this.byteLength>=this.offset?this.getInt16(this.offset-2,1):null};DataView.prototype.read32=function(){return this.offset+=4,this.byteLength>=this.offset?this.getInt32(this.offset-4,1):null};DataView.prototype.readString=function(){for(var n="";this.byteLength>this.offset;){var e=this.readU8();if(!e)break;n+=String.fromCharCode(e)}return n};DataView.prototype.asHex=function(){let n="";for(let e=0;e<this.byteLength;e++)e==this.offset&&(n+="/"),n+=this.getUint8(e).toString(16);return n};const LOGIC_OPERATORS={0:{name:"True",operandType:"Active",hasOperand:[!1,!1],output:"boolean"},1:{name:"Equal (A = B)",operandType:"Comparison",hasOperand:[!0,!0],output:"boolean"},2:{name:"Greater Than (A > B)",operandType:"Comparison",hasOperand:[!0,!0],output:"boolean"},3:{name:"Lower Than (A < B)",operandType:"Comparison",hasOperand:[!0,!0],output:"boolean"},4:{name:"Low",operandType:"RC Switch Check",hasOperand:[!0,!1],output:"boolean"},5:{name:"Mid",operandType:"RC Switch Check",hasOperand:[!0,!1],output:"boolean"},6:{name:"High",operandType:"RC Switch Check",hasOperand:[!0,!1],output:"boolean"},7:{name:"AND",operandType:"Logic Switches",hasOperand:[!0,!0],output:"boolean"},8:{name:"OR",operandType:"Logic Switches",hasOperand:[!0,!0],output:"boolean"},9:{name:"XOR",operandType:"Logic Switches",hasOperand:[!0,!0],output:"boolean"},10:{name:"NAND",operandType:"Logic Switches",hasOperand:[!0,!0],output:"boolean"},11:{name:"NOR",operandType:"Logic Switches",hasOperand:[!0,!0],output:"boolean"},12:{name:"NOT",operandType:"Logic Switches",hasOperand:[!0,!1],output:"boolean"},13:{name:"Sticky",operandType:"Logic Switches",hasOperand:[!0,!0],output:"boolean"},14:{name:"Basic: Add",operandType:"Maths",hasOperand:[!0,!0],output:"raw"},15:{name:"Basic: Subtract",operandType:"Maths",hasOperand:[!0,!0],output:"raw"},16:{name:"Basic: Multiply",operandType:"Maths",hasOperand:[!0,!0],output:"raw"},17:{name:"Basic: Divide",operandType:"Maths",hasOperand:[!0,!0],output:"raw"},40:{name:"Modulo",operandType:"Maths",hasOperand:[!0,!0],output:"raw"},18:{name:"Set GVAR",operandType:"Variables",hasOperand:[!0,!0],output:"none"},19:{name:"Increase GVAR",operandType:"Variables",hasOperand:[!0,!0],output:"none"},20:{name:"Decrease GVAR",operandType:"Variables",hasOperand:[!0,!0],output:"none"},21:{name:"Set IO Port",operandType:"Set Flight Parameter",hasOperand:[!0,!0],output:"none"},22:{name:"Override Arming Safety",operandType:"Set Flight Parameter",hasOperand:[!1,!1],output:"boolean"},23:{name:"Override Throttle Scale",operandType:"Set Flight Parameter",hasOperand:[!0,!1],output:"boolean"},29:{name:"Override Throttle",operandType:"Set Flight Parameter",hasOperand:[!0,!1],output:"boolean"},24:{name:"Swap Roll & Yaw",operandType:"Set Flight Parameter",hasOperand:[!1,!1],output:"boolean"},25:{name:"Set VTx Power Level",operandType:"Set Flight Parameter",hasOperand:[!0,!1],output:"boolean"},30:{name:"Set VTx Band",operandType:"Set Flight Parameter",hasOperand:[!0,!1],output:"boolean"},31:{name:"Set VTx Channel",operandType:"Set Flight Parameter",hasOperand:[!0,!1],output:"boolean"},26:{name:"Invert Roll",operandType:"Set Flight Parameter",hasOperand:[!1,!1],output:"boolean"},27:{name:"Invert Pitch",operandType:"Set Flight Parameter",hasOperand:[!1,!1],output:"boolean"},28:{name:"Invert Yaw",operandType:"Set Flight Parameter",hasOperand:[!1,!1],output:"boolean"},32:{name:"Set OSD Layout",operandType:"Set Flight Parameter",hasOperand:[!0,!1],output:"boolean"},33:{name:"Trigonometry: Sine",operandType:"Maths",hasOperand:[!0,!0],output:"raw"},34:{name:"Trigonometry: Cosine",operandType:"Maths",hasOperand:[!0,!0],output:"raw"},35:{name:"Trigonometry: Tangent",operandType:"Maths",hasOperand:[!0,!0],output:"raw"},36:{name:"Map Input",operandType:"Maths",hasOperand:[!0,!0],output:"raw"},37:{name:"Map Output",operandType:"Maths",hasOperand:[!0,!0],output:"raw"},38:{name:"Override RC Channel",operandType:"Set Flight Parameter",hasOperand:[!0,!0],output:"boolean"},39:{name:"Set Heading Target",operandType:"Set Flight Parameter",hasOperand:[!0,!1],output:"raw"},41:{name:"Override Loiter Radius",operandType:"Set Flight Parameter",hasOperand:[!0,!1],output:"boolean"},56:{name:"Override Minimum Ground Speed",operandType:"Set Flight Parameter",hasOperand:[!0,!1],output:"boolean"},42:{name:"Set Control Profile",operandType:"Set Flight Parameter",hasOperand:[!0,!1],output:"boolean"},43:{name:"Use Lowest Value",operandType:"Comparison",hasOperand:[!0,!0],output:"raw"},44:{name:"Use Highest Value",operandType:"Comparison",hasOperand:[!0,!0],output:"raw"},45:{name:"Flight Axis Angle Override",operandType:"Set Flight Parameter",hasOperand:[!0,!0],output:"boolean"},46:{name:"Flight Axis Rate Override",operandType:"Set Flight Parameter",hasOperand:[!0,!0],output:"boolean"},47:{name:"Edge",operandType:"Logic Switches",hasOperand:[!0,!0],output:"boolean"},48:{name:"Delay",operandType:"Logic Switches",hasOperand:[!0,!0],output:"boolean"},49:{name:"Timer",operandType:"Logic Switches",hasOperand:[!0,!0],output:"boolean"},50:{name:"Delta (|A| >= B)",operandType:"Comparison",hasOperand:[!0,!0],output:"boolean"},51:{name:"Approx Equals (A ~ B)",operandType:"Comparison",hasOperand:[!0,!0],output:"boolean"},52:{name:"LED Pin PWM",operandType:"Set Flight Parameter",hasOperand:[!0,!1],output:"raw"},53:{name:"Disable GPS Sensor Fix",operandType:"Set Flight Parameter",hasOperand:[!0,!1],output:"boolean"},54:{name:"Mag calibration",operandType:"Set Flight Parameter",hasOperand:[!1,!1],output:"boolean"},55:{name:"Gimbal sensitivity",operandType:"Set Flight Parameter",hasOperand:[!0,!1],output:"boolean"}},OPERAND_TYPES={0:{name:"Value",type:"value",min:-1e6,max:1e6,step:1,default:0},1:{name:"Get RC Channel",type:"range",range:[1,34],default:1},2:{name:"Flight",type:"dictionary",default:0,values:{0:"ARM timer [s]",1:"Home distance [m]",2:"Trip distance [m]",3:"RSSI",4:"Vbat [centi-Volt] [1V = 100]",5:"Cell voltage [centi-Volt] [1V = 100]",6:"Current [centi-Amp] [1A = 100]",7:"Current drawn [mAh]",8:"GPS Sats",9:"Ground speed [cm/s]",10:"3D speed [cm/s]",11:"Air speed [cm/s]",12:"Altitude [cm]",13:"Vertical speed [cm/s]",14:"Throttle position [%]",15:"Roll [deg]",16:"Pitch [deg]",17:"Is Armed",18:"Is Autolaunch",19:"Is Controlling Altitude",20:"Is Controlling Position",21:"Is Emergency Landing",22:"Is RTH",23:"Is Landing",24:"Is Failsafe",25:"Stabilized Roll",26:"Stabilized Pitch",27:"Stabilized Yaw",28:"3D home distance [m]",29:"Uplink LQ",30:"SNR",31:"GPS Valid Fix",32:"Loiter Radius [cm]",33:"Active Control Profile",34:"Battery cells",35:"AGL status [0/1]",36:"AGL [cm]",37:"Rangefinder [cm]",38:"Active Mixer Profile",39:"Mixer Transition Active",40:"Yaw [deg]",41:"FW Land State",42:"Active Battery Profile",43:"Flown Loiter Radius [m]",44:"Downlink LQ",45:"Uplink RSSI dBm",46:"Minimum Ground Speed [m/s]",47:"Horizontal Wind Speed [cm/s]",48:"Wind Direction [deg]",49:"Relative Wind Offset [deg]"}},3:{name:"Flight Mode",type:"dictionary",default:0,values:{0:"Failsafe",1:"Manual",2:"RTH",3:"Position Hold",4:"Cruise",5:"Altitude Hold",6:"Angle",7:"Horizon",8:"Air",9:"USER 1",10:"USER 2",11:"Course Hold",12:"USER 3",13:"USER 4",14:"Acro",15:"Waypoint Mission"}},4:{name:"Logic Condition",type:"range",range:[0,63],default:0},5:{name:"Get Global Variable",type:"range",range:[0,7],default:0},6:{name:"Programming PID",type:"range",range:[0,3],default:0},7:{name:"Waypoints",type:"dictionary",default:0,values:{0:"Is WP",1:"Current Waypoint Index",2:"Current Waypoint Action",3:"Next Waypoint Action",4:"Distance to next Waypoint [m]",5:"Distance from last Waypoint [m]",6:"Current WP has User Action 1",7:"Current WP has User Action 2",8:"Current WP has User Action 3",9:"Current WP has User Action 4",10:"Next WP has User Action 1",11:"Next WP has User Action 2",12:"Next WP has User Action 3",13:"Next WP has User Action 4"}}};let LogicCondition=function(n,e,t,i,s,r,o,a){let h={},c;return h.getEnabled=function(){return!!n},h.setEnabled=function(d){n=!!d},h.getActivatorId=function(){return e},h.setActivatorId=function(d){e=d},h.getOperation=function(){return t},h.setOperation=function(d){t=d},h.getOperandAType=function(){return i},h.setOperandAType=function(d){i=d},h.getOperandAValue=function(){return s},h.setOperandAValue=function(d){s=d},h.getOperandBType=function(){return r},h.setOperandBType=function(d){r=d},h.getOperandBValue=function(){return o},h.setOperandBValue=function(d){o=d},h.getFlags=function(){return a},h.setFlags=function(d){a=d},h.onEnabledChange=function(d){let f=$(d.currentTarget);h.setEnabled(!!f.prop("checked")),h.renderStatus(),h.renderActivator()},h.getOperatorMetadata=function(){return LOGIC_OPERATORS[h.getOperation()]},h.hasOperand=function(d){return h.getOperatorMetadata().hasOperand[d]},h.onOperatorChange=function(d){let f=$(d.currentTarget);h.setOperation(f.val()),h.setOperandAType(0),h.setOperandBType(0),h.setOperandAValue(0),h.setOperandBValue(0),h.renderOperand(0),h.renderOperand(1),h.renderStatus()},h.onOperatorTypeChange=function(d){let f=$(d.currentTarget),_=f.data("operand"),y=f.parent(),S=OPERAND_TYPES[f.val()];_==0?(h.setOperandAType(f.val()),h.setOperandAValue(S.default)):(h.setOperandBType(f.val()),h.setOperandBValue(S.default)),GUI.renderOperandValue(y,S,_,S.default,h.onOperatorValueChange)},h.onOperatorValueChange=function(d){let f=$(d.currentTarget);f.data("operand")==0?h.setOperandAValue(f.val()):h.setOperandBValue(f.val())},h.renderOperand=function(d){let f,_,y;if(d==0?(f=i,_=s,y=c.find(".logic_cell__operandA")):(f=r,_=o,y=c.find(".logic_cell__operandB")),y.html(""),h.hasOperand(d)){y.append('<select class="logic_element__operand--type" data-operand="'+d+'"></select>');let S=y.find(".logic_element__operand--type");for(let v in OPERAND_TYPES)if(OPERAND_TYPES.hasOwnProperty(v)){let I=OPERAND_TYPES[v];f==v?(S.append('<option value="'+v+'" selected>'+I.name+"</option>"),GUI.renderOperandValue(y,I,d,_,h.onOperatorValueChange)):S.append('<option value="'+v+'">'+I.name+"</option>")}S.on("change",h.onOperatorTypeChange)}},h.renderStatus=function(){let d=c.find(".logic_cell__status"),f=LOGIC_OPERATORS[h.getOperation()].output;h.getEnabled()&&f=="boolean"?d.html('<div class="logic_cell__active_marker"></div>'):h.getEnabled()&&f=="raw"?d.html('<div class="logic_cell__raw_value"></div>'):d.html("")},h.update=function(d,f,_){if(typeof c>"u")return;let y=LOGIC_OPERATORS[h.getOperation()].output,S;h.getEnabled()&&y=="boolean"?(S=c.find(".logic_cell__active_marker"),f?(S.addClass("logic_cell__active_marker--active"),S.removeClass("logic_cell__active_marker--inactive")):(S.removeClass("logic_cell__active_marker--active"),S.addClass("logic_cell__active_marker--inactive"))):h.getEnabled()&&y=="raw"&&(S=c.find(".logic_cell__raw_value"),S.html(f))},h.onActivatorChange=function(d){let f=$(d.currentTarget);h.setActivatorId(f.val())},h.renderActivator=function(){let d=c.find(".logic_cell__activator");h.getEnabled()?GUI.renderLogicConditionSelect(d,FC.LOGIC_CONDITIONS,h.getActivatorId,h.onActivatorChange,!0,!0):d.html("")},h.render=function(d,f){f.find("tbody").append('<tr>                <td class="logic_cell__activator"></div></td>                <td class="logic_cell__index"></td>                <td class="logic_cell__enabled"></td>                <td class="logic_cell__operation"></td>                <td class="logic_cell__operandA"></td>                <td class="logic_cell__operandB"></td>                <td class="logic_cell__flags"></div></td>                <td class="logic_cell__status"></td>            </tr>        '),c=f.find("tr:last"),c.find(".logic_cell__index").html(d),c.find(".logic_cell__enabled").html("<input type='checkbox' class='toggle logic_element__enabled' />"),c.find(".logic_element__enabled").prop("checked",h.getEnabled()).change(h.onEnabledChange),c.find(".logic_cell__operation").html("<select class='logic_element__operation' ></select>");let _=c.find(".logic_element__operation"),y=[];for(let v in LOGIC_OPERATORS)if(LOGIC_OPERATORS.hasOwnProperty(v)){let I=LOGIC_OPERATORS[v];y[parseInt(v,10)]={id:parseInt(v,10),name:I.name,operandType:I.operandType,hasOperand:I.hasOperand,output:I.output}}y.sort((v,I)=>{let A=v.operandType.toLowerCase(),B=I.operandType.toLowerCase(),G=v.name.toLowerCase(),k=I.name.toLowerCase();return A==B?G<k?-1:G>k?1:0:A<B?-1:1});let S="";y.forEach(v=>{S!=v.operandType&&(S!=""&&_.append("</optgroup>"),S=v.operandType,_.append('<optgroup label="** '+v.operandType+' **">')),h.getOperation()==v.id?_.append('<option value="'+v.id+'" selected>'+v.name+"</option>"):_.append('<option value="'+v.id+'">'+v.name+"</option>")}),_.append("</optgroup>"),_.on("change",h.onOperatorChange),h.renderOperand(0),h.renderOperand(1),h.renderStatus(),h.renderActivator()},h};const serialPortHelper=(function(){let n={},e={};return e.namesGenerated=!1,e.rules=[{name:"MSP",groups:["data"]},{name:"GPS",groups:["sensors"],defaultBaud:115200,isUnique:!0},{name:"TELEMETRY_FRSKY",groups:["telemetry"]},{name:"TELEMETRY_HOTT",groups:["telemetry"]},{name:"TELEMETRY_SMARTPORT",groups:["telemetry"]},{name:"TELEMETRY_LTM",groups:["telemetry"]},{name:"RX_SERIAL",groups:["rx"],isUnique:!0},{name:"BLACKBOX",groups:["peripherals"]},{name:"TELEMETRY_MAVLINK",groups:["telemetry"]},{name:"TELEMETRY_IBUS",groups:["telemetry"]},{name:"RANGEFINDER",groups:["sensors"],isUnique:!0},{name:"GSM_SMS",groups:["telemetry"]},{name:"RUNCAM_DEVICE_CONTROL",groups:["peripherals"]},{name:"TBS_SMARTAUDIO",groups:["peripherals"],isUnique:!0},{name:"IRC_TRAMP",groups:["peripherals"],isUnique:!0},{name:"VTX_FFPV",groups:["peripherals"],isUnique:!0},{name:"ESC",groups:["peripherals"],defaultBaud:115200,isUnique:!0},{name:"OPFLOW",groups:["sensors"],isUnique:!0},{name:"FRSKY_OSD",groups:["peripherals"],defaultBaud:25e4,isUnique:!0},{name:"DJI_FPV",groups:["peripherals"],defaultBaud:115200,isUnique:!0},{name:"MSP_DISPLAYPORT",groups:["peripherals"],isUnique:!0},{name:"SMARTPORT_MASTER",groups:["peripherals"],defaultBaud:57600},{name:"SBUS_OUTPUT",groups:["peripherals"],defaultBaud:115200},{name:"GIMBAL",groups:["peripherals"],defaultBaud:115200},{name:"HEADTRACKER",groups:["peripherals"],defaultBaud:115200}],e.functionIDs={MSP:0,GPS:1,TELEMETRY_FRSKY:2,TELEMETRY_HOTT:3,TELEMETRY_LTM:4,TELEMETRY_SMARTPORT:5,RX_SERIAL:6,BLACKBOX:7,TELEMETRY_MAVLINK:8,TELEMETRY_IBUS:9,RUNCAM_DEVICE_CONTROL:10,TBS_SMARTAUDIO:11,IRC_TRAMP:12,OPFLOW:14,LOG:15,RANGEFINDER:16,VTX_FFPV:17,ESC:18,GSM_SMS:19,FRSKY_OSD:20,DJI_FPV:21,SBUS_OUTPUT:22,SMARTPORT_MASTER:23,MSP_DISPLAYPORT:25,GIMBAL:26,HEADTRACKER:27},e.identifierToName={0:"UART1",1:"UART2",2:"UART3",3:"UART4",4:"UART5",5:"UART6",6:"UART7",7:"UART8",20:"USB VCP",30:"SOFTSERIAL1",31:"SOFTSERIAL2"},e.bauds={SENSOR:["9600","19200","38400","57600","115200","230400"],MSP:["2400","4800","9600","19200","38400","57600","115200","230400"],TELEMETRY:["AUTO","1200","2400","4800","9600","19200","38400","57600","115200","230400","460800"],PERIPHERAL:["19200","38400","57600","115200","230400","250000"]},e.generateNames=function(){if(!e.namesGenerated){for(var t=0;t<e.rules.length;t++)e.rules[t].displayName=i18n.getMessage("portsFunction_"+e.rules[t].name);e.namesGenerated=!0}},n.getRules=function(){return e.generateNames(),e.rules},n.getRuleByName=function(t){for(var i=0;i<e.rules.length;i++)if(e.rules[i].name===t)return e.rules[i];return null},n.functionsToMask=function(t){let i=0;for(let s=0;s<t.length;s++){let r=t[s],o=e.functionIDs[r];o>=0&&(i=BitHelper.bit_set(i,o))}return i},n.maskToFunctions=function(t){let i=[],s=Object.keys(e.functionIDs);for(let r=0;r<s.length;r++){let o=s[r],a=e.functionIDs[o];BitHelper.bit_check(t,a)&&i.push(o)}return i},n.getPortName=function(t){return e.identifierToName[t]},n.getPortIdentifiersForFunction=function(t){let i=[];for(let s=0;s<FC.SERIAL_CONFIG.ports.length;s++){let r=FC.SERIAL_CONFIG.ports[s];r.functions.indexOf(t)!=-1&&i.push(r.identifier)}return i},n.getPortList=function(){let t=[];for(let i=0;i<FC.SERIAL_CONFIG.ports.length;i++){let s=FC.SERIAL_CONFIG.ports[i];if(s.identifier==20)continue;let r={identifier:s.identifier,displayName:e.identifierToName[s.identifier]};t.push(r)}return t},n.getBauds=function(t){return e.bauds[t]},n.getPortByIdentifier=function(t){for(let i=0;i<FC.SERIAL_CONFIG.ports.length;i++){let s=FC.SERIAL_CONFIG.ports[i];if(s.identifier==t)return s}return null},n.clearByFunction=function(t){for(let i=0;i<FC.SERIAL_CONFIG.ports.length;i++){let s=FC.SERIAL_CONFIG.ports[i];s.functions.indexOf(t)!=-1&&(s.functions=[])}},n.set=function(t,i,s){n.clearByFunction(i);let r=n.getPortByIdentifier(t);r&&(r.functions=[i],i=="MSP"?r.msp_baudrate=s:i=="GPS"&&(r.sensors_baudrate=s))},n})();let ProgrammingPid=function(n,e,t,i,s,r,o,a,h){let c={},d;return c.getEnabled=function(){return!!n},c.setEnabled=function(f){n=!!f},c.getSetpointType=function(){return e},c.setSetpointType=function(f){e=f},c.getSetpointValue=function(){return t},c.setSetpointValue=function(f){t=f},c.getMeasurementType=function(){return i},c.setMeasurementType=function(f){i=f},c.getMeasurementValue=function(){return s},c.setMeasurementValue=function(f){s=f},c.getGainP=function(){return r},c.setGainP=function(f){r=f},c.getGainI=function(){return o},c.setGainI=function(f){o=f},c.getGainD=function(){return a},c.setGainD=function(f){a=f},c.getGainFF=function(){return h},c.setGainFF=function(f){h=f},c.onEnabledChange=function(f){let _=$(f.currentTarget);c.setEnabled(!!_.prop("checked"))},c.onGainPChange=function(f){let _=$(f.currentTarget);c.setGainP(_.val())},c.onGainIChange=function(f){let _=$(f.currentTarget);c.setGainI(_.val())},c.onGainDChange=function(f){let _=$(f.currentTarget);c.setGainD(_.val())},c.onGainFFChange=function(f){let _=$(f.currentTarget);c.setGainFF(_.val())},c.onOperatorValueChange=function(f){let _=$(f.currentTarget);_.data("operand")==0?c.setSetpointValue(_.val()):c.setMeasurementValue(_.val())},c.render=function(f,_){_.find("tbody").append('<tr>                <td class="pid_cell__index"></td>                <td class="pid_cell__enabled"></td>                <td class="pid_cell__setpoint"></td>                <td class="pid_cell__measurement"></td>                <td class="pid_cell__p"></td>                <td class="pid_cell__i"></td>                <td class="pid_cell__d"></td>                <td class="pid_cell__ff"></td>                <td class="pid_cell__output"></td>            </tr>        '),d=_.find("tr:last"),d.find(".pid_cell__index").html(f),d.find(".pid_cell__enabled").html("<input type='checkbox' class='toggle logic_element__enabled' />"),d.find(".logic_element__enabled").prop("checked",c.getEnabled()).change(c.onEnabledChange),c.renderOperand(0),c.renderOperand(1),d.find(".pid_cell__p").html('<input type="number" class="pid_cell__p-gain" step="1" min="0" max="32767" value="0">'),d.find(".pid_cell__p-gain").val(c.getGainP()).on("change",c.onGainPChange),d.find(".pid_cell__i").html('<input type="number" class="pid_cell__i-gain" step="1" min="0" max="32767" value="0">'),d.find(".pid_cell__i-gain").val(c.getGainI()).on("change",c.onGainIChange),d.find(".pid_cell__d").html('<input type="number" class="pid_cell__d-gain" step="1" min="0" max="32767" value="0">'),d.find(".pid_cell__d-gain").val(c.getGainD()).on("change",c.onGainDChange),d.find(".pid_cell__ff").html('<input type="number" class="pid_cell__ff-gain" step="1" min="0" max="32767" value="0">'),d.find(".pid_cell__ff-gain").val(c.getGainFF()).on("change",c.onGainFFChange)},c.onOperatorTypeChange=function(f){let _=$(f.currentTarget),y=_.data("operand"),S=_.parent(),v=OPERAND_TYPES[_.val()];y==0?(c.setSetpointType(_.val()),c.setSetpointValue(v.default)):(c.setMeasurementType(_.val()),c.setMeasurementValue(v.default)),GUI.renderOperandValue(S,v,y,v.default,c.onOperatorValueChange)},c.renderOperand=function(f){let _,y,S;f==0?(_=e,y=t,S=d.find(".pid_cell__setpoint")):(_=i,y=s,S=d.find(".pid_cell__measurement")),S.html(""),S.append('<select class="logic_element__operand--type" data-operand="'+f+'"></select>');let v=S.find(".logic_element__operand--type");for(let I in OPERAND_TYPES)if(OPERAND_TYPES.hasOwnProperty(I)){let A=OPERAND_TYPES[I];_==I?(v.append('<option value="'+I+'" selected>'+A.name+"</option>"),GUI.renderOperandValue(S,A,f,y,c.onOperatorValueChange)):v.append('<option value="'+I+'">'+A.name+"</option>")}v.on("change",c.onOperatorTypeChange)},c.update=function(f,_,y){typeof d>"u"||d.find(".pid_cell__output").html(_)},c};var Safehome=function(n,e,t,i){var s={};return s.getNumber=function(){return n},s.setNumber=function(r){n=r},s.getLon=function(){return i},s.setLon=function(r){i=r},s.getLonMap=function(){return i/1e7},s.getLat=function(){return t},s.setLat=function(r){t=r},s.getLatMap=function(){return t/1e7},s.isUsed=function(){return e==1},s.getEnabled=function(){return e},s.setEnabled=function(r){e=r},s.cleanup=function(){n=0,e=0,i=0,t=0},s};const ApproachDirection=Object.freeze({LEFT:0,RIGHT:1});let FwApproach=function(n,e=0,t=0,i=0,s=0,r=0,o=0,a=0){var h={};return h.getNumber=function(){return n},h.setNumber=function(c){n=c},h.getApproachAltAsl=function(){return e},h.setApproachAltAsl=function(c){e=c},h.getLandAltAsl=function(){return t},h.setLandAltAsl=function(c){t=c},h.getApproachDirection=function(){return i},h.setApproachDirection=function(c){i=c},h.getLandHeading1=function(){return s},h.setLandHeading1=function(c){s=c},h.getLandHeading2=function(){return r},h.setLandHeading2=function(c){r=c},h.getIsSeaLevelRef=function(){return o},h.setIsSeaLevelRef=function(c){o=c},h.getElevation=function(){return a},h.setElevation=function(c){a=c},h.cleanup=function(){e=0,t=0,i=0,s=0,r=0,o=0,a=0},h.getElevationFromServer=async function(c,d,f){let _="N/A";const S=await(await fetch("https://api.opentopodata.org/v1/aster30m?locations="+d+","+c)).json();return S.status=="OK"&&S.results[0].elevation!=null&&(_=S.results[0].elevation),_},h};var mspStatistics=(function(){let n={},e={};return e.statistics={},n.add=function(t,i){e.statistics[t]||(e.statistics[t]={ctime:new Date().getTime(),count:0,duration:0,average:0,callsPerSecond:0}),e.statistics[t].count++,e.statistics[t].duration+=i,e.statistics[t].average=e.statistics[t].duration/e.statistics[t].count,e.statistics[t].callsPerSecond=e.statistics[t].count/((new Date().getTime()-e.statistics[t].ctime)/1e3)},n.get=function(){return e.statistics},n.reset=function(){e.statistics={}},n})(),settingsCache=(function(){let n={},e={};const t="settings";return e.getSetingKey=function(i){return FC.CONFIG.target+"_"+FC.CONFIG.flightControllerVersion+"_"+FC.CONFIG.buildInfo+"_"+i},n.flush=function(){bridge.storeDelete(t),console.log("Settings cache flushed")},n.get=function(i){let s=bridge.storeGet(t,null);return s===null?void 0:s[e.getSetingKey(i)]},n.set=function(i,s){let r=bridge.storeGet(t,null);r===null&&(r={}),r[e.getSetingKey(i)]=s,bridge.storeSet(t,r)},n})(),mspHelper$1=(function(){var n={};n.sensorStatusEx=null,n.setSensorStatusEx=function(t){n.sensorStatusEx=t},n.BAUD_RATES_post1_6_3=["AUTO","1200","2400","4800","9600","19200","38400","57600","115200","230400","250000","460800","921600"];var e="";return n.init=function(){MSP.setProcessData(this.processData)},n.processData=function(t){var i=new DataView(t.message_buffer,0),s=0,r=0,o=0,a=[],h="",c,d,f;if(!t.unsupported||t.unsupported)switch(t.code){case MSPCodes.MSPV2_INAV_STATUS:let Ce=0;FC.CONFIG.cycleTime=i.getUint16(s,!0),s+=2,FC.CONFIG.i2cError=i.getUint16(s,!0),s+=2,FC.CONFIG.activeSensors=i.getUint16(s,!0),s+=2,FC.CONFIG.cpuload=i.getUint16(s,!0),s+=2;let Oe=i.getUint8(s++),Ve=Oe&15;Ve!==FC.CONFIG.profile&&(Ce|=GUI.PROFILES_CHANGED.CONTROL),FC.CONFIG.profile=Ve;let tt=(Oe&240)>>4;tt!==FC.CONFIG.battery_profile&&(Ce|=GUI.PROFILES_CHANGED.BATTERY),FC.CONFIG.battery_profile=tt,FC.CONFIG.armingFlags=i.getUint32(s,!0),s+=4,Oe=i.getUint8(t.message_length_expected-1);let it=Oe&15;it!==FC.CONFIG.mixer_profile&&(Ce|=GUI.PROFILES_CHANGED.MIXER),FC.CONFIG.mixer_profile=it,GUI.updateStatusBar(),Ce>0&&GUI.updateProfileChange(Ce);break;case MSPCodes.MSP_ACTIVEBOXES:var _=t.message_length_expected/4;FC.CONFIG.mode=[];for(let J=0;J<_;++J)FC.CONFIG.mode.push(i.getUint32(J*4,!0));break;case MSPCodes.MSP_SENSOR_STATUS:FC.SENSOR_STATUS.isHardwareHealthy=i.getUint8(0),FC.SENSOR_STATUS.gyroHwStatus=i.getUint8(1),FC.SENSOR_STATUS.accHwStatus=i.getUint8(2),FC.SENSOR_STATUS.magHwStatus=i.getUint8(3),FC.SENSOR_STATUS.baroHwStatus=i.getUint8(4),FC.SENSOR_STATUS.gpsHwStatus=i.getUint8(5),FC.SENSOR_STATUS.rangeHwStatus=i.getUint8(6),FC.SENSOR_STATUS.speedHwStatus=i.getUint8(7),FC.SENSOR_STATUS.flowHwStatus=i.getUint8(8),n.sensorStatusEx(FC.SENSOR_STATUS);break;case MSPCodes.MSP_RAW_IMU:FC.SENSOR_DATA.accelerometer[0]=i.getInt16(0,!0)/512,FC.SENSOR_DATA.accelerometer[1]=i.getInt16(2,!0)/512,FC.SENSOR_DATA.accelerometer[2]=i.getInt16(4,!0)/512,FC.SENSOR_DATA.gyroscope[0]=i.getInt16(6,!0)*(4/16.4),FC.SENSOR_DATA.gyroscope[1]=i.getInt16(8,!0)*(4/16.4),FC.SENSOR_DATA.gyroscope[2]=i.getInt16(10,!0)*(4/16.4),FC.SENSOR_DATA.magnetometer[0]=i.getInt16(12,!0)/1090,FC.SENSOR_DATA.magnetometer[1]=i.getInt16(14,!0)/1090,FC.SENSOR_DATA.magnetometer[2]=i.getInt16(16,!0)/1090;break;case MSPCodes.MSP_SERVO:var y=t.message_length_expected/2;for(let J=0;J<y;J++)FC.SERVO_DATA[J]=i.getUint16(r,!0),r+=2;break;case MSPCodes.MSP_MOTOR:var S=t.message_length_expected/2;for(let J=0;J<S;J++)FC.MOTOR_DATA[J]=i.getUint16(r,!0),r+=2;break;case MSPCodes.MSP_RC:FC.RC.active_channels=t.message_length_expected/2;for(let J=0;J<FC.RC.active_channels;J++)FC.RC.channels[J]=i.getUint16(J*2,!0);break;case MSPCodes.MSP_RAW_GPS:FC.GPS_DATA.fix=i.getUint8(0),FC.GPS_DATA.numSat=i.getUint8(1),FC.GPS_DATA.lat=i.getInt32(2,!0),FC.GPS_DATA.lon=i.getInt32(6,!0),FC.GPS_DATA.alt=i.getInt16(10,!0),FC.GPS_DATA.speed=i.getUint16(12,!0),FC.GPS_DATA.ground_course=i.getUint16(14,!0),FC.GPS_DATA.hdop=i.getUint16(16,!0);break;case MSPCodes.MSP_COMP_GPS:FC.GPS_DATA.distanceToHome=i.getUint16(0,1),FC.GPS_DATA.directionToHome=i.getUint16(2,1),FC.GPS_DATA.update=i.getUint8(4);break;case MSPCodes.MSP_GPSSTATISTICS:FC.GPS_DATA.messageDt=i.getUint16(0,!0),FC.GPS_DATA.errors=i.getUint32(2,!0),FC.GPS_DATA.timeouts=i.getUint32(6,!0),FC.GPS_DATA.packetCount=i.getUint32(10,!0),FC.GPS_DATA.hdop=i.getUint16(14,!0),FC.GPS_DATA.eph=i.getUint16(16,!0),FC.GPS_DATA.epv=i.getUint16(18,!0);break;case MSPCodes.MSP2_ADSB_VEHICLE_LIST:var v=0;for(FC.ADSB_VEHICLES.vehicles=[],FC.ADSB_VEHICLES.vehiclesCount=i.getUint8(v++),FC.ADSB_VEHICLES.callsignLength=i.getUint8(v++),FC.ADSB_VEHICLES.vehiclePacketCount=i.getUint32(v,!0),v+=4,FC.ADSB_VEHICLES.heartbeatPacketCount=i.getUint32(v,!0),v+=4,o=0;o<FC.ADSB_VEHICLES.vehiclesCount;o++){var I={callSignByteArray:[],callsign:"",icao:0,lat:0,lon:0,alt:0,heading:0,ttl:0,tslc:0,emitterType:0};for(z=0;z<FC.ADSB_VEHICLES.callsignLength;z++)I.callSignByteArray.push(i.getUint8(v++));I.callsign=String.fromCharCode(...I.callSignByteArray).replace(/[^\x20-\x7E]/g,""),I.icao=i.getUint32(v,!0),v+=4,I.lat=i.getInt32(v,!0),v+=4,I.lon=i.getInt32(v,!0),v+=4,I.altCM=i.getInt32(v,!0),v+=4,I.headingDegrees=i.getUint16(v,!0),v+=2,I.tslc=i.getUint8(v++),I.emitterType=i.getUint8(v++),I.ttl=i.getUint8(v++),FC.ADSB_VEHICLES.vehicles.push(I)}break;case MSPCodes.MSP_ATTITUDE:FC.SENSOR_DATA.kinematics[0]=i.getInt16(0,!0)/10,FC.SENSOR_DATA.kinematics[1]=i.getInt16(2,!0)/10,FC.SENSOR_DATA.kinematics[2]=i.getInt16(4,!0);break;case MSPCodes.MSP_ALTITUDE:FC.SENSOR_DATA.altitude=parseFloat((i.getInt32(0,!0)/100).toFixed(2)),FC.SENSOR_DATA.barometer=parseFloat((i.getInt32(6,!0)/100).toFixed(2));break;case MSPCodes.MSP_SONAR:FC.SENSOR_DATA.sonar=i.getInt32(0,!0);break;case MSPCodes.MSPV2_INAV_AIR_SPEED:FC.SENSOR_DATA.air_speed=i.getInt32(0,!0);break;case MSPCodes.MSPV2_INAV_ANALOG:let ct=i.getUint8(s++);FC.ANALOG.battery_full_when_plugged_in=!!(ct&1),FC.ANALOG.use_capacity_thresholds=!!((ct&2)>>1),FC.ANALOG.battery_state=(ct&12)>>2,FC.ANALOG.cell_count=(ct&240)>>4,FC.ANALOG.voltage=i.getUint16(s,!0)/100,s+=2,FC.ANALOG.amperage=i.getInt16(s,!0)/100,s+=2,FC.ANALOG.power=i.getInt32(s,!0)/100,s+=4,FC.ANALOG.mAhdrawn=i.getInt32(s,!0),s+=4,FC.ANALOG.mWhdrawn=i.getInt32(s,!0),s+=4,FC.ANALOG.battery_remaining_capacity=i.getUint32(s,!0),s+=4,FC.ANALOG.battery_percentage=i.getUint8(s++),FC.ANALOG.rssi=i.getUint16(s,!0),s+=2,t.analog_last_received_timestamp=Date.now();break;case MSPCodes.MSP_RC_TUNING:FC.RC_tuning.RC_RATE=parseFloat((i.getUint8(s++)/100).toFixed(2)),FC.RC_tuning.RC_EXPO=parseFloat((i.getUint8(s++)/100).toFixed(2)),FC.RC_tuning.roll_pitch_rate=0,FC.RC_tuning.roll_rate=parseFloat(i.getUint8(s++)*10),FC.RC_tuning.pitch_rate=parseFloat(i.getUint8(s++)*10),FC.RC_tuning.yaw_rate=parseFloat(i.getUint8(s++)*10),FC.RC_tuning.dynamic_THR_PID=parseInt(i.getUint8(s++)),FC.RC_tuning.throttle_MID=parseFloat((i.getUint8(s++)/100).toFixed(2)),FC.RC_tuning.throttle_EXPO=parseFloat((i.getUint8(s++)/100).toFixed(2)),FC.RC_tuning.dynamic_THR_breakpoint=i.getUint16(s,!0),s+=2,FC.RC_tuning.RC_YAW_EXPO=parseFloat((i.getUint8(s++)/100).toFixed(2));break;case MSPCodes.MSPV2_INAV_RATE_PROFILE:FC.RC_tuning.RC_RATE=100,FC.RC_tuning.roll_pitch_rate=0,FC.RC_tuning.throttle_MID=parseFloat((i.getUint8(s++)/100).toFixed(2)),FC.RC_tuning.throttle_EXPO=parseFloat((i.getUint8(s++)/100).toFixed(2)),FC.RC_tuning.dynamic_THR_PID=parseInt(i.getUint8(s++)),FC.RC_tuning.dynamic_THR_breakpoint=i.getUint16(s,!0),s+=2,FC.RC_tuning.RC_EXPO=parseFloat((i.getUint8(s++)/100).toFixed(2)),FC.RC_tuning.RC_YAW_EXPO=parseFloat((i.getUint8(s++)/100).toFixed(2)),FC.RC_tuning.roll_rate=i.getUint8(s++)*10,FC.RC_tuning.pitch_rate=i.getUint8(s++)*10,FC.RC_tuning.yaw_rate=i.getUint8(s++)*10,FC.RC_tuning.manual_RC_EXPO=parseFloat((i.getUint8(s++)/100).toFixed(2)),FC.RC_tuning.manual_RC_YAW_EXPO=parseFloat((i.getUint8(s++)/100).toFixed(2)),FC.RC_tuning.manual_roll_rate=i.getUint8(s++),FC.RC_tuning.manual_pitch_rate=i.getUint8(s++),FC.RC_tuning.manual_yaw_rate=i.getUint8(s++);break;case MSPCodes.MSP2_PID:for(let J=0,ze=0;J<t.message_length_expected/4;J++,ze+=4)FC.PIDs[J][0]=i.getUint8(ze),FC.PIDs[J][1]=i.getUint8(ze+1),FC.PIDs[J][2]=i.getUint8(ze+2),FC.PIDs[J][3]=i.getUint8(ze+3);break;case MSPCodes.MSP_LOOP_TIME:FC.FC_CONFIG.loopTime=i.getInt16(0,!0);break;case MSPCodes.MSPV2_INAV_MISC:FC.MISC.midrc=i.getInt16(s,!0),s+=2,FC.MISC.minthrottle=i.getUint16(s,!0),s+=2,FC.MISC.maxthrottle=i.getUint16(s,!0),s+=2,FC.MISC.mincommand=i.getUint16(s,!0),s+=2,FC.MISC.failsafe_throttle=i.getUint16(s,!0),s+=2,FC.MISC.gps_type=i.getUint8(s++),FC.MISC.sensors_baudrate=i.getUint8(s++),FC.MISC.gps_ubx_sbas=i.getInt8(s++),FC.MISC.rssi_channel=i.getUint8(s++),FC.MISC.mag_declination=i.getInt16(s,1)/10,s+=2,FC.MISC.vbatscale=i.getUint16(s,!0),s+=2,FC.MISC.voltage_source=i.getUint8(s++),FC.MISC.battery_cells=i.getUint8(s++),FC.MISC.vbatdetectcellvoltage=i.getUint16(s,!0)/100,s+=2,FC.MISC.vbatmincellvoltage=i.getUint16(s,!0)/100,s+=2,FC.MISC.vbatmaxcellvoltage=i.getUint16(s,!0)/100,s+=2,FC.MISC.vbatwarningcellvoltage=i.getUint16(s,!0)/100,s+=2,FC.MISC.battery_capacity=i.getUint32(s,!0),s+=4,FC.MISC.battery_capacity_warning=i.getUint32(s,!0),s+=4,FC.MISC.battery_capacity_critical=i.getUint32(s,!0),s+=4,FC.MISC.battery_capacity_unit=i.getUint8(s++)?"mWh":"mAh";break;case MSPCodes.MSPV2_INAV_SET_MISC:console.log("MISC INAV Configuration saved");break;case MSPCodes.MSPV2_INAV_BATTERY_CONFIG:FC.BATTERY_CONFIG.vbatscale=i.getUint16(s,!0),s+=2,FC.BATTERY_CONFIG.voltage_source=i.getUint8(s++),FC.BATTERY_CONFIG.battery_cells=i.getUint8(s++),FC.BATTERY_CONFIG.vbatdetectcellvoltage=i.getUint16(s,!0)/100,s+=2,FC.BATTERY_CONFIG.vbatmincellvoltage=i.getUint16(s,!0)/100,s+=2,FC.BATTERY_CONFIG.vbatmaxcellvoltage=i.getUint16(s,!0)/100,s+=2,FC.BATTERY_CONFIG.vbatwarningcellvoltage=i.getUint16(s,!0)/100,s+=2,FC.BATTERY_CONFIG.current_offset=i.getUint16(s,!0),s+=2,FC.BATTERY_CONFIG.current_scale=i.getUint16(s,!0),s+=2,FC.BATTERY_CONFIG.capacity=i.getUint32(s,!0),s+=4,FC.BATTERY_CONFIG.capacity_warning=i.getUint32(s,!0),s+=4,FC.BATTERY_CONFIG.capacity_critical=i.getUint32(s,!0),s+=4,FC.BATTERY_CONFIG.battery_capacity_unit=i.getUint8(s++)?"mWh":"mAh";break;case MSPCodes.MSP_3D:FC.REVERSIBLE_MOTORS.deadband_low=i.getUint16(s,!0),s+=2,FC.REVERSIBLE_MOTORS.deadband_high=i.getUint16(s,!0),s+=2,FC.REVERSIBLE_MOTORS.neutral=i.getUint16(s,!0);break;case MSPCodes.MSP_MOTOR_PINS:console.log(i);break;case MSPCodes.MSP_PIDNAMES:FC.PID_names=[],a=[];for(let J=0;J<i.byteLength;J++)i.getUint8(J)==59?(FC.PID_names.push(String.fromCharCode.apply(null,a)),a=[]):a.push(i.getUint8(J));break;case MSPCodes.MSP_WP:FC.MISSION_PLANNER.put(new Waypoint(i.getUint8(0),i.getUint8(1),i.getInt32(2,!0),i.getInt32(6,!0),i.getInt32(10,!0),i.getInt16(14,!0),i.getInt16(16,!0),i.getInt16(18,!0),i.getUint8(20)));break;case MSPCodes.MSP_BOXIDS:FC.AUX_CONFIG_IDS=[];for(let J=0;J<i.byteLength;J++)FC.AUX_CONFIG_IDS.push(i.getUint8(J));break;case MSPCodes.MSP2_INAV_SERVO_MIXER:if(FC.SERVO_RULES.flush(),i.byteLength%6===0)for(let J=0;J<i.byteLength;J+=6)FC.SERVO_RULES.put(new ServoMixRule(i.getUint8(J),i.getUint8(J+1),i.getInt16(J+2,!0),i.getUint8(J+4),i.getInt8(J+5)));FC.SERVO_RULES.cleanup();break;case MSPCodes.MSP2_INAV_SET_SERVO_MIXER:console.log("Servo mix saved");break;case MSPCodes.MSP2_INAV_LOGIC_CONDITIONS:if(FC.LOGIC_CONDITIONS.flush(),i.byteLength%14===0)for(let J=0;J<i.byteLength;J+=14)FC.LOGIC_CONDITIONS.put(new LogicCondition(i.getInt8(J),i.getInt8(J+1),i.getUint8(J+2),i.getUint8(J+3),i.getInt32(J+4,!0),i.getUint8(J+8),i.getInt32(J+9,!0),i.getInt8(J+13)));break;case MSPCodes.MSP2_INAV_LOGIC_CONDITIONS_SINGLE:FC.LOGIC_CONDITIONS.put(new LogicCondition(i.getInt8(0),i.getInt8(1),i.getUint8(2),i.getUint8(3),i.getInt32(4,!0),i.getUint8(8),i.getInt32(9,!0),i.getInt8(13)));break;case MSPCodes.MSP2_INAV_LOGIC_CONDITIONS_STATUS:if(i.byteLength%4===0){let J=0;for(let ze=0;ze<i.byteLength;ze+=4)FC.LOGIC_CONDITIONS_STATUS.set(J,i.getInt32(ze,!0)),J++}break;case MSPCodes.MSP2_INAV_GVAR_STATUS:if(i.byteLength%4===0){let J=0;for(let ze=0;ze<i.byteLength;ze+=4)FC.GLOBAL_VARIABLES_STATUS.set(J,i.getInt32(ze,!0)),J++}break;case MSPCodes.MSP2_INAV_SET_LOGIC_CONDITIONS:console.log("Logic conditions saved");break;case MSPCodes.MSP2_INAV_PROGRAMMING_PID:if(FC.PROGRAMMING_PID.flush(),i.byteLength%19===0)for(let J=0;J<i.byteLength;J+=19)FC.PROGRAMMING_PID.put(new ProgrammingPid(i.getInt8(J),i.getInt8(J+1),i.getInt32(J+2,!0),i.getInt8(J+6),i.getInt32(J+7,!0),i.getInt16(J+11,!0),i.getInt16(J+13,!0),i.getInt16(J+15,!0),i.getInt16(J+17,!0)));break;case MSPCodes.MSP2_INAV_PROGRAMMING_PID_STATUS:if(i.byteLength%4===0){let J=0;for(let ze=0;ze<i.byteLength;ze+=4)FC.PROGRAMMING_PID_STATUS.set(J,i.getInt32(ze,!0)),J++}break;case MSPCodes.MSP2_INAV_SET_PROGRAMMING_PID:console.log("Programming PID saved");break;case MSPCodes.MSP2_COMMON_MOTOR_MIXER:if(FC.MOTOR_RULES.flush(),i.byteLength%8===0)for(let J=0;J<i.byteLength;J+=8){var A=new MotorMixRule(0,0,0,0);A.fromMsp(i.getUint16(J,!0),i.getUint16(J+2,!0),i.getUint16(J+4,!0),i.getUint16(J+6,!0)),FC.MOTOR_RULES.put(A)}FC.MOTOR_RULES.cleanup();break;case MSPCodes.MSP2_COMMON_SET_MOTOR_MIXER:console.log("motor mixer saved");break;case MSPCodes.MSP2_INAV_SERVO_CONFIG:if(FC.SERVO_CONFIG=[],i.byteLength%7==0)for(o=0;o<i.byteLength;o+=7){var B={min:i.getInt16(o+0,!0),max:i.getInt16(o+2,!0),middle:i.getInt16(o+4,!0),rate:i.getInt8(o+6)};FC.SERVO_CONFIG.push(B)}break;case MSPCodes.MSP_RC_DEADBAND:FC.RC_deadband.deadband=i.getUint8(s++),FC.RC_deadband.yaw_deadband=i.getUint8(s++),FC.RC_deadband.alt_hold_deadband=i.getUint8(s++),FC.REVERSIBLE_MOTORS.deadband_throttle=i.getUint16(s,!0);break;case MSPCodes.MSP_SENSOR_ALIGNMENT:FC.SENSOR_ALIGNMENT.align_gyro=i.getUint8(s++),FC.SENSOR_ALIGNMENT.align_acc=i.getUint8(s++),FC.SENSOR_ALIGNMENT.align_mag=i.getUint8(s++),FC.SENSOR_ALIGNMENT.align_opflow=i.getUint8(s++);break;case MSPCodes.MSP_SET_RAW_RC:break;case MSPCodes.MSP_SET_RAW_GPS:break;case MSPCodes.MSP2_SET_PID:console.log("PID settings saved");break;case MSPCodes.MSP_SET_RC_TUNING:console.log("RC Tuning saved");break;case MSPCodes.MSP_ACC_CALIBRATION:console.log("Accelerometer calibration executed");break;case MSPCodes.MSP_MAG_CALIBRATION:console.log("Mag calibration executed");break;case MSPCodes.MSP2_INAV_OPFLOW_CALIBRATION:console.log("Optic flow calibration executed");break;case MSPCodes.MSP_RESET_CONF:console.log("Settings Reset");break;case MSPCodes.MSP_SELECT_SETTING:console.log("Profile selected");break;case MSPCodes.MSP2_INAV_SET_SERVO_CONFIG:console.log("Servo Configuration saved");break;case MSPCodes.MSP_RTC:if(i.length>=6){var G=i.getInt32(0,!0),k=i.getUint16(4,!0);console.log("RTC received: "+new Date(G*1e3+k))}break;case MSPCodes.MSP_SET_RTC:console.log("RTC set");break;case MSPCodes.MSP_EEPROM_WRITE:console.log("Settings Saved in EEPROM");break;case MSPCodes.MSP_DEBUGMSG:for(var z=0;z<i.byteLength;z++){var q=i.readU8();if(q==0){e.length>1&&(console.log("[DEBUG] "+e),FC.DEBUG_TRACE=(FC.DEBUG_TRACE||"")+e),e="";continue}e+=String.fromCharCode(q)}break;case MSPCodes.MSP_DEBUG:for(let J=0;J<4;J++)FC.SENSOR_DATA.debug[J]=i.getInt16(2*J,1);break;case MSPCodes.MSP2_INAV_DEBUG:for(let J=0;J<8;J++)FC.SENSOR_DATA.debug[J]=i.getInt32(4*J,1);break;case MSPCodes.MSP_SET_MOTOR:console.log("Motor Speeds Updated");break;case MSPCodes.MSP_UID:FC.CONFIG.uid[0]=i.getUint32(0,!0),FC.CONFIG.uid[1]=i.getUint32(4,!0),FC.CONFIG.uid[2]=i.getUint32(8,!0);break;case MSPCodes.MSP_ACC_TRIM:FC.CONFIG.accelerometerTrims[0]=i.getInt16(0,!0),FC.CONFIG.accelerometerTrims[1]=i.getInt16(2,!0);break;case MSPCodes.MSP_SET_ACC_TRIM:console.log("Accelerometer trimms saved.");break;case MSPCodes.MSP_RX_MAP:FC.RC_MAP=[];for(let J=0;J<i.byteLength;J++)FC.RC_MAP.push(i.getUint8(J));break;case MSPCodes.MSP_SET_RX_MAP:console.log("RCMAP saved");break;case MSPCodes.MSP_BOARD_ALIGNMENT:FC.BOARD_ALIGNMENT.roll=i.getInt16(0,!0),FC.BOARD_ALIGNMENT.pitch=i.getInt16(2,!0),FC.BOARD_ALIGNMENT.yaw=i.getInt16(4,!0);break;case MSPCodes.MSP_SET_BOARD_ALIGNMENT:console.log("MSP_SET_BOARD_ALIGNMENT saved");break;case MSPCodes.MSP_CURRENT_METER_CONFIG:FC.CURRENT_METER_CONFIG.scale=i.getInt16(0,!0),FC.CURRENT_METER_CONFIG.offset=i.getInt16(2,!0),FC.CURRENT_METER_CONFIG.type=i.getUint8(4),FC.CURRENT_METER_CONFIG.capacity=i.getInt16(5,!0);break;case MSPCodes.MSP_SET_CURRENT_METER_CONFIG:console.log("MSP_SET_CURRENT_METER_CONFIG saved");break;case MSPCodes.MSP_FEATURE:FC.FEATURES=i.getUint32(0,!0);break;case MSPCodes.MSP_SET_FEATURE:console.log("MSP_SET_FEATURE saved");break;case MSPCodes.MSP_SET_REBOOT:console.log("Reboot request accepted");break;case MSPCodes.MSP_API_VERSION:FC.CONFIG.mspProtocolVersion=i.getUint8(s++),FC.CONFIG.apiVersion=i.getUint8(s++)+"."+i.getUint8(s++)+".0";break;case MSPCodes.MSP_FC_VARIANT:for(s=0;s<4;s++)h+=String.fromCharCode(i.getUint8(s));FC.CONFIG.flightControllerIdentifier=h;break;case MSPCodes.MSP_FC_VERSION:FC.CONFIG.flightControllerVersion=i.getUint8(s++)+"."+i.getUint8(s++)+"."+i.getUint8(s++);break;case MSPCodes.MSP_BUILD_INFO:var T=11;a=[];for(let J=0;J<T;J++)a.push(i.getUint8(s++));a.push(32);var j=8;for(let J=0;J<j;J++)a.push(i.getUint8(s++));FC.CONFIG.buildInfo=String.fromCharCode.apply(null,a);break;case MSPCodes.MSP_BOARD_INFO:for(s=0;s<4;s++)h+=String.fromCharCode(i.getUint8(s));if(FC.CONFIG.boardIdentifier=h,FC.CONFIG.boardVersion=i.getUint16(s,1),s+=2,semver.gt(FC.CONFIG.flightControllerVersion,"4.1.0")){FC.CONFIG.osdUsed=i.getUint8(s++),FC.CONFIG.commCompatability=i.getUint8(s++);let J=i.getUint8(s++),ze="";for(J+=s,s=s;s<J;s++)ze+=String.fromCharCode(i.getUint8(s));FC.CONFIG.target=ze}break;case MSPCodes.MSP2_CF_SERIAL_CONFIG:FC.SERIAL_CONFIG.ports=[];var te=9,Se=i.byteLength/te;for(let J=0;J<Se;J++){var be=mspHelper$1.BAUD_RATES_post1_6_3,Te={identifier:i.getUint8(s),functions:serialPortHelper.maskToFunctions(i.getUint32(s+1,!0)),msp_baudrate:be[i.getUint8(s+5)],sensors_baudrate:be[i.getUint8(s+6)],telemetry_baudrate:be[i.getUint8(s+7)],peripherals_baudrate:be[i.getUint8(s+8)]};s+=te,FC.SERIAL_CONFIG.ports.push(Te)}break;case MSPCodes.MSP2_SET_CF_SERIAL_CONFIG:console.log("Serial config saved");break;case MSPCodes.MSP_MODE_RANGES:FC.MODE_RANGES=[];var pe=i.byteLength/4;for(let J=0;s<i.byteLength&&J<pe;J++){var ie={id:i.getUint8(s++),auxChannelIndex:i.getUint8(s++),range:{start:900+i.getUint8(s++)*25,end:900+i.getUint8(s++)*25}};FC.MODE_RANGES.push(ie)}break;case MSPCodes.MSP_ADJUSTMENT_RANGES:FC.ADJUSTMENT_RANGES=[];var he=i.byteLength/6;for(let J=0;s<i.byteLength&&J<he;J++){var ge={slotIndex:i.getUint8(s++),auxChannelIndex:i.getUint8(s++),range:{start:900+i.getUint8(s++)*25,end:900+i.getUint8(s++)*25},adjustmentFunction:i.getUint8(s++),auxSwitchChannelIndex:i.getUint8(s++)};FC.ADJUSTMENT_RANGES.push(ge)}break;case MSPCodes.MSP_RX_CONFIG:FC.RX_CONFIG.serialrx_provider=i.getUint8(s),s++,FC.RX_CONFIG.maxcheck=i.getUint16(s,!0),s+=2,FC.RX_CONFIG.midrc=i.getUint16(s,!0),s+=2,FC.RX_CONFIG.mincheck=i.getUint16(s,!0),s+=2,FC.RX_CONFIG.spektrum_sat_bind=i.getUint8(s),s++,FC.RX_CONFIG.rx_min_usec=i.getUint16(s,!0),s+=2,FC.RX_CONFIG.rx_max_usec=i.getUint16(s,!0),s+=2,s+=4,FC.RX_CONFIG.spirx_protocol=i.getUint8(s),s++,FC.RX_CONFIG.spirx_id=i.getUint32(s,!0),s+=4,FC.RX_CONFIG.spirx_channel_count=i.getUint8(s),s+=1,s+=1,FC.RX_CONFIG.receiver_type=i.getUint8(s),s+=1;break;case MSPCodes.MSP_FAILSAFE_CONFIG:FC.FAILSAFE_CONFIG.failsafe_delay=i.getUint8(s),s++,FC.FAILSAFE_CONFIG.failsafe_off_delay=i.getUint8(s),s++,FC.FAILSAFE_CONFIG.failsafe_throttle=i.getUint16(s,!0),s+=2,FC.FAILSAFE_CONFIG.failsafe_kill_switch=i.getUint8(s),s++,FC.FAILSAFE_CONFIG.failsafe_throttle_low_delay=i.getUint16(s,!0),s+=2,FC.FAILSAFE_CONFIG.failsafe_procedure=i.getUint8(s),s++,FC.FAILSAFE_CONFIG.failsafe_recovery_delay=i.getUint8(s),s++,FC.FAILSAFE_CONFIG.failsafe_fw_roll_angle=i.getUint16(s,!0),s+=2,FC.FAILSAFE_CONFIG.failsafe_fw_pitch_angle=i.getUint16(s,!0),s+=2,FC.FAILSAFE_CONFIG.failsafe_fw_yaw_rate=i.getUint16(s,!0),s+=2,FC.FAILSAFE_CONFIG.failsafe_stick_motion_threshold=i.getUint16(s,!0),s+=2,FC.FAILSAFE_CONFIG.failsafe_min_distance=i.getUint16(s,!0),s+=2,FC.FAILSAFE_CONFIG.failsafe_min_distance_procedure=i.getUint8(s),s++;break;case MSPCodes.MSP_LED_STRIP_CONFIG:FC.LED_STRIP=[];var C=i.byteLength/4,b,P,O,L,U;for(let J=0;s<i.byteLength&&J<C;J++)if(semver.lt(FC.CONFIG.apiVersion,"1.20.0")){for(b=i.getUint16(s,!0),s+=2,P=[],O=0;O<MSP.ledDirectionLetters.length;O++)BitHelper.bit_check(b,O)&&P.push(MSP.ledDirectionLetters[O]);var ue=i.getUint16(s,1);s+=2,L=[];for(var de=0;de<MSP.ledFunctionLetters.length;de++)BitHelper.bit_check(ue,de)&&L.push(MSP.ledFunctionLetters[de]);U={directions:P,functions:L,x:i.getUint8(s++),y:i.getUint8(s++),color:i.getUint8(s++)},FC.LED_STRIP.push(U)}else{var se=i.getUint32(s,1);s+=4;var l=se>>8&15;L=[];for(var u=0;u<MSP.ledBaseFunctionLetters.length;u++)if(l==u){L.push(MSP.ledBaseFunctionLetters[u]);break}for(var p=se>>12&63,g=0;g<MSP.ledOverlayLetters.length;g++)BitHelper.bit_check(p,g)&&L.push(MSP.ledOverlayLetters[g]);for(b=se>>22&63,P=[],O=0;O<MSP.ledDirectionLetters.length;O++)BitHelper.bit_check(b,O)&&P.push(MSP.ledDirectionLetters[O]);U={y:se&15,x:se>>4&15,functions:L,color:se>>18&15,directions:P,parameters:se>>28&15},FC.LED_STRIP.push(U)}break;case MSPCodes.MSP2_INAV_LED_STRIP_CONFIG_EX:FC.LED_STRIP=[];var C=i.byteLength/5,b,P,O,L,U;for(let J=0;s<i.byteLength&&J<C;J++){var se=i.getUint32(s,1);s+=4;var H=i.getUint8(s,1);s++;var l=se>>8&255;L=[];for(var u=0;u<MSP.ledBaseFunctionLetters.length;u++)if(l==u){L.push(MSP.ledBaseFunctionLetters[u]);break}for(var p=se>>16&255,g=0;g<MSP.ledOverlayLetters.length;g++)BitHelper.bit_check(p,g)&&L.push(MSP.ledOverlayLetters[g]);for(b=se>>28&15|(H&3)<<4,P=[],O=0;O<MSP.ledDirectionLetters.length;O++)BitHelper.bit_check(b,O)&&P.push(MSP.ledDirectionLetters[O]);U={y:se&15,x:se>>4&15,functions:L,color:se>>24&15,directions:P,parameters:H>>2&63},FC.LED_STRIP.push(U)}break;case MSPCodes.MSP_SET_LED_STRIP_CONFIG:console.log("Led strip config saved");break;case MSPCodes.MSP2_INAV_SET_LED_STRIP_CONFIG_EX:console.log("Led strip extended config saved");break;case MSPCodes.MSP_LED_COLORS:FC.LED_COLORS=[],d=i.byteLength/4;for(let J=0;s<i.byteLength&&J<d;J++){var ee=i.getUint16(s,!0),ae=i.getUint8(s+2),Y=i.getUint8(s+3);s+=4,f={h:ee,s:ae,v:Y},FC.LED_COLORS.push(f)}break;case MSPCodes.MSP_SET_LED_COLORS:console.log("Led strip colors saved");break;case MSPCodes.MSP_LED_STRIP_MODECOLOR:FC.LED_MODE_COLORS=[],d=i.byteLength/3;for(let J=0;s<i.byteLength&&J<d;J++){var Z=i.getUint8(s++),ce=i.getUint8(s++);f=i.getUint8(s++),FC.LED_MODE_COLORS.push({mode:Z,direction:ce,color:f})}break;case MSPCodes.MSP_SET_LED_STRIP_MODECOLOR:console.log("Led strip mode colors saved");break;case MSPCodes.MSP_DATAFLASH_SUMMARY:i.byteLength>=13?(c=i.getUint8(0),FC.DATAFLASH.ready=(c&1)!=0,FC.DATAFLASH.supported=(c&2)!=0||FC.DATAFLASH.ready,FC.DATAFLASH.sectors=i.getUint32(1,1),FC.DATAFLASH.totalSize=i.getUint32(5,1),FC.DATAFLASH.usedSize=i.getUint32(9,1)):(FC.DATAFLASH.ready=!1,FC.DATAFLASH.supported=!1,FC.DATAFLASH.sectors=0,FC.DATAFLASH.totalSize=0,FC.DATAFLASH.usedSize=0),GUI.update_dataflash_global();break;case MSPCodes.MSP_DATAFLASH_READ:break;case MSPCodes.MSP_DATAFLASH_ERASE:console.log("Data flash erase begun...");break;case MSPCodes.MSP_SDCARD_SUMMARY:c=i.getUint8(0),FC.SDCARD.supported=(c&1)!=0,FC.SDCARD.state=i.getUint8(1),FC.SDCARD.filesystemLastError=i.getUint8(2),FC.SDCARD.freeSizeKB=i.getUint32(3,!0),FC.SDCARD.totalSizeKB=i.getUint32(7,!0);break;case MSPCodes.MSP_BLACKBOX_CONFIG:FC.BLACKBOX.supported=(i.getUint8(0)&1)!=0,FC.BLACKBOX.blackboxDevice=i.getUint8(1),FC.BLACKBOX.blackboxRateNum=i.getUint8(2),FC.BLACKBOX.blackboxRateDenom=i.getUint8(3);break;case MSPCodes.MSP_SET_BLACKBOX_CONFIG:console.log("Blackbox config saved");break;case MSPCodes.MSP_VTX_CONFIG:FC.VTX_CONFIG.device_type=i.getUint8(s++),FC.VTX_CONFIG.device_type!=VTX.DEV_UNKNOWN&&(FC.VTX_CONFIG.band=i.getUint8(s++),FC.VTX_CONFIG.channel=i.getUint8(s++),FC.VTX_CONFIG.power=i.getUint8(s++),FC.VTX_CONFIG.pitmode=i.getUint8(s++),s++,FC.VTX_CONFIG.low_power_disarm=i.getUint8(s++));break;case MSPCodes.MSP_ADVANCED_CONFIG:FC.ADVANCED_CONFIG.gyroSyncDenominator=i.getUint8(s),s++,FC.ADVANCED_CONFIG.pidProcessDenom=i.getUint8(s),s++,FC.ADVANCED_CONFIG.useUnsyncedPwm=i.getUint8(s),s++,FC.ADVANCED_CONFIG.motorPwmProtocol=i.getUint8(s),s++,FC.ADVANCED_CONFIG.motorPwmRate=i.getUint16(s,!0),s+=2,FC.ADVANCED_CONFIG.servoPwmRate=i.getUint16(s,!0),s+=2,FC.ADVANCED_CONFIG.gyroSync=i.getUint8(s);break;case MSPCodes.MSP_SET_VTX_CONFIG:console.log("VTX config saved");break;case MSPCodes.MSP_SET_ADVANCED_CONFIG:console.log("Advanced config saved");break;case MSPCodes.MSP_FILTER_CONFIG:FC.FILTER_CONFIG.gyroSoftLpfHz=i.getUint8(0),FC.FILTER_CONFIG.dtermLpfHz=i.getUint16(1,!0),FC.FILTER_CONFIG.yawLpfHz=i.getUint16(3,!0),FC.FILTER_CONFIG.gyroNotchHz1=i.getUint16(5,!0),FC.FILTER_CONFIG.gyroNotchCutoff1=i.getUint16(7,!0),FC.FILTER_CONFIG.dtermNotchHz=i.getUint16(9,!0),FC.FILTER_CONFIG.dtermNotchCutoff=i.getUint16(11,!0),FC.FILTER_CONFIG.gyroNotchHz2=i.getUint16(13,!0),FC.FILTER_CONFIG.gyroNotchCutoff2=i.getUint16(15,!0),FC.FILTER_CONFIG.accNotchHz=i.getUint16(17,!0),FC.FILTER_CONFIG.accNotchCutoff=i.getUint16(19,!0),FC.FILTER_CONFIG.gyroStage2LowpassHz=i.getUint16(21,!0);break;case MSPCodes.MSP_SET_FILTER_CONFIG:console.log("Filter config saved");break;case MSPCodes.MSP_PID_ADVANCED:FC.PID_ADVANCED.rollPitchItermIgnoreRate=i.getUint16(0,!0),FC.PID_ADVANCED.yawItermIgnoreRate=i.getUint16(2,!0),FC.PID_ADVANCED.yawPLimit=i.getUint16(4,!0),FC.PID_ADVANCED.dtermSetpointWeight=i.getUint8(9),FC.PID_ADVANCED.pidSumLimit=i.getUint16(10,!0),FC.PID_ADVANCED.axisAccelerationLimitRollPitch=i.getUint16(13,!0),FC.PID_ADVANCED.axisAccelerationLimitYaw=i.getUint16(15,!0);break;case MSPCodes.MSP_SET_PID_ADVANCED:console.log("PID advanced saved");break;case MSPCodes.MSP_SENSOR_CONFIG:FC.SENSOR_CONFIG.accelerometer=i.getUint8(0,!0),FC.SENSOR_CONFIG.barometer=i.getUint8(1,!0),FC.SENSOR_CONFIG.magnetometer=i.getUint8(2,!0),FC.SENSOR_CONFIG.pitot=i.getUint8(3,!0),FC.SENSOR_CONFIG.rangefinder=i.getUint8(4,!0),FC.SENSOR_CONFIG.opflow=i.getUint8(5,!0);break;case MSPCodes.MSP_SET_SENSOR_CONFIG:console.log("Sensor config saved");break;case MSPCodes.MSP_INAV_PID:FC.INAV_PID_CONFIG.asynchronousMode=i.getUint8(0),FC.INAV_PID_CONFIG.accelerometerTaskFrequency=i.getUint16(1,!0),FC.INAV_PID_CONFIG.attitudeTaskFrequency=i.getUint16(3,!0),FC.INAV_PID_CONFIG.magHoldRateLimit=i.getUint8(5),FC.INAV_PID_CONFIG.magHoldErrorLpfFrequency=i.getUint8(6),FC.INAV_PID_CONFIG.yawJumpPreventionLimit=i.getUint16(7,!0),FC.INAV_PID_CONFIG.gyroscopeLpf=i.getUint8(9),FC.INAV_PID_CONFIG.accSoftLpfHz=i.getUint8(10);break;case MSPCodes.MSP_SET_INAV_PID:console.log("MSP_INAV_PID saved");break;case MSPCodes.MSP_NAV_POSHOLD:FC.NAV_POSHOLD.userControlMode=i.getUint8(0),FC.NAV_POSHOLD.maxSpeed=i.getUint16(1,!0),FC.NAV_POSHOLD.maxClimbRate=i.getUint16(3,!0),FC.NAV_POSHOLD.maxManualSpeed=i.getUint16(5,!0),FC.NAV_POSHOLD.maxManualClimbRate=i.getUint16(7,!0),FC.NAV_POSHOLD.maxBankAngle=i.getUint8(9),FC.NAV_POSHOLD.useThrottleMidForAlthold=i.getUint8(10),FC.NAV_POSHOLD.hoverThrottle=i.getUint16(11,!0);break;case MSPCodes.MSP_SET_NAV_POSHOLD:console.log("NAV_POSHOLD saved");break;case MSPCodes.MSP_CALIBRATION_DATA:var ye=i.getUint8(0);FC.CALIBRATION_DATA.acc.Pos0=1&ye>>0,FC.CALIBRATION_DATA.acc.Pos1=1&ye>>1,FC.CALIBRATION_DATA.acc.Pos2=1&ye>>2,FC.CALIBRATION_DATA.acc.Pos3=1&ye>>3,FC.CALIBRATION_DATA.acc.Pos4=1&ye>>4,FC.CALIBRATION_DATA.acc.Pos5=1&ye>>5,FC.CALIBRATION_DATA.accZero.X=i.getInt16(1,!0),FC.CALIBRATION_DATA.accZero.Y=i.getInt16(3,!0),FC.CALIBRATION_DATA.accZero.Z=i.getInt16(5,!0),FC.CALIBRATION_DATA.accGain.X=i.getInt16(7,!0),FC.CALIBRATION_DATA.accGain.Y=i.getInt16(9,!0),FC.CALIBRATION_DATA.accGain.Z=i.getInt16(11,!0),FC.CALIBRATION_DATA.magZero.X=i.getInt16(13,!0),FC.CALIBRATION_DATA.magZero.Y=i.getInt16(15,!0),FC.CALIBRATION_DATA.magZero.Z=i.getInt16(17,!0),FC.CALIBRATION_DATA.opflow.Scale=i.getInt16(19,!0)/256,FC.CALIBRATION_DATA.magGain.X=i.getInt16(21,!0),FC.CALIBRATION_DATA.magGain.Y=i.getInt16(23,!0),FC.CALIBRATION_DATA.magGain.Z=i.getInt16(25,!0);break;case MSPCodes.MSP_SET_CALIBRATION_DATA:console.log("Calibration data saved");break;case MSPCodes.MSP_RTH_AND_LAND_CONFIG:FC.RTH_AND_LAND_CONFIG.minRthDistance=i.getUint16(0,!0),FC.RTH_AND_LAND_CONFIG.rthClimbFirst=i.getUint8(2),FC.RTH_AND_LAND_CONFIG.rthClimbIgnoreEmergency=i.getUint8(3),FC.RTH_AND_LAND_CONFIG.rthTailFirst=i.getUint8(4),FC.RTH_AND_LAND_CONFIG.rthAllowLanding=i.getUint8(5),FC.RTH_AND_LAND_CONFIG.rthAltControlMode=i.getUint8(6),FC.RTH_AND_LAND_CONFIG.rthAbortThreshold=i.getUint16(7,!0),FC.RTH_AND_LAND_CONFIG.rthAltitude=i.getUint16(9,!0),FC.RTH_AND_LAND_CONFIG.landMinAltVspd=i.getUint16(11,!0),FC.RTH_AND_LAND_CONFIG.landMaxAltVspd=i.getUint16(13,!0),FC.RTH_AND_LAND_CONFIG.landSlowdownMinAlt=i.getUint16(15,!0),FC.RTH_AND_LAND_CONFIG.landSlowdownMaxAlt=i.getUint16(17,!0),FC.RTH_AND_LAND_CONFIG.emergencyDescentRate=i.getUint16(19,!0);break;case MSPCodes.MSP_SET_RTH_AND_LAND_CONFIG:console.log("RTH_AND_LAND_CONFIG saved");break;case MSPCodes.MSP_FW_CONFIG:FC.FW_CONFIG.cruiseThrottle=i.getUint16(0,!0),FC.FW_CONFIG.minThrottle=i.getUint16(2,!0),FC.FW_CONFIG.maxThrottle=i.getUint16(4,!0),FC.FW_CONFIG.maxBankAngle=i.getUint8(6),FC.FW_CONFIG.maxClimbAngle=i.getUint8(7),FC.FW_CONFIG.maxDiveAngle=i.getUint8(8),FC.FW_CONFIG.pitchToThrottle=i.getUint8(9),FC.FW_CONFIG.loiterRadius=i.getUint16(10,!0);break;case MSPCodes.MSP_SET_FW_CONFIG:console.log("FW_CONFIG saved");break;case MSPCodes.MSP_SET_MODE_RANGE:console.log("Mode range saved");break;case MSPCodes.MSP_SET_ADJUSTMENT_RANGE:console.log("Adjustment range saved");break;case MSPCodes.MSP_SET_LOOP_TIME:console.log("Looptime saved");break;case MSPCodes.MSP_SET_RESET_CURR_PID:console.log("Current Control profile reset");break;case MSPCodes.MSP_SET_3D:console.log("3D settings saved");break;case MSPCodes.MSP_SET_RC_DEADBAND:console.log("Rc controls settings saved");break;case MSPCodes.MSP_SET_SENSOR_ALIGNMENT:console.log("Sensor alignment saved");break;case MSPCodes.MSP_SET_RX_CONFIG:console.log("Rx config saved");break;case MSPCodes.MSP_SET_FAILSAFE_CONFIG:console.log("Failsafe config saved");break;case MSPCodes.MSP_OSD_CHAR_READ:break;case MSPCodes.MSP_OSD_CHAR_WRITE:console.log("OSD char uploaded");break;case MSPCodes.MSP_NAME:FC.CONFIG.name="";for(var ve;(ve=i.readU8())!==null;)FC.CONFIG.name+=String.fromCharCode(ve);break;case MSPCodes.MSP_SET_NAME:console.log("Craft name set");break;case MSPCodes.MSPV2_SETTING:break;case MSPCodes.MSP2_COMMON_SETTING_INFO:break;case MSPCodes.MSPV2_SET_SETTING:console.log("Setting set");break;case MSPCodes.MSP_WP_GETINFO:FC.MISSION_PLANNER.setMaxWaypoints(i.getUint8(1)),FC.MISSION_PLANNER.setValidMission(i.getUint8(2)),FC.MISSION_PLANNER.setCountBusyPoints(i.getUint8(3));break;case MSPCodes.MSP_SET_WP:console.log("Point saved");break;case MSPCodes.MSP_WP_MISSION_SAVE:console.log(i);break;case MSPCodes.MSP_WP_MISSION_LOAD:console.log("Mission load");break;case MSPCodes.MSP2_INAV_MIXER:FC.MIXER_CONFIG.yawMotorDirection=i.getInt8(0),FC.MIXER_CONFIG.yawJumpPreventionLimit=i.getUint8(1,!0),FC.MIXER_CONFIG.motorStopOnLow=i.getUint8(2,!0),FC.MIXER_CONFIG.platformType=i.getInt8(3),FC.MIXER_CONFIG.hasFlaps=i.getInt8(4),FC.MIXER_CONFIG.appliedMixerPreset=i.getInt16(5,!0),FC.MIXER_CONFIG.numberOfMotors=i.getInt8(7),FC.MIXER_CONFIG.numberOfServos=i.getInt8(8),FC.MOTOR_RULES.setMotorCount(FC.MIXER_CONFIG.numberOfMotors),FC.SERVO_RULES.setServoCount(FC.MIXER_CONFIG.numberOfServos);break;case MSPCodes.MSP2_INAV_SET_MIXER:console.log("Mixer config saved");case MSPCodes.MSP2_INAV_OSD_LAYOUTS:break;case MSPCodes.MSP2_INAV_OSD_SET_LAYOUT_ITEM:console.log("OSD layout item saved");break;case MSPCodes.MSP2_INAV_OSD_ALARMS:break;case MSPCodes.MSP2_INAV_OSD_SET_ALARMS:console.log("OSD alarms saved");break;case MSPCodes.MSP2_INAV_OSD_PREFERENCES:break;case MSPCodes.MSP2_INAV_OSD_SET_PREFERENCES:console.log("OSD preferences saved");break;case MSPCodes.MSP2_INAV_SELECT_BATTERY_PROFILE:console.log("Battery profile selected");break;case MSPCodes.MSP2_INAV_SET_CUSTOM_OSD_ELEMENTS:console.log("OSD custom elements preferences saved");break;case MSPCodes.MSPV2_INAV_OUTPUT_MAPPING_EXT2:FC.OUTPUT_MAPPING.flush();for(let J=0;J<i.byteLength;J+=6){let ze=i.getUint8(J),pt=i.getUint32(J+1,!0),ot=i.getUint8(J+5);FC.OUTPUT_MAPPING.put({timerId:ze,usageFlags:pt,specialLabels:ot})}break;case MSPCodes.MSP2_INAV_TIMER_OUTPUT_MODE:i.byteLength>2&&FC.OUTPUT_MAPPING.flushTimerOverrides();for(let J=0;J<i.byteLength;J+=2){let ze=i.getUint8(J),pt=i.getUint8(J+1);FC.OUTPUT_MAPPING.setTimerOverride(ze,pt)}break;case MSPCodes.MSP2_INAV_MC_BRAKING:try{FC.BRAKING_CONFIG.speedThreshold=i.getUint16(0,!0),FC.BRAKING_CONFIG.disengageSpeed=i.getUint16(2,!0),FC.BRAKING_CONFIG.timeout=i.getUint16(4,!0),FC.BRAKING_CONFIG.boostFactor=i.getInt8(6),FC.BRAKING_CONFIG.boostTimeout=i.getUint16(7,!0),FC.BRAKING_CONFIG.boostSpeedThreshold=i.getUint16(9,!0),FC.BRAKING_CONFIG.boostDisengageSpeed=i.getUint16(11,!0),FC.BRAKING_CONFIG.bankAngle=i.getInt8(13)}catch{console.log("MC_BRAKING MODE is not supported by the hardware")}break;case MSPCodes.MSP2_INAV_SET_MC_BRAKING:console.log("Braking config saved");break;case MSPCodes.MSP2_BLACKBOX_CONFIG:FC.BLACKBOX.supported=(i.getUint8(0)&1)!=0,FC.BLACKBOX.blackboxDevice=i.getUint8(1),FC.BLACKBOX.blackboxRateNum=i.getUint16(2),FC.BLACKBOX.blackboxRateDenom=i.getUint16(4),FC.BLACKBOX.blackboxIncludeFlags=i.getUint32(6,!0);break;case MSPCodes.MSP2_SET_BLACKBOX_CONFIG:console.log("Blackbox config saved");break;case MSPCodes.MSP2_INAV_TEMPERATURES:for(let J=0;J<8;++J){let ze=i.getInt16(J*2,!0);FC.SENSOR_DATA.temperature[J]=ze/10}break;case MSPCodes.MSP2_INAV_SAFEHOME:var Ee=new Safehome(i.getUint8(0),i.getUint8(1),i.getInt32(2,!0),i.getInt32(6,!0));Ee.getEnabled()&&FC.SAFEHOMES.put(Ee);break;case MSPCodes.MSP2_INAV_SET_SAFEHOME:console.log("Safehome points saved");break;case MSPCodes.MSP2_INAV_FW_APPROACH:FC.FW_APPROACH.put(new FwApproach(i.getUint8(0),i.getInt32(1,!0),i.getInt32(5,!0),i.getUint8(9,!0),i.getInt16(10,!0),i.getInt16(12,!0),i.getUint8(14,!0)));break;case MSPCodes.MSP2_INAV_SET_FW_APPROACH:console.log("FW Approach saved");break;case MSPCodes.MSP2_INAV_RATE_DYNAMICS:FC.RATE_DYNAMICS.sensitivityCenter=i.getUint8(0),FC.RATE_DYNAMICS.sensitivityEnd=i.getUint8(1),FC.RATE_DYNAMICS.correctionCenter=i.getUint8(2),FC.RATE_DYNAMICS.correctionEnd=i.getUint8(3),FC.RATE_DYNAMICS.weightCenter=i.getUint8(4),FC.RATE_DYNAMICS.weightEnd=i.getUint8(5);break;case MSPCodes.MSP2_INAV_SET_RATE_DYNAMICS:console.log("Rate dynamics saved");break;case MSPCodes.MSP2_INAV_EZ_TUNE:FC.EZ_TUNE.enabled=i.getUint8(0),FC.EZ_TUNE.filterHz=i.getUint16(1,!0),FC.EZ_TUNE.axisRatio=i.getUint8(3),FC.EZ_TUNE.response=i.getUint8(4),FC.EZ_TUNE.damping=i.getUint8(5),FC.EZ_TUNE.stability=i.getUint8(6),FC.EZ_TUNE.aggressiveness=i.getUint8(7),FC.EZ_TUNE.rate=i.getUint8(8),FC.EZ_TUNE.expo=i.getUint8(9),FC.EZ_TUNE.snappiness=i.getUint8(10);break;case MSPCodes.MSP2_INAV_EZ_TUNE_SET:console.log("EzTune settings saved");break;case MSPCodes.MSP2_INAV_CUSTOM_OSD_ELEMENTS:FC.OSD_CUSTOM_ELEMENTS.items=[];let mt=0;if(i.byteLength==0){FC.OSD_CUSTOM_ELEMENTS.settings.customElementsCount=0,FC.OSD_CUSTOM_ELEMENTS.settings.customElementTextSize=0,FC.OSD_CUSTOM_ELEMENTS.settings.customElementParts=0;return}FC.OSD_CUSTOM_ELEMENTS.settings.customElementsCount=i.getUint8(mt++),FC.OSD_CUSTOM_ELEMENTS.settings.customElementTextSize=i.getUint8(mt++),FC.OSD_CUSTOM_ELEMENTS.settings.customElementParts=i.getUint8(mt++);break;case MSPCodes.MSP2_INAV_CUSTOM_OSD_ELEMENT:var Re={customElementItems:[],customElementVisibility:{type:0,value:0},customElementText:[]};let st=0;for(let J=0;J<FC.OSD_CUSTOM_ELEMENTS.settings.customElementParts;J++){var Ne={type:0,value:0};Ne.type=i.getUint8(st++),Ne.value=i.getUint16(st,!0),st+=2,Re.customElementItems.push(Ne)}Re.customElementVisibility.type=i.getUint8(st++),Re.customElementVisibility.value=i.getUint16(st,!0),st+=2;for(let J=0;J<FC.OSD_CUSTOM_ELEMENTS.settings.customElementTextSize;J++){var ve=i.getUint8(st++);if(ve===0){st+=FC.OSD_CUSTOM_ELEMENTS.settings.customElementTextSize-1-J;break}Re.customElementText[J]=ve}Re.customElementText=String.fromCharCode(...Re.customElementText),FC.OSD_CUSTOM_ELEMENTS.items.push(Re);break;case MSPCodes.MSP2_INAV_GPS_UBLOX_COMMAND:break;case MSPCodes.MSP2_INAV_GEOZONE:if(i.buffer.byteLength==0)break;var Ae=new Geozone(i.getUint8(1),i.getUint8(2),i.getInt32(3,!0),i.getInt32(7,!0),i.getUint8(11),0,i.getInt8(12,!0),null,i.getUint8(0,!0));let ut=i.getUint8(13,!0);if(ut==0)break;Ae.getShape()==GeozoneShapes.POLYGON?Ae.setVertices(new Array(ut)):Ae.setVertices(new Array(1)),FC.GEOZONES.put(Ae);break;case MSPCodes.MSP2_INAV_GEOZONE_VERTEX:if(i.buffer.byteLength==0)break;var Fe=i.getUint8(0),De=i.getUint8(1),Ae=FC.GEOZONES.at(Fe);Fe<FC.GEOZONES.geozoneCount()&&(Ae.setVertex(De,new GeozoneVertex(De,i.getInt32(2,!0),i.getInt32(6,!0))),Ae.getShape()==GeozoneShapes.CIRCULAR&&Ae.setRadius(i.getUint32(10,!0)));break;case MSPCodes.MSP2_INAV_SET_GEOZONE_VERTICE:console.log("Geozone vertex saved");break;case MSPCodes.MSP2_INAV_SET_GEOZONE:console.log("Geozone saved");break;default:console.log("Unknown code detected: 0x"+t.code.toString(16))}else console.log("FC reports unsupported message error: 0x"+t.code.toString(16));for(let Ce=t.callbacks.length-1;Ce>=0;Ce--)if(Ce<t.callbacks.length&&t.callbacks[Ce].code==t.code){var Ue=t.callbacks[Ce].onFinish;if(clearTimeout(t.callbacks[Ce].timer),t.callbacks[Ce]){mspQueue.putRoundtrip(new Date().getTime()-t.callbacks[Ce].createdOn);const Oe=new Date().getTime()-t.callbacks[Ce].sentOn;mspQueue.putHardwareRoundtrip(Oe),mspStatistics.add(t.code,Oe)}mspDeduplicationQueue.remove(t.code),t.callbacks.splice(Ce,1),Ue&&Ue({command:t.code,data:i,length:t.message_length_expected});break}},n.crunch=function(t){var i=[];switch(t){case MSPCodes.MSP_SET_FEATURE:i.push(BitHelper.specificByte(FC.FEATURES,0)),i.push(BitHelper.specificByte(FC.FEATURES,1)),i.push(BitHelper.specificByte(FC.FEATURES,2)),i.push(BitHelper.specificByte(FC.FEATURES,3));break;case MSPCodes.MSP_SET_BOARD_ALIGNMENT:i.push(BitHelper.specificByte(FC.BOARD_ALIGNMENT.roll,0)),i.push(BitHelper.specificByte(FC.BOARD_ALIGNMENT.roll,1)),i.push(BitHelper.specificByte(FC.BOARD_ALIGNMENT.pitch,0)),i.push(BitHelper.specificByte(FC.BOARD_ALIGNMENT.pitch,1)),i.push(BitHelper.specificByte(FC.BOARD_ALIGNMENT.yaw,0)),i.push(BitHelper.specificByte(FC.BOARD_ALIGNMENT.yaw,1));break;case MSPCodes.MSP_SET_CURRENT_METER_CONFIG:i.push(BitHelper.specificByte(FC.CURRENT_METER_CONFIG.scale,0)),i.push(BitHelper.specificByte(FC.CURRENT_METER_CONFIG.scale,1)),i.push(BitHelper.specificByte(FC.CURRENT_METER_CONFIG.offset,0)),i.push(BitHelper.specificByte(FC.CURRENT_METER_CONFIG.offset,1)),i.push(FC.CURRENT_METER_CONFIG.type),i.push(BitHelper.specificByte(FC.CURRENT_METER_CONFIG.capacity,0)),i.push(BitHelper.specificByte(FC.CURRENT_METER_CONFIG.capacity,1));break;case MSPCodes.MSP_SET_VTX_CONFIG:FC.VTX_CONFIG.band>0?i.push16((FC.VTX_CONFIG.band-1)*8+(FC.VTX_CONFIG.channel-1)):i.push16(VTX.MAX_FREQUENCY_MHZ+1),i.push(FC.VTX_CONFIG.power),i.push(0),i.push(FC.VTX_CONFIG.low_power_disarm);break;case MSPCodes.MSP2_SET_PID:for(let a=0;a<FC.PIDs.length;a++)i.push(parseInt(FC.PIDs[a][0])),i.push(parseInt(FC.PIDs[a][1])),i.push(parseInt(FC.PIDs[a][2])),i.push(parseInt(FC.PIDs[a][3]));break;case MSPCodes.MSP_SET_RC_TUNING:i.push(Math.round(FC.RC_tuning.RC_RATE*100)),i.push(Math.round(FC.RC_tuning.RC_EXPO*100)),i.push(Math.round(FC.RC_tuning.roll_rate/10)),i.push(Math.round(FC.RC_tuning.pitch_rate/10)),i.push(Math.round(FC.RC_tuning.yaw_rate/10)),i.push(FC.RC_tuning.dynamic_THR_PID),i.push(Math.round(FC.RC_tuning.throttle_MID*100)),i.push(Math.round(FC.RC_tuning.throttle_EXPO*100)),i.push(BitHelper.lowByte(FC.RC_tuning.dynamic_THR_breakpoint)),i.push(BitHelper.highByte(FC.RC_tuning.dynamic_THR_breakpoint)),i.push(Math.round(FC.RC_tuning.RC_YAW_EXPO*100));break;case MSPCodes.MSPV2_INAV_SET_RATE_PROFILE:i.push(Math.round(FC.RC_tuning.throttle_MID*100)),i.push(Math.round(FC.RC_tuning.throttle_EXPO*100)),i.push(FC.RC_tuning.dynamic_THR_PID),i.push(BitHelper.lowByte(FC.RC_tuning.dynamic_THR_breakpoint)),i.push(BitHelper.highByte(FC.RC_tuning.dynamic_THR_breakpoint)),i.push(Math.round(FC.RC_tuning.RC_EXPO*100)),i.push(Math.round(FC.RC_tuning.RC_YAW_EXPO*100)),i.push(Math.round(FC.RC_tuning.roll_rate/10)),i.push(Math.round(FC.RC_tuning.pitch_rate/10)),i.push(Math.round(FC.RC_tuning.yaw_rate/10)),i.push(Math.round(FC.RC_tuning.manual_RC_EXPO*100)),i.push(Math.round(FC.RC_tuning.manual_RC_YAW_EXPO*100)),i.push(FC.RC_tuning.manual_roll_rate),i.push(FC.RC_tuning.manual_pitch_rate),i.push(FC.RC_tuning.manual_yaw_rate);break;case MSPCodes.MSP_SET_RX_MAP:for(let a=0;a<FC.RC_MAP.length;a++)i.push(FC.RC_MAP[a]);break;case MSPCodes.MSP_SET_ACC_TRIM:i.push(BitHelper.lowByte(FC.CONFIG.accelerometerTrims[0])),i.push(BitHelper.highByte(FC.CONFIG.accelerometerTrims[0])),i.push(BitHelper.lowByte(FC.CONFIG.accelerometerTrims[1])),i.push(BitHelper.highByte(FC.CONFIG.accelerometerTrims[1]));break;case MSPCodes.MSP_SET_LOOP_TIME:i.push(BitHelper.lowByte(FC.FC_CONFIG.loopTime)),i.push(BitHelper.highByte(FC.FC_CONFIG.loopTime));break;case MSPCodes.MSPV2_INAV_SET_MISC:i.push(BitHelper.lowByte(FC.MISC.midrc)),i.push(BitHelper.highByte(FC.MISC.midrc)),i.push(BitHelper.lowByte(FC.MISC.minthrottle)),i.push(BitHelper.highByte(FC.MISC.minthrottle)),i.push(BitHelper.lowByte(FC.MISC.maxthrottle)),i.push(BitHelper.highByte(FC.MISC.maxthrottle)),i.push(BitHelper.lowByte(FC.MISC.mincommand)),i.push(BitHelper.highByte(FC.MISC.mincommand)),i.push(BitHelper.lowByte(FC.MISC.failsafe_throttle)),i.push(BitHelper.highByte(FC.MISC.failsafe_throttle)),i.push(FC.MISC.gps_type),i.push(FC.MISC.sensors_baudrate),i.push(FC.MISC.gps_ubx_sbas),i.push(FC.MISC.rssi_channel),i.push(BitHelper.lowByte(Math.round(FC.MISC.mag_declination*10))),i.push(BitHelper.highByte(Math.round(FC.MISC.mag_declination*10))),i.push(BitHelper.lowByte(FC.MISC.vbatscale)),i.push(BitHelper.highByte(FC.MISC.vbatscale)),i.push(FC.MISC.voltage_source),i.push(FC.MISC.battery_cells),i.push(BitHelper.lowByte(Math.round(FC.MISC.vbatdetectcellvoltage*100))),i.push(BitHelper.highByte(Math.round(FC.MISC.vbatdetectcellvoltage*100))),i.push(BitHelper.lowByte(Math.round(FC.MISC.vbatmincellvoltage*100))),i.push(BitHelper.highByte(Math.round(FC.MISC.vbatmincellvoltage*100))),i.push(BitHelper.lowByte(Math.round(FC.MISC.vbatmaxcellvoltage*100))),i.push(BitHelper.highByte(Math.round(FC.MISC.vbatmaxcellvoltage*100))),i.push(BitHelper.lowByte(Math.round(FC.MISC.vbatwarningcellvoltage*100))),i.push(BitHelper.highByte(Math.round(FC.MISC.vbatwarningcellvoltage*100)));for(let a=0;a<4;++a)i.push(BitHelper.specificByte(FC.MISC.battery_capacity,a));for(let a=0;a<4;++a)i.push(BitHelper.specificByte(FC.MISC.battery_capacity_warning,a));for(let a=0;a<4;++a)i.push(BitHelper.specificByte(FC.MISC.battery_capacity_critical,a));i.push(FC.MISC.battery_capacity_unit=="mAh"?0:1);break;case MSPCodes.MSPV2_INAV_SET_BATTERY_CONFIG:i.push(BitHelper.lowByte(FC.BATTERY_CONFIG.vbatscale)),i.push(BitHelper.highByte(FC.BATTERY_CONFIG.vbatscale)),i.push(FC.BATTERY_CONFIG.voltage_source),i.push(FC.BATTERY_CONFIG.battery_cells),i.push(BitHelper.lowByte(Math.round(FC.BATTERY_CONFIG.vbatdetectcellvoltage*100))),i.push(BitHelper.highByte(Math.round(FC.BATTERY_CONFIG.vbatdetectcellvoltage*100))),i.push(BitHelper.lowByte(Math.round(FC.BATTERY_CONFIG.vbatmincellvoltage*100))),i.push(BitHelper.highByte(Math.round(FC.BATTERY_CONFIG.vbatmincellvoltage*100))),i.push(BitHelper.lowByte(Math.round(FC.BATTERY_CONFIG.vbatmaxcellvoltage*100))),i.push(BitHelper.highByte(Math.round(FC.BATTERY_CONFIG.vbatmaxcellvoltage*100))),i.push(BitHelper.lowByte(Math.round(FC.BATTERY_CONFIG.vbatwarningcellvoltage*100))),i.push(BitHelper.highByte(Math.round(FC.BATTERY_CONFIG.vbatwarningcellvoltage*100))),i.push(BitHelper.lowByte(FC.BATTERY_CONFIG.current_offset)),i.push(BitHelper.highByte(FC.BATTERY_CONFIG.current_offset)),i.push(BitHelper.lowByte(FC.BATTERY_CONFIG.current_scale)),i.push(BitHelper.highByte(FC.BATTERY_CONFIG.current_scale));for(let a=0;a<4;++a)i.push(BitHelper.specificByte(FC.BATTERY_CONFIG.capacity,a));for(let a=0;a<4;++a)i.push(BitHelper.specificByte(FC.BATTERY_CONFIG.capacity_warning,a));for(let a=0;a<4;++a)i.push(BitHelper.specificByte(FC.BATTERY_CONFIG.capacity_critical,a));i.push(FC.BATTERY_CONFIG.capacity_unit);break;case MSPCodes.MSP_SET_RX_CONFIG:i.push(FC.RX_CONFIG.serialrx_provider),i.push(BitHelper.lowByte(FC.RX_CONFIG.maxcheck)),i.push(BitHelper.highByte(FC.RX_CONFIG.maxcheck)),i.push(BitHelper.lowByte(FC.RX_CONFIG.midrc)),i.push(BitHelper.highByte(FC.RX_CONFIG.midrc)),i.push(BitHelper.lowByte(FC.RX_CONFIG.mincheck)),i.push(BitHelper.highByte(FC.RX_CONFIG.mincheck)),i.push(FC.RX_CONFIG.spektrum_sat_bind),i.push(BitHelper.lowByte(FC.RX_CONFIG.rx_min_usec)),i.push(BitHelper.highByte(FC.RX_CONFIG.rx_min_usec)),i.push(BitHelper.lowByte(FC.RX_CONFIG.rx_max_usec)),i.push(BitHelper.highByte(FC.RX_CONFIG.rx_max_usec)),i.push(0),i.push(0),i.push(0),i.push(0),i.push(FC.RX_CONFIG.spirx_protocol),i.push32(FC.RX_CONFIG.spirx_id),i.push(FC.RX_CONFIG.spirx_channel_count),i.push(0),i.push(FC.RX_CONFIG.receiver_type);break;case MSPCodes.MSP_SET_FAILSAFE_CONFIG:i.push(FC.FAILSAFE_CONFIG.failsafe_delay),i.push(FC.FAILSAFE_CONFIG.failsafe_off_delay),i.push(BitHelper.lowByte(FC.FAILSAFE_CONFIG.failsafe_throttle)),i.push(BitHelper.highByte(FC.FAILSAFE_CONFIG.failsafe_throttle)),i.push(FC.FAILSAFE_CONFIG.failsafe_kill_switch),i.push(BitHelper.lowByte(FC.FAILSAFE_CONFIG.failsafe_throttle_low_delay)),i.push(BitHelper.highByte(FC.FAILSAFE_CONFIG.failsafe_throttle_low_delay)),i.push(FC.FAILSAFE_CONFIG.failsafe_procedure),i.push(FC.FAILSAFE_CONFIG.failsafe_recovery_delay),i.push(BitHelper.lowByte(FC.FAILSAFE_CONFIG.failsafe_fw_roll_angle)),i.push(BitHelper.highByte(FC.FAILSAFE_CONFIG.failsafe_fw_roll_angle)),i.push(BitHelper.lowByte(FC.FAILSAFE_CONFIG.failsafe_fw_pitch_angle)),i.push(BitHelper.highByte(FC.FAILSAFE_CONFIG.failsafe_fw_pitch_angle)),i.push(BitHelper.lowByte(FC.FAILSAFE_CONFIG.failsafe_fw_yaw_rate)),i.push(BitHelper.highByte(FC.FAILSAFE_CONFIG.failsafe_fw_yaw_rate)),i.push(BitHelper.lowByte(FC.FAILSAFE_CONFIG.failsafe_stick_motion_threshold)),i.push(BitHelper.highByte(FC.FAILSAFE_CONFIG.failsafe_stick_motion_threshold)),i.push(BitHelper.lowByte(FC.FAILSAFE_CONFIG.failsafe_min_distance)),i.push(BitHelper.highByte(FC.FAILSAFE_CONFIG.failsafe_min_distance)),i.push(FC.FAILSAFE_CONFIG.failsafe_min_distance_procedure);break;case MSPCodes.MSP2_SET_CF_SERIAL_CONFIG:console.log("will crunch",FC.SERIAL_CONFIG);for(let a=0;a<FC.SERIAL_CONFIG.ports.length;a++){var s=FC.SERIAL_CONFIG.ports[a];i.push(s.identifier);var r=serialPortHelper.functionsToMask(s.functions);i.push(BitHelper.specificByte(r,0)),i.push(BitHelper.specificByte(r,1)),i.push(BitHelper.specificByte(r,2)),i.push(BitHelper.specificByte(r,3));var o=mspHelper$1.BAUD_RATES_post1_6_3;i.push(o.indexOf(s.msp_baudrate)),i.push(o.indexOf(s.sensors_baudrate)),i.push(o.indexOf(s.telemetry_baudrate)),i.push(o.indexOf(s.peripherals_baudrate))}break;case MSPCodes.MSP_SET_3D:i.push(BitHelper.lowByte(FC.REVERSIBLE_MOTORS.deadband_low)),i.push(BitHelper.highByte(FC.REVERSIBLE_MOTORS.deadband_low)),i.push(BitHelper.lowByte(FC.REVERSIBLE_MOTORS.deadband_high)),i.push(BitHelper.highByte(FC.REVERSIBLE_MOTORS.deadband_high)),i.push(BitHelper.lowByte(FC.REVERSIBLE_MOTORS.neutral)),i.push(BitHelper.highByte(FC.REVERSIBLE_MOTORS.neutral));break;case MSPCodes.MSP_SET_RC_DEADBAND:i.push(FC.RC_deadband.deadband),i.push(FC.RC_deadband.yaw_deadband),i.push(FC.RC_deadband.alt_hold_deadband),i.push(BitHelper.lowByte(FC.REVERSIBLE_MOTORS.deadband_throttle)),i.push(BitHelper.highByte(FC.REVERSIBLE_MOTORS.deadband_throttle));break;case MSPCodes.MSP_SET_SENSOR_ALIGNMENT:i.push(FC.SENSOR_ALIGNMENT.align_gyro),i.push(FC.SENSOR_ALIGNMENT.align_acc),i.push(FC.SENSOR_ALIGNMENT.align_mag),i.push(FC.SENSOR_ALIGNMENT.align_opflow);break;case MSPCodes.MSP_SET_ADVANCED_CONFIG:i.push(FC.ADVANCED_CONFIG.gyroSyncDenominator),i.push(FC.ADVANCED_CONFIG.pidProcessDenom),i.push(FC.ADVANCED_CONFIG.useUnsyncedPwm),i.push(FC.ADVANCED_CONFIG.motorPwmProtocol),i.push(BitHelper.lowByte(FC.ADVANCED_CONFIG.motorPwmRate)),i.push(BitHelper.highByte(FC.ADVANCED_CONFIG.motorPwmRate)),i.push(BitHelper.lowByte(FC.ADVANCED_CONFIG.servoPwmRate)),i.push(BitHelper.highByte(FC.ADVANCED_CONFIG.servoPwmRate)),i.push(FC.ADVANCED_CONFIG.gyroSync);break;case MSPCodes.MSP_SET_INAV_PID:i.push(FC.INAV_PID_CONFIG.asynchronousMode),i.push(BitHelper.lowByte(FC.INAV_PID_CONFIG.accelerometerTaskFrequency)),i.push(BitHelper.highByte(FC.INAV_PID_CONFIG.accelerometerTaskFrequency)),i.push(BitHelper.lowByte(FC.INAV_PID_CONFIG.attitudeTaskFrequency)),i.push(BitHelper.highByte(FC.INAV_PID_CONFIG.attitudeTaskFrequency)),i.push(FC.INAV_PID_CONFIG.magHoldRateLimit),i.push(FC.INAV_PID_CONFIG.magHoldErrorLpfFrequency),i.push(BitHelper.lowByte(FC.INAV_PID_CONFIG.yawJumpPreventionLimit)),i.push(BitHelper.highByte(FC.INAV_PID_CONFIG.yawJumpPreventionLimit)),i.push(FC.INAV_PID_CONFIG.gyroscopeLpf),i.push(FC.INAV_PID_CONFIG.accSoftLpfHz),i.push(0),i.push(0),i.push(0),i.push(0);break;case MSPCodes.MSP_SET_NAV_POSHOLD:i.push(FC.NAV_POSHOLD.userControlMode),i.push(BitHelper.lowByte(FC.NAV_POSHOLD.maxSpeed)),i.push(BitHelper.highByte(FC.NAV_POSHOLD.maxSpeed)),i.push(BitHelper.lowByte(FC.NAV_POSHOLD.maxClimbRate)),i.push(BitHelper.highByte(FC.NAV_POSHOLD.maxClimbRate)),i.push(BitHelper.lowByte(FC.NAV_POSHOLD.maxManualSpeed)),i.push(BitHelper.highByte(FC.NAV_POSHOLD.maxManualSpeed)),i.push(BitHelper.lowByte(FC.NAV_POSHOLD.maxManualClimbRate)),i.push(BitHelper.highByte(FC.NAV_POSHOLD.maxManualClimbRate)),i.push(FC.NAV_POSHOLD.maxBankAngle),i.push(FC.NAV_POSHOLD.useThrottleMidForAlthold),i.push(BitHelper.lowByte(FC.NAV_POSHOLD.hoverThrottle)),i.push(BitHelper.highByte(FC.NAV_POSHOLD.hoverThrottle));break;case MSPCodes.MSP_SET_CALIBRATION_DATA:i.push(BitHelper.lowByte(FC.CALIBRATION_DATA.accZero.X)),i.push(BitHelper.highByte(FC.CALIBRATION_DATA.accZero.X)),i.push(BitHelper.lowByte(FC.CALIBRATION_DATA.accZero.Y)),i.push(BitHelper.highByte(FC.CALIBRATION_DATA.accZero.Y)),i.push(BitHelper.lowByte(FC.CALIBRATION_DATA.accZero.Z)),i.push(BitHelper.highByte(FC.CALIBRATION_DATA.accZero.Z)),i.push(BitHelper.lowByte(FC.CALIBRATION_DATA.accGain.X)),i.push(BitHelper.highByte(FC.CALIBRATION_DATA.accGain.X)),i.push(BitHelper.lowByte(FC.CALIBRATION_DATA.accGain.Y)),i.push(BitHelper.highByte(FC.CALIBRATION_DATA.accGain.Y)),i.push(BitHelper.lowByte(FC.CALIBRATION_DATA.accGain.Z)),i.push(BitHelper.highByte(FC.CALIBRATION_DATA.accGain.Z)),i.push(BitHelper.lowByte(FC.CALIBRATION_DATA.magZero.X)),i.push(BitHelper.highByte(FC.CALIBRATION_DATA.magZero.X)),i.push(BitHelper.lowByte(FC.CALIBRATION_DATA.magZero.Y)),i.push(BitHelper.highByte(FC.CALIBRATION_DATA.magZero.Y)),i.push(BitHelper.lowByte(FC.CALIBRATION_DATA.magZero.Z)),i.push(BitHelper.highByte(FC.CALIBRATION_DATA.magZero.Z)),i.push(BitHelper.lowByte(Math.round(FC.CALIBRATION_DATA.opflow.Scale*256))),i.push(BitHelper.highByte(Math.round(FC.CALIBRATION_DATA.opflow.Scale*256))),i.push(BitHelper.lowByte(FC.CALIBRATION_DATA.magGain.X)),i.push(BitHelper.highByte(FC.CALIBRATION_DATA.magGain.X)),i.push(BitHelper.lowByte(FC.CALIBRATION_DATA.magGain.Y)),i.push(BitHelper.highByte(FC.CALIBRATION_DATA.magGain.Y)),i.push(BitHelper.lowByte(FC.CALIBRATION_DATA.magGain.Z)),i.push(BitHelper.highByte(FC.CALIBRATION_DATA.magGain.Z));break;case MSPCodes.MSP_SET_RTH_AND_LAND_CONFIG:i.push(BitHelper.lowByte(FC.RTH_AND_LAND_CONFIG.minRthDistance)),i.push(BitHelper.highByte(FC.RTH_AND_LAND_CONFIG.minRthDistance)),i.push(FC.RTH_AND_LAND_CONFIG.rthClimbFirst),i.push(FC.RTH_AND_LAND_CONFIG.rthClimbIgnoreEmergency),i.push(FC.RTH_AND_LAND_CONFIG.rthTailFirst),i.push(FC.RTH_AND_LAND_CONFIG.rthAllowLanding),i.push(FC.RTH_AND_LAND_CONFIG.rthAltControlMode),i.push(BitHelper.lowByte(FC.RTH_AND_LAND_CONFIG.rthAbortThreshold)),i.push(BitHelper.highByte(FC.RTH_AND_LAND_CONFIG.rthAbortThreshold)),i.push(BitHelper.lowByte(FC.RTH_AND_LAND_CONFIG.rthAltitude)),i.push(BitHelper.highByte(FC.RTH_AND_LAND_CONFIG.rthAltitude)),i.push(BitHelper.lowByte(FC.RTH_AND_LAND_CONFIG.landMinAltVspd)),i.push(BitHelper.highByte(FC.RTH_AND_LAND_CONFIG.landMinAltVspd)),i.push(BitHelper.lowByte(FC.RTH_AND_LAND_CONFIG.landMaxAltVspd)),i.push(BitHelper.highByte(FC.RTH_AND_LAND_CONFIG.landMaxAltVspd)),i.push(BitHelper.lowByte(FC.RTH_AND_LAND_CONFIG.landSlowdownMinAlt)),i.push(BitHelper.highByte(FC.RTH_AND_LAND_CONFIG.landSlowdownMinAlt)),i.push(BitHelper.lowByte(FC.RTH_AND_LAND_CONFIG.landSlowdownMaxAlt)),i.push(BitHelper.highByte(FC.RTH_AND_LAND_CONFIG.landSlowdownMaxAlt)),i.push(BitHelper.lowByte(FC.RTH_AND_LAND_CONFIG.emergencyDescentRate)),i.push(BitHelper.highByte(FC.RTH_AND_LAND_CONFIG.emergencyDescentRate));break;case MSPCodes.MSP_SET_FW_CONFIG:i.push(BitHelper.lowByte(FC.FW_CONFIG.cruiseThrottle)),i.push(BitHelper.highByte(FC.FW_CONFIG.cruiseThrottle)),i.push(BitHelper.lowByte(FC.FW_CONFIG.minThrottle)),i.push(BitHelper.highByte(FC.FW_CONFIG.minThrottle)),i.push(BitHelper.lowByte(FC.FW_CONFIG.maxThrottle)),i.push(BitHelper.highByte(FC.FW_CONFIG.maxThrottle)),i.push(FC.FW_CONFIG.maxBankAngle),i.push(FC.FW_CONFIG.maxClimbAngle),i.push(FC.FW_CONFIG.maxDiveAngle),i.push(FC.FW_CONFIG.pitchToThrottle),i.push(BitHelper.lowByte(FC.FW_CONFIG.loiterRadius)),i.push(BitHelper.highByte(FC.FW_CONFIG.loiterRadius));break;case MSPCodes.MSP_SET_FILTER_CONFIG:i.push(FC.FILTER_CONFIG.gyroSoftLpfHz),i.push(BitHelper.lowByte(FC.FILTER_CONFIG.dtermLpfHz)),i.push(BitHelper.highByte(FC.FILTER_CONFIG.dtermLpfHz)),i.push(BitHelper.lowByte(FC.FILTER_CONFIG.yawLpfHz)),i.push(BitHelper.highByte(FC.FILTER_CONFIG.yawLpfHz)),i.push(BitHelper.lowByte(FC.FILTER_CONFIG.gyroNotchHz1)),i.push(BitHelper.highByte(FC.FILTER_CONFIG.gyroNotchHz1)),i.push(BitHelper.lowByte(FC.FILTER_CONFIG.gyroNotchCutoff1)),i.push(BitHelper.highByte(FC.FILTER_CONFIG.gyroNotchCutoff1)),i.push(BitHelper.lowByte(FC.FILTER_CONFIG.dtermNotchHz)),i.push(BitHelper.highByte(FC.FILTER_CONFIG.dtermNotchHz)),i.push(BitHelper.lowByte(FC.FILTER_CONFIG.dtermNotchCutoff)),i.push(BitHelper.highByte(FC.FILTER_CONFIG.dtermNotchCutoff)),i.push(BitHelper.lowByte(FC.FILTER_CONFIG.gyroNotchHz2)),i.push(BitHelper.highByte(FC.FILTER_CONFIG.gyroNotchHz2)),i.push(BitHelper.lowByte(FC.FILTER_CONFIG.gyroNotchCutoff2)),i.push(BitHelper.highByte(FC.FILTER_CONFIG.gyroNotchCutoff2)),i.push(BitHelper.lowByte(FC.FILTER_CONFIG.accNotchHz)),i.push(BitHelper.highByte(FC.FILTER_CONFIG.accNotchHz)),i.push(BitHelper.lowByte(FC.FILTER_CONFIG.accNotchCutoff)),i.push(BitHelper.highByte(FC.FILTER_CONFIG.accNotchCutoff)),i.push(BitHelper.lowByte(FC.FILTER_CONFIG.gyroStage2LowpassHz)),i.push(BitHelper.highByte(FC.FILTER_CONFIG.gyroStage2LowpassHz));break;case MSPCodes.MSP_SET_PID_ADVANCED:i.push(BitHelper.lowByte(FC.PID_ADVANCED.rollPitchItermIgnoreRate)),i.push(BitHelper.highByte(FC.PID_ADVANCED.rollPitchItermIgnoreRate)),i.push(BitHelper.lowByte(FC.PID_ADVANCED.yawItermIgnoreRate)),i.push(BitHelper.highByte(FC.PID_ADVANCED.yawItermIgnoreRate)),i.push(BitHelper.lowByte(FC.PID_ADVANCED.yawPLimit)),i.push(BitHelper.highByte(FC.PID_ADVANCED.yawPLimit)),i.push(0),i.push(0),i.push(0),i.push(FC.PID_ADVANCED.dtermSetpointWeight),i.push(BitHelper.lowByte(FC.PID_ADVANCED.pidSumLimit)),i.push(BitHelper.highByte(FC.PID_ADVANCED.pidSumLimit)),i.push(0),i.push(BitHelper.lowByte(FC.PID_ADVANCED.axisAccelerationLimitRollPitch)),i.push(BitHelper.highByte(FC.PID_ADVANCED.axisAccelerationLimitRollPitch)),i.push(BitHelper.lowByte(FC.PID_ADVANCED.axisAccelerationLimitYaw)),i.push(BitHelper.highByte(FC.PID_ADVANCED.axisAccelerationLimitYaw));break;case MSPCodes.MSP_SET_SENSOR_CONFIG:i.push(FC.SENSOR_CONFIG.accelerometer),i.push(FC.SENSOR_CONFIG.barometer),i.push(FC.SENSOR_CONFIG.magnetometer),i.push(FC.SENSOR_CONFIG.pitot),i.push(FC.SENSOR_CONFIG.rangefinder),i.push(FC.SENSOR_CONFIG.opflow);break;case MSPCodes.MSP_WP_MISSION_SAVE:i.push(0);break;case MSPCodes.MSP_WP_MISSION_LOAD:i.push(0);break;case MSPCodes.MSP2_INAV_SET_MIXER:i.push(FC.MIXER_CONFIG.yawMotorDirection),i.push(FC.MIXER_CONFIG.yawJumpPreventionLimit),i.push(FC.MIXER_CONFIG.motorStopOnLow),i.push(FC.MIXER_CONFIG.platformType),i.push(FC.MIXER_CONFIG.hasFlaps),i.push(BitHelper.lowByte(FC.MIXER_CONFIG.appliedMixerPreset)),i.push(BitHelper.highByte(FC.MIXER_CONFIG.appliedMixerPreset)),i.push(0),i.push(0);break;case MSPCodes.MSP2_INAV_SET_MC_BRAKING:i.push(BitHelper.lowByte(FC.BRAKING_CONFIG.speedThreshold)),i.push(BitHelper.highByte(FC.BRAKING_CONFIG.speedThreshold)),i.push(BitHelper.lowByte(FC.BRAKING_CONFIG.disengageSpeed)),i.push(BitHelper.highByte(FC.BRAKING_CONFIG.disengageSpeed)),i.push(BitHelper.lowByte(FC.BRAKING_CONFIG.timeout)),i.push(BitHelper.highByte(FC.BRAKING_CONFIG.timeout)),i.push(FC.BRAKING_CONFIG.boostFactor),i.push(BitHelper.lowByte(FC.BRAKING_CONFIG.boostTimeout)),i.push(BitHelper.highByte(FC.BRAKING_CONFIG.boostTimeout)),i.push(BitHelper.lowByte(FC.BRAKING_CONFIG.boostSpeedThreshold)),i.push(BitHelper.highByte(FC.BRAKING_CONFIG.boostSpeedThreshold)),i.push(BitHelper.lowByte(FC.BRAKING_CONFIG.boostDisengageSpeed)),i.push(BitHelper.highByte(FC.BRAKING_CONFIG.boostDisengageSpeed)),i.push(FC.BRAKING_CONFIG.bankAngle);break;case MSPCodes.MSP2_INAV_SET_RATE_DYNAMICS:i.push(FC.RATE_DYNAMICS.sensitivityCenter),i.push(FC.RATE_DYNAMICS.sensitivityEnd),i.push(FC.RATE_DYNAMICS.correctionCenter),i.push(FC.RATE_DYNAMICS.correctionEnd),i.push(FC.RATE_DYNAMICS.weightCenter),i.push(FC.RATE_DYNAMICS.weightEnd);break;case MSPCodes.MSP2_INAV_EZ_TUNE_SET:i.push(FC.EZ_TUNE.enabled),i.push(BitHelper.lowByte(FC.EZ_TUNE.filterHz)),i.push(BitHelper.highByte(FC.EZ_TUNE.filterHz)),i.push(FC.EZ_TUNE.axisRatio),i.push(FC.EZ_TUNE.response),i.push(FC.EZ_TUNE.damping),i.push(FC.EZ_TUNE.stability),i.push(FC.EZ_TUNE.aggressiveness),i.push(FC.EZ_TUNE.rate),i.push(FC.EZ_TUNE.expo),i.push(FC.EZ_TUNE.snappiness);break;default:return!1}return i},n.setRawRx=function(t){for(var i=[],s=0;s<t.length;s++)i.push(BitHelper.specificByte(t[s],0)),i.push(BitHelper.specificByte(t[s],1));MSP.send_message(MSPCodes.MSP_SET_RAW_RC,i,!1)},n.sendBlackboxConfiguration=function(t){var i=[],s=MSPCodes.MSP_SET_BLACKBOX_CONFIG;i.push(FC.BLACKBOX.blackboxDevice&255),s=MSPCodes.MSP2_SET_BLACKBOX_CONFIG,i.push(BitHelper.lowByte(FC.BLACKBOX.blackboxRateNum)),i.push(BitHelper.highByte(FC.BLACKBOX.blackboxRateNum)),i.push(BitHelper.lowByte(FC.BLACKBOX.blackboxRateDenom)),i.push(BitHelper.highByte(FC.BLACKBOX.blackboxRateDenom)),i.push32(FC.BLACKBOX.blackboxIncludeFlags),MSP.send_message(s,i,!1,function(r){t()})},n.sendServoConfigurations=function(t){var i=r,s=0;FC.SERVO_CONFIG.length==0?t():i();function r(){var o=[],a=FC.SERVO_CONFIG[s];o.push(s),o.push(BitHelper.lowByte(a.min)),o.push(BitHelper.highByte(a.min)),o.push(BitHelper.lowByte(a.max)),o.push(BitHelper.highByte(a.max)),o.push(BitHelper.lowByte(a.middle)),o.push(BitHelper.highByte(a.middle)),o.push(BitHelper.lowByte(a.rate)),s++,s==FC.SERVO_CONFIG.length&&(i=t),MSP.send_message(MSPCodes.MSP2_INAV_SET_SERVO_CONFIG,o,!1,i)}},n.sendServoMixer=function(t){var i=r,s=0;FC.SERVO_RULES.length==0?t():i();function r(){var o=[],a=FC.SERVO_RULES.get()[s];o.push(s),o.push(a.getTarget()),o.push(a.getInput()),o.push(BitHelper.lowByte(a.getRate())),o.push(BitHelper.highByte(a.getRate())),o.push(a.getSpeed()),o.push(a.getConditionId()),s++,s==FC.SERVO_RULES.getServoRulesCount()&&(i=t),MSP.send_message(MSPCodes.MSP2_INAV_SET_SERVO_MIXER,o,!1,i)}},n.sendMotorMixer=function(t){var i=r,s=0;FC.MOTOR_RULES.length===0?t():i();function r(){var o=[],a=FC.MOTOR_RULES.get()[s];a?(o.push(s),o.push(BitHelper.lowByte(a.getThrottleForMsp())),o.push(BitHelper.highByte(a.getThrottleForMsp())),o.push(BitHelper.lowByte(a.getRollForMsp())),o.push(BitHelper.highByte(a.getRollForMsp())),o.push(BitHelper.lowByte(a.getPitchForMsp())),o.push(BitHelper.highByte(a.getPitchForMsp())),o.push(BitHelper.lowByte(a.getYawForMsp())),o.push(BitHelper.highByte(a.getYawForMsp())),s++,s==FC.MOTOR_RULES.getMotorCount()&&(i=t),MSP.send_message(MSPCodes.MSP2_COMMON_SET_MOTOR_MIXER,o,!1,i)):t()}},n.loadLogicConditions=function(t){if(semver.gte(FC.CONFIG.flightControllerVersion,"5.0.0")){let s=function(){i++,i<FC.LOGIC_CONDITIONS.getMaxLogicConditionCount()-1?MSP.send_message(MSPCodes.MSP2_INAV_LOGIC_CONDITIONS_SINGLE,[i],!1,s):MSP.send_message(MSPCodes.MSP2_INAV_LOGIC_CONDITIONS_SINGLE,[i],!1,t)};FC.LOGIC_CONDITIONS.flush();let i=0;MSP.send_message(MSPCodes.MSP2_INAV_LOGIC_CONDITIONS_SINGLE,[i],!1,s)}else MSP.send_message(MSPCodes.MSP2_INAV_LOGIC_CONDITIONS,!1,!1,t)},n.sendLogicConditions=function(t){let i=r,s=0;FC.LOGIC_CONDITIONS.getCount()==0?t():i();function r(){let o=[],a=FC.LOGIC_CONDITIONS.get()[s];o.push(s),o.push(a.getEnabled()),o.push(a.getActivatorId()),o.push(a.getOperation()),o.push(a.getOperandAType()),o.push(BitHelper.specificByte(a.getOperandAValue(),0)),o.push(BitHelper.specificByte(a.getOperandAValue(),1)),o.push(BitHelper.specificByte(a.getOperandAValue(),2)),o.push(BitHelper.specificByte(a.getOperandAValue(),3)),o.push(a.getOperandBType()),o.push(BitHelper.specificByte(a.getOperandBValue(),0)),o.push(BitHelper.specificByte(a.getOperandBValue(),1)),o.push(BitHelper.specificByte(a.getOperandBValue(),2)),o.push(BitHelper.specificByte(a.getOperandBValue(),3)),o.push(a.getFlags()),s++,s==FC.LOGIC_CONDITIONS.getCount()&&(i=t),MSP.send_message(MSPCodes.MSP2_INAV_SET_LOGIC_CONDITIONS,o,!1,i)}},n.loadProgrammingPid=function(t){MSP.send_message(MSPCodes.MSP2_INAV_PROGRAMMING_PID,!1,!1,t)},n.sendProgrammingPid=function(t){let i=r,s=0;FC.PROGRAMMING_PID.getCount()==0?t():i();function r(){let o=[],a=FC.PROGRAMMING_PID.get()[s];o.push(s),o.push(a.getEnabled()),o.push(a.getSetpointType()),o.push(BitHelper.specificByte(a.getSetpointValue(),0)),o.push(BitHelper.specificByte(a.getSetpointValue(),1)),o.push(BitHelper.specificByte(a.getSetpointValue(),2)),o.push(BitHelper.specificByte(a.getSetpointValue(),3)),o.push(a.getMeasurementType()),o.push(BitHelper.specificByte(a.getMeasurementValue(),0)),o.push(BitHelper.specificByte(a.getMeasurementValue(),1)),o.push(BitHelper.specificByte(a.getMeasurementValue(),2)),o.push(BitHelper.specificByte(a.getMeasurementValue(),3)),o.push(BitHelper.specificByte(a.getGainP(),0)),o.push(BitHelper.specificByte(a.getGainP(),1)),o.push(BitHelper.specificByte(a.getGainI(),0)),o.push(BitHelper.specificByte(a.getGainI(),1)),o.push(BitHelper.specificByte(a.getGainD(),0)),o.push(BitHelper.specificByte(a.getGainD(),1)),o.push(BitHelper.specificByte(a.getGainFF(),0)),o.push(BitHelper.specificByte(a.getGainFF(),1)),s++,s==FC.PROGRAMMING_PID.getCount()&&(i=t),MSP.send_message(MSPCodes.MSP2_INAV_SET_PROGRAMMING_PID,o,!1,i)}},n.loadOsdCustomElements=function(t){MSP.send_message(MSPCodes.MSP2_INAV_CUSTOM_OSD_ELEMENTS,!1,!1,s);var i=0;function s(){i<FC.OSD_CUSTOM_ELEMENTS.settings.customElementsCount-1?MSP.send_message(MSPCodes.MSP2_INAV_CUSTOM_OSD_ELEMENT,[i++],!1,s):MSP.send_message(MSPCodes.MSP2_INAV_CUSTOM_OSD_ELEMENT,[i++],!1,t)}},n.sendModeRanges=function(t){var i=r,s=0;FC.MODE_RANGES.length==0?t():r();function r(){var o=FC.MODE_RANGES[s],a=[];a.push(s),a.push(o.id),a.push(o.auxChannelIndex),a.push((o.range.start-900)/25),a.push((o.range.end-900)/25),s++,s==FC.MODE_RANGES.length&&(i=t),MSP.send_message(MSPCodes.MSP_SET_MODE_RANGE,a,!1,i)}},n.dataflashRead=function(t,i){var s=[];s.push(t&255),s.push(t>>8&255),s.push(t>>16&255),s.push(t>>24&255),FC.CONFIG.apiVersion&&semver.gte(FC.CONFIG.apiVersion,"2.0.0")&&(s.push(BitHelper.lowByte(4096)),s.push(BitHelper.highByte(4096))),MSP.send_message(MSPCodes.MSP_DATAFLASH_READ,s,!1,function(r){var o=r.data.getUint32(0,1);o==t?i(t,r.data.buffer.slice(4)):i(t,null)})},n.sendServoMixRules=function(t){t()},n.sendAdjustmentRanges=function(t){var i=r,s=0;FC.ADJUSTMENT_RANGES.length==0?t():r();function r(){var o=FC.ADJUSTMENT_RANGES[s],a=[];a.push(s),a.push(o.slotIndex),a.push(o.auxChannelIndex),a.push((o.range.start-900)/25),a.push((o.range.end-900)/25),a.push(o.adjustmentFunction),a.push(o.auxSwitchChannelIndex),s++,s==FC.ADJUSTMENT_RANGES.length&&(i=t),MSP.send_message(MSPCodes.MSP_SET_ADJUSTMENT_RANGE,a,!1,i)}},n.sendLedStripColors=function(t){if(FC.LED_COLORS.length==0)t();else{for(var i=[],s=0;s<FC.LED_COLORS.length;s++){var r=FC.LED_COLORS[s];i.push(BitHelper.specificByte(r.h,0)),i.push(BitHelper.specificByte(r.h,1)),i.push(r.s),i.push(r.v)}MSP.send_message(MSPCodes.MSP_SET_LED_COLORS,i,!1,t)}},n.sendLedStripConfig=function(t){var i=r,s=0;FC.LED_STRIP.length==0?t():r();function r(){var o=FC.LED_STRIP[s],a=[],h,c,d;a.push(s);var f=0,_=0;for(f|=o.y<<0,f|=o.x<<4,c=0;c<o.functions.length;c++){var y=MSP.ledBaseFunctionLetters.indexOf(o.functions[c]);if(y>=0){f|=y<<8;break}}for(var S=0;S<o.functions.length;S++)d=MSP.ledOverlayLetters.indexOf(o.functions[S]),d>=0&&(f|=BitHelper.bit_set(f,d+16));for(f|=o.color<<24,h=0;h<o.directions.length;h++)d=MSP.ledDirectionLetters.indexOf(o.directions[h]),d>=0&&(d<4?f|=BitHelper.bit_set(f,d+28):_|=BitHelper.bit_set(_,d-4));_|=0,a.push(BitHelper.specificByte(f,0)),a.push(BitHelper.specificByte(f,1)),a.push(BitHelper.specificByte(f,2)),a.push(BitHelper.specificByte(f,3)),a.push(BitHelper.specificByte(_,0)),s++,s==FC.LED_STRIP.length&&(i=t),MSP.send_message(MSPCodes.MSP2_INAV_SET_LED_STRIP_CONFIG_EX,a,!1,i)}},n.sendLedStripModeColors=function(t){var i=r,s=0;FC.LED_MODE_COLORS.length==0?t():r();function r(){var o=[],a=FC.LED_MODE_COLORS[s];o.push(a.mode),o.push(a.direction),o.push(a.color),s++,s==FC.LED_MODE_COLORS.length&&(i=t),MSP.send_message(MSPCodes.MSP_SET_LED_STRIP_MODECOLOR,o,!1,i)}},n.loadINAVPidConfig=function(t){MSP.send_message(MSPCodes.MSP_INAV_PID,!1,!1,t)},n.loadAdvancedConfig=function(t){MSP.send_message(MSPCodes.MSP_ADVANCED_CONFIG,!1,!1,t)},n.loadFilterConfig=function(t){MSP.send_message(MSPCodes.MSP_FILTER_CONFIG,!1,!1,t)},n.loadPidAdvanced=function(t){MSP.send_message(MSPCodes.MSP_PID_ADVANCED,!1,!1,t)},n.loadRcTuningData=function(t){MSP.send_message(MSPCodes.MSP_RC_TUNING,!1,!1,t)},n.loadRateProfileData=function(t){MSP.send_message(MSPCodes.MSPV2_INAV_RATE_PROFILE,!1,!1,t)},n.loadPidData=function(t){MSP.send_message(MSPCodes.MSP2_PID,!1,!1,t)},n.loadPidNames=function(t){MSP.send_message(MSPCodes.MSP_PIDNAMES,!1,!1,t)},n.loadFeatures=function(t){MSP.send_message(MSPCodes.MSP_FEATURE,!1,!1,t)},n.loadBoardAlignment=function(t){MSP.send_message(MSPCodes.MSP_BOARD_ALIGNMENT,!1,!1,t)},n.loadCurrentMeterConfig=function(t){MSP.send_message(MSPCodes.MSP_CURRENT_METER_CONFIG,!1,!1,t)},n.queryFcStatus=function(t){MSP.send_message(MSPCodes.MSPV2_INAV_STATUS,!1,!1,t)},n.loadMiscV2=function(t){MSP.send_message(MSPCodes.MSPV2_INAV_MISC,!1,!1,t)},n.loadOutputMapping=function(t){console.warn("Warning: self.loadOutputMapping is obsolete and may be removed in future versions. Please update usage."),MSP.send_message(MSPCodes.MSPV2_INAV_OUTPUT_MAPPING,!1,!1,t)},n.loadOutputMappingExt=function(t){MSP.send_message(MSPCodes.MSPV2_INAV_OUTPUT_MAPPING_EXT2,!1,!1,t)},n.loadTimerOutputModes=function(t){MSP.send_message(MSPCodes.MSP2_INAV_TIMER_OUTPUT_MODE,!1,!1,t)},n.sendTimerOutputModes=function(t){var i=o,s=0,r=FC.OUTPUT_MAPPING.getUsedTimerIds();r.length==0?t():o();function o(){var a=r[s],h=FC.OUTPUT_MAPPING.getTimerOverride(a),c=[];c.push(a),c.push(h),s++,s==r.length&&(i=t),MSP.send_message(MSPCodes.MSP2_INAV_SET_TIMER_OUTPUT_MODE,c,!1,i)}},n.loadBatteryConfig=function(t){MSP.send_message(MSPCodes.MSPV2_BATTERY_CONFIG,!1,!1,t)},n.loadRxConfig=function(t){MSP.send_message(MSPCodes.MSP_RX_CONFIG,!1,!1,t)},n.load3dConfig=function(t){MSP.send_message(MSPCodes.MSP_3D,!1,!1,t)},n.loadSensorAlignment=function(t){MSP.send_message(MSPCodes.MSP_SENSOR_ALIGNMENT,!1,!1,t)},n.loadSensorConfig=function(t){MSP.send_message(MSPCodes.MSP_SENSOR_CONFIG,!1,!1,t)},n.loadSensorStatus=function(t){MSP.send_message(MSPCodes.MSP_SENSOR_STATUS,!1,!1,t)},n.loadRcDeadband=function(t){MSP.send_message(MSPCodes.MSP_RC_DEADBAND,!1,!1,t)},n.loadRcMap=function(t){MSP.send_message(MSPCodes.MSP_RX_MAP,!1,!1,t)},n.loadRcData=function(t){MSP.send_message(MSPCodes.MSP_RC,!1,!1,t)},n.loadAccTrim=function(t){MSP.send_message(MSPCodes.MSP_ACC_TRIM,!1,!1,t)},n.saveToEeprom=function(i){MSP.send_message(MSPCodes.MSP_EEPROM_WRITE,!1,!1,i)},n.saveINAVPidConfig=function(t){MSP.send_message(MSPCodes.MSP_SET_INAV_PID,mspHelper$1.crunch(MSPCodes.MSP_SET_INAV_PID),!1,t)},n.saveAdvancedConfig=function(t){MSP.send_message(MSPCodes.MSP_SET_ADVANCED_CONFIG,mspHelper$1.crunch(MSPCodes.MSP_SET_ADVANCED_CONFIG),!1,t)},n.saveFilterConfig=function(t){MSP.send_message(MSPCodes.MSP_SET_FILTER_CONFIG,mspHelper$1.crunch(MSPCodes.MSP_SET_FILTER_CONFIG),!1,t)},n.savePidData=function(t){MSP.send_message(MSPCodes.MSP2_SET_PID,mspHelper$1.crunch(MSPCodes.MSP2_SET_PID),!1,t)},n.saveRcTuningData=function(t){MSP.send_message(MSPCodes.MSP_SET_RC_TUNING,mspHelper$1.crunch(MSPCodes.MSP_SET_RC_TUNING),!1,t)},n.saveRateProfileData=function(t){MSP.send_message(MSPCodes.MSPV2_INAV_SET_RATE_PROFILE,mspHelper$1.crunch(MSPCodes.MSPV2_INAV_SET_RATE_PROFILE),!1,t)},n.savePidAdvanced=function(t){MSP.send_message(MSPCodes.MSP_SET_PID_ADVANCED,mspHelper$1.crunch(MSPCodes.MSP_SET_PID_ADVANCED),!1,t)},n.saveFeatures=function(t){MSP.send_message(MSPCodes.MSP_SET_FEATURE,mspHelper$1.crunch(MSPCodes.MSP_SET_FEATURE),!1,t)},n.saveCurrentMeterConfig=function(t){MSP.send_message(MSPCodes.MSP_SET_CURRENT_METER_CONFIG,mspHelper$1.crunch(MSPCodes.MSP_SET_CURRENT_METER_CONFIG),!1,t)},n.saveBoardAlignment=function(t){MSP.send_message(MSPCodes.MSP_SET_BOARD_ALIGNMENT,mspHelper$1.crunch(MSPCodes.MSP_SET_BOARD_ALIGNMENT),!1,t)},n.saveMiscV2=function(t){MSP.send_message(MSPCodes.MSPV2_INAV_SET_MISC,mspHelper$1.crunch(MSPCodes.MSPV2_INAV_SET_MISC),!1,t)},n.saveBatteryConfig=function(t){MSP.send_message(MSPCodes.MSPV2_SET_BATTERY_CONFIG,mspHelper$1.crunch(MSPCodes.MSPV2_SET_BATTERY_CONFIG),!1,t)},n.save3dConfig=function(t){MSP.send_message(MSPCodes.MSP_SET_3D,mspHelper$1.crunch(MSPCodes.MSP_SET_3D),!1,t)},n.saveSensorAlignment=function(t){MSP.send_message(MSPCodes.MSP_SET_SENSOR_ALIGNMENT,mspHelper$1.crunch(MSPCodes.MSP_SET_SENSOR_ALIGNMENT),!1,t)},n.saveAccTrim=function(t){MSP.send_message(MSPCodes.MSP_SET_ACC_TRIM,mspHelper$1.crunch(MSPCodes.MSP_SET_ACC_TRIM),!1,t)},n.saveRxConfig=function(t){MSP.send_message(MSPCodes.MSP_SET_RX_CONFIG,mspHelper$1.crunch(MSPCodes.MSP_SET_RX_CONFIG),!1,t)},n.saveSensorConfig=function(t){MSP.send_message(MSPCodes.MSP_SET_SENSOR_CONFIG,mspHelper$1.crunch(MSPCodes.MSP_SET_SENSOR_CONFIG),!1,t)},n.loadNavPosholdConfig=function(t){MSP.send_message(MSPCodes.MSP_NAV_POSHOLD,!1,!1,t)},n.saveNavPosholdConfig=function(t){MSP.send_message(MSPCodes.MSP_SET_NAV_POSHOLD,mspHelper$1.crunch(MSPCodes.MSP_SET_NAV_POSHOLD),!1,t)},n.loadCalibrationData=function(t){MSP.send_message(MSPCodes.MSP_CALIBRATION_DATA,!1,!1,t)},n.saveCalibrationData=function(t){MSP.send_message(MSPCodes.MSP_SET_CALIBRATION_DATA,mspHelper$1.crunch(MSPCodes.MSP_SET_CALIBRATION_DATA),!1,t)},n.loadRthAndLandConfig=function(t){MSP.send_message(MSPCodes.MSP_RTH_AND_LAND_CONFIG,!1,!1,t)},n.saveRthAndLandConfig=function(t){MSP.send_message(MSPCodes.MSP_SET_RTH_AND_LAND_CONFIG,mspHelper$1.crunch(MSPCodes.MSP_SET_RTH_AND_LAND_CONFIG),!1,t)},n.loadFwConfig=function(t){MSP.send_message(MSPCodes.MSP_FW_CONFIG,!1,!1,t)},n.saveFwConfig=function(t){MSP.send_message(MSPCodes.MSP_SET_FW_CONFIG,mspHelper$1.crunch(MSPCodes.MSP_SET_FW_CONFIG),!1,t)},n.getMissionInfo=function(t){MSP.send_message(MSPCodes.MSP_WP_GETINFO,!1,!1,t)},n.loadWaypoints=function(t){FC.MISSION_PLANNER.reinit();let i=0;new Date().getTime(),MSP.send_message(MSPCodes.MSP_WP_GETINFO,!1,!1,s);function s(){i++,i<FC.MISSION_PLANNER.getCountBusyPoints()?MSP.send_message(MSPCodes.MSP_WP,[i],!1,s):MSP.send_message(MSPCodes.MSP_WP,[i],!1,t)}},n.saveWaypoints=function(t){let i=0;new Date().getTime(),s();function s(){i++,i<FC.MISSION_PLANNER.get().length?MSP.send_message(MSPCodes.MSP_SET_WP,FC.MISSION_PLANNER.extractBuffer(i),!1,s):MSP.send_message(MSPCodes.MSP_SET_WP,FC.MISSION_PLANNER.extractBuffer(i),!1,r)}function r(){MSP.send_message(MSPCodes.MSP_WP_GETINFO,!1,!1,t)}},n.loadSafehomes=function(t){FC.SAFEHOMES.flush();let i=0;MSP.send_message(MSPCodes.MSP2_INAV_SAFEHOME,[i],!1,s);function s(){i++,i<FC.SAFEHOMES.getMaxSafehomeCount()-1?MSP.send_message(MSPCodes.MSP2_INAV_SAFEHOME,[i],!1,s):MSP.send_message(MSPCodes.MSP2_INAV_SAFEHOME,[i],!1,t)}},n.saveSafehomes=function(t){let i=0;MSP.send_message(MSPCodes.MSP2_INAV_SET_SAFEHOME,FC.SAFEHOMES.extractBuffer(i),!1,s);function s(){i++,i<FC.SAFEHOMES.getMaxSafehomeCount()-1?MSP.send_message(MSPCodes.MSP2_INAV_SET_SAFEHOME,FC.SAFEHOMES.extractBuffer(i),!1,s):MSP.send_message(MSPCodes.MSP2_INAV_SET_SAFEHOME,FC.SAFEHOMES.extractBuffer(i),!1,t)}},n.loadFwApproach=function(t){FC.FW_APPROACH.flush();let i=0;MSP.send_message(MSPCodes.MSP2_INAV_FW_APPROACH,[i],!1,s);function s(){i++,i<FC.FW_APPROACH.getMaxFwApproachCount()-1?MSP.send_message(MSPCodes.MSP2_INAV_FW_APPROACH,[i],!1,s):MSP.send_message(MSPCodes.MSP2_INAV_FW_APPROACH,[i],!1,t)}},n.saveFwApproach=function(t){let i=0;MSP.send_message(MSPCodes.MSP2_INAV_SET_FW_APPROACH,FC.FW_APPROACH.extractBuffer(i),!1,s);function s(){i++,i<FC.FW_APPROACH.getMaxFwApproachCount()-1?MSP.send_message(MSPCodes.MSP2_INAV_SET_FW_APPROACH,FC.FW_APPROACH.extractBuffer(i),!1,s):MSP.send_message(MSPCodes.MSP2_INAV_SET_FW_APPROACH,FC.FW_APPROACH.extractBuffer(i),!1,t)}},n.loadGeozones=function(t){FC.GEOZONES.flush();let i=-1,s=-1;o();function r(){s++;let a=FC.GEOZONES.at(i);if(!a||a.getVerticesCount()==0){o();return}s<FC.GEOZONES.at(i).getVerticesCount()&&a.getShape()==GeozoneShapes.POLYGON?MSP.send_message(MSPCodes.MSP2_INAV_GEOZONE_VERTEX,[i,s],!1,r):MSP.send_message(MSPCodes.MSP2_INAV_GEOZONE_VERTEX,[i,s],!1,o)}function o(){i++,s=-1,i<FC.GEOZONES.getMaxZones()?MSP.send_message(MSPCodes.MSP2_INAV_GEOZONE,[i],!1,r):MSP.send_message(MSPCodes.MSP2_INAV_GEOZONE,[i],!1,t)}},n.saveGeozones=function(t){let i=-1,s=-1;o();function r(){s++;let a=FC.GEOZONES.at(i);if(!a||a.getVerticesCount()==0){o();return}s<FC.GEOZONES.at(i).getVerticesCount()-1?MSP.send_message(MSPCodes.MSP2_INAV_SET_GEOZONE_VERTICE,FC.GEOZONES.extractBufferVertices(i,s),!1,r):MSP.send_message(MSPCodes.MSP2_INAV_SET_GEOZONE_VERTICE,FC.GEOZONES.extractBufferVertices(i,s),!1,o)}function o(){i++,s=-1,i<FC.GEOZONES.getMaxZones()?MSP.send_message(MSPCodes.MSP2_INAV_SET_GEOZONE,FC.GEOZONES.extractBufferZone(i),!1,r):MSP.send_message(MSPCodes.MSP2_INAV_SET_GEOZONE,FC.GEOZONES.extractBufferZone(i),!1,t)}},n._getSetting=function(t){const i=settingsCache.get(t);if(typeof i<"u")return Promise.resolve(i);var s=[];return n._encodeSettingReference(t,null,s),MSP.promise(MSPCodes.MSP2_COMMON_SETTING_INFO,s).then(function(r){var a={0:"uint8_t",1:"int8_t",2:"uint16_t",3:"int16_t",4:"uint32_t",5:"float",6:"string"},h={};r.data.readString(),r.data.readU16();var c=r.data.readU8();if(h.type=a[c],!h.type)return console.log("Unknown setting type "+c+" for setting '"+t+"'"),null;if(r.data.readU8(),h.mode=r.data.readU8(),h.min=r.data.read32(),h.max=r.data.readU32(),h.index=r.data.readU16(),r.data.readU8(),r.data.readU8(),h.mode==64){for(var d=[],f=h.min;f<=h.max;f++)d.push(r.data.readString());h.table={values:d}}return settingsCache.set(t,h),h})},n._encodeSettingReference=function(t,i,s){if(Number.isInteger(i))s.push8(0),s.push16(i);else{for(var r=0;r<t.length;r++)s.push(t.charCodeAt(r));s.push(0)}},n.getSetting=function(t){var i=this;return this._getSetting(t).then(function(s){if(!s)return null;var r=[];return i._encodeSettingReference(t,s.index,r),MSP.promise(MSPCodes.MSPV2_SETTING,r).then(function(o){var a;switch(s.type){case"uint8_t":a=o.data.getUint8(0);break;case"int8_t":a=o.data.getInt8(0);break;case"uint16_t":a=o.data.getUint16(0,!0);break;case"int16_t":a=o.data.getInt16(0,!0);break;case"uint32_t":a=o.data.getUint32(0,!0);break;case"float":var h=o.data.getUint32(0,!0),c=new ArrayBuffer(4);new Uint32Array(c)[0]=h,a=new Float32Array(c)[0];break;case"string":a=o.data.readString();break;default:throw"Unknown setting type "+s.type}return{setting:s,value:a}})})},n.encodeSetting=function(t,i){return this._getSetting(t).then(function(s){if(!s)throw"Invalid setting";if(s.table&&!Number.isInteger(i)){for(var r=!1,o=0;o<s.table.values.length;o++)if(s.table.values[o]==i){i=o,r=!0;break}if(!r)throw'Invalid value "'+i+'" for setting '+t}var a=[];switch(n._encodeSettingReference(t,s.index,a),s.type){case"uint8_t":case"int8_t":a.push8(i);break;case"uint16_t":case"int16_t":a.push16(i);break;case"uint32_t":a.push32(i);break;case"float":var h=new ArrayBuffer(4);new Float32Array(h)[0]=i;var c=new Uint32Array(h)[0];a.push32(c);break;case"string":for(var o=0;o<i.length;o++)a.push(i.charCodeAt(o));break;default:throw"Unknown setting type "+s.type}return a})},n.setSetting=function(t,i,s){this.encodeSetting(t,i).then(function(r){return MSP.promise(MSPCodes.MSPV2_SET_SETTING,r).then(s)}).catch(r=>(console.log("Invalid setting: "+t,r),Promise.resolve().then(s)))},n.getRTC=function(t){MSP.send_message(MSPCodes.MSP_RTC,!1,!1,function(i){var s=i.data.read32(),r=i.data.readU16();t&&t(s,r)})},n.setRTC=function(t){var i=Date.now(),s=i/1e3,r=i%1e3,o=[];o.push32(s),o.push16(r),MSP.send_message(MSPCodes.MSP_SET_RTC,o,!1,t)},n.loadServoConfiguration=function(t){MSP.send_message(MSPCodes.MSP2_INAV_SERVO_CONFIG,!1,!1,t)},n.loadServoMixRules=function(t){MSP.send_message(MSPCodes.MSP2_INAV_SERVO_MIXER,!1,!1,t)},n.loadMotorMixRules=function(t){MSP.send_message(MSPCodes.MSP2_COMMON_MOTOR_MIXER,!1,!1,t)},n.loadMotors=function(t){MSP.send_message(MSPCodes.MSP_MOTOR,!1,!1,t)},n.getTarget=function(t){MSP.send_message(MSPCodes.MSP_FC_VERSION,!1,!1,function(i){var s=i.data.readString();t&&t(s)})},n.getCraftName=function(t){MSP.send_message(MSPCodes.MSP_NAME,!1,!1,function(i){var s=i.data.readString();t&&t(s)})},n.setCraftName=function(t,i){var s=[];t=t||"";for(var r=0;r<t.length;r++)s.push(t.charCodeAt(r));MSP.send_message(MSPCodes.MSP_SET_NAME,s,!1,i)},n.loadMixerConfig=function(t){MSP.send_message(MSPCodes.MSP2_INAV_MIXER,!1,!1,t)},n.saveMixerConfig=function(t){MSP.send_message(MSPCodes.MSP2_INAV_SET_MIXER,mspHelper$1.crunch(MSPCodes.MSP2_INAV_SET_MIXER),!1,t)},n.loadVTXConfig=function(t){MSP.send_message(MSPCodes.MSP_VTX_CONFIG,!1,!1,t)},n.saveVTXConfig=function(t){MSP.send_message(MSPCodes.MSP_SET_VTX_CONFIG,mspHelper$1.crunch(MSPCodes.MSP_SET_VTX_CONFIG),!1,t)},n.loadBrakingConfig=function(t){MSP.send_message(MSPCodes.MSP2_INAV_MC_BRAKING,!1,!1,t)},n.saveBrakingConfig=function(t){MSP.send_message(MSPCodes.MSP2_INAV_SET_MC_BRAKING,mspHelper$1.crunch(MSPCodes.MSP2_INAV_SET_MC_BRAKING),!1,t)},n.loadRateDynamics=function(t){MSP.send_message(MSPCodes.MSP2_INAV_RATE_DYNAMICS,!1,!1,t)},n.saveRateDynamics=function(t){MSP.send_message(MSPCodes.MSP2_INAV_SET_RATE_DYNAMICS,mspHelper$1.crunch(MSPCodes.MSP2_INAV_SET_RATE_DYNAMICS),!1,t)},n.loadEzTune=function(t){MSP.send_message(MSPCodes.MSP2_INAV_EZ_TUNE,!1,!1,t)},n.saveEzTune=function(t){MSP.send_message(MSPCodes.MSP2_INAV_EZ_TUNE_SET,mspHelper$1.crunch(MSPCodes.MSP2_INAV_EZ_TUNE_SET),!1,t)},n.loadParameterGroups=function(t){MSP.send_message(MSPCodes.MSP2_COMMON_PG_LIST,!1,!1,function(i){for(var s=[];i.data.offset<i.data.byteLength;){var r=i.data.readU16(),o=i.data.readU16(),a=i.data.readU16();s.push({id:r,start:o,end:a})}t&&t(s)})},n.loadBrakingConfig=function(t){MSP.send_message(MSPCodes.MSP2_INAV_MC_BRAKING,!1,!1,t)},n.loadLogicConditionsStatus=function(t){MSP.send_message(MSPCodes.MSP2_INAV_LOGIC_CONDITIONS_STATUS,!1,!1,t)},n.loadGlobalVariablesStatus=function(t){MSP.send_message(MSPCodes.MSP2_INAV_GVAR_STATUS,!1,!1,t)},n.loadProgrammingPidStatus=function(t){MSP.send_message(MSPCodes.MSP2_INAV_PROGRAMMING_PID_STATUS,!1,!1,t)},n.loadSerialPorts=function(t){MSP.send_message(MSPCodes.MSP2_CF_SERIAL_CONFIG,!1,!1,t)},n.saveSerialPorts=function(t){MSP.send_message(MSPCodes.MSP2_SET_CF_SERIAL_CONFIG,mspHelper$1.crunch(MSPCodes.MSP2_SET_CF_SERIAL_CONFIG),!1,t)},n.sendUbloxCommand=function(t,i){MSP.send_message(MSPCodes.MSP2_INAV_GPS_UBLOX_COMMAND,t,!1,i)},n})();const ConnectionType={Serial:0,TCP:1,UDP:2,BLE:3};class Connection{constructor(){if(this._connectionId=0,this._openRequested=!1,this._openCanceled=!1,this._bitrate=0,this._bytesReceived=0,this._bytesSent=0,this._transmitting=!1,this._outputBuffer=[],this._onReceiveListeners=[],this._onReceiveErrorListeners=[],this._type=null,this.constructor===Connection)throw new TypeError("Abstract class, cannot be instanced.");if(this.connectImplementation===Connection.prototype.connectImplementation)throw new TypeError("connectImplementation is an abstract member and not implemented.");if(this.disconnectImplementation===Connection.prototype.disconnectImplementation)throw new TypeError("disconnectImplementation is an abstract member and not implemented.");if(this.addOnReceiveCallback===Connection.prototype.addOnReceiveCallback)throw new TypeError("addOnReceiveCallback is an abstract member and not implemented.");if(this.removeOnReceiveCallback===Connection.prototype.removeOnReceiveCallback)throw new TypeError("removeOnReceiveCallback is an abstract member and not implemented.");if(this.addOnReceiveErrorCallback===Connection.prototype.addOnReceiveErrorCallback)throw new TypeError("addOnReceiveErrorCallback is an abstract member and not implemented.");if(this.removeOnReceiveErrorCallback===Connection.prototype.removeOnReceiveErrorCallback)throw new TypeError("removeOnReceiveErrorCallback is an abstract member and not implemented.")}get connectionId(){return this._connectionId}get bitrate(){return this._bitrate}get type(){return this._type}connectImplementation(e,t,i){throw new TypeError("Abstract method")}connect(e,t,i){this._openRequested=!0,this._openCanceled=!1,this._failed=0,this.connectImplementation(e,t,s=>{s&&!this._openCanceled?(this._connectionId=s.connectionId,this._bitrate=s.bitrate,this._bytesReceived=0,this._bytesSent=0,this._openRequested=!1,this.addOnReceiveListener(r=>{this._bytesReceived+=r.data.byteLength}),console.log("Connection opened with ID: "+s.connectionId+", Baud: "+s.bitrate),i&&i(s)):s&&this._openCanceled?(this._connectionId=s.connectionId,console.log("Connection opened with ID: "+s.connectionId+", but request was canceled, disconnecting"),setTimeout(()=>{this._openRequested=!1,this._openCanceled=!1,this.disconnect(()=>{i&&i(!1)})},150)):this._openCanceled?(console.log("Connection didn't open and request was canceled"),this._openRequested=!1,this._openCanceled=!1,i&&i(!1)):(this._openRequested=!1,console.log("Failed to open"),i&&i(!1))})}disconnectImplementation(e){throw new TypeError("Abstract method")}disconnect(e){this._connectionId?(this.emptyOutputBuffer(),this.removeAllListeners(),this.disconnectImplementation(t=>{console.log(t?"Connection with ID: "+this._connectionId+" closed, Sent: "+this._bytesSent+" bytes, Received: "+this._bytesReceived+" bytes":"Failed to close connection with ID: "+this._connectionId+" closed, Sent: "+this._bytesSent+" bytes, Received: "+this._bytesReceived+" bytes"),this._connectionId=!1,e&&e(t)})):this._openCanceled=!0}sendImplementation(e,t){throw new TypeError("Abstract method")}send(e,t){this._outputBuffer.push({data:e,callback:t});var i=()=>{var s=this._outputBuffer[0].data,r=this._outputBuffer[0].callback;this.sendImplementation(s,o=>{if(this._bytesSent+=o.bytesSent,r&&r(o),this._outputBuffer.shift(),this._outputBuffer.length){if(this._outputBuffer.length>100){for(var a=0;this._outputBuffer.length>100;)this._outputBuffer.pop(),a++;console.log("Send buffer overflowing, dropped: "+a+" entries")}i()}else this._transmitting=!1})};this._transmitting||(this._transmitting=!0,i())}abort(){GUI.connected_to||GUI.connecting_to?$("a.connect").trigger("click"):this.disconnect()}addOnReceiveCallback(e){throw new TypeError("Abstract method")}removeOnReceiveCallback(e){throw new TypeError("Abstract method")}addOnReceiveListener(e){this._onReceiveListeners.push(e),this.addOnReceiveCallback(e)}addOnReceiveErrorCallback(e){throw new TypeError("Abstract method")}removeOnReceiveErrorCallback(e){throw new TypeError("Abstract method")}addOnReceiveErrorListener(e){this._onReceiveErrorListeners.push(e),this.addOnReceiveErrorCallback(e)}removeAllListeners(){this._onReceiveListeners.forEach(e=>this.removeOnReceiveCallback(e)),this._onReceiveListeners=[],this._onReceiveErrorListeners.forEach(e=>this.removeOnReceiveErrorCallback(e)),this._onReceiveErrorListeners=[]}emptyOutputBuffer(){this._outputBuffer=[],this._transmitting=!1}getTimeout(){return this._bitrate>=57600?3e3:this._bitrate>=19200?4e3:6e3}}const BLE_WRITE_BUFFER_LENGTH=20,BleDevices=[{name:"CC2541 based",serviceUuid:"0000ffe0-0000-1000-8000-00805f9b34fb",writeCharateristic:"0000ffe1-0000-1000-8000-00805f9b34fb",readCharateristic:"0000ffe1-0000-1000-8000-00805f9b34fb",delay:30},{name:"Nordic Semiconductor NRF",serviceUuid:"6e400001-b5a3-f393-e0a9-e50e24dcca9e",writeCharateristic:"6e400003-b5a3-f393-e0a9-e50e24dcca9e",readCharateristic:"6e400002-b5a3-f393-e0a9-e50e24dcca9e",delay:30},{name:"SpeedyBee Type 2",serviceUuid:"0000abf0-0000-1000-8000-00805f9b34fb",writeCharateristic:"0000abf1-0000-1000-8000-00805f9b34fb",readCharateristic:"0000abf2-0000-1000-8000-00805f9b34fb",delay:0},{name:"SpeedyBee Type 1",serviceUuid:"00001000-0000-1000-8000-00805f9b34fb",writeCharateristic:"00001001-0000-1000-8000-00805f9b34fb",readCharateristic:"00001002-0000-1000-8000-00805f9b34fb",delay:0}];class ConnectionBle extends Connection{constructor(){super(),this._readCharacteristic=!1,this._writeCharacteristic=!1,this._device=!1,this._deviceDescription=!1,this._onCharateristicValueChangedListeners=[],this._onDisconnectListeners=[],this._reconnects=0,this._handleOnCharateristicValueChanged=!1,this._handleDisconnect=!1,super._type=ConnectionType.BLE}get deviceDescription(){return this._deviceDescription}async connectImplementation(e,t,i){return console.log("Request BLE Device"),await this.openDevice().then(()=>{this.addOnReceiveErrorListener(s=>{GUI.log(i18n.getMessage("connectionBleInterrupted")),this.abort()}),i&&i({connectionId:255,bitrate:115200})}).catch(s=>{GUI.log(i18n.getMessage("connectionBleError",[s])),i&&i(!1)}),Promise.resolve()}async openDevice(){return await this.request().then(e=>this.connectBle(e)).then(()=>this.startNotification()),Promise.resolve()}request(){var e=[];return BleDevices.forEach(t=>{e.push(t.serviceUuid)}),navigator.bluetooth.requestDevice({acceptAllDevices:!0,optionalServices:e}).then(t=>(console.log("Found BLE device: "+t.name),this._device=t,this._handleDisconnect=i=>{this._onDisconnectListeners.forEach(s=>{s("disconnected")})},this._device.addEventListener("gattserverdisconnected",this._handleDisconnect),this._device))}connectBle(e){return e.gatt.connected&&this._readCharacteristic&&this._writeCharacteristic?Promise.resolve():e.gatt.connect().then(t=>(console.log("Connect to: "+e.name),GUI.log(i18n.getMessage("connectionConnected",[e.name])),t.getPrimaryServices())).then(t=>{let i=t.find(s=>(this._deviceDescription=BleDevices.find(r=>r.serviceUuid==s.uuid),this._deviceDescription));if(!this._deviceDescription)throw new Error("Unsupported device (service UUID mismatch).");return GUI.log(i18n.getMessage("connectionBleType",[this._deviceDescription.name])),i.getCharacteristics()}).then(t=>{if(t.forEach(i=>(i.uuid==this._deviceDescription.writeCharateristic&&(this._writeCharacteristic=i),i.uuid==this._deviceDescription.readCharateristic&&(this._readCharacteristic=i),this._writeCharacteristic&&this._readCharacteristic)),!this._writeCharacteristic)throw new Error("No or unexpected write charateristic found (should be "+this._deviceDescription.writeCharateristic+")");if(!this._readCharacteristic)throw new Error("No or unexpected read charateristic found (should be "+this._deviceDescription.readCharateristic+")");return this._handleOnCharateristicValueChanged=i=>{let s=new Uint8Array(i.target.value.byteLength);for(var r=0;r<i.target.value.byteLength;r++)s[r]=i.target.value.getUint8(r);this._onCharateristicValueChangedListeners.forEach(o=>{o({connectionId:255,data:s})})},this._readCharacteristic.addEventListener("characteristicvaluechanged",this._handleOnCharateristicValueChanged),Promise.resolve()})}startNotification(){if(!this._readCharacteristic)throw new Error("No read charateristic");if(!this._readCharacteristic.properties.notify)throw new Error("Read charateristic can't notify.");return this._readCharacteristic.startNotifications().then(()=>{console.log("BLE notifications started.")})}disconnectImplementation(e){this._device&&(this._device.removeEventListener("gattserverdisconnected",this._handleDisconnect),this._readCharacteristic.removeEventListener("characteristicvaluechanged",this._handleOnCharateristicValueChanged),this._device.gatt.connected&&this._device.gatt.disconnect(),this._device=!1,this._writeCharacteristic=!1,this._readCharacteristic=!1,this._deviceDescription=!1),e&&e(!0)}async sendImplementation(e,t){if(!this._writeCharacteristic)return;let i=0,s=new Uint8Array(e);for(var r=0;r<s.length;r+=BLE_WRITE_BUFFER_LENGTH){var o=BLE_WRITE_BUFFER_LENGTH;r+BLE_WRITE_BUFFER_LENGTH>s.length&&(o=s.length%BLE_WRITE_BUFFER_LENGTH);var a=s.subarray(r,r+o);i+=a.length,await this._writeCharacteristic.writeValue(a)}t&&t({bytesSent:i,resultCode:0})}addOnReceiveCallback(e){this._onCharateristicValueChangedListeners.push(e)}removeOnReceiveCallback(e){this._onCharateristicValueChangedListeners=this._onCharateristicValueChangedListeners.filter(t=>t!==e)}addOnReceiveErrorCallback(e){this._onDisconnectListeners.push(e)}removeOnReceiveErrorCallback(e){this._onDisconnectListeners=this._onDisconnectListeners.filter(t=>t!==e)}static getBleUUIDs(){var e=[];return BleDevices.forEach(t=>{e.push(t.serviceUuid)}),e}}class ConnectionSerial extends Connection{constructor(){super(),this._errorListeners=[],this._onReceiveListeners=[],this._onErrorListener=[],this.ports=[],super._type=ConnectionType.Serial,bridge.serialEvents.addEventListener("data",e=>{this._onReceiveListeners.forEach(t=>{t({connectionId:this._connectionId,data:e.detail})})}),bridge.serialEvents.addEventListener("close",e=>{console.log("Serial conenection closed"),this.abort()}),bridge.serialEvents.addEventListener("error",e=>{const t=e.detail;GUI.log(t),console.log(t),this.abort(),this._onReceiveErrorListeners.forEach(i=>{i(t)})})}connectImplementation(e,t,i){bridge.serialConnect(e,t).then(s=>{s.error?(console.log("Serial connection error: "+s.msg),i&&i(!1)):(GUI.log(i18n.getMessage("connectionConnected",[`${e} @ ${t.bitrate} baud`])),this._connectionId=s.id,i&&i({bitrate:t.bitrate,connectionId:this._connectionId}))})}disconnectImplementation(e){this._connectionId&&bridge.serialClose().then(t=>{var i=!0;t.error&&(console.log("Unable to close serial: "+t.msg),i=!1),e&&e(i)})}sendImplementation(e,t){this._connectionId&&bridge.serialSend(e).then(i=>{var s=0,r=i.bytesWritten;i.error&&(console.log("Serial write error: "+i.msg),s=1,r=0),t&&t({bytesSent:r,resultCode:s})})}addOnReceiveCallback(e){this._onReceiveErrorListeners.push(e)}removeOnReceiveCallback(e){this._onReceiveListeners=this._onReceiveErrorListeners.filter(t=>t!==e)}addOnReceiveErrorCallback(e){this._onReceiveErrorListeners.push(e)}removeOnReceiveErrorCallback(e){this._onReceiveErrorListeners=this._onReceiveErrorListeners.filter(t=>t!==e)}static async getDevices(){return await bridge.listSerialDevices()}}const STANDARD_TCP_PORT=5761;class ConnectionTcp extends Connection{constructor(){super(),this._connectionIP="",this.connectionPort=0,this._onReceiveListeners=[],this._onErrorListener=[],super._type=ConnectionType.TCP,bridge.tcpEvents.addEventListener("data",e=>{this._onReceiveListeners.forEach(t=>{t({connectionId:this._connectionId,data:e.detail})})}),bridge.tcpEvents.addEventListener("close",e=>{console.log("TCP Remote has closed the connection"),this.abort()}),bridge.tcpEvents.addEventListener("error",e=>{const t=e.detail;GUI.log(t),console.log(t),this.abort(),this._onReceiveErrorListeners.forEach(i=>{i(t)})})}connectImplementation(e,t,i){var s=e.split(":");s.length>=2?(this._connectionIP=s[0],this._connectionPort=parseInt(s[1])):(this._connectionIP=e[0],this._connectionPort=STANDARD_TCP_PORT),bridge.tcpConnect(this._connectionIP,this._connectionPort).then(r=>{r.error?(console.log("TCP error "+r.errorMsg),i&&i(!1)):(GUI.log(i18n.getMessage("connectionConnected",["tcp://"+this._connectionIP+":"+this._connectionPort])),this._connectionId=r.id,i&&i({bitrate:115200,connectionId:this._connectionId}))})}disconnectImplementation(e){this._connectionId&&bridge.tcpClose(),this._connectionIP="",this._connectionPort=0,e&&e(!0)}sendImplementation(e,t){this._connectionId&&bridge.tcpSend(e).then(i=>{var s=0,r=i.bytesWritten;i.error&&(console.log("Serial write error: "+i.msg),s=1,r=0),t&&t({bytesSent:r,resultCode:s})})}addOnReceiveCallback(e){this._onReceiveErrorListeners.push(e)}removeOnReceiveCallback(e){this._onReceiveListeners=this._onReceiveErrorListeners.filter(t=>t!==e)}addOnReceiveErrorCallback(e){this._onReceiveErrorListeners.push(e)}removeOnReceiveErrorCallback(e){this._onReceiveErrorListeners=this._onReceiveErrorListeners.filter(t=>t!==e)}}const STANDARD_UDP_PORT=5761;class ConnectionUdp extends Connection{constructor(){super(),this._connectionIP="",this._connectionPort=0,this._onReceiveListeners=[],this._onErrorListener=[],super._type=ConnectionType.UDP,bridge.udpEvents.addEventListener("data",e=>{this._onReceiveListeners.forEach(t=>{t({connectionId:this._connectionId,data:e.detail})})}),bridge.udpEvents.addEventListener("error",e=>{const t=e.detail;GUI.log(t),console.log(t),this.abort(),this._onReceiveErrorListeners.forEach(i=>{i(t)})})}connectImplementation(e,t,i){var s=e.split(":");s.length>=2?(this._connectionIP=s[0],this._connectionPort=parseInt(s[1])):(this._connectionIP=e[0],this._connectionPort=STANDARD_UDP_PORT),bridge.udpConnect(this._connectionIP,this._connectionPort).then(r=>{r.error?(console.log("UDP error: "+r.msg),i&&i(!1)):(GUI.log(i18n.getMessage("connectionConnected",["udp://"+this._connectionIP+":"+this._connectionPort])),this._connectionId=r.id,i&&i({bitrate:115200,connectionId:this._connectionId}))})}disconnectImplementation(e){this._connectionId&&bridge.udpClose().then(t=>{var i=!0;t.error&&(console.log("Unable to close UDP: "+t.msg),i=!1),e&&e(i)})}sendImplementation(e,t){this._connectionId&&bridge.udpSend(e).then(i=>{var s=0,r=i.bytesWritten;i.error&&(console.log("Serial write error: "+i.msg),s=1,r=0),t&&t({bytesSent:r,resultCode:s})})}addOnReceiveCallback(e){this._onReceiveErrorListeners.push(e)}removeOnReceiveCallback(e){this._onReceiveListeners=this._onReceiveErrorListeners.filter(t=>t!==e)}addOnReceiveErrorCallback(e){this._onReceiveErrorListeners.push(e)}removeOnReceiveErrorCallback(e){this._onReceiveErrorListeners=this._onReceiveErrorListeners.filter(t=>t!==e)}}var connectionFactory=function(n,e){if(e&&(e.type==n||e.connectionId))return e;switch(n){case ConnectionType.BLE:e=new ConnectionBle;break;case ConnectionType.TCP:e=new ConnectionTcp;break;case ConnectionType.UDP:e=new ConnectionUdp;break;default:case ConnectionType.Serial:e=new ConnectionSerial;break}return e},usbDevices=[{vendorId:1155,productId:57105},{vendorId:11836,productId:57105},{vendorId:12619,productId:262}],PortHandler=new function(){this.initial_ports=!1,this.port_detected_callbacks=[],this.port_removed_callbacks=[],this.dfu_available=!1};PortHandler.initialize=function(){this.check()};PortHandler.check=function(){var n=this;ConnectionSerial.getDevices().then(e=>{let t=[];for(var i=0;i<e.length;i++)e[i].indexOf(":")===-1&&t.push(e[i]);if(n.array_difference(n.initial_ports,t).length>0||!n.initial_ports){var s=n.array_difference(n.initial_ports,t);if(n.initial_ports!=!1&&(s.length>1?console.log("PortHandler - Removed: "+s):console.log("PortHandler - Removed: "+s[0])),GUI.connected_to)for(var i=0;i<s.length;i++)s[i]==GUI.connected_to&&$("div#port-picker a.connect").trigger("click");if(n.update_port_select(t),n.initial_ports)for(var i=n.port_removed_callbacks.length-1;i>=0;i--){var r=n.port_removed_callbacks[i];clearTimeout(r.timer),r.code(s);var o=n.port_removed_callbacks.indexOf(r);o>-1&&n.port_removed_callbacks.splice(o,1)}if(!n.initial_ports){const c=bridge.storeGet("last_used_port",!1);c?c=="ble"||c=="tcp"||c=="udp"||c=="sitl"||c=="sitl-demo"?$("#port").val(c):t.forEach(function(d){d==c&&(console.log("Selecting last used port: "+c),$("#port").val(c))}):console.log(`Last used port wasn't saved "yet", auto-select disabled.`);var a=bridge.storeGet("last_used_bps",!1);a&&$("#baud").val(a),bridge.storeGet("wireless_mode_enabled",!1)&&$("#wireless-mode").prop("checked",!0).trigger("change")}if(!n.initial_ports)n.initial_ports=t;else for(var i=0;i<s.length;i++)n.initial_ports.splice(n.initial_ports.indexOf(s[i]),1)}var h=n.array_difference(t,n.initial_ports);if(h.length){h.length>1?console.log("PortHandler - Found: "+h):console.log("PortHandler - Found: "+h[0]),n.update_port_select(t),GUI.connected_to?$("div#port-picker #port").val(GUI.connected_to):$("div#port-picker #port").val(h[0]);for(var i=n.port_detected_callbacks.length-1;i>=0;i--){var r=n.port_detected_callbacks[i];clearTimeout(r.timer),r.code(h);var o=n.port_detected_callbacks.indexOf(r);o>-1&&n.port_detected_callbacks.splice(o,1)}n.initial_ports=t}n.check_usb_devices(),GUI.updateManualPortVisibility(),setTimeout(function(){n.check()},250)})};PortHandler.check_usb_devices=function(n){self.dfu_available=!1,navigator.usb.getDevices().then(e=>{e.forEach(t=>{usbDevices.forEach(i=>{if(t.vendorId==i.vendorId&&t.productId==i.productId){self.dfu_available=!0;return}})}),self.dfu_available?$("div#port-picker #port [value='DFU']").length||($("div#port-picker #port").append($("<option/>",{value:"DFU",text:"DFU",data:{isDFU:!0}})),$("div#port-picker #port").val("DFU")):$("div#port-picker #port [value='DFU']").length&&$("div#port-picker #port [value='DFU']").remove(),n&&n(self.dfu_available)})};PortHandler.update_port_select=function(n){$("div#port-picker #port").html("");for(var e=0;e<n.length;e++)$("div#port-picker #port").append($("<option/>",{value:n[e],text:n[e],data:{isManual:!1}}));$("div#port-picker #port").append($("<option/>",{value:"manual",text:"Manual Selection",data:{isManual:!0}})),bridge.isElectron||($("div#port-picker #port").append($("<option/>",{value:"webPermission",text:i18n.getMessage("webSerialPermission"),data:{isWebPermission:!0}})),$("div#port-picker #port").append($("<option/>",{value:"dfuPermission",text:i18n.getMessage("webDfuPermission"),data:{isDfuPermission:!0}}))),$("div#port-picker #port").append($("<option/>",{value:"ble",text:"BLE",data:{isBle:!0}})),bridge.isElectron&&($("div#port-picker #port").append($("<option/>",{value:"tcp",text:"TCP",data:{isTcp:!0}})),$("div#port-picker #port").append($("<option/>",{value:"udp",text:"UDP",data:{isUdp:!0}})),$("div#port-picker #port").append($("<option/>",{value:"sitl",text:"SITL",data:{isSitl:!0}})),$("div#port-picker #port").append($("<option/>",{value:"sitl-demo",text:"Demo mode",data:{isSitl:!0}})))};PortHandler.port_detected=function(n,e,t,i){var s=this,r={name:n,code:e,timeout:t||1e4};return i?(r.timer=!1,r.timeout=!1):r.timer=setTimeout(function(){console.log("PortHandler - timeout - "+r.name),e(!1);var o=s.port_detected_callbacks.indexOf(r);o>-1&&s.port_detected_callbacks.splice(o,1)},t||1e4),this.port_detected_callbacks.push(r),r};PortHandler.port_removed=function(n,e,t,i){var s=this,r={name:n,code:e,timeout:t||1e4};return i?(r.timer=!1,r.timeout=!1):r.timer=setTimeout(function(){console.log("PortHandler - timeout - "+r.name),e(!1);var o=s.port_removed_callbacks.indexOf(r);o>-1&&s.port_removed_callbacks.splice(o,1)},t||1e4),this.port_removed_callbacks.push(r),r};PortHandler.array_difference=function(n,e){for(var t=[],i=0;i<n.length;i++)t.push(n[i]);for(var i=0;i<e.length;i++)t.indexOf(e[i])!=-1&&t.splice(t.indexOf(e[i]),1);return t};PortHandler.flush_callbacks=function(){for(var n=0,e=this.port_detected_callbacks.length-1;e>=0;e--)this.port_detected_callbacks[e].timer&&clearTimeout(this.port_detected_callbacks[e].timer),this.port_detected_callbacks.splice(e,1),n++;for(var e=this.port_removed_callbacks.length-1;e>=0;e--)this.port_removed_callbacks[e].timer&&clearTimeout(this.port_removed_callbacks[e].timer),this.port_removed_callbacks.splice(e,1),n++;return n};var periodicStatusUpdater=(function(){var n={},e={},t=!1;return n.getUpdateInterval=function(i){return i||(i=115200),i>=115200?300:i>=57600?600:i>=38400?800:1e3},e.updateView=function(){var i=Date.now()-MSP.analog_last_received_timestamp<n.getUpdateInterval(CONFIGURATOR.connection.bitrate)*3;if(FC.isModeEnabled("ARM")?($("#armedIcon").removeClass("armed"),$("#armedIcon").addClass("armed-active")):($("#armedIcon").removeClass("armed-active"),$("#armedIcon").addClass("armed")),FC.isModeEnabled("FAILSAFE")?($("#failsafeicon").removeClass("failsafe"),$("#failsafeicon").addClass("failsafe-active")):($("#failsafeicon").removeClass("failsafe-active"),$("#failsafeicon").addClass("failsafe")),FC.ANALOG!=null){var s;s=FC.ANALOG.cell_count;var r=FC.MISC.vbatmincellvoltage*s;FC.MISC.vbatmaxcellvoltage*s;var o=FC.MISC.vbatwarningcellvoltage*s;$(".battery-status").css({width:FC.ANALOG.battery_percentage+"%",display:"inline-block"}),i?($("#linkicon").removeClass("link"),$("#linkicon").addClass("link-active")):($("#linkicon").removeClass("link-active"),$("#linkicon").addClass("link")),FC.ANALOG.use_capacity_thresholds&&FC.ANALOG.battery_remaining_capacity<=FC.MISC.battery_capacity_warning-FC.MISC.battery_capacity_critical||!FC.ANALOG.use_capacity_thresholds&&FC.ANALOG.voltage<o||FC.ANALOG.voltage<r?$(".battery-status").css("background-color","#D42133"):$(".battery-status").css("background-color","#59AA29"),$(".battery-legend").text(FC.ANALOG.voltage+" V")}$("#quad-status_wrapper").show()},n.run=function(){CONFIGURATOR.connectionValid&&($(".quad-status-contents").css({display:"inline-block"}),!t&&GUI.active_tab!="cli"&&(MSP.send_message(MSPCodes.MSP_SENSOR_STATUS,!1,!1),MSP.send_message(MSPCodes.MSPV2_INAV_STATUS,!1,!1),MSP.send_message(MSPCodes.MSP_ACTIVEBOXES,!1,!1),MSP.send_message(MSPCodes.MSPV2_INAV_ANALOG,!1,!1),e.updateView()))},n.stop=function(){t=!0},n.resume=function(){t=!1},n})(),MSPChainerClass$1=function(){var n={};return n.chain=[],n.exitPoint=null,n.chainIndex=0,n.setChain=function(e){n.chain=e},n.setExitPoint=function(e){n.exitPoint=e},n.returnCallback=function(){n.chainIndex++,n.chain[n.chainIndex]?n.chain[n.chainIndex](n.returnCallback):n.exitPoint&&n.exitPoint()},n.execute=function(){n.chainIndex=0,n.chain[n.chainIndex](n.returnCallback)},n},features=(function(){let n={},e={},t=[],i=[],s;return n.reset=function(){t=[],i=[]},n.set=function(r){t.push(r)},n.unset=function(r){i.push(r)},n.updateUI=function(r,o){r.find("[data-bit].feature").each(function(){let a=$(this);a.prop("checked",BitHelper.bit_check(o,a.attr("data-bit")))})},n.fromUI=function(r){r.find("[data-bit].feature").each(function(){let o=$(this);o.is(":checked")?n.set(o.attr("data-bit")):n.unset(o.attr("data-bit"))})},n.execute=function(r){s=r,mspHelper$1.loadFeatures(e.setBits)},e.setBits=function(){for(const r of t)FC.FEATURES=BitHelper.bit_set(FC.FEATURES,r);for(const r of i)FC.FEATURES=BitHelper.bit_clear(FC.FEATURES,r);mspHelper$1.saveFeatures(s)},n})(),jBox_all_min$1={exports:{}},jBox_all_min=jBox_all_min$1.exports,hasRequiredJBox_all_min;function requireJBox_all_min(){return hasRequiredJBox_all_min||(hasRequiredJBox_all_min=1,(function(module){function jBoxWrapper(n){function e(s,r){return this.options={id:null,width:"auto",height:"auto",minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,responsiveWidth:!0,responsiveHeight:!0,responsiveMinWidth:100,responsiveMinHeight:100,attach:null,trigger:"click",preventDefault:!1,content:null,getContent:null,title:null,getTitle:null,footer:null,isolateScroll:!0,ajax:{url:null,data:"",reload:!1,getURL:"data-url",getData:"data-ajax",setContent:!0,loadingClass:!0,spinner:!0,spinnerDelay:300,spinnerReposition:!0},cancelAjaxOnClose:!0,target:null,position:{x:"center",y:"center"},outside:null,offset:0,attributes:{x:"left",y:"top"},fixed:!1,adjustPosition:!0,adjustTracker:!1,adjustDistance:5,reposition:!0,repositionOnOpen:!0,repositionOnContent:!0,holdPosition:!0,pointer:!1,pointTo:"target",fade:180,animation:null,theme:"Default",addClass:null,overlay:!1,overlayClass:null,zIndex:1e4,delayOpen:0,delayClose:0,closeOnEsc:!1,closeOnClick:!1,closeOnMouseleave:!1,closeButton:!1,appendTo:n("body"),createOnInit:!1,blockScroll:!1,blockScrollAdjust:!0,draggable:!1,dragOver:!0,autoClose:!1,delayOnHover:!1,showCountdown:!1,preloadAudio:!0,audio:null,volume:100,onInit:null,onAttach:null,onPosition:null,onCreated:null,onOpen:null,onOpenComplete:null,onClose:null,onCloseComplete:null,onDragStart:null,onDragEnd:null},this._pluginOptions={Tooltip:{getContent:"title",trigger:"mouseenter",position:{x:"center",y:"top"},outside:"y",pointer:!0},Mouse:{responsiveWidth:!1,responsiveHeight:!1,adjustPosition:"flip",target:"mouse",trigger:"mouseenter",position:{x:"right",y:"bottom"},outside:"xy",offset:5},Modal:{target:n(window),fixed:!0,blockScroll:!0,closeOnEsc:!0,closeOnClick:"overlay",closeButton:!0,overlay:!0,animation:"zoomIn"}},this.options=n.extend(!0,this.options,this._pluginOptions[s]||e._pluginOptions[s],r),n.type(s)=="string"&&(this.type=s),this.isTouchDevice=(function(){var a=" -webkit- -moz- -o- -ms- ".split(" ");if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return!0;var o,a=["(",a.join("touch-enabled),("),"heartz",")"].join("");return o=a,window.matchMedia(o).matches})(),this.isTouchDevice&&this.options.trigger==="mouseenter"&&this.options.closeOnClick===!1&&(this.options.closeOnClick="body"),this._fireEvent=function(o,a){this.options["_"+o]&&this.options["_"+o].bind(this)(a),this.options[o]&&this.options[o].bind(this)(a)},this.options.id===null&&(this.options.id="jBox"+e._getUniqueID()),this.id=this.options.id,(this.options.position.x=="center"&&this.options.outside=="x"||this.options.position.y=="center"&&this.options.outside=="y")&&(this.options.outside=null),this.options.pointTo!="target"||this.options.outside&&this.options.outside!="xy"||(this.options.pointer=!1),n.type(this.options.offset)!="object"?this.options.offset={x:this.options.offset,y:this.options.offset}:this.options.offset=n.extend({x:0,y:0},this.options.offset),n.type(this.options.adjustDistance)!="object"?this.options.adjustDistance={top:this.options.adjustDistance,right:this.options.adjustDistance,bottom:this.options.adjustDistance,left:this.options.adjustDistance}:this.options.adjustDistance=n.extend({top:5,left:5,right:5,bottom:5},this.options.adjustDistance),this.outside=!(!this.options.outside||this.options.outside=="xy")&&this.options.position[this.options.outside],this.align=this.outside||(this.options.position.y!="center"&&n.type(this.options.position.y)!="number"?this.options.position.x:this.options.position.x!="center"&&n.type(this.options.position.x)!="number"?this.options.position.y:this.options.attributes.x),e.zIndexMax=Math.max(e.zIndexMax||0,this.options.zIndex==="auto"?1e4:this.options.zIndex),this.options.zIndex==="auto"&&(this.adjustZIndexOnOpen=!0,this.options.zIndex=e.zIndexMax+=2,this.trueModal=this.options.overlay),this._getOpp=function(o){return{left:"right",right:"left",top:"bottom",bottom:"top",x:"y",y:"x"}[o]},this._getXY=function(o){return{left:"x",right:"x",top:"y",bottom:"y",center:"x"}[o]},this._getTL=function(o){return{left:"left",right:"left",top:"top",bottom:"top",center:"left",x:"left",y:"top"}[o]},this._getInt=function(o,a){return o=="auto"?"auto":o&&n.type(o)=="string"&&o.slice(-1)=="%"?n(window)[a=="height"?"innerHeight":"innerWidth"]()*parseInt(o.replace("%",""))/100:o},this._createSVG=function(o,a){var h=document.createElementNS("http://www.w3.org/2000/svg",o);return n.each(a,function(c,d){h.setAttribute(d[0],d[1]||"")}),h},this._isolateScroll=function(o){o&&o.length&&o.on("DOMMouseScroll.jBoxIsolateScroll mousewheel.jBoxIsolateScroll",function(a){var h=a.wheelDelta||a.originalEvent&&a.originalEvent.wheelDelta||-a.detail,c=0<=this.scrollTop+o.outerHeight()-this.scrollHeight,d=this.scrollTop<=0;(h<0&&c||0<h&&d)&&a.preventDefault()})},this._setTitleWidth=function(){if(!this.titleContainer||this.content[0].style.width=="auto"&&!this.content[0].style.maxWidth)return null;var o;this.wrapper.css("display")=="none"?(this.wrapper.css("display","block"),o=this.content.outerWidth(),this.wrapper.css("display","none")):o=this.content.outerWidth(),this.titleContainer.css({maxWidth:Math.max(o,parseInt(this.content[0].style.maxWidth))||null})},this._draggable=function(){if(!this.options.draggable)return!1;var o=this.options.draggable=="title"?this.titleContainer:this.options.draggable instanceof n?this.options.draggable:n.type(this.options.draggable)=="string"?n(this.options.draggable):this.wrapper;return!(!(o&&o instanceof n&&o.length)||o.data("jBox-draggable"))&&(o.addClass("jBox-draggable").data("jBox-draggable",!0).on("touchstart mousedown",(function(a){var h,c,d,f,_,y;a.button==2||n(a.target).hasClass("jBox-noDrag")||n(a.target).parents(".jBox-noDrag").length?a.type=="touchstart"&&(n(a.target).hasClass("jBox-closeButton")||n(a.target).parents(".jBox-closeButton").length)&&this.close({ignoreDelay:!0}):(c=a.type=="touchstart"&&a.touches&&a.touches[0]?(h=a.touches[0].pageX,a.touches[0].pageY):(h=a.pageX,a.pageY),this.draggingStartX=h,this.draggingStartY=c,this.options.dragOver&&!this.trueModal&&parseInt(this.wrapper.css("zIndex"),10)<=e.zIndexMaxDragover&&(e.zIndexMaxDragover+=1,this.wrapper.css("zIndex",e.zIndexMaxDragover)),d=this.wrapper.outerHeight(),f=this.wrapper.outerWidth(),_=this.wrapper.offset().top+d-c,y=this.wrapper.offset().left+f-h,n(document).on("touchmove.jBox-draggable-"+this.id+" mousemove.jBox-draggable-"+this.id,(function(I){var v,I=I.type=="touchmove"&&I.touches&&I.touches[0]?(v=I.touches[0].pageX,I.touches[0].pageY):(v=I.pageX,I.pageY);this.dragging||this.draggingStartX==v||this.draggingStartY==I||(this._fireEvent("onDragStart"),this.dragging=!0),this.wrapper.offset({top:I+_-d,left:v+y-f})}).bind(this)),a.preventDefault())}).bind(this)).on("touchend mouseup",(function(){var a;n(document).off("touchmove.jBox-draggable-"+this.id+" mousemove.jBox-draggable-"+this.id),this.dragging&&this._fireEvent("onDragEnd"),this.dragging=!1,this.type!="Modal"&&this.type!="Confirm"||!this.options.holdPosition||(a={x:(a=n("#"+this.id).offset()).left-n(document).scrollLeft(),y:a.top-n(document).scrollTop()},this.position({position:a,offset:{x:0,y:0}}))}).bind(this)),this.trueModal||(e.zIndexMaxDragover=e.zIndexMaxDragover?Math.max(e.zIndexMaxDragover,this.options.zIndex):this.options.zIndex),this)},this._create=function(){var o;this.wrapper||(this.wrapper=n("<div/>",{id:this.id,class:"jBox-wrapper"+(this.type?" jBox-"+this.type:"")+(this.options.theme?" jBox-"+this.options.theme:"")+(this.options.addClass?" "+this.options.addClass:"")}).css({position:this.options.fixed?"fixed":"absolute",display:"none",opacity:0,zIndex:this.options.zIndex}).data("jBox",this),this.options.closeOnMouseleave&&this.wrapper.on("mouseleave",(function(a){!this.source||a.relatedTarget!=this.source[0]&&n.inArray(this.source[0],n(a.relatedTarget).parents("*"))===-1&&this.close()}).bind(this)),this.options.closeOnClick=="box"&&this.wrapper.on("click tap",(function(){this.close({ignoreDelay:!0})}).bind(this)),this.container=n('<div class="jBox-container"/>').appendTo(this.wrapper),this.content=n('<div class="jBox-content"/>').appendTo(this.container),this.options.footer&&(this.footer=n('<div class="jBox-footer"/>').append(this.options.footer).appendTo(this.container)),this.options.isolateScroll&&this._isolateScroll(this.content),this.options.closeButton&&((o=this._createSVG("svg",[["viewBox","0 0 24 24"]])).appendChild(this._createSVG("path",[["d","M22.2,4c0,0,0.5,0.6,0,1.1l-6.8,6.8l6.9,6.9c0.5,0.5,0,1.1,0,1.1L20,22.3c0,0-0.6,0.5-1.1,0L12,15.4l-6.9,6.9c-0.5,0.5-1.1,0-1.1,0L1.7,20c0,0-0.5-0.6,0-1.1L8.6,12L1.7,5.1C1.2,4.6,1.7,4,1.7,4L4,1.7c0,0,0.6-0.5,1.1,0L12,8.5l6.8-6.8c0.5-0.5,1.1,0,1.1,0L22.2,4z"]])),this.closeButton=n('<div class="jBox-closeButton jBox-noDrag"/>').on("click tap",(function(a){this.close({ignoreDelay:!0})}).bind(this)).append(o),this.options.closeButton!="box"&&(this.options.closeButton!==!0||this.options.overlay||this.options.title||this.options.getTitle)||(this.wrapper.addClass("jBox-closeButton-box"),this.closeButton.appendTo(this.container))),this.wrapper.appendTo(this.options.appendTo),this.wrapper.find(".jBox-closeButton").length&&n.each(["top","right","bottom","left"],(function(a,h){this.wrapper.find(".jBox-closeButton").css(h)&&this.wrapper.find(".jBox-closeButton").css(h)!="auto"&&(this.options.adjustDistance[h]=Math.max(this.options.adjustDistance[h],this.options.adjustDistance[h]+-1*((parseInt(this.wrapper.find(".jBox-closeButton").css(h))||0)+(parseInt(this.container.css("border-"+h+"-width"))||0))))}).bind(this)),this.options.pointer&&(this.pointer={position:this.options.pointTo!="target"?this.options.pointTo:this._getOpp(this.outside),xy:this.options.pointTo!="target"?this._getXY(this.options.pointTo):this._getXY(this.outside),align:"center",offset:0},this.pointer.element=n('<div class="jBox-pointer jBox-pointer-'+this.pointer.position+'"/>').appendTo(this.wrapper),this.pointer.dimensions={x:this.pointer.element.outerWidth(),y:this.pointer.element.outerHeight()},n.type(this.options.pointer)=="string"&&((o=this.options.pointer.split(":"))[0]&&(this.pointer.align=o[0]),o[1]&&(this.pointer.offset=parseInt(o[1]))),this.pointer.alignAttribute=this.pointer.xy=="x"?this.pointer.align=="bottom"?"bottom":"top":this.pointer.align=="right"?"right":"left",this.wrapper.css("padding-"+this.pointer.position,this.pointer.dimensions[this.pointer.xy]),this.pointer.element.css(this.pointer.alignAttribute,this.pointer.align=="center"?"50%":0).css("margin-"+this.pointer.alignAttribute,this.pointer.offset),this.pointer.margin={},this.pointer.margin["margin-"+this.pointer.alignAttribute]=this.pointer.offset,this.pointer.align=="center"&&this.pointer.element.css("transform","translate("+(this.pointer.xy=="y"?-.5*this.pointer.dimensions.x+"px":0)+", "+(this.pointer.xy=="x"?-.5*this.pointer.dimensions.y+"px":0)+")"),this.pointer.element.css(this.pointer.xy=="x"?"width":"height",parseInt(this.pointer.dimensions[this.pointer.xy])+parseInt(this.container.css("border-"+this.pointer.alignAttribute+"-width"))),this.wrapper.addClass("jBox-pointerPosition-"+this.pointer.position)),this.setContent(this.options.content,!0),this.setTitle(this.options.title,!0),this.options.draggable&&this._draggable(),this._fireEvent("onCreated"))},this.options.createOnInit&&this._create(),this.options.attach&&this.attach(),this._attachEvents=function(){this.options.delayOnHover&&n("#"+this.id).on("mouseenter",(function(o){this.isHovered=!0}).bind(this)),this.options.delayOnHover&&n("#"+this.id).on("mouseleave",(function(o){this.isHovered=!1}).bind(this)),(this.options.adjustPosition||this.options.reposition)&&!this.fixed&&this.outside&&(this.options.adjustTracker&&n(window).on("scroll.jBox-"+this.id,(function(o){this.position()}).bind(this)),(this.options.adjustPosition||this.options.reposition)&&n(window).on("resize.jBox-"+this.id,(function(o){this.position()}).bind(this))),this.options.target=="mouse"&&n("body").on("mousemove.jBox-"+this.id,(function(o){this.position({mouseTarget:{top:o.pageY,left:o.pageX}})}).bind(this))},this._detachEvents=function(){this.options.closeOnEsc&&n(document).off("keyup.jBox-"+this.id),this.options.closeOnClick!==!0&&this.options.closeOnClick!="body"||n(document).off("click.jBox-"+this.id+" tap.jBox-"+this.id),this.options.adjustTracker&&n(window).off("scroll.jBox-"+this.id),(this.options.adjustPosition||this.options.reposition)&&n(window).off("resize.jBox-"+this.id),this.options.target=="mouse"&&n("body").off("mousemove.jBox-"+this.id)},this._showOverlay=function(){this.overlay||(this.overlay=n('<div id="'+this.id+'-overlay"/>').addClass("jBox-overlay"+(this.type?" jBox-overlay-"+this.type:"")).css({display:"none",opacity:0,zIndex:this.options.zIndex-1}).appendTo(this.options.appendTo),this.options.overlayClass&&this.overlay.addClass(this.options.overlayClass),this.options.closeButton!="overlay"&&this.options.closeButton!==!0||this.overlay.append(this.closeButton),this.options.closeOnClick=="overlay"&&this.overlay.on("click tap",(function(){this.close({ignoreDelay:!0})}).bind(this)),n("#"+this.id+"-overlay .jBox-closeButton").length&&(this.options.adjustDistance.top=Math.max(n("#"+this.id+"-overlay .jBox-closeButton").outerHeight(),this.options.adjustDistance.top))),this.adjustZIndexOnOpen===!0&&this.overlay.css("zIndex",parseInt(this.wrapper.css("zIndex"),10)-1),this.overlay.css("display")!="block"&&(this.options.fade?this.overlay.stop()&&this.overlay.animate({opacity:1},{queue:!1,duration:this.options.fade,start:(function(){this.overlay.css({display:"block"})}).bind(this)}):this.overlay.css({display:"block",opacity:1}))},this._hideOverlay=function(){this.overlay&&(this.options.fade?this.overlay.stop()&&this.overlay.animate({opacity:0},{queue:!1,duration:this.options.fade,complete:(function(){this.overlay.css({display:"none"})}).bind(this)}):this.overlay.css({display:"none",opacity:0}))},this._exposeDimensions=function(){this.wrapper.css({top:-1e4,left:-1e4,right:"auto",bottom:"auto"});var o={x:this.wrapper.outerWidth(),y:this.wrapper.outerHeight()};return this.wrapper.css({top:"auto",left:"auto"}),o},this._generateAnimationCSS=function(){if(n.type(this.options.animation)!="object"&&(this.options.animation={pulse:{open:"pulse",close:"zoomOut"},zoomIn:{open:"zoomIn",close:"zoomIn"},zoomOut:{open:"zoomOut",close:"zoomOut"},move:{open:"move",close:"move"},slide:{open:"slide",close:"slide"},flip:{open:"flip",close:"flip"},tada:{open:"tada",close:"zoomOut"}}[this.options.animation]),!this.options.animation)return null;this.options.animation.open&&(this.options.animation.open=this.options.animation.open.split(":")),this.options.animation.close&&(this.options.animation.close=this.options.animation.close.split(":")),this.options.animation.openDirection=this.options.animation.open[1]||null,this.options.animation.closeDirection=this.options.animation.close[1]||null,this.options.animation.open&&(this.options.animation.open=this.options.animation.open[0]),this.options.animation.close&&(this.options.animation.close=this.options.animation.close[0]),this.options.animation.open&&(this.options.animation.open+="Open"),this.options.animation.close&&(this.options.animation.close+="Close");var o={pulse:{duration:350,css:[["0%","scale(1)"],["50%","scale(1.1)"],["100%","scale(1)"]]},zoomInOpen:{duration:this.options.fade||180,css:[["0%","scale(0.9)"],["100%","scale(1)"]]},zoomInClose:{duration:this.options.fade||180,css:[["0%","scale(1)"],["100%","scale(0.9)"]]},zoomOutOpen:{duration:this.options.fade||180,css:[["0%","scale(1.1)"],["100%","scale(1)"]]},zoomOutClose:{duration:this.options.fade||180,css:[["0%","scale(1)"],["100%","scale(1.1)"]]},moveOpen:{duration:this.options.fade||180,positions:{top:{"0%":-12},right:{"0%":12},bottom:{"0%":12},left:{"0%":-12}},css:[["0%","translate%XY(%Vpx)"],["100%","translate%XY(0px)"]]},moveClose:{duration:this.options.fade||180,timing:"ease-in",positions:{top:{"100%":-12},right:{"100%":12},bottom:{"100%":12},left:{"100%":-12}},css:[["0%","translate%XY(0px)"],["100%","translate%XY(%Vpx)"]]},slideOpen:{duration:400,positions:{top:{"0%":-400},right:{"0%":400},bottom:{"0%":400},left:{"0%":-400}},css:[["0%","translate%XY(%Vpx)"],["100%","translate%XY(0px)"]]},slideClose:{duration:400,timing:"ease-in",positions:{top:{"100%":-400},right:{"100%":400},bottom:{"100%":400},left:{"100%":-400}},css:[["0%","translate%XY(0px)"],["100%","translate%XY(%Vpx)"]]},flipOpen:{duration:600,css:[["0%","perspective(400px) rotateX(90deg)"],["40%","perspective(400px) rotateX(-15deg)"],["70%","perspective(400px) rotateX(15deg)"],["100%","perspective(400px) rotateX(0deg)"]]},flipClose:{duration:this.options.fade||300,css:[["0%","perspective(400px) rotateX(0deg)"],["100%","perspective(400px) rotateX(90deg)"]]},tada:{duration:800,css:[["0%","scale(1)"],["10%, 20%","scale(0.9) rotate(-3deg)"],["30%, 50%, 70%, 90%","scale(1.1) rotate(3deg)"],["40%, 60%, 80%","scale(1.1) rotate(-3deg)"],["100%","scale(1) rotate(0)"]]}};n.each(["pulse","tada"],function(h,c){o[c+"Open"]=o[c+"Close"]=o[c]});var a=(function(h,c){var d="@keyframes jBox-"+this.id+"-animation-"+this.options.animation[h]+"-"+h+(c?"-"+c:"")+" {";return n.each(o[this.options.animation[h]].css,(function(f,_){var y=c?_[1].replace("%XY",this._getXY(c).toUpperCase()):_[1];o[this.options.animation[h]].positions&&(y=y.replace("%V",o[this.options.animation[h]].positions[c][_[0]])),d+=_[0]+" {transform:"+y+";}"}).bind(this)),d+="}",d+=".jBox-"+this.id+"-animation-"+this.options.animation[h]+"-"+h+(c?"-"+c:"")+" {",d+="animation-duration: "+o[this.options.animation[h]].duration+"ms;",d+="animation-name: jBox-"+this.id+"-animation-"+this.options.animation[h]+"-"+h+(c?"-"+c:"")+";",d+=o[this.options.animation[h]].timing?"animation-timing-function: "+o[this.options.animation[h]].timing+";":"",d+="}"}).bind(this);this._animationCSS="",n.each(["open","close"],(function(h,c){if(!this.options.animation[c]||!o[this.options.animation[c]]||c=="close"&&!this.options.fade)return"";o[this.options.animation[c]].positions?n.each(["top","right","bottom","left"],(function(d,f){this._animationCSS+=a(c,f)}).bind(this)):this._animationCSS+=a(c)}).bind(this))},this.options.animation&&this._generateAnimationCSS(),this._blockBodyClick=function(){this.blockBodyClick=!0,setTimeout((function(){this.blockBodyClick=!1}).bind(this),10)},this._animate=function(o){if(o=o||(this.isOpen?"open":"close"),!this.options.fade&&o=="close")return null;var a=this.options.animation[o+"Direction"]||(this.align!="center"?this.align:this.options.attributes.x);this.flipped&&this._getXY(a)==this._getXY(this.align)&&(a=this._getOpp(a));var h="jBox-"+this.id+"-animation-"+this.options.animation[o]+"-"+o+" jBox-"+this.id+"-animation-"+this.options.animation[o]+"-"+o+"-"+a;this.wrapper.addClass(h),a=1e3*parseFloat(this.wrapper.css("animation-duration")),o=="close"&&(a=Math.min(a,this.options.fade)),setTimeout((function(){this.wrapper&&this.wrapper.removeClass(h)}).bind(this),a)},this._abortAnimation=function(){var o=this.wrapper.attr("class").split(" ").filter((function(a){return a.lastIndexOf("jBox-"+this.id+"-animation",0)!==0}).bind(this));this.wrapper.attr("class",o.join(" "))},(this.options.responsiveWidth||this.options.responsiveHeight)&&n(window).on("resize.responsivejBox-"+this.id,(function(o){this.isOpen&&this.position()}).bind(this)),n.type(this.options.preloadAudio)==="string"&&(this.options.preloadAudio=[this.options.preloadAudio]),n.type(this.options.audio)==="string"&&(this.options.audio={open:this.options.audio}),n.type(this.options.volume)==="number"&&(this.options.volume={open:this.options.volume,close:this.options.volume}),this.options.preloadAudio===!0&&this.options.audio&&(this.options.preloadAudio=[],n.each(this.options.audio,(function(o,a){this.options.preloadAudio.push(a+".mp3"),this.options.preloadAudio.push(a+".ogg")}).bind(this))),this.options.preloadAudio.length&&n.each(this.options.preloadAudio,function(o,a){var h=new Audio;h.src=a,h.preload="auto"}),this._fireEvent("onInit"),this}var t,i;return e.prototype.attach=function(s,r){return s=s||this.options.attach,n.type(s)=="string"&&(s=n(s)),r=r||this.options.trigger,s&&s.length&&n.each(s,(function(o,a){(a=n(a)).data("jBox-attached-"+this.id)||(this.options.getContent=="title"&&a.attr("title")!=null&&a.data("jBox-getContent",a.attr("title")).removeAttr("title"),this.attachedElements||(this.attachedElements=[]),this.attachedElements.push(a[0]),a.on(r+".jBox-attach-"+this.id,(function(h){var c;this.timer&&clearTimeout(this.timer),r=="mouseenter"&&this.isOpen&&this.source[0]==a[0]||(this.isOpen&&this.source&&this.source[0]!=a[0]&&(c=!0),this.source=a,this.options.target||(this.target=a),r=="click"&&this.options.preventDefault&&h.preventDefault(),this[r!="click"||c?"open":"toggle"]())}).bind(this)),this.options.trigger=="mouseenter"&&a.on("mouseleave",(function(h){if(!this.wrapper)return null;this.options.closeOnMouseleave&&(h.relatedTarget==this.wrapper[0]||n(h.relatedTarget).parents("#"+this.id).length)||this.close()}).bind(this)),a.data("jBox-attached-"+this.id,r),this._fireEvent("onAttach",a))}).bind(this)),this},e.prototype.detach=function(s){return(s=s||this.attachedElements||[])&&s.length&&n.each(s,(function(r,o){(o=n(o)).data("jBox-attached-"+this.id)&&(o.off(o.data("jBox-attached-"+this.id)+".jBox-attach-"+this.id),o.data("jBox-attached-"+this.id,null)),this.attachedElements=n.grep(this.attachedElements,function(a){return a!=o[0]})}).bind(this)),this},e.prototype.setTitle=function(s,r){if(s==null||s==null)return this;this.wrapper||this._create();var o=this.wrapper.outerHeight(),a=this.wrapper.outerWidth();return this.title||(this.titleContainer=n('<div class="jBox-title"/>'),this.title=n("<div/>").appendTo(this.titleContainer),this.options.closeButton!="title"&&(this.options.closeButton!==!0||this.options.overlay)||(this.wrapper.addClass("jBox-closeButton-title"),this.closeButton.appendTo(this.titleContainer)),this.titleContainer.insertBefore(this.content),this._setTitleWidth()),this.wrapper[s?"addClass":"removeClass"]("jBox-hasTitle"),this.title.html(s),a!=this.wrapper.outerWidth()&&this._setTitleWidth(),this.options.draggable&&this._draggable(),r||!this.options.repositionOnContent||o==this.wrapper.outerHeight()&&a==this.wrapper.outerWidth()||this.position(),this},e.prototype.setContent=function(s,r){if(s==null||s==null)return this;this.wrapper||this._create();var o=this.wrapper.outerHeight(),a=this.wrapper.outerWidth();switch(this.content.children("[data-jbox-content-appended]").appendTo("body").css({display:"none"}),n.type(s)){case"string":this.content.html(s);break;case"object":s&&(s instanceof n||s.constructor.prototype.jquery)?(this.content.html(""),s.attr("data-jbox-content-appended",1).appendTo(this.content).css({display:"block"})):this.content.html(JSON.stringify(s))}return a!=this.wrapper.outerWidth()&&this._setTitleWidth(),this.options.draggable&&this._draggable(),r||!this.options.repositionOnContent||o==this.wrapper.outerHeight()&&a==this.wrapper.outerWidth()||this.position(),this},e.prototype.setDimensions=function(s,r,o){this.wrapper||this._create(),this.content.css(s,this._getInt(r=r??"auto")),s=="width"&&this._setTitleWidth(),this.options[s]=r,o!=null&&!o||this.position()},e.prototype.setWidth=function(s,r){this.setDimensions("width",s,r)},e.prototype.setHeight=function(s,r){this.setDimensions("height",s,r)},e.prototype.position=function(s){if(s=n.extend(!0,this.options,s=s||{}),this.target=s.target||this.target||n(window),this.target instanceof n||this.target=="mouse"||(this.target=n(this.target)),!this.target.length)return this;this.content.css({width:this._getInt(s.width,"width"),height:this._getInt(s.height,"height"),minWidth:this._getInt(s.minWidth,"width"),minHeight:this._getInt(s.minHeight,"height"),maxWidth:this._getInt(s.maxWidth,"width"),maxHeight:this._getInt(s.maxHeight,"height")}),this._setTitleWidth();var r=this._exposeDimensions();this.target=="mouse"||this.target.data("jBox-"+this.id+"-fixed")||this.target.data("jBox-"+this.id+"-fixed",this.target[0]!=n(window)[0]&&(this.target.css("position")=="fixed"||0<this.target.parents().filter(function(){return n(this).css("position")=="fixed"}).length)?"fixed":"static");var o={x:n(window).outerWidth(),y:n(window).outerHeight(),top:s.fixed&&this.target.data("jBox-"+this.id+"-fixed")?0:n(window).scrollTop(),left:s.fixed&&this.target.data("jBox-"+this.id+"-fixed")?0:n(window).scrollLeft()};o.bottom=o.top+o.y,o.right=o.left+o.x;try{var a=this.target.offset()}catch{a={top:0,left:0}}this.target!="mouse"&&this.target.data("jBox-"+this.id+"-fixed")=="fixed"&&s.fixed&&(a.top=a.top-n(window).scrollTop(),a.left=a.left-n(window).scrollLeft());var h={x:this.target=="mouse"?12:this.target.outerWidth(),y:this.target=="mouse"?20:this.target.outerHeight(),top:this.target=="mouse"&&s.mouseTarget?s.mouseTarget.top:a?a.top:0,left:this.target=="mouse"&&s.mouseTarget?s.mouseTarget.left:a?a.left:0},c=s.outside&&!(s.position.x=="center"&&s.position.y=="center"),d={x:o.x-s.adjustDistance.left-s.adjustDistance.right,y:o.y-s.adjustDistance.top-s.adjustDistance.bottom,left:c?h.left-n(window).scrollLeft()-s.adjustDistance.left:0,right:c?o.x-h.left+n(window).scrollLeft()-h.x-s.adjustDistance.right:0,top:c?h.top-n(window).scrollTop()-this.options.adjustDistance.top:0,bottom:c?o.y-h.top+n(window).scrollTop()-h.y-s.adjustDistance.bottom:0},f={x:s.outside!="x"&&s.outside!="xy"||n.type(s.position.x)=="number"?null:s.position.x,y:s.outside!="y"&&s.outside!="xy"||n.type(s.position.y)=="number"?null:s.position.y},_={x:!1,y:!1};f.x&&r.x>d[f.x]&&d[this._getOpp(f.x)]>d[f.x]&&(f.x=this._getOpp(f.x))&&(_.x=!0),f.y&&r.y>d[f.y]&&d[this._getOpp(f.y)]>d[f.y]&&(f.y=this._getOpp(f.y))&&(_.y=!0),(s.responsiveWidth||s.responsiveHeight)&&(G=(function(){var T;s.responsiveWidth&&r.x>d[f.x||"x"]&&(T=d[f.x||"x"]-(this.pointer&&c&&s.outside=="x"?this.pointer.dimensions.x:0)-parseInt(this.container.css("border-left-width"))-parseInt(this.container.css("border-right-width")),this.content.css({width:T>this.options.responsiveMinWidth?T:null,minWidth:T<parseInt(this.content.css("minWidth"))?0:null}),this._setTitleWidth()),r=this._exposeDimensions()}).bind(this),s.responsiveWidth&&G(),s.responsiveWidth&&!_.y&&f.y&&r.y>d[f.y]&&d[this._getOpp(f.y)]>d[f.y]&&(f.y=this._getOpp(f.y))&&(_.y=!0),k=(function(){var T;s.responsiveHeight&&r.y>d[f.y||"y"]&&(T=(function(){return this.titleContainer||this.footer?(this.wrapper.css("display")=="none"?(this.wrapper.css("display","block"),j=(this.titleContainer?this.titleContainer.outerHeight():0)+(this.footer?this.footer.outerHeight():0),this.wrapper.css("display","none")):j=(this.titleContainer?this.titleContainer.outerHeight():0)+(this.footer?this.footer.outerHeight():0),j||0):0;var j}).bind(this),T=d[f.y||"y"]-(this.pointer&&c&&s.outside=="y"?this.pointer.dimensions.y:0)-T()-parseInt(this.container.css("border-top-width"))-parseInt(this.container.css("border-bottom-width")),this.content.css({height:T>this.options.responsiveMinHeight?T:null}),this._setTitleWidth()),r=this._exposeDimensions()}).bind(this),s.responsiveHeight&&k(),s.responsiveHeight&&!_.x&&f.x&&r.x>d[f.x]&&d[this._getOpp(f.x)]>d[f.x]&&(f.x=this._getOpp(f.x))&&(_.x=!0),s.adjustPosition&&s.adjustPosition!="move"&&(_.x&&G(),_.y&&k()));var y={},S=(function(T){if(n.type(s.position[T])!="number"){var j=s.attributes[T]=T=="x"?"left":"top";if(y[j]=h[j],s.position[T]=="center")return y[j]+=Math.ceil((h[T]-r[T])/2),void(this.target!="mouse"&&this.target[0]&&this.target[0]==n(window)[0]&&(y[j]+=.5*(s.adjustDistance[j]-s.adjustDistance[this._getOpp(j)])));j!=s.position[T]&&(y[j]+=h[T]-r[T]),s.outside!=T&&s.outside!="xy"||(y[j]+=r[T]*(j!=s.position[T]?1:-1))}else y[s.attributes[T]]=s.position[T]}).bind(this);if(S("x"),S("y"),this.pointer&&s.pointTo=="target"&&n.type(s.position.x)!="number"&&n.type(s.position.y)!="number"&&(z=0,this.pointer.align==="center"?s.position[this._getOpp(s.outside)]!="center"&&(z+=r[this._getOpp(s.outside)]/2):s.position[this._getOpp(s.outside)]==="center"?z+=(r[this._getOpp(s.outside)]/2-this.pointer.dimensions[this._getOpp(s.outside)]/2)*(this.pointer.align==this._getTL(this.pointer.align)?1:-1):z+=this.pointer.align!=s.position[this._getOpp(s.outside)]?r[this._getOpp(s.outside)]*(n.inArray(this.pointer.align,["top","left"])!==-1?1:-1)+this.pointer.dimensions[this._getOpp(s.outside)]/2*(n.inArray(this.pointer.align,["top","left"])!==-1?-1:1):this.pointer.dimensions[this._getOpp(s.outside)]/2*(n.inArray(this.pointer.align,["top","left"])!==-1?1:-1),z*=s.position[this._getOpp(s.outside)]==this.pointer.alignAttribute?-1:1,z+=this.pointer.offset*(this.pointer.align==this._getOpp(this._getTL(this.pointer.align))?1:-1),y[this._getTL(this._getOpp(this.pointer.xy))]+=z),y[s.attributes.x]+=s.offset.x,y[s.attributes.y]+=s.offset.y,this.wrapper.css(y),s.adjustPosition){this.positionAdjusted&&(this.pointer&&this.wrapper.css("padding",0).css("padding-"+this._getOpp(this.outside),this.pointer.dimensions[this._getXY(this.outside)]).removeClass("jBox-pointerPosition-"+this._getOpp(this.pointer.position)).addClass("jBox-pointerPosition-"+this.pointer.position),this.pointer&&this.pointer.element.attr("class","jBox-pointer jBox-pointer-"+this._getOpp(this.outside)).css(this.pointer.margin),this.positionAdjusted=!1,this.flipped=!1);var v=o.top>y.top-(s.adjustDistance.top||0),I=o.right<y.left+r.x+(s.adjustDistance.right||0),A=o.bottom<y.top+r.y+(s.adjustDistance.bottom||0),B=o.left>y.left-(s.adjustDistance.left||0),a=B?"left":I?"right":null,G=v?"top":A?"bottom":null;if(a||G){if((this.type=="Modal"||this.type=="Confirm")&&n.type(this.options.position.x)=="number"&&n.type(this.options.position.y)=="number"){var k=0,z=0;return this.options.holdPosition&&(B?k=o.left-(y.left-(s.adjustDistance.left||0)):I&&(k=o.right-(y.left+r.x+(s.adjustDistance.right||0))),v?z=o.top-(y.top-(s.adjustDistance.top||0)):A&&(z=o.bottom-(y.top+r.y+(s.adjustDistance.bottom||0))),this.options.position.x=Math.max(o.top,this.options.position.x+k),this.options.position.y=Math.max(o.left,this.options.position.y+z),S("x"),S("y"),this.wrapper.css(y)),this._fireEvent("onPosition"),this}s.adjustPosition!==!0&&s.adjustPosition!=="flip"||(q=(function(j){this.wrapper.css(this._getTL(j),y[this._getTL(j)]+(r[this._getXY(j)]+s.offset[this._getXY(j)]*(j=="top"||j=="left"?-2:2)+h[this._getXY(j)])*(j=="top"||j=="left"?1:-1)),this.pointer&&this.wrapper.removeClass("jBox-pointerPosition-"+this.pointer.position).addClass("jBox-pointerPosition-"+this._getOpp(this.pointer.position)).css("padding",0).css("padding-"+j,this.pointer.dimensions[this._getXY(j)]),this.pointer&&this.pointer.element.attr("class","jBox-pointer jBox-pointer-"+j),this.positionAdjusted=!0,this.flipped=!0}).bind(this),_.x&&q(this.options.position.x),_.y&&q(this.options.position.y));var q=this._getXY(this.outside)=="x"?G:a;this.pointer&&s.pointTo=="target"&&s.adjustPosition!="flip"&&this._getXY(q)==this._getOpp(this._getXY(this.outside))&&(G=this.pointer.align=="center"?r[this._getXY(q)]/2-this.pointer.dimensions[this._getOpp(this.pointer.xy)]/2-parseInt(this.pointer.element.css("margin-"+this.pointer.alignAttribute))*(q!=this._getTL(q)?-1:1):q==this.pointer.alignAttribute?parseInt(this.pointer.element.css("margin-"+this.pointer.alignAttribute)):r[this._getXY(q)]-parseInt(this.pointer.element.css("margin-"+this.pointer.alignAttribute))-this.pointer.dimensions[this._getXY(q)],a=q==this._getTL(q)?o[this._getTL(q)]-y[this._getTL(q)]+s.adjustDistance[q]:-1*(o[this._getOpp(this._getTL(q))]-y[this._getTL(q)]-s.adjustDistance[q]-r[this._getXY(q)]),q==this._getOpp(this._getTL(q))&&y[this._getTL(q)]-a<o[this._getTL(q)]+s.adjustDistance[this._getTL(q)]&&(a-=o[this._getTL(q)]+s.adjustDistance[this._getTL(q)]-(y[this._getTL(q)]-a)),(a=Math.min(a,G))<=G&&0<a&&(this.pointer.element.css("margin-"+this.pointer.alignAttribute,parseInt(this.pointer.element.css("margin-"+this.pointer.alignAttribute))-a*(q!=this.pointer.alignAttribute?-1:1)),this.wrapper.css(this._getTL(q),y[this._getTL(q)]+a*(q!=this._getTL(q)?-1:1)),this.positionAdjusted=!0))}}return this._fireEvent("onPosition"),this},(e.prototype.unscroll=function(s){if(this.set=function(_,y){window.unscrollStore||(window.unscrollStore={}),window.unscrollStore[_]=y},this.get=function(_){return window.unscrollStore?window.unscrollStore[_]:null},this.getScrollbarWidth=function(){if(this.get("scrollbarWidth"))return this.get("scrollbarWidth")+"px";var _=document.createElement("div");_.style.width="100px",_.style.height="100px",_.style.overflow="scroll",_.style.position="absolute",_.style.top="-10000",document.body.appendChild(_);var y=_.offsetWidth-_.clientWidth;return document.body.removeChild(_),this.set("scrollbarWidth",y),y+"px"},this.getElementsToAdjust=function(_){(_=typeof(_=_||[])=="string"?[[_,"padding-right"]]:_).forEach(function(v,I){typeof v=="string"&&(_[I]=[v,"padding-right"])});for(var y=!1,S=0;S<_.length;S++)_[S][0].indexOf("body")!==-1&&(y=!0);return y===!1&&_.push(["body","padding-right"]),_},this.pageHasScrollbar=function(){return this.getScrollbarWidth()&&document.body.offsetHeight>window.innerHeight},this.pageHasScrollbar()){s=this.getElementsToAdjust(s);for(var r=0;r<s.length;r++)for(var o=document.querySelectorAll(s[r][0]),a=0;a<o.length;a++){if(o[a].getAttribute("data-unscroll"))return;var h=s[r][1],c=window.getComputedStyle(o[a]).getPropertyValue(h);o[a].setAttribute("data-unscroll",h),o[a].style[h]="calc("+(c=c||"0px")+" "+(h=="padding-right"||h=="right"?"+":"-")+" "+this.getScrollbarWidth()+")"}}var d,f;document.getElementById("unscroll-class-name")||(d=document.head||document.getElementsByTagName("head")[0],(f=document.createElement("style")).type="text/css",f.setAttribute("id","unscroll-class-name"),f.appendChild(document.createTextNode(".unscrollable { overflow: hidden !important; }")),d.appendChild(f)),document.body.classList.add("unscrollable")}).reset=function(){for(var s=document.querySelectorAll("[data-unscroll]"),r=0;r<s.length;r++){var o=s[r].getAttribute("data-unscroll");s[r].style[o]=null,s[r].removeAttribute("data-unscroll")}document.body.classList.remove("unscrollable")},e.prototype.open=function(s){if(s=s||{},this.isDestroyed)return this;if(this.wrapper||this._create(),this._styles||(this._styles=n("<style/>").append(this._animationCSS).appendTo(n("head"))),this.timer&&clearTimeout(this.timer),this._blockBodyClick(),this.isDisabled)return this;this.options.closeOnEsc&&n(document).on("keyup.jBox-"+this.id,(function(o){o.keyCode==27&&this.close({ignoreDelay:!0})}).bind(this)),this.options.closeOnClick!==!0&&this.options.closeOnClick!=="body"||(n("body").on("click.jBox-"+this.id+" tap.jBox-"+this.id,(function(o){this.blockBodyClick||this.options.closeOnClick=="body"&&(o.target==this.wrapper[0]||this.wrapper.has(o.target).length)||this.close({ignoreDelay:!0})}).bind(this)),this.isTouchDevice&&n("body > *").on("click.jBox-"+this.id+" tap.jBox-"+this.id,function(){return!0}));var r=(function(){this.adjustZIndexOnOpen===!0&&(e.zIndexMax=Math.max(parseInt(this.wrapper.css("zIndex"),10),this.options.zIndex,e.zIndexMax||0,e.zIndexMaxDragover||0)+2,this.wrapper.css("zIndex",e.zIndexMax),this.options.zIndex=e.zIndexMax),this.source&&this.options.getTitle&&this.source.attr(this.options.getTitle)&&this.setTitle(this.source.attr(this.options.getTitle),!0),this.source&&this.options.getContent&&(this.source.data("jBox-getContent")?this.setContent(this.source.data("jBox-getContent"),!0):this.source.attr(this.options.getContent)?this.setContent(this.source.attr(this.options.getContent),!0):this.options.getContent=="html"&&this.setContent(this.source.html(),!0)),this._fireEvent("onOpen"),(this.options.ajax&&(this.options.ajax.url||this.source&&this.source.attr(this.options.ajax.getURL))&&(!this.ajaxLoaded||this.options.ajax.reload)||s.ajax&&(s.ajax.url||s.ajax.data))&&(this.options.ajax.reload=="strict"||!this.source||!this.source.data("jBox-ajax-data")||s.ajax&&(s.ajax.url||s.ajax.data)?this.ajax(s.ajax||null,!0):this.setContent(this.source.data("jBox-ajax-data"))),this.positionedOnOpen&&!this.options.repositionOnOpen||!this.position(s)||(this.positionedOnOpen=!0),this.isClosing&&this._abortAnimation(),this.isOpen||(this.isOpen=!0,this.options.autoClose&&(this.options.delayClose=this.options.autoClose)&&this.close(),this._attachEvents(),this.options.blockScroll&&(this.options.blockScrollAdjust?e.blockScrollScopes?e.blockScrollScopes++:(e.blockScrollScopes=1,this.unscroll(Array.isArray(this.options.blockScrollAdjust)||typeof this.options.blockScrollAdjust=="string"?this.options.blockScrollAdjust:null)):n("body").addClass("jBox-blockScroll-"+this.id)),this.options.overlay&&(this._showOverlay(),this.position()),this.options.animation&&!this.isClosing&&this._animate("open"),this.options.audio&&this.options.audio.open&&this.audio(this.options.audio.open,this.options.volume.open),this.options.fade?this.wrapper.stop().animate({opacity:1},{queue:!1,duration:this.options.fade,start:(function(){this.isOpening=!0,this.wrapper.css({display:"block"})}).bind(this),complete:(function(){this._fireEvent("onOpenComplete")}).bind(this),always:(function(){this.isOpening=!1,setTimeout((function(){this.positionOnFadeComplete&&this.position()&&(this.positionOnFadeComplete=!1)}).bind(this),10)}).bind(this)}):(this.wrapper.css({display:"block",opacity:1}),this.positionOnFadeComplete&&this.position()&&(this.positionOnFadeComplete=!1),this._fireEvent("onOpenComplete")))}).bind(this);return!this.options.delayOpen||this.isOpen||this.isClosing||s.ignoreDelay?r():this.timer=setTimeout(r,this.options.delayOpen),this},e.prototype.close=function(s){if(s=s||{},n("body").off("click.jBox-"+this.id+" tap.jBox-"+this.id),this.isTouchDevice&&n("body > *").off("click.jBox-"+this.id+" tap.jBox-"+this.id),this.isDestroyed||this.isClosing)return this;if(this.timer&&clearTimeout(this.timer),this._blockBodyClick(),this.isDisabled)return this;var r,o,a,h=(function(){var c;this._fireEvent("onClose"),this.options.cancelAjaxOnClose&&this.cancelAjax(),this.isOpen&&(this.isOpen=!1,this._detachEvents(),this.options.blockScroll&&(this.options.blockScrollAdjust?(e.blockScrollScopes=e.blockScrollScopes?--e.blockScrollScopes:0)||this.unscroll.reset():n("body").removeClass("jBox-blockScroll-"+this.id)),this.options.overlay&&this._hideOverlay(),this.options.animation&&!this.isOpening&&this._animate("close"),this.options.audio&&this.options.audio.close&&this.audio(this.options.audio.close,this.options.volume.close),(c=this.isTouchDevice&&this.options.target=="mouse"?0:this.options.fade)?this.wrapper.stop().animate({opacity:0},{queue:!1,duration:c,start:(function(){this.isClosing=!0}).bind(this),complete:(function(){this.wrapper.css({display:"none"}),this._fireEvent("onCloseComplete")}).bind(this),always:(function(){this.isClosing=!1}).bind(this)}):(this.wrapper.css({display:"none",opacity:0}),this._fireEvent("onCloseComplete")))}).bind(this);return s.ignoreDelay||this.isTouchDevice&&this.options.target=="mouse"?h():(this.options.delayOnHover||this.options.showCountdown)&&10<this.options.delayClose?(o=(r=this).options.delayClose,a=Date.now(),this.options.showCountdown&&!this.inner&&(s=n('<div class="jBox-countdown" />'),this.inner=n('<div class="jBox-countdown-inner" />'),s.prepend(this.inner),n("#"+this.id).append(s)),this.countdown=function(){var c=Date.now();r.isHovered||(o-=c-a),a=c,0<o?(r.options.showCountdown&&r.inner.css("width",100*o/r.options.delayClose+"%"),window.requestAnimationFrame(r.countdown)):h()},window.requestAnimationFrame(this.countdown)):this.timer=setTimeout(h,Math.max(this.options.delayClose,10)),this},e.prototype.toggle=function(s){return this[this.isOpen?"close":"open"](s),this},e.prototype.disable=function(){return this.isDisabled=!0,this},e.prototype.enable=function(){return this.isDisabled=!1,this},e.prototype.hide=function(){return this.disable(),this.wrapper&&(this.cacheWrapperDisplay=this.wrapper.css("display"),this.wrapper.css({display:"none"})),this.overlay&&(this.cacheOverlayDisplay=this.overlay.css("display"),this.overlay.css({display:"none"})),this},e.prototype.show=function(){return this.enable(),this.wrapper&&this.cacheWrapperDisplay&&(this.wrapper.css({display:this.cacheWrapperDisplay}),this.cacheWrapperDisplay=null),this.overlay&&this.cacheOverlayDisplay&&(this.overlay.css({display:this.cacheOverlayDisplay}),this.cacheOverlayDisplay=null),this},e.prototype.ajax=function(s,r){s=s||{},n.each([["getData","data"],["getURL","url"]],(function(_,y){this.options.ajax[y[0]]&&!s[y[1]]&&this.source&&this.source.attr(this.options.ajax[y[0]])!=null&&(s[y[1]]=this.source.attr(this.options.ajax[y[0]])||"")}).bind(this));var o=n.extend(!0,{},this.options.ajax);this.cancelAjax();var a=s.beforeSend||o.beforeSend||function(){},h=s.complete||o.complete||function(){},c=s.success||o.success||function(){},d=s.error||o.error||function(){},f=n.extend(!0,o,s);return f.beforeSend=(function(_){f.loadingClass&&this.wrapper.addClass(f.loadingClass===!0?"jBox-loading":f.loadingClass),f.spinner&&(this.spinnerDelay=setTimeout((function(){this.wrapper.addClass("jBox-loading-spinner"),f.spinnerReposition&&(r?this.positionOnFadeComplete=!0:this.position()),this.spinner=n(f.spinner!==!0?f.spinner:'<div class="jBox-spinner"></div>').appendTo(this.container),this.titleContainer&&this.spinner.css("position")=="absolute"&&this.spinner.css({transform:"translateY("+.5*this.titleContainer.outerHeight()+"px)"})}).bind(this),this.content.html()!=""&&f.spinnerDelay||0)),a.bind(this)(_)}).bind(this),f.complete=(function(_){this.spinnerDelay&&clearTimeout(this.spinnerDelay),this.wrapper.removeClass("jBox-loading jBox-loading-spinner jBox-loading-spinner-delay"),this.spinner&&this.spinner.length&&this.spinner.remove()&&f.spinnerReposition&&(r?this.positionOnFadeComplete=!0:this.position()),this.ajaxLoaded=!0,h.bind(this)(_)}).bind(this),f.success=(function(_){f.setContent&&this.setContent(_,!0)&&(r?this.positionOnFadeComplete=!0:this.position()),f.setContent&&this.source&&this.source.data("jBox-ajax-data",_),c.bind(this)(_)}).bind(this),f.error=(function(_){d.bind(this)(_)}).bind(this),this.ajaxRequest=n.ajax(f),this},e.prototype.cancelAjax=function(){this.ajaxRequest&&(this.ajaxRequest.abort(),this.ajaxLoaded=!1)},e.prototype.audio=function(s,r){if(!s)return this;var o;(e._audio=e._audio?e._audio:{})[s]||(o=n("<audio/>"),n("<source/>",{src:s+".mp3"}).appendTo(o),n("<source/>",{src:s+".ogg"}).appendTo(o),e._audio[s]=o[0]),e._audio[s].volume=Math.min((r??100)/100,1);try{e._audio[s].pause(),e._audio[s].currentTime=0}catch{}return e._audio[s].play(),this},e._animationSpeeds={tada:1e3,tadaSmall:1e3,flash:500,shake:400,pulseUp:250,pulseDown:250,popIn:250,popOut:250,fadeIn:200,fadeOut:200,slideUp:400,slideRight:400,slideLeft:400,slideDown:400},e.prototype.animate=function(s,r){r=r||{},this.animationTimeout||(this.animationTimeout={}),r.element||(r.element=this.wrapper),r.element.data("jBox-animating-id")||r.element.data("jBox-animating-id",e._getUniqueElementID()),r.element.data("jBox-animating")&&(r.element.removeClass(r.element.data("jBox-animating")).data("jBox-animating",null),this.animationTimeout[r.element.data("jBox-animating-id")]&&clearTimeout(this.animationTimeout[r.element.data("jBox-animating-id")])),r.element.addClass("jBox-animated-"+s).data("jBox-animating","jBox-animated-"+s),this.animationTimeout[r.element.data("jBox-animating-id")]=setTimeout(function(){r.element.removeClass(r.element.data("jBox-animating")).data("jBox-animating",null),r.complete&&r.complete()},e._animationSpeeds[s])},e.prototype.swipeDetector=function(s,r){var o=0,a=0,h=0,c=0,d=0;function f(S){r.useOnlyTouch&&!S.originalEvent.touches||(S.originalEvent.touches&&(S=S.originalEvent.touches[0]),o===0&&(o=1,a=S.clientX,h=S.clientY))}function _(S){o===2&&(o=0,Math.abs(c)>Math.abs(d)&&Math.abs(c)>r.swipeThreshold?c<0?s.trigger(n.Event("swipeLeft.sd")):s.trigger(n.Event("swipeRight.sd")):Math.abs(d)>r.swipeThreshold&&(d<0?s.trigger(n.Event("swipeUp.sd")):s.trigger(n.Event("swipeDown.sd"))))}function y(S){var v;o===1&&(v=(S=S.originalEvent.touches?S.originalEvent.touches[0]:S).clientX-a,S=S.clientY-h,(Math.abs(v)>r.swipeThreshold||Math.abs(S)>r.swipeThreshold)&&(o=2,c=v,d=S))}return r=n.extend({swipeThreshold:70,useOnlyTouch:!1},r),s.on("mousedown touchstart",f),n("html").on("mouseup touchend",_),n("html").on("mousemove touchmove",y),s},e.prototype.destroy=function(){return this.detach(),this.isOpen&&this.close({ignoreDelay:!0}),this.wrapper&&this.wrapper.remove(),this.overlay&&this.overlay.remove(),this._styles&&this._styles.remove(),this.isDestroyed=!0,this},e._getUniqueID=(t=1,function(){return t++}),e._getUniqueElementID=(i=1,function(){return i++}),e._pluginOptions={},e.plugin=function(s,r){e._pluginOptions[s]=r},n.fn.jBox=function(s,r){return new e(s=s||{},n.extend(r=r||{},{attach:this}))},e}function jBoxConfirmWrapper(jBox,jQuery){new jBox.plugin("Confirm",{confirmButton:"Submit",cancelButton:"Cancel",confirm:null,cancel:null,closeOnConfirm:!0,target:window,fixed:!0,attach:"[data-confirm]",getContent:"data-confirm",content:"Do you really want to do this?",minWidth:360,maxWidth:500,blockScroll:!0,closeOnEsc:!0,closeOnClick:!1,closeButton:!1,overlay:!0,animation:"zoomIn",preventDefault:!0,_onAttach:function(n){var e;this.options.confirm||(e=n.attr("onclick")?n.attr("onclick"):n.attr("href")?n.attr("target")?'window.open("'+n.attr("href")+'", "'+n.attr("target")+'");':'window.location.href = "'+n.attr("href")+'";':"",n.prop("onclick",null).data("jBox-Confirm-submit",e))},_onCreated:function(){this.wrapper.addClass("jBox-Modal"),this.footer=jQuery('<div class="jBox-Confirm-footer"/>'),jQuery('<div class="jBox-Confirm-button jBox-Confirm-button-cancel"/>').html(this.options.cancelButton).on("click tap",(function(){this.options.cancel&&this.options.cancel(this.source),this.close()}).bind(this)).appendTo(this.footer),this.submitButton=jQuery('<div class="jBox-Confirm-button jBox-Confirm-button-submit"/>').html(this.options.confirmButton).appendTo(this.footer),this.footer.appendTo(this.container)},_onOpen:function(){this.submitButton.off("click.jBox-Confirm"+this.id+" tap.jBox-Confirm"+this.id).on("click.jBox-Confirm"+this.id+" tap.jBox-Confirm"+this.id,(function(){this.options.confirm?this.options.confirm(this.source):eval(this.source.data("jBox-Confirm-submit")),this.options.closeOnConfirm&&this.close()}).bind(this))}})}function jBoxImageWrapper(n,e){new n.plugin("Image",{src:"href",gallery:"data-jbox-image",imageLabel:"title",imageFade:360,imageSize:"contain",imageCounter:!1,imageCounterSeparator:"/",downloadButton:!1,downloadButtonText:null,downloadButtonUrl:null,mobileImageAttr:null,mobileImageBreakpoint:null,preloadFirstImage:!1,target:window,attach:"[data-jbox-image]",fixed:!0,blockScroll:!0,closeOnEsc:!0,closeOnClick:"button",closeButton:!0,overlay:!0,animation:"zoomIn",preventDefault:!0,width:"100%",height:"100%",adjustDistance:{top:40,right:0,bottom:40,left:0},_onInit:function(){this.images=this.currentImage={},this.imageZIndex=1,this.initImage=(function(s){var r,o;(s=e(s)).data("jBox-image-gallery")||(r=s.attr(this.options.src),this.options.mobileImageAttr&&this.options.mobileImageBreakpoint&&s.attr(this.options.mobileImageAttr)&&e(window).width()<=this.options.mobileImageBreakpoint&&(r=s.attr(this.options.mobileImageAttr)),o=s.attr(this.options.gallery)||"default",this.images[o]||(this.images[o]=[]),this.images[o].push({src:r,label:s.attr(this.options.imageLabel)||"",downloadUrl:this.options.downloadButtonUrl&&s.attr(this.options.downloadButtonUrl)?s.attr(this.options.downloadButtonUrl):null}),this.options.imageLabel=="title"&&s.removeAttr("title"),s.data("jBox-image-gallery",o),s.data("jBox-image-id",this.images[o].length-1))}).bind(this),this.attachedElements&&this.attachedElements.length&&e.each(this.attachedElements,(function(s,r){this.initImage(r)}).bind(this));var t=(function(s,r,o,a){if(!e("#jBox-image-"+s+"-"+r).length){var h=e("<div/>",{id:"jBox-image-"+s+"-"+r,class:"jBox-image-container"+(o?" jBox-image-"+s+"-current":"")}).css({backgroundSize:this.options.imageSize,opacity:a?1:0,zIndex:o?this.imageZIndex++:0}).appendTo(this.content);return this.swipeDetector(h).on("swipeLeft.sd swipeRight.sd",(function(c){c.type==="swipeLeft"?this.showImage("next"):c.type==="swipeRight"&&this.showImage("prev")}).bind(this)),e("<div/>",{id:"jBox-image-label-"+s+"-"+r,class:"jBox-image-label"+(o?" active":"")}).html(this.images[s][r].label).on("click tap",function(){e(this).toggleClass("expanded")}).appendTo(this.imageLabelContainer),o&&h.animate({opacity:1},a?0:this.options.imageFade),h}}).bind(this);this.downloadImage=function(s){var r=document.createElement("a");r.href=s,r.setAttribute("download",s.substring(s.lastIndexOf("/")+1)),document.body.appendChild(r),r.click()};var i=(function(s,r,o,a){var h=t(s,r,o,a);h.addClass("jBox-image-loading"),e('<img src="'+this.images[s][r].src+'" />').each((function(){var c=new Image;c.onload=(function(){h.removeClass("jBox-image-loading"),h.css({backgroundImage:'url("'+this.images[s][r].src+'")'})}).bind(this),c.onerror=(function(){h.removeClass("jBox-image-loading"),h.addClass("jBox-image-not-found")}).bind(this),c.src=this.images[s][r].src}).bind(this))}).bind(this);this.showImage=function(s){var r,o,a;if(s!="open")r=this.currentImage.gallery,a=(a=this.currentImage.id+(+(s=="prev")?-1:1))>this.images[r].length-1?0:a<0?this.images[r].length-1:a;else{if(this.source)r=this.source.data("jBox-image-gallery"),a=this.source.data("jBox-image-id");else{if(!this.attachedElements||!this.attachedElements.length)return;r=e(this.attachedElements[0]).data("jBox-image-gallery"),a=e(this.attachedElements[0]).data("jBox-image-id")}this.images&&this.images[r]&&e(".jBox-image-pointer-prev, .jBox-image-pointer-next").css({display:1<this.images[r].length?"block":"none"})}e(".jBox-image-"+r+"-current").length&&e(".jBox-image-"+r+"-current").removeClass("jBox-image-"+r+"-current").animate({opacity:0},s=="open"?0:this.options.imageFade),this.currentImage={gallery:r,id:a},e("#jBox-image-"+r+"-"+a).length?e("#jBox-image-"+r+"-"+a).addClass("jBox-image-"+r+"-current").css({zIndex:this.imageZIndex++,opacity:0}).animate({opacity:1},s=="open"?0:this.options.imageFade):i(r,a,!0,s==="open"),o=r,s=a,e(".jBox-image-label.active").removeClass("active expanded"),e("#jBox-image-label-"+o+"-"+s).addClass("active"),this.imageCounter&&(this.images[r]&&1<this.images[r].length?(this.wrapper.addClass("jBox-image-has-counter"),this.imageCounter.find(".jBox-image-counter-all").html(this.images[r].length),this.imageCounter.find(".jBox-image-counter-current").html(a+1)):this.wrapper.removeClass("jBox-image-has-counter")),this.images[r]&&this.images[r].length-1&&(a=(a=a+1)>this.images[r].length-1?0:a<0?this.images[r].length-1:a,e("#jBox-image-"+r+"-"+a).length||i(r,a,!1,!1))},this.options.preloadFirstImage&&e(window).on("load",(function(){this.showImage("open")}).bind(this))},_onAttach:function(t){this.initImage&&this.initImage(t)},_onCreated:function(){this.imageLabelWrapper=e('<div class="jBox-image-label-wrapper"/>').appendTo(this.wrapper),this.imagePrevButton=e('<div class="jBox-image-pointer-prev"/>').on("click tap",(function(){this.showImage("prev")}).bind(this)),this.imageNextButton=e('<div class="jBox-image-pointer-next"/>').on("click tap",(function(){this.showImage("next")}).bind(this)),this.imageLabelContainer=e('<div class="jBox-image-label-container"/>'),this.imageLabelWrapper.append(this.imagePrevButton).append(this.imageLabelContainer).append(this.imageNextButton),this.options.downloadButton&&(this.downloadButton=e("<div/>",{class:"jBox-image-download-button-wrapper"}).appendTo(this.wrapper).append(this.options.downloadButtonText?e("<div/>",{class:"jBox-image-download-button-text"}).html(this.options.downloadButtonText):null).append(e("<div/>",{class:"jBox-image-download-button-icon"})).on("click tap",(function(){var t;t=this.images[this.currentImage.gallery][this.currentImage.id].downloadUrl||this.wrapper.find(".jBox-image-"+this.currentImage.gallery+"-current")[0].style.backgroundImage.slice(4,-1).replace(/["']/g,""),this.downloadImage(t)}).bind(this))),this.options.imageCounter&&(this.imageCounter=e("<div/>",{class:"jBox-image-counter-container"}).insertAfter(this.imageLabelContainer),this.imageCounter.append(e("<span/>",{class:"jBox-image-counter-current"})).append(e("<span/>").html(this.options.imageCounterSeparator)).append(e("<span/>",{class:"jBox-image-counter-all"})))},_onOpen:function(){e(document).on("keyup.jBox-Image-"+this.id,(function(t){t.keyCode==37&&this.showImage("prev"),t.keyCode==39&&this.showImage("next")}).bind(this)),this.showImage("open")},_onClose:function(){e(document).off("keyup.jBox-Image-"+this.id)},_onCloseComplete:function(){this.wrapper.find(".jBox-image-container").css("opacity",0)}})}function jBoxNoticeWrapper(n,e){new n.plugin("Notice",{color:null,stack:!0,stackSpacing:10,autoClose:6e3,attributes:{x:"right",y:"top"},position:{x:15,y:15},responsivePositions:{500:{x:5,y:5},768:{x:10,y:10}},target:window,fixed:!0,animation:"zoomIn",closeOnClick:"box",zIndex:12e3,_onInit:function(){this.defaultNoticePosition=e.extend({},this.options.position),this._adjustNoticePositon=function(){var t=e(window),i=t.width();t.height(),this.options.position=e.extend({},this.defaultNoticePosition),e.each(this.options.responsivePositions,(function(s,r){if(i<=s)return this.options.position=r,!1}).bind(this)),this.options.adjustDistance={top:this.options.position.y,right:this.options.position.x,bottom:this.options.position.y,left:this.options.position.x}},this.options.content instanceof e&&(this.options.content=this.options.content.clone().attr("id","")),e(window).on("resize.responsivejBoxNotice-"+this.id,(function(t){this.isOpen&&this._adjustNoticePositon()}).bind(this)),this.open()},_onCreated:function(){this.wrapper.addClass("jBox-Notice-color jBox-Notice-"+(this.options.color||"gray")),this.wrapper.data("jBox-Notice-position",this.options.attributes.x+"-"+this.options.attributes.y)},_onOpen:function(){this.options.stack||(this._adjustNoticePositon(),e.each(e(".jBox-Notice"),(function(t,i){(i=e(i)).attr("id")!=this.id&&i.data("jBox-Notice-position")==this.options.attributes.x+"-"+this.options.attributes.y&&(this.options.stack||i.data("jBox").close({ignoreDelay:!0}))}).bind(this)))},_onPosition:function(){var t,i={};for(t in e.each(e(".jBox-Notice"),function(h,c){var d=(c=e(c)).data("jBox-Notice-position");i[d]||(i[d]=[]),i[d].push(c)}),i){var s=t.split("-")[1];i[t].reverse();var r,o=0;for(r in i[t]){var a=e(i[t][r]);a.css("margin-"+s,o),o+=a.outerHeight()+this.options.stackSpacing}}},_onCloseComplete:function(){this.destroy(),this.options._onPosition.bind(this).call()}})}(function(n,e){module.exports?module.exports=n.jBox=e(requireJquery()):n.jBox=e(n.jQuery)})(jBox_all_min,function(n){var e=jBoxWrapper(n);try{jBoxConfirmWrapper!==void 0&&jBoxConfirmWrapper&&jBoxConfirmWrapper(e,n)}catch(t){console.error(t)}try{jBoxImageWrapper!==void 0&&jBoxImageWrapper&&jBoxImageWrapper(e,n)}catch(t){console.error(t)}try{jBoxNoticeWrapper!==void 0&&jBoxNoticeWrapper&&jBoxNoticeWrapper(e,n)}catch(t){console.error(t)}return e})})(jBox_all_min$1)),jBox_all_min$1.exports}var jBox_all_minExports=requireJBox_all_min();const jBox=getDefaultExportFromCjs(jBox_all_minExports);var defaultsDialogData=[{title:'Mini Quad with 3" propellers',id:6,notRecommended:!1,reboot:!0,mixerToApply:3,wizardPages:["receiver","gps"],settings:[{key:"model_preview_type",value:3},{key:"gyro_hardware_lpf",value:"256HZ"},{key:"motor_pwm_protocol",value:"DSHOT300"},{key:"ez_enabled",value:"ON"},{key:"ez_filter_hz",value:90},{key:"ez_axis_ratio",value:116},{key:"ez_response",value:71},{key:"ez_damping",value:103},{key:"ez_stability",value:105},{key:"ez_aggressiveness",value:100},{key:"ez_rate",value:134},{key:"ez_expo",value:118},{key:"airmode_type",value:"THROTTLE_THRESHOLD"},{key:"airmode_throttle_threshold",value:1150},{key:"mc_iterm_relax",value:"RP"},{key:"d_boost_min",value:1},{key:"d_boost_max",value:1},{key:"antigravity_gain",value:2},{key:"antigravity_accelerator",value:5},{key:"tpa_rate",value:20},{key:"tpa_breakpoint",value:1200},{key:"platform_type",value:"MULTIROTOR"},{key:"applied_defaults",value:6},{key:"failsafe_procedure",value:"DROP"}]},{title:'Mini Quad with 5" propellers',id:2,notRecommended:!1,reboot:!0,mixerToApply:3,wizardPages:["receiver","gps"],settings:[{key:"model_preview_type",value:3},{key:"gyro_hardware_lpf",value:"256HZ"},{key:"motor_pwm_protocol",value:"DSHOT300"},{key:"ez_enabled",value:"ON"},{key:"ez_filter_hz",value:110},{key:"ez_axis_ratio",value:110},{key:"ez_response",value:92},{key:"ez_damping",value:108},{key:"ez_stability",value:110},{key:"ez_aggressiveness",value:80},{key:"ez_rate",value:134},{key:"ez_expo",value:118},{key:"gyro_dyn_lpf_min_hz",value:85},{key:"gyro_dyn_lpf_max_hz",value:300},{key:"gyro_dyn_lpf_curve_expo",value:3},{key:"airmode_type",value:"THROTTLE_THRESHOLD"},{key:"airmode_throttle_threshold",value:1150},{key:"mc_iterm_relax",value:"RP"},{key:"d_boost_min",value:1},{key:"d_boost_max",value:1},{key:"antigravity_gain",value:2},{key:"antigravity_accelerator",value:5},{key:"tpa_rate",value:20},{key:"tpa_breakpoint",value:1200},{key:"platform_type",value:"MULTIROTOR"},{key:"applied_defaults",value:2},{key:"failsafe_procedure",value:"DROP"}]},{title:'Mini Quad with 7" propellers',id:5,notRecommended:!1,reboot:!0,mixerToApply:3,wizardPages:["receiver","gps"],settings:[{key:"model_preview_type",value:3},{key:"gyro_hardware_lpf",value:"256HZ"},{key:"motor_pwm_protocol",value:"DSHOT300"},{key:"ez_enabled",value:"ON"},{key:"ez_filter_hz",value:90},{key:"ez_axis_ratio",value:110},{key:"ez_response",value:101},{key:"ez_damping",value:115},{key:"ez_stability",value:100},{key:"ez_aggressiveness",value:100},{key:"ez_rate",value:134},{key:"ez_expo",value:118},{key:"airmode_type",value:"THROTTLE_THRESHOLD"},{key:"airmode_throttle_threshold",value:1150},{key:"mc_iterm_relax",value:"RPY"},{key:"d_boost_min",value:.8},{key:"d_boost_max",value:1.2},{key:"antigravity_gain",value:2},{key:"antigravity_accelerator",value:5},{key:"tpa_rate",value:20},{key:"tpa_breakpoint",value:1200},{key:"platform_type",value:"MULTIROTOR"},{key:"applied_defaults",value:5},{key:"failsafe_procedure",value:"DROP"}]},{title:"Airplane with a Tail",notRecommended:!1,id:3,reboot:!0,mixerToApply:14,wizardPages:["receiver","gps"],settings:[{key:"model_preview_type",value:14},{key:"platform_type",value:"AIRPLANE"},{key:"applied_defaults",value:3},{key:"gyro_hardware_lpf",value:"256HZ"},{key:"gyro_main_lpf_hz",value:25},{key:"dterm_lpf_hz",value:10},{key:"d_boost_min",value:1},{key:"d_boost_max",value:1},{key:"dynamic_gyro_notch_enabled",value:"ON"},{key:"dynamic_gyro_notch_q",value:250},{key:"dynamic_gyro_notch_min_hz",value:30},{key:"motor_pwm_protocol",value:"STANDARD"},{key:"ahrs_inertia_comp_method",value:"ADAPTIVE"},{key:"throttle_idle",value:5},{key:"rc_yaw_expo",value:30},{key:"rc_expo",value:30},{key:"roll_rate",value:18},{key:"pitch_rate",value:9},{key:"yaw_rate",value:3},{key:"nav_fw_pos_z_p",value:35},{key:"nav_fw_pos_z_i",value:5},{key:"nav_fw_pos_z_d",value:10},{key:"nav_fw_pos_xy_p",value:55},{key:"fw_turn_assist_pitch_gain",value:.4},{key:"max_angle_inclination_rll",value:450},{key:"nav_fw_bank_angle",value:35},{key:"fw_p_pitch",value:15},{key:"fw_i_pitch",value:5},{key:"fw_d_pitch",value:5},{key:"fw_ff_pitch",value:80},{key:"fw_p_roll",value:15},{key:"fw_i_roll",value:3},{key:"fw_d_roll",value:7},{key:"fw_ff_roll",value:50},{key:"fw_p_yaw",value:50},{key:"fw_i_yaw",value:0},{key:"fw_d_yaw",value:20},{key:"fw_ff_yaw",value:255},{key:"airmode_type",value:"STICK_CENTER_ONCE"},{key:"small_angle",value:180},{key:"nav_fw_control_smoothness",value:2},{key:"nav_rth_allow_landing",value:"FS_ONLY"},{key:"nav_rth_altitude",value:5e3},{key:"nav_wp_radius",value:800},{key:"nav_wp_max_safe_distance",value:500},{key:"nav_fw_launch_max_angle",value:45},{key:"nav_fw_launch_motor_delay",value:100},{key:"nav_fw_launch_max_altitude",value:5e3},{key:"nav_fw_launch_climb_angle",value:25}]},{title:"Airplane without a Tail (Wing, Delta, etc)",notRecommended:!1,id:4,reboot:!0,mixerToApply:8,wizardPages:["receiver","gps"],settings:[{key:"model_preview_type",value:8},{key:"platform_type",value:"AIRPLANE"},{key:"applied_defaults",value:4},{key:"gyro_hardware_lpf",value:"256HZ"},{key:"gyro_main_lpf_hz",value:25},{key:"dterm_lpf_hz",value:10},{key:"d_boost_min",value:1},{key:"d_boost_max",value:1},{key:"dynamic_gyro_notch_enabled",value:"ON"},{key:"dynamic_gyro_notch_q",value:250},{key:"dynamic_gyro_notch_min_hz",value:30},{key:"motor_pwm_protocol",value:"STANDARD"},{key:"ahrs_inertia_comp_method",value:"ADAPTIVE"},{key:"throttle_idle",value:5},{key:"rc_yaw_expo",value:30},{key:"rc_expo",value:30},{key:"roll_rate",value:18},{key:"pitch_rate",value:9},{key:"yaw_rate",value:3},{key:"nav_fw_pos_z_p",value:25},{key:"nav_fw_pos_z_i",value:5},{key:"nav_fw_pos_z_d",value:8},{key:"nav_fw_pos_xy_p",value:75},{key:"fw_turn_assist_pitch_gain",value:.3},{key:"max_angle_inclination_rll",value:550},{key:"nav_fw_bank_angle",value:45},{key:"fw_p_pitch",value:15},{key:"fw_i_pitch",value:5},{key:"fw_d_pitch",value:5},{key:"fw_ff_pitch",value:70},{key:"fw_p_roll",value:15},{key:"fw_i_roll",value:3},{key:"fw_d_roll",value:7},{key:"fw_ff_roll",value:50},{key:"fw_p_yaw",value:20},{key:"fw_i_yaw",value:0},{key:"fw_d_yaw",value:0},{key:"fw_ff_yaw",value:100},{key:"airmode_type",value:"STICK_CENTER_ONCE"},{key:"small_angle",value:180},{key:"nav_fw_control_smoothness",value:2},{key:"nav_rth_allow_landing",value:"FS_ONLY"},{key:"nav_rth_altitude",value:5e3},{key:"nav_wp_radius",value:1e3},{key:"nav_wp_max_safe_distance",value:500},{key:"nav_fw_launch_max_angle",value:75},{key:"nav_fw_launch_motor_delay",value:100},{key:"nav_fw_launch_max_altitude",value:5e3},{key:"nav_fw_launch_climb_angle",value:25}]},{title:"Rovers & Boats",id:1,notRecommended:!1,reboot:!0,mixerToApply:31,wizardPages:["receiver","gps"],settings:[{key:"model_preview_type",value:31},{key:"gyro_hardware_lpf",value:"256HZ"},{key:"gyro_main_lpf_hz",value:10},{key:"motor_pwm_protocol",value:"STANDARD"},{key:"applied_defaults",value:1},{key:"failsafe_procedure",value:"DROP"},{key:"platform_type",value:"ROVER"},{key:"nav_wp_max_safe_distance",value:500},{key:"nav_fw_loiter_radius",value:100},{key:"nav_fw_yaw_deadband",value:5},{key:"pidsum_limit_yaw",value:500},{key:"nav_fw_pos_hdg_p",value:60},{key:"nav_fw_pos_hdg_i",value:2},{key:"nav_fw_pos_hdg_d",value:0}]},{title:"Keep current settings (Not recommended)",id:0,notRecommended:!0,reboot:!1,settings:[{key:"applied_defaults",value:1}]}],promiseMapSeries,hasRequiredPromiseMapSeries;function requirePromiseMapSeries(){return hasRequiredPromiseMapSeries||(hasRequiredPromiseMapSeries=1,promiseMapSeries=async function(e,t,i){const s=e.length,r=arguments.length>2?t.bind(i):t,o=new Array(s);for(let a=0;a<s;++a)o[a]=await r(e[a],a,e);return o}),promiseMapSeries}var promiseMapSeriesExports=requirePromiseMapSeries();const mapSeries=getDefaultExportFromCjs(promiseMapSeriesExports);function padZeros(n,e){let t=n.toString();return t.length<e&&(t.charAt(0)==="-"?(t="-0"+t.substring(1),t=padZeros(t,e)):t=padZeros("0"+t,e)),t}var Settings=(function(){let n={};return n.fillSelectOption=function(e,t){var i=e.setting.table?e.setting.table.values[t]:null;if(i){var s=i18n.getMessage(i);s&&(i=s)}else i=t;var r=$("<option/>").attr("value",t).text(i);return t==e.value&&r.prop("selected",!0),r},n.configureInputs=function(){var e=[];return $('[data-setting!=""][data-setting]').each(function(){e.push($(this))}),mapSeries(e,function(t,i){var s=t.data("setting"),r=t.data("unit");return t.attr("id")===void 0&&$("#"+s).length===0&&t.attr("id",s),globalSettings.showProfileParameters&&(FC.isBatteryProfileParameter(s)&&t.css("background-color","#fef2d5"),FC.isControlProfileParameter(s)&&t.css("background-color","#d5ebfe")),mspHelper$1.getSetting(s).then(function(a){var h=t.parents(".setting-container:first");if(h.length==0&&(h=t.parent()),!a){t.val(null),h.remove();return}if(h.show(),t.prop("title","CLI: "+t.data("setting")),t.prop("tagName")=="SELECT"||a.setting.table)if(t.attr("type")=="checkbox")t.prop("checked",a.value>0);else if(t.attr("type")=="radio")t.prop("checked",a.value==t.attr("value"));else{t.empty();let f=null;if(t.data("setting-invert-select")===!0)for(var c=a.setting.max;c>=a.setting.min;c--)f=null,f=n.fillSelectOption(a,c),f.appendTo(t);else for(var c=a.setting.min;c<=a.setting.max;c++)f=null,f=n.fillSelectOption(a,c),f.appendTo(t)}else if(a.setting.type=="string")t.val(a.value),t.attr("maxlength",a.setting.max);else if(t.data("presentation")=="range")GUI.sliderize(t,a.value,a.setting.min,a.setting.max);else if(a.setting.type=="float"){t.attr("type","number");let f=t.data("step");typeof f>"u"&&(f=n.countDecimals(a.value),f=1/Math.pow(10,f),t.data("step",f)),t.attr("step",f),t.attr("min",a.setting.min),t.attr("max",a.setting.max),t.val(a.value.toFixed(n.countDecimals(f)))}else{var d=parseFloat(t.data("setting-multiplier")||1);t.data("step",1),t.val((a.value/d).toFixed(Math.log10(d))),t.attr("type","number"),typeof a.setting.min<"u"&&a.setting.min!==null&&t.attr("min",(a.setting.min/d).toFixed(Math.log10(d))),typeof a.setting.max<"u"&&a.setting.max!==null&&t.attr("max",(a.setting.max/d).toFixed(Math.log10(d)))}n.convertToUnitSetting(t,r),t.data("setting-info",a.setting),t.data("live")&&t.on("change",function(){const f=n.processInput(t);return mspHelper$1.setSetting(f.setting,f.value)})})})},n.convertToUnitSetting=function(e,t){const i=globalSettings.unitType,r=(()=>{switch(i){case UnitType.imperial:return 0;case UnitType.metric:return 1;case UnitType.OSD:return globalSettings.osdUnits;case UnitType.none:default:return-1}})(),o=e.val(),a={cw:"cW",percent:"%",cmss:"cm/s/s",us:"uS",msec:"ms","msec-nc":"ms",dsec:"ds",sec:"s",mins:"m",hours:"h",tzmins:"m",tzhours:"hh:mm",centideg:"centi&deg;","centideg-deg":"centi&deg;",decideg:"deci&deg;","decideg-lrg":"deci&deg;",deg:"&deg;",decadeg:"deca&deg;",degps:"&deg; per second",decadegps:"deca&deg; per second",decidegc:"deci&deg;C",degc:"&deg;C",degf:"&deg;F",cms:"cm/s","v-cms":"cm/s",ms:"m/s",kmh:"Km/h",mph:"mph",hftmin:"x100 ft/min",fts:"ft/s",kt:"Kt",cm:"cm",m:"m",km:"Km","m-lrg":"m",ft:"ft",mi:"mi",nm:"NM"},h={cw:"CentiWatts",percent:"Percent",cmss:"Centimetres per second, per second",us:"Microseconds",msec:"Milliseconds","msec-nc":"Milliseconds",dsec:"Deciseconds",sec:"Seconds",mins:"Minutes",hours:"Hours",tzmins:"Minutes",tzhours:"Hours:Minutes",centideg:"CentiDegrees","centideg-deg":"CentiDegrees",decideg:"DeciDegrees","decideg-lrg":"DeciDegrees",deg:"Degrees",decadeg:"DecaDegrees",degps:"Degrees per second",decadegps:"DecaDegrees per second",decidegc:"DeciDegrees Celsius",degc:"Degrees Celsius",degf:"Degrees Fahrenheit",cms:"Centimetres per second","v-cms":"Centimetres per second",ms:"Metres per second",kmh:"Kilometres per hour",mph:"Miles per hour",hftmin:"Hundred feet per minute",fts:"Feet per second",kt:"Knots",cm:"Centimetres",m:"Metres",km:"Kilometres","m-lrg":"Metres",ft:"Feet",mi:"Miles",nm:"Nautical Miles"};if(!t||!o||!e)return;const c={cm:{m:100,ft:30.48},m:{m:1,ft:.3048},"m-lrg":{km:1e3,mi:1609.344,nm:1852},cms:{kmh:27.77777777777778,kt:51.44444444444457,mph:44.704,ms:100},"v-cms":{ms:100,hftmin:50.8,fts:30.48},"msec-nc":{"msec-nc":1},msec:{sec:1e3},dsec:{sec:10},mins:{hours:60},tzmins:{tzhours:"TZHOURS"},centideg:{deg:100},"centideg-deg":{deg:100},decideg:{deg:10},"decideg-lrg":{deg:10},decadeg:{deg:.1},decadegps:{degps:.1},decidegc:{degc:10,degf:"FAHREN"}},d={0:{cm:"ft",m:"ft","m-lrg":"mi",cms:"mph","v-cms":"fts",msec:"sec",dsec:"sec",mins:"hours",tzmins:"tzhours",decadegps:"degps",centideg:"deg","centideg-deg":"deg",decideg:"deg","decideg-lrg":"deg",decadeg:"deg",decidegc:"degf"},1:{cm:"m",m:"m","m-lrg":"km",cms:"kmh","v-cms":"ms",msec:"sec",dsec:"sec",mins:"hours",tzmins:"tzhours",decadegps:"degps",centideg:"deg","centideg-deg":"deg",decideg:"deg","decideg-lrg":"deg",decadeg:"deg",decidegc:"degc"},2:{cm:"m",m:"m","m-lrg":"km",cms:"mph","v-cms":"ms",decadegps:"degps",centideg:"deg","centideg-deg":"deg",decideg:"deg","decideg-lrg":"deg",decadeg:"deg",msec:"sec",dsec:"sec",mins:"hours",tzmins:"tzhours",decidegc:"degc"},3:{cm:"ft",m:"ft","m-lrg":"mi",cms:"mph","v-cms":"fts",decadegps:"degps",centideg:"deg","centideg-deg":"deg",decideg:"deg","decideg-lrg":"deg",decadeg:"deg",msec:"sec",dsec:"sec",mins:"hours",tzmins:"tzhours",decidegc:"degc"},4:{cm:"ft",m:"ft","m-lrg":"nm",cms:"kt","v-cms":"hftmin",decadegps:"degps",centideg:"deg","centideg-deg":"deg",decideg:"deg","decideg-lrg":"deg",decadeg:"deg",msec:"sec",dsec:"sec",mins:"hours",tzmins:"tzhours",decidegc:"degc"},default:{decadegps:"degps","decideg-lrg":"deg",centideg:"deg","centideg-deg":"deg",decadeg:"deg",tzmins:"tzhours"}},_=(()=>{let B=r!=-1?r:"default";if(d[B]){const G=d[B];if(G[t])return{multiplier:c[t][G[t]],unitName:G[t]}}return{multiplier:1,unitName:t}})(),y=_.multiplier,S=_.unitName;let v=0;if(e.attr("type")=="number"){let B=parseFloat(e.data("step"))||parseFloat(e.attr("step"))||1;y!==1?(v=Math.min(Math.ceil(y/100),3),y%1!=0&&v<3&&v++,B=1/Math.pow(10,v)):v=this.countDecimals(B),e.attr("step",B.toFixed(v)),y!=="FAHREN"&&y!=="TZHOURS"&&y!==1&&(e.data("default-min",e.attr("min")),e.data("default-max",e.attr("max")),e.attr("min",(parseFloat(e.attr("min"))/y).toFixed(v)),e.attr("max",(parseFloat(e.attr("max"))/y).toFixed(v)))}let I="";if(y==="FAHREN")e.attr("min",A(e.attr("min")).toFixed(v)),e.attr("max",A(e.attr("max")).toFixed(v)),I=A(o).toFixed(v);else if(y==="TZHOURS"){e.attr("type","text"),e.removeAttr("step"),e.attr("pattern","([0-9]{2}|[-,0-9]{3}):([0-9]{2})");let B=Math.floor(o/60),G=o-B*60;I=(B<0?padZeros(B,3):padZeros(B,2))+":"+padZeros(G,2)}else I=Number(o/y).toFixed(v);e.val(I),e.data("setting-multiplier",y),e.wrap(`<div data-unit="${a[S]}" title="${h[S]}" class="unit_wrapper unit"></div>`);function A(B){return B/10*1.8+32}},n.processInput=function(e){var t=e.data("setting"),i=e.data("setting-info"),s;if(typeof i>"u")return null;if(i.table)e.attr("type")=="checkbox"?s=e.prop("checked")?1:0:e.attr("type")=="radio"?e.prop("checked")&&(s=parseInt(e.val())):s=parseInt(e.val());else if(i.type=="string")s=e.val();else{var r=e.data("setting-multiplier")||1;if(r=="FAHREN")s=Math.round((parseFloat(e.val())-32)/1.8*10);else if(r==="TZHOURS"){let o=e.val().split(":");s=parseInt(o[0])*60+parseInt(o[1]),s>parseInt(e.attr("max"))&&(s=parseInt(e.attr("max"))),s<parseInt(e.attr("min"))&&(s=parseInt(e.attr("min")))}else{r=parseFloat(r);let o=e.data("step")||1;o=n.countDecimals(o),o===0?s=Math.round(parseFloat(e.val())*r):s=Math.round(parseFloat(e.val())*r*Math.pow(10,o))/Math.pow(10,o),s>parseInt(e.data("default-max"))&&(s=parseInt(e.data("default-max"))),s<parseInt(e.data("default-min"))&&(s=parseInt(e.data("default-min")))}}return{setting:t,value:s}},n.countDecimals=function(e){let t=e.toString();if(t.indexOf("e-")>-1){let[i,s]=t.split("e-");return parseInt(s,10)}return Math.floor(e)!==e&&e.toString().split(".")[1].length||0},n.pickAndSaveSingleInput=function(e,t){if(e.length>0){var i=e.shift(),s=n.processInput(i);return mspHelper$1.setSetting(s.setting,s.value,function(){return n.pickAndSaveSingleInput(e,t)})}else t&&t()},n.saveInputs=function(e){var t=[];$('[data-setting!=""][data-setting]').each(function(){t.push($(this))}),n.pickAndSaveSingleInput(t,e)},n.processHtml=function(e){return function(){n.configureInputs().then(e),n.linkHelpIcons()}},n.getInputValue=function(e){return $('[data-setting="'+e+'"]').val()},n.linkHelpIcons=function(){var e=[];return $(".helpicon").each(function(){e.push($(this))}),mapSeries(e,function(t,i){let s=t.attr("for");if(typeof s<"u"&&s!==""){let r=$("#"+s).data("setting");(typeof r>"u"||r==="")&&(r=$("#"+s).data("setting-placeholder")),typeof r<"u"&&r!==""&&t.wrap('<a class="helpiconLink" href="'+globalSettings.docsTreeLocation+"Settings.md#"+r+'" target="_blank"></a>')}})},n})();const wizardUiBindings=(function(){let n={};return n.gps=function(e){mspHelper$1.loadFeatures(mspHelper$1.loadSerialPorts(function(){let t=$("#wizard-gps-port"),i=$("#wizard-gps-baud"),s=$("#wizard-gps-protocol"),r=serialPortHelper.getPortIdentifiersForFunction("GPS"),o=null;r.length==1&&(o=r[0]);let a=serialPortHelper.getPortList();t.append('<option value="-1">None</option>');for(let c=0;c<a.length;c++){let d=a[c];t.append('<option value="'+d.identifier+'">'+d.displayName+"</option>")}serialPortHelper.getBauds("SENSOR").forEach(function(c){i.append('<option value="'+c+'">'+c+"</option>")});let h=FC.getGpsProtocols();for(let c=0;c<h.length;c++)s.append('<option value="'+c+'">'+h[c]+"</option>");o!==null?t.val(o):t.val(-1),t.on("change",function(){let c=$(this).val();i.val(serialPortHelper.getRuleByName("GPS").defaultBaud),c==-1?($("#wizard-gps-baud-container").hide(),$("#wizard-gps-protocol-container").hide()):($("#wizard-gps-baud-container").show(),$("#wizard-gps-protocol-container").show())}).trigger("change")}))},n.receiver=function(e){mspHelper$1.loadSerialPorts(function(){let t=e.find("#wizard-receiver-port"),i=serialPortHelper.getPortIdentifiersForFunction("RX_SERIAL"),s=null;i.length>0&&(s=i[0]);let r=serialPortHelper.getPortList();t.append('<option value="-1">NONE</option>');for(let o=0;o<r.length;o++){let a=r[o];t.append('<option value="'+a.identifier+'">'+a.displayName+"</option>")}s!==null?t.val(s):t.val(-1)})},n})();var wizardSaveFramework=(function(){let n={};return n.saveSetting=function(e,t){switch(e.name){case"receiverPort":serialPortHelper.set(e.value,"RX_SERIAL",null),mspHelper$1.saveSerialPorts(t);break;case"receiverProtocol":mspHelper$1.setSetting("serialrx_provider",e.value,t);break;case"gpsPort":let i=FC.getFeatures().find(s=>s.name==="GPS").bit;e.value.port=="-1"?features.unset(i):features.set(i),serialPortHelper.set(e.value.port,"GPS",e.value.baud),mspHelper$1.saveSerialPorts(function(){features.execute(n.enableVirtulaPitot(e,t))});break;case"gpsProtocol":mspHelper$1.setSetting("gps_provider",e.value,t);break;default:t();break}},n.enableVirtulaPitot=function(e,t){e.value.port!="-1"?mspHelper$1.setSetting("pitot_hardware","VIRTUAL",t):t()},n.handleSetting=function(e,t){if(e.length>0){let i=e.shift();n.saveSetting(i,function(){n.handleSetting(e,t)})}else console.log("Nothing to save"),t()},n.persist=function(e,t){if(e==null||e.length===0){t();return}let i=Array.from(e);n.handleSetting(i,t)},n})(),savingDefaultsModal,defaultsDialog=(function(){let n={},e={},t;return e.wizardSettings=[],n.init=function(){mspHelper$1.getSetting("applied_defaults").then(e.onInitSettingReturned),t=$("#defaults-wrapper")},e.setFeaturesBits=function(i){if(i.features&&i.features.length>0){features.reset();for(const s of i.features)s.state?features.set(s.bit):features.unset(s.bit);features.execute(function(){e.setSettings(i)})}else e.setSettings(i)},e.saveWizardStep=function(i,s){const o=i.wizardPages[s];if(o=="receiver"){let h=t.find("#wizard-receiver-port").val();h!="-1"&&e.wizardSettings.push({name:"receiverPort",value:h}),e.wizardSettings.push({name:"receiverProtocol",value:t.find("#wizard-receiver-protocol option:selected").text()})}else if(o=="gps"){let a=t.find("#wizard-gps-port").val(),h=t.find("#wizard-gps-baud").val(),c=t.find("#wizard-gps-protocol option:selected").text();e.wizardSettings.push({name:"gpsPort",value:{port:a,baud:h}}),e.wizardSettings.push({name:"gpsProtocol",value:c})}e.wizard(i,s+1)},e.wizard=function(i,s){const r=i.wizardPages,o=i.wizardPages.length,a=r[s];if(s>=o)t.hide(),wizardSaveFramework.persist(e.wizardSettings,function(){mspHelper$1.saveToEeprom(function(){GUI.log(i18n.getMessage("configurationEepromSaved")),i.reboot&&e.reboot()})});else{const h=t.find(".defaults-dialog__wizard");h.unbind(),__variableDynamicImportRuntimeHelper(Object.assign({"../wizard/step-buttons.html":()=>__vitePreload(()=>import("./step-buttons-CDLFkTKJ.js"),[],import.meta.url),"../wizard/step-filters.html":()=>__vitePreload(()=>import("./step-filters-D2DJJau9.js"),[],import.meta.url),"../wizard/step-gps.html":()=>__vitePreload(()=>import("./step-gps-W8_Lhm_5.js"),[],import.meta.url),"../wizard/step-outputs.html":()=>__vitePreload(()=>import("./step-outputs-PhFdLPx5.js"),[],import.meta.url),"../wizard/step-pids.html":()=>__vitePreload(()=>import("./step-pids-zVIg-h92.js"),[],import.meta.url),"../wizard/step-receiver.html":()=>__vitePreload(()=>import("./step-receiver-D1xqO9i1.js"),[],import.meta.url)}),`../wizard/step-${a}.html`,3).then(({default:c})=>{h.html(""),$(c).appendTo(h),__vitePreload(async()=>{const{default:d}=await import("./step-buttons-CDLFkTKJ.js");return{default:d}},[],import.meta.url).then(({default:d})=>{$(d).appendTo(h),h.on("click","#wizard-next",function(){e.saveWizardStep(i,s)}),h.on("click","#wizard-skip",function(){e.wizard(i,s+1)}),a=="receiver"?wizardUiBindings.receiver(h):a=="gps"&&wizardUiBindings.gps(h),Settings.configureInputs().then(function(){console.log("configure done"),t.find(".defaults-dialog__content").hide(),t.find(".defaults-dialog__wizard").show(),savingDefaultsModal.close(),t.show()})})})}},e.reboot=function(){periodicStatusUpdater.resume(),GUI.tab_switch_cleanup(function(){MSP.send_message(MSPCodes.MSP_SET_REBOOT,!1,!1,function(){typeof savingDefaultsModal<"u"&&savingDefaultsModal.close(),GUI.log(i18n.getMessage("deviceRebooting")),GUI.handleReconnect()})})},e.finalize=function(i){i.wizardPages?e.wizard(i,0):mspHelper$1.saveToEeprom(function(){GUI.log(i18n.getMessage("configurationEepromSaved")),i.reboot&&e.reboot()})},e.setSettings=function(i){i.reboot&&periodicStatusUpdater.stop();var s=parseInt($("#profilechange").val()),r=parseInt($("#batteryprofilechange").val()),o=[],a=[],h=[];i.settings.forEach(f=>{FC.isControlProfileParameter(f.key)?o.push(f):FC.isBatteryProfileParameter(f.key)?a.push(f):h.push(f)});var c=MSPChainerClass$1(),d=[];h.forEach(f=>{d.push(function(_){mspHelper$1.setSetting(f.key,f.value,_)})});for(let f=0;f<3;f++)d.push(function(_){MSP.send_message(MSPCodes.MSP_SELECT_SETTING,[f],!1,_)}),o.forEach(_=>{d.push(function(y){mspHelper$1.setSetting(_.key,_.value,y)})}),d.push(function(_){MSP.send_message(MSPCodes.MSP2_INAV_SELECT_BATTERY_PROFILE,[f],!1,_)}),a.forEach(_=>{d.push(function(y){mspHelper$1.setSetting(_.key,_.value,y)})});if(i.mixerToApply){let f=mixer.getById(i.mixerToApply);mixer.loadServoRules(FC,f),mixer.loadMotorRules(FC,f),FC.MIXER_CONFIG.platformType=f.platform,FC.MIXER_CONFIG.appliedMixerPreset=i.mixerToApply,FC.MIXER_CONFIG.motorStopOnLow=f.motorStopOnLow===!0,FC.MIXER_CONFIG.hasFlaps=f.hasFlaps===!0,FC.SERVO_RULES.cleanup(),FC.SERVO_RULES.inflate(),FC.MOTOR_RULES.cleanup(),FC.MOTOR_RULES.inflate(),d=d.concat([mspHelper$1.saveMixerConfig,mspHelper$1.sendServoMixer,mspHelper$1.sendMotorMixer])}d.push(function(f){MSP.send_message(MSPCodes.MSP_SELECT_SETTING,[s],!1,f)}),d.push(function(f){MSP.send_message(MSPCodes.MSP2_INAV_SELECT_BATTERY_PROFILE,[r],!1,f)}),c.setChain(d),c.setExitPoint(function(){e.finalize(i)}),c.execute()},e.onPresetClick=function(i){savingDefaultsModal=new jBox("Modal",{width:400,height:120,animation:!1,closeOnClick:!1,closeOnEsc:!1,content:$("#modal-saving-defaults")}).open(),t.hide();let s=defaultsDialogData[$(i.currentTarget).data("index")];s&&s.settings?(s.id==0&&savingDefaultsModal.close(),mspHelper$1.loadFeatures(function(){e.setFeaturesBits(s)})):savingDefaultsModal.close()},e.render=function(){t.find(".defaults-dialog__content").show(),t.find(".defaults-dialog__wizard").hide();let i=t.find(".defaults-dialog__options");i.html("");for(let s in defaultsDialogData)if(defaultsDialogData.hasOwnProperty(s)){let r=defaultsDialogData[s],o=$("<div class='default_btn defaults_btn'>                        <a class='confirm' href='#'></a>                    </div>");r.notRecommended&&o.addClass("defaults_btn--not-recommended"),o.find("a").html(r.title),o.data("index",s).on("click",e.onPresetClick),o.appendTo(i)}},e.onInitSettingReturned=function(i){i.value>0||(e.render(),t.show())},n})();const serialRXProtocolls=[{name:"Flight Controller Proxy",baudRate:115200,stopBits:"One",parity:"None"},{name:"SBus",baudRate:1e5,stopBits:"Two",parity:"Even"},{name:"SBus Fast",baudRate:2e5,stopBits:"Two",parity:"Even"},{name:"Crossfire/Ghost",baudRate:42e4,stopBits:"One",parity:"None"},{name:"FPort/IBus/Spektrum/SRXL2/SUMD",baudRate:115200,stopBits:"One",parity:"None"},{name:"JETI EX Bus",baudRate:125e3,stopBits:"One",parity:"None"}];var SitlSerialPortUtils={portsList:[],stopPolling:!1,getProtocolls:function(){return serialRXProtocolls},getDevices:function(n){window.electronAPI.listSerialDevices().then(e=>n(e))},pollSerialPorts:function(n){this.getDevices(e=>{this.arraysEqual(this.portsList,e)||(this.portsList=e,n&&n(this.portsList))}),this.stopPolling?this.stopPolling=!1:setTimeout(()=>{this.pollSerialPorts(n)},250)},resetPortsList:function(){this.portsList=[]},stopPollSerialPorts:function(){this.stopPolling=!0},arraysEqual:function(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}},SITLProcess={spawn:null,isRunning:!1,deleteEepromFile(n){window.electronAPI.rm(`${window.electronAPI.appGetPath("userData")}/${n}`).then(e=>{e&&GUI.log(`Unable to reset Demo mode: ${e}`)})},start:function(n,e,t,i,s,r,o,a){this.isRunning&&this.stop();var h,c,d=window.electronAPI.appGetPath("userData");if(GUI.operating_system=="Windows")h="/windows/inav_SITL.exe",c=`${d}\\${n}`;else if(GUI.operating_system=="Linux")h="/linux/inav_SITL",c=`${d}/${n}`,window.electronAPI.chmod(h,493).then(y=>{y&&console.log(y)});else if(GUI.operating_system=="MacOS")h="/macos/inav_SITL",c=`${d}/${n}`,window.electronAPI.chmod(h,493).then(y=>{y&&console.log(y)});else return;var f=[];if(f.push(`--path=${c}`),e&&(f.push(`--sim=${e}`),t&&f.push("--useimu"),i&&f.push(`--simip=${i}`),s&&f.push(`--simport=${s}`),r&&f.push(`--chanmap=${r}`)),o!=null){var _=serialRXProtocolls.find(y=>y.name==o.protocollName);_&&_.name!="manual"?(f.push(`--serialport=${o.serialPort}`),f.push(`--baudrate=${_.baudRate}`),f.push(`--stopbits=${_.stopBits}`),f.push(`--parity=${_.parity}`),_.name=="Flight Controller Proxy"?f.push("--fcproxy"):f.push(`--serialuart=${o.serialUart}`)):(f.push(`--serialport=${o.serialPort}`),f.push(`--baudrate=${o.baudRate}`),f.push(`--stopbits=${o.stopBits}`),f.push(`--parity=${o.parity}`),f.push(`--serialuart=${o.serialUart}`))}a&&a(h+" "+f.join(" ")+`
`),this.spawn(h,f)},spawn:function(n,e){var t=void 0;if(GUI.operating_system=="Linux"&&(t={useShell:!0}),window.electronAPI.startChildProcess(n,e,t),this.processHandle==-1){this.isRunning=!1;return}this.isRunning=!0},stop:function(){this.isRunning&&(this.isRunning=!1,window.electronAPI.killChildProcess())}},update={activatedTab:function(){var n=$("#tabs > ul li.active");n.removeClass("active"),$("a",n).trigger("click")},firmwareVersion:function(){CONFIGURATOR.connectionValid?($("#logo .firmware_version").text(FC.CONFIG.flightControllerVersion+" ["+FC.CONFIG.target+"]"),globalSettings.docsTreeLocation="https://github.com/iNavFlight/inav/blob/"+FC.CONFIG.flightControllerVersion+"/docs/",globalSettings.configuratorTreeLocation="https://github.com/iNavFlight/inav-configurator/tree/"+FC.CONFIG.flightControllerVersion+"/",$.ajax({url:globalSettings.docsTreeLocation+"Settings.md",method:"HEAD",statusCode:{404:function(){globalSettings.docsTreeLocation="https://github.com/iNavFlight/inav/blob/master/docs/"}}})):($("#logo .firmware_version").text(i18n.getMessage("fcNotConnected")),globalSettings.docsTreeLocation="https://github.com/iNavFlight/inav/blob/master/docs/")}},BOARD_DEFINITIONS=[{name:"ChebuzzF3",identifier:"CHF3",vcp:!1},{name:"CJMCU",identifier:"CJM1",vcp:!1},{name:"EUSTM32F103RB",identifier:"EUF1",vcp:!1},{name:"Naze/Flip32+",identifier:"AFNA",vcp:!1},{name:"Naze32Pro",identifier:"AFF3",vcp:!1},{name:"Olimexino",identifier:"OLI1"},{name:"Port103R",identifier:"103R",vcp:!1},{name:"SP Racing F3",identifier:"SRF3",vcp:!1}],DEFAULT_BOARD_DEFINITION={name:"Unknown",identifier:"????",vcp:!0},BOARD={};BOARD.hasVcp=function(n){return!!BOARD.findDefinition(n).vcp};BOARD.findDefinition=function(n){for(let e=0;e<BOARD_DEFINITIONS.length;e++){let t=BOARD_DEFINITIONS[e];if(t.identifier==n)return t}return DEFAULT_BOARD_DEFINITION};const CollectionEventType={ADD:"add",REMOVE:"remove"},Property$2={LENGTH:"length"};class CollectionEvent extends BaseEvent{constructor(e,t,i){super(e),this.element=t,this.index=i}}class Collection extends BaseObject{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let i=0,s=this.array_.length;i<s;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,s=t.length;i<s;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(Property$2.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,s=t.length;i<s;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const s=this.array_[e];this.array_[e]=t,this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,s,e)),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,t,e))}updateLength_(){this.set(Property$2.LENGTH,this.array_.length)}assertUnique_(e,t){for(let i=0,s=this.array_.length;i<s;++i)if(this.array_[i]===e&&i!==t)throw new Error("Duplicate item added to a unique collection")}}class MapEvent extends BaseEvent{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}class MapBrowserEvent extends MapEvent{constructor(e,t,i,s,r,o){super(e,t,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const MapBrowserEventType={SINGLECLICK:"singleclick",CLICK:EventType.CLICK,DBLCLICK:EventType.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},ua=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",SAFARI=ua.includes("safari")&&!ua.includes("chrom");SAFARI&&(ua.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(ua));const WEBKIT=ua.includes("webkit")&&!ua.includes("edge"),MAC=ua.includes("macintosh"),DEVICE_PIXEL_RATIO=typeof devicePixelRatio<"u"?devicePixelRatio:1,WORKER_OFFSCREEN_CANVAS=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,IMAGE_DECODE=typeof Image<"u"&&Image.prototype.decode,PASSIVE_EVENT_LISTENERS=(function(){let n=!1;try{const e=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return n})(),PointerEventType={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class MapBrowserEventHandler extends Target{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=listen(i,PointerEventType.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=listen(i,PointerEventType.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(EventType.TOUCHMOVE,this.boundHandleTouchMove_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1)}emulateClick_(e){let t=new MapBrowserEvent(MapBrowserEventType.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new MapBrowserEvent(MapBrowserEventType.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new MapBrowserEvent(MapBrowserEventType.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==MapBrowserEventType.POINTERUP||t.type==MapBrowserEventType.POINTERCANCEL){delete this.trackedTouches_[i];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==t.target){delete this.trackedTouches_[s];break}}else(t.type==MapBrowserEventType.POINTERDOWN||t.type==MapBrowserEventType.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new MapBrowserEvent(MapBrowserEventType.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new MapBrowserEvent(MapBrowserEventType.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(listen(i,MapBrowserEventType.POINTERMOVE,this.handlePointerMove_,this),listen(i,MapBrowserEventType.POINTERUP,this.handlePointerUp_,this),listen(this.element_,MapBrowserEventType.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(listen(this.element_.getRootNode(),MapBrowserEventType.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new MapBrowserEvent(MapBrowserEventType.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new MapBrowserEvent(MapBrowserEventType.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(EventType.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const MapEventType={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},MapProperty={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},TileState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},DROP=1/0;class PriorityQueue{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,clear(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const s=this.keyFunction_(i);return delete this.queuedElements_[s],i}enqueue(e){assert(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=DROP?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,s=t.length,r=t[e],o=i[e],a=e;for(;e<s>>1;){const h=this.getLeftChildIndex_(e),c=this.getRightChildIndex_(e),d=c<s&&i[c]<i[h]?c:h;t[e]=t[d],i[e]=i[d],e=d}t[e]=r,i[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const i=this.elements_,s=this.priorities_,r=i[t],o=s[t];for(;t>e;){const a=this.getParentIndex_(t);if(s[a]>o)i[t]=i[a],s[t]=s[a],t=a;else break}i[t]=r,s[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let s=0;const r=t.length;let o,a,h;for(a=0;a<r;++a)o=t[a],h=e(o),h==DROP?delete this.queuedElements_[this.keyFunction_(o)]:(i[s]=h,t[s++]=o);t.length=s,i.length=s,this.heapify_()}}class TileQueue extends PriorityQueue{constructor(e,t){super(i=>e.apply(null,i),i=>i[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(EventType.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===TileState.LOADED||i===TileState.ERROR||i===TileState.EMPTY){i!==TileState.ERROR&&t.removeEventListener(EventType.CHANGE,this.boundHandleTileChange_);const s=t.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;){const s=this.dequeue()[0],r=s.getKey();s.getState()===TileState.IDLE&&!(r in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++i,s.load())}}}function getTilePriority(n,e,t,i,s){if(!n||!(t in n.wantedTiles)||!n.wantedTiles[t][e.getKey()])return DROP;const r=n.viewState.center,o=i[0]-r[0],a=i[1]-r[1];return 65536*Math.log(s)+Math.sqrt(o*o+a*a)/s}const ViewHint={ANIMATING:0,INTERACTING:1},ViewProperty={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function createExtent(n,e,t){return(function(i,s,r,o,a){if(!i)return;if(!s&&!e)return i;const h=e?0:r[0]*s,c=e?0:r[1]*s,d=a?a[0]:0,f=a?a[1]:0;let _=n[0]+h/2+d,y=n[2]-h/2+d,S=n[1]+c/2+f,v=n[3]-c/2+f;_>y&&(_=(y+_)/2,y=_),S>v&&(S=(v+S)/2,v=S);let I=clamp(i[0],_,y),A=clamp(i[1],S,v);if(o&&t&&s){const B=30*s;I+=-B*Math.log(1+Math.max(0,_-i[0])/B)+B*Math.log(1+Math.max(0,i[0]-y)/B),A+=-B*Math.log(1+Math.max(0,S-i[1])/B)+B*Math.log(1+Math.max(0,i[1]-v)/B)}return[I,A]})}function none$1(n){return n}function easeIn(n){return Math.pow(n,3)}function easeOut(n){return 1-easeIn(1-n)}function inAndOut(n){return 3*n*n-2*n*n*n}function linear(n){return n}function getViewportClampedResolution(n,e,t,i){const s=getWidth(e)/t[0],r=getHeight(e)/t[1];return i?Math.min(n,Math.max(s,r)):Math.min(n,Math.min(s,r))}function getSmoothClampedResolution(n,e,t){let i=Math.min(n,e);const s=50;return i*=Math.log(1+s*Math.max(0,n/e-1))/s+1,t&&(i=Math.max(i,t),i/=Math.log(1+s*Math.max(0,t/n-1))/s+1),clamp(i,t/2,e*2)}function createSnapToResolutions(n,e,t,i){return e=e!==void 0?e:!0,(function(s,r,o,a){if(s!==void 0){const h=n[0],c=n[n.length-1],d=t?getViewportClampedResolution(h,t,o,i):h;if(a)return e?getSmoothClampedResolution(s,d,c):clamp(s,c,d);const f=Math.min(d,s),_=Math.floor(linearFindNearest(n,f,r));return n[_]>d&&_<n.length-1?n[_+1]:n[_]}})}function createSnapToPower(n,e,t,i,s,r){return i=i!==void 0?i:!0,t=t!==void 0?t:0,(function(o,a,h,c){if(o!==void 0){const d=s?getViewportClampedResolution(e,s,h,r):e;if(c)return i?getSmoothClampedResolution(o,d,t):clamp(o,t,d);const f=1e-9,_=Math.ceil(Math.log(e/d)/Math.log(n)-f),y=-a*(.5-f)+.5,S=Math.min(d,o),v=Math.floor(Math.log(e/S)/Math.log(n)+y),I=Math.max(_,v),A=e/Math.pow(n,I);return clamp(A,t,d)}})}function createMinMaxResolution(n,e,t,i,s){return t=t!==void 0?t:!0,(function(r,o,a,h){if(r!==void 0){const c=i?getViewportClampedResolution(n,i,a,s):n;return!t||!h?clamp(r,e,c):getSmoothClampedResolution(r,c,e)}})}function disable(n){if(n!==void 0)return 0}function none(n){if(n!==void 0)return n}function createSnapToN(n){const e=2*Math.PI/n;return(function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t})}function createSnapToZero(n){const e=toRadians(5);return(function(t,i){return i||t===void 0?t:Math.abs(t)<=e?0:t})}const DEFAULT_MAX_ZOOM=42,DEFAULT_TILE_SIZE=256,DEFAULT_MIN_ZOOM=0;class View extends BaseObject{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=createProjection(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&disableCoordinateWarning(),e.center&&(e.center=fromUserCoordinate(e.center,this.projection_)),e.extent&&(e.extent=fromUserExtent(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in ViewProperty)delete t[a];this.setProperties(t,!0);const i=createResolutionConstraint(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const s=createCenterConstraint(e),r=i.constraint,o=createRotationConstraint(e);this.constraints_={center:s,resolution:r,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const s=e||[0,0,0,0];t=t||[0,0,0,0];const r=this.getResolution(),o=r/2*(s[3]-t[3]+t[1]-s[1]),a=r/2*(s[0]-t[0]+t[2]-s[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let s=arguments[i];s.center&&(s=Object.assign({},s),s.center=fromUserCoordinate(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=fromUserCoordinate(s.anchor,this.getProjection())),t[i]=s}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let s=0;for(;s<t&&!this.isDef();++s){const d=arguments[s];d.center&&this.setCenterInternal(d.center),d.zoom!==void 0?this.setZoom(d.zoom):d.resolution&&this.setResolution(d.resolution),d.rotation!==void 0&&this.setRotation(d.rotation)}if(s===t){i&&animationCallback(i,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,h=this.targetRotation_;const c=[];for(;s<t;++s){const d=arguments[s],f={start:r,complete:!1,anchor:d.anchor,duration:d.duration!==void 0?d.duration:1e3,easing:d.easing||inAndOut,callback:i};if(d.center&&(f.sourceCenter=o,f.targetCenter=d.center.slice(),o=f.targetCenter),d.zoom!==void 0?(f.sourceResolution=a,f.targetResolution=this.getResolutionForZoom(d.zoom),a=f.targetResolution):d.resolution&&(f.sourceResolution=a,f.targetResolution=d.resolution,a=f.targetResolution),d.rotation!==void 0){f.sourceRotation=h;const _=modulo(d.rotation-h+Math.PI,2*Math.PI)-Math.PI;f.targetRotation=h+_,h=f.targetRotation}isNoopAnimation(f)?f.complete=!0:r+=f.duration,c.push(f)}this.animations_.push(c),this.setHint(ViewHint.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ViewHint.ANIMATING]>0}getInteracting(){return this.hints_[ViewHint.INTERACTING]>0}cancelAnimations(){this.setHint(ViewHint.ANIMATING,-this.hints_[ViewHint.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const s=this.animations_[t];if(s[0].callback&&animationCallback(s[0].callback,!1),!e)for(let r=0,o=s.length;r<o;++r){const a=s[r];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const s=this.animations_[i];let r=!0;for(let o=0,a=s.length;o<a;++o){const h=s[o];if(h.complete)continue;const c=e-h.start;let d=h.duration>0?c/h.duration:1;d>=1?(h.complete=!0,d=1):r=!1;const f=h.easing(d);if(h.sourceCenter){const _=h.sourceCenter[0],y=h.sourceCenter[1],S=h.targetCenter[0],v=h.targetCenter[1];this.nextCenter_=h.targetCenter;const I=_+f*(S-_),A=y+f*(v-y);this.targetCenter_=[I,A]}if(h.sourceResolution&&h.targetResolution){const _=f===1?h.targetResolution:h.sourceResolution+f*(h.targetResolution-h.sourceResolution);if(h.anchor){const y=this.getViewportSize_(this.getRotation()),S=this.constraints_.resolution(_,0,y,!0);this.targetCenter_=this.calculateCenterZoom(S,h.anchor)}this.nextResolution_=h.targetResolution,this.targetResolution_=_,this.applyTargetState_(!0)}if(h.sourceRotation!==void 0&&h.targetRotation!==void 0){const _=f===1?modulo(h.targetRotation+Math.PI,2*Math.PI)-Math.PI:h.sourceRotation+f*(h.targetRotation-h.sourceRotation);if(h.anchor){const y=this.constraints_.rotation(_,!0);this.targetCenter_=this.calculateCenterRotate(y,h.anchor)}this.nextRotation_=h.targetRotation,this.targetRotation_=_}if(this.applyTargetState_(!0),t=!0,!h.complete)break}if(r){this.animations_[i]=null,this.setHint(ViewHint.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=s[0].callback;o&&animationCallback(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const s=this.getCenterInternal();return s!==void 0&&(i=[s[0]-t[0],s[1]-t[1]],rotate$1(i,e-this.getRotation()),add$2(i,t)),i}calculateCenterZoom(e,t){let i;const s=this.getCenterInternal(),r=this.getResolution();if(s!==void 0&&r!==void 0){const o=t[0]-e*(t[0]-s[0])/r,a=t[1]-e*(t[1]-s[1])/r;i=[o,a]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],s=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(s*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(s*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&toUserCoordinate(e,this.getProjection())}getCenterInternal(){return this.get(ViewProperty.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return toUserExtent(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();assert(t,"The view center is not defined");const i=this.getResolution();assert(i!==void 0,"The view resolution is not defined");const s=this.getRotation();return assert(s!==void 0,"The view rotation is not defined"),getForViewAndSize(t,i,s,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(ViewProperty.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(fromUserExtent(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=getWidth(e)/t[0],s=getHeight(e)/t[1];return Math.max(i,s)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(t/i)/Math.log(e);return(function(r){return t/Math.pow(e,r*s)})}getRotation(){return this.get(ViewProperty.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,r=Math.log(i/s)/t;return(function(o){return Math.log(i/o)/t/r})}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let s=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();s=calculateCenterOn(s,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],t,i)}return{center:s.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,s;if(this.resolutions_){const r=linearFindNearest(this.resolutions_,e,1);t=r,i=this.resolutions_[r],r==this.resolutions_.length-1?s=2:s=i/this.resolutions_[r+1]}else i=this.maxResolution_,s=this.zoomFactor_;return t+Math.log(i/e)/Math.log(s)}getResolutionForZoom(e){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];const t=clamp(Math.floor(e),0,this.resolutions_.length-2),i=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(i,clamp(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(assert(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){assert(!isEmpty$1(e),"Cannot fit empty extent provided as `geometry`");const s=fromUserExtent(e,this.getProjection());i=fromExtent(s)}else if(e.getType()==="Circle"){const s=fromUserExtent(e.getExtent(),this.getProjection());i=fromExtent(s),i.rotate(this.getRotation(),getCenter(s))}else i=e;this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),s=Math.sin(-t),r=e.getFlatCoordinates(),o=e.getStride();let a=1/0,h=1/0,c=-1/0,d=-1/0;for(let f=0,_=r.length;f<_;f+=o){const y=r[f]*i-r[f+1]*s,S=r[f]*s+r[f+1]*i;a=Math.min(a,y),h=Math.min(h,S),c=Math.max(c,y),d=Math.max(d,S)}return[a,h,c,d]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const s=t.padding!==void 0?t.padding:[0,0,0,0],r=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let h=this.getResolutionForExtentInternal(a,[i[0]-s[1]-s[3],i[1]-s[0]-s[2]]);h=isNaN(h)?o:Math.max(h,o),h=this.getConstrainedResolution(h,r?0:1);const c=this.getRotation(),d=Math.sin(c),f=Math.cos(c),_=getCenter(a);_[0]+=(s[1]-s[3])/2*h,_[1]+=(s[0]-s[2])/2*h;const y=_[0]*f-_[1]*d,S=_[1]*f+_[0]*d,v=this.getConstrainedCenter([y,S],h),I=t.callback?t.callback:VOID;t.duration!==void 0?this.animateInternal({resolution:h,center:v,duration:t.duration,easing:t.easing},I):(this.targetResolution_=h,this.targetCenter_=v,this.applyTargetState_(!1,!0),animationCallback(I,!0))}centerOn(e,t,i){this.centerOnInternal(fromUserCoordinate(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(calculateCenterOn(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,s){let r;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-i),h=calculateCenterOn(e,s,[a[0]/2+o[3],a[1]/2+o[0]],t,i);r=[e[0]-h[0],e[1]-h[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=toUserCoordinate(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&fromUserCoordinate(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*e,0,s,i);t&&(this.targetCenter_=this.calculateCenterZoom(r,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=fromUserCoordinate(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(s,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&fromUserCoordinate(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,s=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,0,r,i),a=this.constraints_.center(this.targetCenter_,o,r,i,this.calculateCenterShift(this.targetCenter_,o,s,r));this.get(ViewProperty.ROTATION)!==s&&this.set(ViewProperty.ROTATION,s),this.get(ViewProperty.RESOLUTION)!==o&&(this.set(ViewProperty.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(ViewProperty.CENTER)||!equals(this.get(ViewProperty.CENTER),a))&&this.set(ViewProperty.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const s=t||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,s,o),h=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=h,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!equals(this.getCenterInternal(),h))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:h,resolution:a,duration:e,easing:easeOut,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ViewHint.INTERACTING,1)}endInteraction(e,t,i){i=i&&fromUserCoordinate(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(ViewHint.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function animationCallback(n,e){setTimeout(function(){n(e)},0)}function createCenterConstraint(n){if(n.extent!==void 0){const t=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return createExtent(n.extent,n.constrainOnlyCenter,t)}const e=createProjection(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,createExtent(t,!1,!1)}return none$1}function createResolutionConstraint(n){let e,t,i,o=n.minZoom!==void 0?n.minZoom:DEFAULT_MIN_ZOOM,a=n.maxZoom!==void 0?n.maxZoom:28;const h=n.zoomFactor!==void 0?n.zoomFactor:2,c=n.multiWorld!==void 0?n.multiWorld:!1,d=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,f=n.showFullExtent!==void 0?n.showFullExtent:!1,_=createProjection(n.projection,"EPSG:3857"),y=_.getExtent();let S=n.constrainOnlyCenter,v=n.extent;if(!c&&!v&&_.isGlobal()&&(S=!1,v=y),n.resolutions!==void 0){const I=n.resolutions;t=I[o],i=I[a]!==void 0?I[a]:I[I.length-1],n.constrainResolution?e=createSnapToResolutions(I,d,!S&&v,f):e=createMinMaxResolution(t,i,d,!S&&v,f)}else{const A=(y?Math.max(getWidth(y),getHeight(y)):360*METERS_PER_UNIT$1.degrees/_.getMetersPerUnit())/DEFAULT_TILE_SIZE/Math.pow(2,DEFAULT_MIN_ZOOM),B=A/Math.pow(2,28-DEFAULT_MIN_ZOOM);t=n.maxResolution,t!==void 0?o=0:t=A/Math.pow(h,o),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=t/Math.pow(h,a):i=A/Math.pow(h,a):i=B),a=o+Math.floor(Math.log(t/i)/Math.log(h)),i=t/Math.pow(h,a-o),n.constrainResolution?e=createSnapToPower(h,t,i,d,!S&&v,f):e=createMinMaxResolution(t,i,d,!S&&v,f)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:o,zoomFactor:h}}function createRotationConstraint(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const t=n.constrainRotation;return t===void 0||t===!0?createSnapToZero():t===!1?none:typeof t=="number"?createSnapToN(t):none}return disable}function isNoopAnimation(n){return!(n.sourceCenter&&n.targetCenter&&!equals(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function calculateCenterOn(n,e,t,i,s){const r=Math.cos(-s);let o=Math.sin(-s),a=n[0]*r-n[1]*o,h=n[1]*r+n[0]*o;a+=(e[0]/2-t[0])*i,h+=(t[1]-e[1]/2)*i,o=-o;const c=a*r-h*o,d=h*r+a*o;return[c,d]}const CLASS_HIDDEN="ol-hidden",CLASS_UNSELECTABLE="ol-unselectable",CLASS_CONTROL="ol-control",CLASS_COLLAPSED="ol-collapsed",fontRegEx=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),fontRegExMatchIndex=["style","variant","weight","size","lineHeight","family"],fontWeights={normal:400,bold:700},getFontParameters=function(n){const e=n.match(fontRegEx);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let i=0,s=fontRegExMatchIndex.length;i<s;++i){const r=e[i+1];r!==void 0&&(t[fontRegExMatchIndex[i]]=typeof r=="string"?r.trim():r)}return isNaN(Number(t.weight))&&t.weight in fontWeights&&(t.weight=fontWeights[t.weight]),t.families=t.family.split(/,\s?/).map(i=>i.trim().replace(/^['"]|['"]$/g,"")),t};function createCanvasContext2D(n,e,t,i){let s;return t&&t.length?s=t.shift():WORKER_OFFSCREEN_CANVAS?s=new OffscreenCanvas(n||300,e||300):s=document.createElement("canvas"),n&&(s.width=n),e&&(s.height=e),s.getContext("2d",i)}let sharedCanvasContext;function getSharedCanvasContext2D(){return sharedCanvasContext||(sharedCanvasContext=createCanvasContext2D(1,1)),sharedCanvasContext}function releaseCanvas(n){const e=n.canvas;e.width=1,e.height=1,n.clearRect(0,0,1,1)}function replaceNode(n,e){const t=e.parentNode;t&&t.replaceChild(n,e)}function removeChildren(n){for(;n.lastChild;)n.lastChild.remove()}function replaceChildren(n,e){const t=n.childNodes;for(let i=0;;++i){const s=t[i],r=e[i];if(!s&&!r)break;if(s!==r){if(!s){n.appendChild(r);continue}if(!r){n.removeChild(s),--i;continue}n.insertBefore(r,s)}}}class Control extends BaseObject{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&this.element?.remove();for(let t=0,i=this.listenerKeys.length;t<i;++t)unlistenByKey(this.listenerKeys[t]);if(this.listenerKeys.length=0,this.map_=e,e){const t=this.target_??e.getOverlayContainerStopEvent();this.element&&t.appendChild(this.element),this.render!==VOID&&this.listenerKeys.push(listen(e,MapEventType.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class Attribution extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",s=e.expandClassName!==void 0?e.expandClassName:t+"-expand",r=e.collapseLabel!==void 0?e.collapseLabel:"âº",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=s):this.label_=a;const h=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(h),this.toggleButton_.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1);const c=t+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" "+CLASS_COLLAPSED:"")+(this.collapsible_?"":" ol-uncollapsible"),d=this.element;d.className=c,d.appendChild(this.toggleButton_),d.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=this.getMap().getAllLayers(),i=new Set(t.flatMap(s=>s.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(s=>i.add(s)):i.add(this.attributions_)),!this.overrideCollapsible_){const s=!t.some(r=>r.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(s)}return Array.from(i)}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=await Promise.all(this.collectSourceAttributions_(e).map(s=>toPromise(()=>s))),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!equals$1(t,this.renderedAttributions_)){removeChildren(this.ulElement_);for(let s=0,r=t.length;s<r;++s){const o=document.createElement("li");o.innerHTML=t[s],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class Rotate extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"â§",s=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(s));const r=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,h=this.element;h.className=a,h.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(CLASS_HIDDEN)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:easeOut}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const s="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(CLASS_HIDDEN);!r&&i===0?this.element.classList.add(CLASS_HIDDEN):r&&i!==0&&this.element.classList.remove(CLASS_HIDDEN)}this.label_.style.transform=s}this.rotation_=i}}class Zoom extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,s=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",r=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"â",h=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",c=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",d=document.createElement("button");d.className=s,d.setAttribute("type","button"),d.title=h,d.appendChild(typeof o=="string"?document.createTextNode(o):o),d.addEventListener(EventType.CLICK,this.handleClick_.bind(this,i),!1);const f=document.createElement("button");f.className=r,f.setAttribute("type","button"),f.title=c,f.appendChild(typeof a=="string"?document.createTextNode(a):a),f.addEventListener(EventType.CLICK,this.handleClick_.bind(this,-i),!1);const _=t+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,y=this.element;y.className=_,y.appendChild(d),y.appendChild(f),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const s=i.getZoom();if(s!==void 0){const r=i.getConstrainedZoom(s+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:easeOut})):i.setZoom(r)}}}function defaults$1(n){n=n||{};const e=new Collection;return(n.zoom!==void 0?n.zoom:!0)&&e.push(new Zoom(n.zoomOptions)),(n.rotate!==void 0?n.rotate:!0)&&e.push(new Rotate(n.rotateOptions)),(n.attribution!==void 0?n.attribution:!0)&&e.push(new Attribution(n.attributionOptions)),e}class Kinetic{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const s=this.points_[t+2]-this.points_[i+2];if(s<1e3/60)return!1;const r=this.points_[t]-this.points_[i],o=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const InteractionProperty={ACTIVE:"active"};class Interaction extends BaseObject{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(InteractionProperty.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(InteractionProperty.ACTIVE,e)}setMap(e){this.map_=e}}function pan(n,e,t){const i=n.getCenterInternal();if(i){const s=[i[0]+e[0],i[1]+e[1]];n.animateInternal({duration:t!==void 0?t:250,easing:linear,center:n.getConstrainedCenter(s)})}}function zoomByDelta(n,e,t,i){const s=n.getZoom();if(s===void 0)return;const r=n.getConstrainedZoom(s+e),o=n.getResolutionForZoom(r);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:o,anchor:t,duration:i!==void 0?i:250,easing:easeOut})}class DoubleClickZoom extends Interaction{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==MapBrowserEventType.DBLCLICK){const i=e.originalEvent,s=e.map,r=e.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=s.getView();zoomByDelta(a,o,r,this.duration_),i.preventDefault(),t=!0}return!t}}function all$1(n){const e=arguments;return function(t){let i=!0;for(let s=0,r=e.length;s<r&&(i=i&&e[s](t),!!i);++s);return i}}const altShiftKeysOnly=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},focus=function(n){const e=n.map.getTargetElement(),t=e.getRootNode(),i=n.map.getOwnerDocument().activeElement;return t instanceof ShadowRoot?t.host.contains(i):e.contains(i)},focusWithTabindex=function(n){const e=n.map.getTargetElement(),t=e.getRootNode();return(t instanceof ShadowRoot?t.host:e).hasAttribute("tabindex")?focus(n):!0},always$1=TRUE,mouseActionButton=function(n){const e=n.originalEvent;return"pointerId"in e&&e.button==0&&!(WEBKIT&&MAC&&e.ctrlKey)},noModifierKeys=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},platformModifierKey=function(n){const e=n.originalEvent;return MAC?e.metaKey:e.ctrlKey},shiftKeyOnly=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},targetNotEditable=function(n){const e=n.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},mouseOnly=function(n){const e=n.originalEvent;return"pointerId"in e&&e.pointerType=="mouse"},primaryAction=function(n){const e=n.originalEvent;return"pointerId"in e&&e.isPrimary&&e.button===0};class PointerInteraction extends Interaction{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==MapBrowserEventType.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==MapBrowserEventType.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==MapBrowserEventType.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==MapBrowserEventType.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function centroid(n){const e=n.length;let t=0,i=0;for(let s=0;s<e;s++)t+=n[s].clientX,i+=n[s].clientY;return{clientX:t/e,clientY:i/e}}class DragPan extends PointerInteraction{constructor(e){super({stopDown:FALSE}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:all$1(noModifierKeys,primaryAction);this.condition_=e.onFocusOnly?all$1(focusWithTabindex,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,s=t.getEventPixel(centroid(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const r=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],a=e.map.getView();scale$2(r,a.getResolution()),rotate$1(r,a.getRotation()),a.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),h=t.getCoordinateFromPixelInternal([a[0]-s*Math.cos(r),a[1]-s*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(h),duration:500,easing:easeOut})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class DragRotate extends PointerInteraction{constructor(e){e=e||{},super({stopDown:FALSE}),this.condition_=e.condition?e.condition:altShiftKeysOnly,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!mouseOnly(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===disable)return;const s=t.getSize(),r=e.pixel,o=Math.atan2(s[1]/2-r[1],r[0]-s[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return mouseOnly(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return mouseOnly(e)&&mouseActionButton(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class RenderBox extends Disposable{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",s=this.element_.style;s.left=Math.min(e[0],t[0])+i,s.top=Math.min(e[1],t[1])+i,s.width=Math.abs(t[0]-e[0])+i,s.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const e=this.startPixel_,t=this.endPixel_,s=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new Polygon([s])}getGeometry(){return this.geometry_}}const DragBoxEventType={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class DragBoxEvent extends BaseEvent{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class DragBox extends PointerInteraction{constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new RenderBox(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??mouseActionButton,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const s=i[0]-t[0],r=i[1]-t[1];return s*s+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new DragBoxEvent(t?DragBoxEventType.BOXEND:DragBoxEventType.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}}class DragZoom extends DragBox{constructor(e){e=e||{};const t=e.condition?e.condition:shiftKeyOnly;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let s=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(s),o=i.getResolutionForExtentInternal(r),a=i.getResolution()/o;s=s.clone(),s.scale(a*a)}i.fitInternal(s,{duration:this.duration_,easing:easeOut})}}const Key={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class KeyboardPan extends Interaction{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return noModifierKeys(t)&&targetNotEditable(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==EventType.KEYDOWN){const i=e.originalEvent,s=i.key;if(this.condition_(e)&&(s==Key.DOWN||s==Key.LEFT||s==Key.RIGHT||s==Key.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let h=0,c=0;s==Key.DOWN?c=-a:s==Key.LEFT?h=-a:s==Key.RIGHT?h=a:c=a;const d=[h,c];rotate$1(d,o.getRotation()),pan(o,d,this.duration_),i.preventDefault(),t=!0}}return!t}}class KeyboardZoom extends Interaction{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!platformModifierKey(t)&&targetNotEditable(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==EventType.KEYDOWN||e.type==EventType.KEYPRESS){const i=e.originalEvent,s=i.key;if(this.condition_(e)&&(s==="+"||s==="-")){const r=e.map,o=s==="+"?this.delta_:-this.delta_,a=r.getView();zoomByDelta(a,o,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}const DELTA_LINE_MULTIPLIER=40,DELTA_PAGE_MULTIPLIER=300;class MouseWheelZoom extends Interaction{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:always$1;this.condition_=e.onFocusOnly?all$1(focusWithTabindex,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==EventType.WHEEL)return!0;const i=e.map,s=e.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let r=s.deltaY;switch(s.deltaMode){case WheelEvent.DOM_DELTA_LINE:r*=DELTA_LINE_MULTIPLIER;break;case WheelEvent.DOM_DELTA_PAGE:r*=DELTA_PAGE_MULTIPLIER;break}if(r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_?i.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=o,!1;this.totalDelta_+=r;const h=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),h),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-clamp(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),zoomByDelta(t,i,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class PinchRotate extends PointerInteraction{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=FALSE),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],s=this.targetPointers[1],r=Math.atan2(s.clientY-i.clientY,s.clientX-i.clientX);if(this.lastAngle_!==void 0){const h=r-this.lastAngle_;this.rotationDelta_+=h,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=h}this.lastAngle_=r;const o=e.map,a=o.getView();a.getConstraints().rotation!==disable&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(centroid(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class PinchZoom extends PointerInteraction{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=FALSE),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],s=this.targetPointers[1],r=i.clientX-s.clientX,o=i.clientY-s.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const h=e.map,c=h.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=h.getCoordinateFromPixelInternal(h.getEventPixel(centroid(this.targetPointers))),h.render(),c.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),s=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function defaults(n){n=n||{};const e=new Collection,t=new Kinetic(-.005,.05,100);return(n.altShiftDragRotate!==void 0?n.altShiftDragRotate:!0)&&e.push(new DragRotate),(n.doubleClickZoom!==void 0?n.doubleClickZoom:!0)&&e.push(new DoubleClickZoom({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan!==void 0?n.dragPan:!0)&&e.push(new DragPan({onFocusOnly:n.onFocusOnly,kinetic:t})),(n.pinchRotate!==void 0?n.pinchRotate:!0)&&e.push(new PinchRotate),(n.pinchZoom!==void 0?n.pinchZoom:!0)&&e.push(new PinchZoom({duration:n.zoomDuration})),(n.keyboard!==void 0?n.keyboard:!0)&&(e.push(new KeyboardPan),e.push(new KeyboardZoom({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom!==void 0?n.mouseWheelZoom:!0)&&e.push(new MouseWheelZoom({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom!==void 0?n.shiftDragZoom:!0)&&e.push(new DragZoom({duration:n.zoomDuration})),e}const LayerProperty={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class BaseLayer extends BaseObject{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[LayerProperty.OPACITY]=e.opacity!==void 0?e.opacity:1,assert(typeof t[LayerProperty.OPACITY]=="number","Layer opacity must be a number"),t[LayerProperty.VISIBLE]=e.visible!==void 0?e.visible:!0,t[LayerProperty.Z_INDEX]=e.zIndex,t[LayerProperty.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[LayerProperty.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[LayerProperty.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[LayerProperty.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=clamp(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return abstract()}getLayerStatesArray(e){return abstract()}getExtent(){return this.get(LayerProperty.EXTENT)}getMaxResolution(){return this.get(LayerProperty.MAX_RESOLUTION)}getMinResolution(){return this.get(LayerProperty.MIN_RESOLUTION)}getMinZoom(){return this.get(LayerProperty.MIN_ZOOM)}getMaxZoom(){return this.get(LayerProperty.MAX_ZOOM)}getOpacity(){return this.get(LayerProperty.OPACITY)}getSourceState(){return abstract()}getVisible(){return this.get(LayerProperty.VISIBLE)}getZIndex(){return this.get(LayerProperty.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(LayerProperty.EXTENT,e)}setMaxResolution(e){this.set(LayerProperty.MAX_RESOLUTION,e)}setMinResolution(e){this.set(LayerProperty.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(LayerProperty.MAX_ZOOM,e)}setMinZoom(e){this.set(LayerProperty.MIN_ZOOM,e)}setOpacity(e){assert(typeof e=="number","Layer opacity must be a number"),this.set(LayerProperty.OPACITY,e)}setVisible(e){this.set(LayerProperty.VISIBLE,e)}setZIndex(e){this.set(LayerProperty.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class GroupEvent extends BaseEvent{constructor(e,t){super(e),this.layer=t}}const Property$1={LAYERS:"layers"};class LayerGroup extends BaseLayer{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Property$1.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new Collection(i.slice(),{unique:!0}):assert(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new Collection(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(unlistenByKey),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(listen(e,CollectionEventType.ADD,this.handleLayersAdd_,this),listen(e,CollectionEventType.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(unlistenByKey);clear(this.listenerKeys_);const t=e.getArray();for(let i=0,s=t.length;i<s;i++){const r=t[i];this.registerLayerListeners_(r),this.dispatchEvent(new GroupEvent("addlayer",r))}this.changed()}registerLayerListeners_(e){const t=[listen(e,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(e,EventType.CHANGE,this.handleLayerChange_,this)];e instanceof LayerGroup&&t.push(listen(e,"addlayer",this.handleLayerGroupAdd_,this),listen(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[getUid(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new GroupEvent("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new GroupEvent("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new GroupEvent("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=getUid(t);this.listenerKeys_[i].forEach(unlistenByKey),delete this.listenerKeys_[i],this.dispatchEvent(new GroupEvent("removelayer",t)),this.changed()}getLayers(){return this.get(Property$1.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let s=0,r=i.length;s<r;++s)this.dispatchEvent(new GroupEvent("removelayer",i[s]))}this.set(Property$1.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const s=this.getLayerState();let r=s.zIndex;!e&&s.zIndex===void 0&&(r=0);for(let o=i,a=t.length;o<a;o++){const h=t[o];h.opacity*=s.opacity,h.visible=h.visible&&s.visible,h.maxResolution=Math.min(h.maxResolution,s.maxResolution),h.minResolution=Math.max(h.minResolution,s.minResolution),h.minZoom=Math.max(h.minZoom,s.minZoom),h.maxZoom=Math.min(h.maxZoom,s.maxZoom),s.extent!==void 0&&(h.extent!==void 0?h.extent=getIntersection(h.extent,s.extent):h.extent=s.extent),h.zIndex===void 0&&(h.zIndex=r)}return t}getSourceState(){return"ready"}}const RenderEventType={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class Layer extends BaseLayer{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(LayerProperty.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(LayerProperty.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(unlistenByKey(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=listen(e,EventType.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const i=this.getMapInternal();!e&&i&&(e=i.getView()),e instanceof View?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let s;if(t.layerStatesArray){if(s=t.layerStatesArray.find(o=>o.layer===this),!s)return!1}else s=this.getLayerState();const r=this.getExtent();return inView(s,t.viewState)&&(!r||intersects$1(r,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];const t=this.getSource()?.getAttributions();if(!t)return[];const i=e instanceof View?e.getViewStateAndExtent():e;let s=t(i);return Array.isArray(s)||(s=[s]),s}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(LayerProperty.MAP,e)}getMapInternal(){return this.get(LayerProperty.MAP)}setMap(e){this.mapPrecomposeKey_&&(unlistenByKey(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(unlistenByKey(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=listen(e,RenderEventType.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=listen(this,EventType.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const t=e.frameState.layerStatesArray,i=this.getLayerState(!1);assert(!t.some(s=>s.layer===i.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(i)}setSource(e){this.set(LayerProperty.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function inView(n,e){if(!n.visible)return!1;const t=e.resolution;if(t<n.minResolution||t>=n.maxResolution)return!1;const i=e.zoom;return i>n.minZoom&&i<=n.maxZoom}function quickselect(n,e,t=0,i=n.length-1,s=defaultCompare){for(;i>t;){if(i-t>600){const h=i-t+1,c=e-t+1,d=Math.log(h),f=.5*Math.exp(2*d/3),_=.5*Math.sqrt(d*f*(h-f)/h)*(c-h/2<0?-1:1),y=Math.max(t,Math.floor(e-c*f/h+_)),S=Math.min(i,Math.floor(e+(h-c)*f/h+_));quickselect(n,e,y,S,s)}const r=n[e];let o=t,a=i;for(swap(n,t,e),s(n[i],r)>0&&swap(n,t,i);o<a;){for(swap(n,o,a),o++,a--;s(n[o],r)<0;)o++;for(;s(n[a],r)>0;)a--}s(n[t],r)===0?swap(n,t,a):(a++,swap(n,a,i)),a<=e&&(t=a+1),e<=a&&(i=a-1)}}function swap(n,e,t){const i=n[e];n[e]=n[t],n[t]=i}function defaultCompare(n,e){return n<e?-1:n>e?1:0}let RBush$1=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!intersects(e,t))return i;const s=this.toBBox,r=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],h=t.leaf?s(a):a;intersects(e,h)&&(t.leaf?i.push(a):contains(e,h)?this._all(a,i):r.push(a))}t=r.pop()}return i}collides(e){let t=this.data;if(!intersects(e,t))return!1;const i=[];for(;t;){for(let s=0;s<t.children.length;s++){const r=t.children[s],o=t.leaf?this.toBBox(r):r;if(intersects(e,o)){if(t.leaf||contains(e,o))return!0;i.push(r)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=createNode([]),this}remove(e,t){if(!e)return this;let i=this.data;const s=this.toBBox(e),r=[],o=[];let a,h,c;for(;i||r.length;){if(i||(i=r.pop(),h=r[r.length-1],a=o.pop(),c=!0),i.leaf){const d=findItem(e,i.children,t);if(d!==-1)return i.children.splice(d,1),r.push(i),this._condense(r),this}!c&&!i.leaf&&contains(i,s)?(r.push(i),o.push(a),a=0,h=i,i=i.children[0]):h?(a++,i=h.children[a],c=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,s){const r=i-t+1;let o=this._maxEntries,a;if(r<=o)return a=createNode(e.slice(t,i+1)),calcBBox(a,this.toBBox),a;s||(s=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,s-1))),a=createNode([]),a.leaf=!1,a.height=s;const h=Math.ceil(r/o),c=h*Math.ceil(Math.sqrt(o));multiSelect(e,t,i,c,this.compareMinX);for(let d=t;d<=i;d+=c){const f=Math.min(d+c-1,i);multiSelect(e,d,f,h,this.compareMinY);for(let _=d;_<=f;_+=h){const y=Math.min(_+h-1,f);a.children.push(this._build(e,_,y,s-1))}}return calcBBox(a,this.toBBox),a}_chooseSubtree(e,t,i,s){for(;s.push(t),!(t.leaf||s.length-1===i);){let r=1/0,o=1/0,a;for(let h=0;h<t.children.length;h++){const c=t.children[h],d=bboxArea(c),f=enlargedArea(e,c)-d;f<o?(o=f,r=d<r?d:r,a=c):f===o&&d<r&&(r=d,a=c)}t=a||t.children[0]}return t}_insert(e,t,i){const s=i?e:this.toBBox(e),r=[],o=this._chooseSubtree(s,this.data,t,r);for(o.children.push(e),extend(o,s);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(s,r,t)}_split(e,t){const i=e[t],s=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,s);const o=this._chooseSplitIndex(i,r,s),a=createNode(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,calcBBox(i,this.toBBox),calcBBox(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this.data=createNode([e,t]),this.data.height=e.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let s,r=1/0,o=1/0;for(let a=t;a<=i-t;a++){const h=distBBox(e,0,a,this.toBBox),c=distBBox(e,a,i,this.toBBox),d=intersectionArea(h,c),f=bboxArea(h)+bboxArea(c);d<r?(r=d,s=a,o=f<o?f:o):d===r&&f<o&&(o=f,s=a)}return s||i-t}_chooseSplitAxis(e,t,i){const s=e.leaf?this.compareMinX:compareNodeMinX,r=e.leaf?this.compareMinY:compareNodeMinY,o=this._allDistMargin(e,t,i,s),a=this._allDistMargin(e,t,i,r);o<a&&e.children.sort(s)}_allDistMargin(e,t,i,s){e.children.sort(s);const r=this.toBBox,o=distBBox(e,0,t,r),a=distBBox(e,i-t,i,r);let h=bboxMargin(o)+bboxMargin(a);for(let c=t;c<i-t;c++){const d=e.children[c];extend(o,e.leaf?r(d):d),h+=bboxMargin(o)}for(let c=i-t-1;c>=t;c--){const d=e.children[c];extend(a,e.leaf?r(d):d),h+=bboxMargin(a)}return h}_adjustParentBBoxes(e,t,i){for(let s=i;s>=0;s--)extend(t[s],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():calcBBox(e[t],this.toBBox)}};function findItem(n,e,t){if(!t)return e.indexOf(n);for(let i=0;i<e.length;i++)if(t(n,e[i]))return i;return-1}function calcBBox(n,e){distBBox(n,0,n.children.length,e,n)}function distBBox(n,e,t,i,s){s||(s=createNode(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=e;r<t;r++){const o=n.children[r];extend(s,n.leaf?i(o):o)}return s}function extend(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function compareNodeMinX(n,e){return n.minX-e.minX}function compareNodeMinY(n,e){return n.minY-e.minY}function bboxArea(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function bboxMargin(n){return n.maxX-n.minX+(n.maxY-n.minY)}function enlargedArea(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function intersectionArea(n,e){const t=Math.max(n.minX,e.minX),i=Math.max(n.minY,e.minY),s=Math.min(n.maxX,e.maxX),r=Math.min(n.maxY,e.maxY);return Math.max(0,s-t)*Math.max(0,r-i)}function contains(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function intersects(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function createNode(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(n,e,t,i,s){const r=[e,t];for(;r.length;){if(t=r.pop(),e=r.pop(),t-e<=i)continue;const o=e+Math.ceil((t-e)/i/2)*i;quickselect(n,o,e,t,s),r.push(e,o,o,t)}}const NO_COLOR=[NaN,NaN,NaN,0];let colorParseContext;function getColorParseContext(){return colorParseContext||(colorParseContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),colorParseContext}const rgbModernRegEx=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,rgbLegacyAbsoluteRegEx=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,rgbLegacyPercentageRegEx=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,hexRegEx=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function toColorComponent(n,e){return n.endsWith("%")?Number(n.substring(0,n.length-1))/e:Number(n)}function throwInvalidColor(n){throw new Error('failed to parse "'+n+'" as color')}function parseRgba(n){if(n.toLowerCase().startsWith("rgb")){const r=n.match(rgbLegacyAbsoluteRegEx)||n.match(rgbModernRegEx)||n.match(rgbLegacyPercentageRegEx);if(r){const o=r[4],a=100/255;return[clamp(toColorComponent(r[1],a)+.5|0,0,255),clamp(toColorComponent(r[2],a)+.5|0,0,255),clamp(toColorComponent(r[3],a)+.5|0,0,255),o!==void 0?clamp(toColorComponent(o,100),0,1):1]}throwInvalidColor(n)}if(n.startsWith("#")){if(hexRegEx.test(n)){const r=n.substring(1),o=r.length<=4?1:2,a=[0,0,0,255];for(let h=0,c=r.length;h<c;h+=o){let d=parseInt(r.substring(h,h+o),16);o===1&&(d+=d<<4),a[h/o]=d}return a[3]=a[3]/255,a}throwInvalidColor(n)}const e=getColorParseContext();e.fillStyle="#abcdef";let t=e.fillStyle;e.fillStyle=n,e.fillStyle===t&&(e.fillStyle="#fedcba",t=e.fillStyle,e.fillStyle=n,e.fillStyle===t&&throwInvalidColor(n));const i=e.fillStyle;if(i.startsWith("#")||i.startsWith("rgba"))return parseRgba(i);e.clearRect(0,0,1,1),e.fillRect(0,0,1,1);const s=Array.from(e.getImageData(0,0,1,1).data);return s[3]=toFixed(s[3]/255,3),s}function asString(n){return typeof n=="string"?n:toString(n)}const MAX_CACHE_SIZE=1024,cache={};let cacheSize=0;function withAlpha(n){if(n.length===4)return n;const e=n.slice();return e[3]=1,e}function b1(n){return n>.0031308?Math.pow(n,1/2.4)*269.025-14.025:n*3294.6}function b2(n){return n>.2068965?Math.pow(n,3):(n-4/29)*(108/841)}function a1(n){return n>10.314724?Math.pow((n+14.025)/269.025,2.4):n/3294.6}function a2(n){return n>.0088564?Math.pow(n,1/3):n/(108/841)+4/29}function rgbaToLcha(n){const e=a1(n[0]),t=a1(n[1]),i=a1(n[2]),s=a2(e*.222488403+t*.716873169+i*.06060791),r=500*(a2(e*.452247074+t*.399439023+i*.148375274)-s),o=200*(s-a2(e*.016863605+t*.117638439+i*.865350722)),a=Math.atan2(o,r)*(180/Math.PI);return[116*s-16,Math.sqrt(r*r+o*o),a<0?a+360:a,n[3]]}function lchaToRgba(n){const e=(n[0]+16)/116,t=n[1],i=n[2]*Math.PI/180,s=b2(e),r=b2(e+t/500*Math.cos(i)),o=b2(e-t/200*Math.sin(i)),a=b1(r*3.021973625-s*1.617392459-o*.404875592),h=b1(r*-.943766287+s*1.916279586+o*.027607165),c=b1(r*.069407491-s*.22898585+o*1.159737864);return[clamp(a+.5|0,0,255),clamp(h+.5|0,0,255),clamp(c+.5|0,0,255),n[3]]}function fromString(n){if(n==="none")return NO_COLOR;if(cache.hasOwnProperty(n))return cache[n];if(cacheSize>=MAX_CACHE_SIZE){let t=0;for(const i in cache)(t++&3)===0&&(delete cache[i],--cacheSize)}const e=parseRgba(n);e.length!==4&&throwInvalidColor(n);for(const t of e)isNaN(t)&&throwInvalidColor(n);return cache[n]=e,++cacheSize,e}function asArray(n){return Array.isArray(n)?n:fromString(n)}function toString(n){let e=n[0];e!=(e|0)&&(e=e+.5|0);let t=n[1];t!=(t|0)&&(t=t+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const s=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+e+","+t+","+i+","+s+")"}function hasArea(n){return n[0]>0&&n[1]>0}function scale(n,e,t){return t===void 0&&(t=[0,0]),t[0]=n[0]*e+.5|0,t[1]=n[1]*e+.5|0,t}function toSize(n,e){return Array.isArray(n)?n:(e===void 0?e=[n,n]:(e[0]=n,e[1]=n),e)}let numTypes=0;const BooleanType=1<<numTypes++,NumberType=1<<numTypes++,StringType=1<<numTypes++,ColorType=1<<numTypes++,NumberArrayType=1<<numTypes++,SizeType=1<<numTypes++,AnyType=Math.pow(2,numTypes)-1,typeNames={[BooleanType]:"boolean",[NumberType]:"number",[StringType]:"string",[ColorType]:"color",[NumberArrayType]:"number[]",[SizeType]:"size"},namedTypes=Object.keys(typeNames).map(Number).sort(ascending);function isSpecific(n){return n in typeNames}function typeName(n){const e=[];for(const t of namedTypes)includesType(n,t)&&e.push(typeNames[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function includesType(n,e){return(n&e)===e}function isType(n,e){return n===e}class LiteralExpression{constructor(e,t){if(!isSpecific(e))throw new Error(`literal expressions must have a specific type, got ${typeName(e)}`);this.type=e,this.value=t}}class CallExpression{constructor(e,t,...i){this.type=e,this.operator=t,this.args=i}}function newParsingContext(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function parse(n,e,t){switch(typeof n){case"boolean":{if(isType(e,StringType))return new LiteralExpression(StringType,n?"true":"false");if(!includesType(e,BooleanType))throw new Error(`got a boolean, but expected ${typeName(e)}`);return new LiteralExpression(BooleanType,n)}case"number":{if(isType(e,SizeType))return new LiteralExpression(SizeType,toSize(n));if(isType(e,BooleanType))return new LiteralExpression(BooleanType,!!n);if(isType(e,StringType))return new LiteralExpression(StringType,n.toString());if(!includesType(e,NumberType))throw new Error(`got a number, but expected ${typeName(e)}`);return new LiteralExpression(NumberType,n)}case"string":{if(isType(e,ColorType))return new LiteralExpression(ColorType,fromString(n));if(isType(e,BooleanType))return new LiteralExpression(BooleanType,!!n);if(!includesType(e,StringType))throw new Error(`got a string, but expected ${typeName(e)}`);return new LiteralExpression(StringType,n)}}if(!Array.isArray(n))throw new Error("expression must be an array or a primitive value");if(n.length===0)throw new Error("empty expression");if(typeof n[0]=="string")return parseCallExpression(n,e,t);for(const i of n)if(typeof i!="number")throw new Error("expected an array of numbers");if(isType(e,SizeType)){if(n.length!==2)throw new Error(`expected an array of two values for a size, got ${n.length}`);return new LiteralExpression(SizeType,n)}if(isType(e,ColorType)){if(n.length===3)return new LiteralExpression(ColorType,[...n,1]);if(n.length===4)return new LiteralExpression(ColorType,n);throw new Error(`expected an array of 3 or 4 values for a color, got ${n.length}`)}if(!includesType(e,NumberArrayType))throw new Error(`got an array of numbers, but expected ${typeName(e)}`);return new LiteralExpression(NumberArrayType,n)}const Ops={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},parsers={[Ops.Get]:createCallExpressionParser(hasArgsCount(1,1/0),withGetArgs),[Ops.Var]:createCallExpressionParser(hasArgsCount(1,1),withVarArgs),[Ops.Has]:createCallExpressionParser(hasArgsCount(1,1/0),withGetArgs),[Ops.Id]:createCallExpressionParser(usesFeatureId,withNoArgs),[Ops.Concat]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(StringType)),[Ops.GeometryType]:createCallExpressionParser(usesGeometryType,withNoArgs),[Ops.LineMetric]:createCallExpressionParser(withNoArgs),[Ops.Resolution]:createCallExpressionParser(usesMapState,withNoArgs),[Ops.Zoom]:createCallExpressionParser(usesMapState,withNoArgs),[Ops.Time]:createCallExpressionParser(usesMapState,withNoArgs),[Ops.Any]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(BooleanType)),[Ops.All]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(BooleanType)),[Ops.Not]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(BooleanType)),[Ops.Equal]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(AnyType)),[Ops.NotEqual]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(AnyType)),[Ops.GreaterThan]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType)),[Ops.GreaterThanOrEqualTo]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType)),[Ops.LessThan]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType)),[Ops.LessThanOrEqualTo]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType)),[Ops.Multiply]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfReturnType),[Ops.Coalesce]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfReturnType),[Ops.Divide]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType)),[Ops.Add]:createCallExpressionParser(hasArgsCount(2,1/0),withArgsOfType(NumberType)),[Ops.Subtract]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType)),[Ops.Clamp]:createCallExpressionParser(hasArgsCount(3,3),withArgsOfType(NumberType)),[Ops.Mod]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType)),[Ops.Pow]:createCallExpressionParser(hasArgsCount(2,2),withArgsOfType(NumberType)),[Ops.Abs]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType)),[Ops.Floor]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType)),[Ops.Ceil]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType)),[Ops.Round]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType)),[Ops.Sin]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType)),[Ops.Cos]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType)),[Ops.Atan]:createCallExpressionParser(hasArgsCount(1,2),withArgsOfType(NumberType)),[Ops.Sqrt]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(NumberType)),[Ops.Match]:createCallExpressionParser(hasArgsCount(4,1/0),hasEvenArgs,withMatchArgs),[Ops.Between]:createCallExpressionParser(hasArgsCount(3,3),withArgsOfType(NumberType)),[Ops.Interpolate]:createCallExpressionParser(hasArgsCount(6,1/0),hasEvenArgs,withInterpolateArgs),[Ops.Case]:createCallExpressionParser(hasArgsCount(3,1/0),hasOddArgs,withCaseArgs),[Ops.In]:createCallExpressionParser(hasArgsCount(2,2),withInArgs),[Ops.Number]:createCallExpressionParser(hasArgsCount(1,1/0),withArgsOfType(AnyType)),[Ops.String]:createCallExpressionParser(hasArgsCount(1,1/0),withArgsOfType(AnyType)),[Ops.Array]:createCallExpressionParser(hasArgsCount(1,1/0),withArgsOfType(NumberType)),[Ops.Color]:createCallExpressionParser(hasArgsCount(1,4),withArgsOfType(NumberType)),[Ops.Band]:createCallExpressionParser(hasArgsCount(1,3),withArgsOfType(NumberType)),[Ops.Palette]:createCallExpressionParser(hasArgsCount(2,2),withPaletteArgs),[Ops.ToString]:createCallExpressionParser(hasArgsCount(1,1),withArgsOfType(BooleanType|NumberType|StringType|ColorType))};function withGetArgs(n,e,t){const i=n.length-1,s=new Array(i);for(let r=0;r<i;++r){const o=n[r+1];switch(typeof o){case"number":{s[r]=new LiteralExpression(NumberType,o);break}case"string":{s[r]=new LiteralExpression(StringType,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}r===0&&t.properties.add(String(o))}return s}function withVarArgs(n,e,t){const i=n[1];if(typeof i!="string")throw new Error("expected a string argument for var operation");return t.variables.add(i),[new LiteralExpression(StringType,i)]}function usesFeatureId(n,e,t){t.featureId=!0}function usesGeometryType(n,e,t){t.geometryType=!0}function usesMapState(n,e,t){t.mapState=!0}function withNoArgs(n,e,t){const i=n[0];if(n.length!==1)throw new Error(`expected no arguments for ${i} operation`);return[]}function hasArgsCount(n,e){return function(t,i,s){const r=t[0],o=t.length-1;if(n===e){if(o!==n){const a=n===1?"":"s";throw new Error(`expected ${n} argument${a} for ${r}, got ${o}`)}}else if(o<n||o>e){const a=e===1/0?`${n} or more`:`${n} to ${e}`;throw new Error(`expected ${a} arguments for ${r}, got ${o}`)}}}function withArgsOfReturnType(n,e,t){const i=n.length-1,s=new Array(i);for(let r=0;r<i;++r){const o=parse(n[r+1],e,t);s[r]=o}return s}function withArgsOfType(n){return function(e,t,i){const s=e.length-1,r=new Array(s);for(let o=0;o<s;++o){const a=parse(e[o+1],n,i);r[o]=a}return r}}function hasOddArgs(n,e,t){const i=n[0],s=n.length-1;if(s%2===0)throw new Error(`expected an odd number of arguments for ${i}, got ${s} instead`)}function hasEvenArgs(n,e,t){const i=n[0],s=n.length-1;if(s%2===1)throw new Error(`expected an even number of arguments for operation ${i}, got ${s} instead`)}function withMatchArgs(n,e,t){const i=n.length-1,s=StringType|NumberType|BooleanType,r=parse(n[1],s,t),o=parse(n[n.length-1],e,t),a=new Array(i-2);for(let h=0;h<i-2;h+=2){try{const c=parse(n[h+2],r.type,t);a[h]=c}catch(c){throw new Error(`failed to parse argument ${h+1} of match expression: ${c.message}`)}try{const c=parse(n[h+3],o.type,t);a[h+1]=c}catch(c){throw new Error(`failed to parse argument ${h+2} of match expression: ${c.message}`)}}return[r,...a,o]}function withInterpolateArgs(n,e,t){const i=n[1];let s;switch(i[0]){case"linear":s=1;break;case"exponential":const h=i[1];if(typeof h!="number"||h<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(h)} instead`);s=h;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(i)}`)}const r=new LiteralExpression(NumberType,s);let o;try{o=parse(n[2],NumberType,t)}catch(h){throw new Error(`failed to parse argument 1 in interpolate expression: ${h.message}`)}const a=new Array(n.length-3);for(let h=0;h<a.length;h+=2){try{const c=parse(n[h+3],NumberType,t);a[h]=c}catch(c){throw new Error(`failed to parse argument ${h+2} for interpolate expression: ${c.message}`)}try{const c=parse(n[h+4],e,t);a[h+1]=c}catch(c){throw new Error(`failed to parse argument ${h+3} for interpolate expression: ${c.message}`)}}return[r,o,...a]}function withCaseArgs(n,e,t){const i=parse(n[n.length-1],e,t),s=new Array(n.length-1);for(let r=0;r<s.length-1;r+=2){try{const o=parse(n[r+1],BooleanType,t);s[r]=o}catch(o){throw new Error(`failed to parse argument ${r} of case expression: ${o.message}`)}try{const o=parse(n[r+2],i.type,t);s[r+1]=o}catch(o){throw new Error(`failed to parse argument ${r+1} of case expression: ${o.message}`)}}return s[s.length-1]=i,s}function withInArgs(n,e,t){let i=n[2];if(!Array.isArray(i))throw new Error('the second argument for the "in" operator must be an array');let s;if(typeof i[0]=="string"){if(i[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(i[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');i=i[1],s=StringType}else s=NumberType;const r=new Array(i.length);for(let a=0;a<r.length;a++)try{const h=parse(i[a],s,t);r[a]=h}catch(h){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${h.message}`)}return[parse(n[1],s,t),...r]}function withPaletteArgs(n,e,t){let i;try{i=parse(n[1],NumberType,t)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}const s=n[2];if(!Array.isArray(s))throw new Error("the second argument of palette must be an array");const r=new Array(s.length);for(let o=0;o<r.length;o++){let a;try{a=parse(s[o],ColorType,t)}catch(h){throw new Error(`failed to parse color at index ${o} in palette expression: ${h.message}`)}if(!(a instanceof LiteralExpression))throw new Error(`the palette color at index ${o} must be a literal value`);r[o]=a}return[i,...r]}function createCallExpressionParser(...n){return function(e,t,i){const s=e[0];let r;for(let o=0;o<n.length;o++){const a=n[o](e,t,i);if(o==n.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");r=a}}return new CallExpression(t,s,...r)}}function parseCallExpression(n,e,t){const i=n[0],s=parsers[i];if(!s)throw new Error(`unknown operator: ${i}`);return s(n,e,t)}function computeGeometryType(n){if(!n)return"";const e=n.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return computeGeometryType(n.getGeometries()[0]);default:return""}}function newEvaluationContext(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function buildExpression(n,e,t){const i=parse(n,e,t);return compileExpression(i)}function compileExpression(n,e){if(n instanceof LiteralExpression){if(n.type===ColorType&&typeof n.value=="string"){const i=fromString(n.value);return function(){return i}}return function(){return n.value}}const t=n.operator;switch(t){case Ops.Number:case Ops.String:case Ops.Coalesce:return compileAssertionExpression(n);case Ops.Get:case Ops.Var:case Ops.Has:return compileAccessorExpression(n);case Ops.Id:return i=>i.featureId;case Ops.GeometryType:return i=>i.geometryType;case Ops.Concat:{const i=n.args.map(s=>compileExpression(s));return s=>"".concat(...i.map(r=>r(s).toString()))}case Ops.Resolution:return i=>i.resolution;case Ops.Any:case Ops.All:case Ops.Between:case Ops.In:case Ops.Not:return compileLogicalExpression(n);case Ops.Equal:case Ops.NotEqual:case Ops.LessThan:case Ops.LessThanOrEqualTo:case Ops.GreaterThan:case Ops.GreaterThanOrEqualTo:return compileComparisonExpression(n);case Ops.Multiply:case Ops.Divide:case Ops.Add:case Ops.Subtract:case Ops.Clamp:case Ops.Mod:case Ops.Pow:case Ops.Abs:case Ops.Floor:case Ops.Ceil:case Ops.Round:case Ops.Sin:case Ops.Cos:case Ops.Atan:case Ops.Sqrt:return compileNumericExpression(n);case Ops.Case:return compileCaseExpression(n);case Ops.Match:return compileMatchExpression(n);case Ops.Interpolate:return compileInterpolateExpression(n);case Ops.ToString:return compileConvertExpression(n);default:throw new Error(`Unsupported operator ${t}`)}}function compileAssertionExpression(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=compileExpression(n.args[r]);switch(t){case Ops.Coalesce:return r=>{for(let o=0;o<i;++o){const a=s[o](r);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case Ops.Number:case Ops.String:return r=>{for(let o=0;o<i;++o){const a=s[o](r);if(typeof a===t)return a}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function compileAccessorExpression(n,e){const i=n.args[0].value;switch(n.operator){case Ops.Get:return s=>{const r=n.args;let o=s.properties[i];for(let a=1,h=r.length;a<h;++a){const d=r[a].value;o=o[d]}return o};case Ops.Var:return s=>s.variables[i];case Ops.Has:return s=>{const r=n.args;if(!(i in s.properties))return!1;let o=s.properties[i];for(let a=1,h=r.length;a<h;++a){const d=r[a].value;if(!o||!Object.hasOwn(o,d))return!1;o=o[d]}return!0};default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function compileComparisonExpression(n,e){const t=n.operator,i=compileExpression(n.args[0]),s=compileExpression(n.args[1]);switch(t){case Ops.Equal:return r=>i(r)===s(r);case Ops.NotEqual:return r=>i(r)!==s(r);case Ops.LessThan:return r=>i(r)<s(r);case Ops.LessThanOrEqualTo:return r=>i(r)<=s(r);case Ops.GreaterThan:return r=>i(r)>s(r);case Ops.GreaterThanOrEqualTo:return r=>i(r)>=s(r);default:throw new Error(`Unsupported comparison operator ${t}`)}}function compileLogicalExpression(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=compileExpression(n.args[r]);switch(t){case Ops.Any:return r=>{for(let o=0;o<i;++o)if(s[o](r))return!0;return!1};case Ops.All:return r=>{for(let o=0;o<i;++o)if(!s[o](r))return!1;return!0};case Ops.Between:return r=>{const o=s[0](r),a=s[1](r),h=s[2](r);return o>=a&&o<=h};case Ops.In:return r=>{const o=s[0](r);for(let a=1;a<i;++a)if(o===s[a](r))return!0;return!1};case Ops.Not:return r=>!s[0](r);default:throw new Error(`Unsupported logical operator ${t}`)}}function compileNumericExpression(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=compileExpression(n.args[r]);switch(t){case Ops.Multiply:return r=>{let o=1;for(let a=0;a<i;++a)o*=s[a](r);return o};case Ops.Divide:return r=>s[0](r)/s[1](r);case Ops.Add:return r=>{let o=0;for(let a=0;a<i;++a)o+=s[a](r);return o};case Ops.Subtract:return r=>s[0](r)-s[1](r);case Ops.Clamp:return r=>{const o=s[0](r),a=s[1](r);if(o<a)return a;const h=s[2](r);return o>h?h:o};case Ops.Mod:return r=>s[0](r)%s[1](r);case Ops.Pow:return r=>Math.pow(s[0](r),s[1](r));case Ops.Abs:return r=>Math.abs(s[0](r));case Ops.Floor:return r=>Math.floor(s[0](r));case Ops.Ceil:return r=>Math.ceil(s[0](r));case Ops.Round:return r=>Math.round(s[0](r));case Ops.Sin:return r=>Math.sin(s[0](r));case Ops.Cos:return r=>Math.cos(s[0](r));case Ops.Atan:return i===2?r=>Math.atan2(s[0](r),s[1](r)):r=>Math.atan(s[0](r));case Ops.Sqrt:return r=>Math.sqrt(s[0](r));default:throw new Error(`Unsupported numeric operator ${t}`)}}function compileCaseExpression(n,e){const t=n.args.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=compileExpression(n.args[s]);return s=>{for(let r=0;r<t-1;r+=2)if(i[r](s))return i[r+1](s);return i[t-1](s)}}function compileMatchExpression(n,e){const t=n.args.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=compileExpression(n.args[s]);return s=>{const r=i[0](s);for(let o=1;o<t-1;o+=2)if(r===i[o](s))return i[o+1](s);return i[t-1](s)}}function compileInterpolateExpression(n,e){const t=n.args.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=compileExpression(n.args[s]);return s=>{const r=i[0](s),o=i[1](s);let a,h;for(let c=2;c<t;c+=2){const d=i[c](s);let f=i[c+1](s);const _=Array.isArray(f);if(_&&(f=withAlpha(f)),d>=o)return c===2?f:_?interpolateColor(r,o,a,h,d,f):interpolateNumber(r,o,a,h,d,f);a=d,h=f}return h}}function compileConvertExpression(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=compileExpression(n.args[r]);switch(t){case Ops.ToString:return r=>{const o=s[0](r);return n.args[0].type===ColorType?toString(o):o.toString()};default:throw new Error(`Unsupported convert operator ${t}`)}}function interpolateNumber(n,e,t,i,s,r){const o=s-t;if(o===0)return i;const a=e-t,h=n===1?a/o:(Math.pow(n,a)-1)/(Math.pow(n,o)-1);return i+h*(r-i)}function interpolateColor(n,e,t,i,s,r){if(s-t===0)return i;const a=rgbaToLcha(i),h=rgbaToLcha(r);let c=h[2]-a[2];c>180?c-=360:c<-180&&(c+=360);const d=[interpolateNumber(n,e,t,a[0],s,h[0]),interpolateNumber(n,e,t,a[1],s,h[1]),a[2]+interpolateNumber(n,e,t,0,s,c),interpolateNumber(n,e,t,i[3],s,r[3])];return lchaToRgba(d)}const ImageState={IDLE:0,LOADING:1,LOADED:2,ERROR:3};function listenImage(n,e,t){const i=n;let s=!0,r=!1,o=!1;const a=[listenOnce(i,EventType.LOAD,function(){o=!0,r||e()})];return i.src&&IMAGE_DECODE?(r=!0,i.decode().then(function(){s&&e()}).catch(function(h){s&&(o?e():t())})):a.push(listenOnce(i,EventType.ERROR,t)),function(){s=!1,a.forEach(unlistenByKey)}}function load(n,e){return new Promise((t,i)=>{function s(){o(),t(n)}function r(){o(),i(new Error("Image load error"))}function o(){n.removeEventListener("load",s),n.removeEventListener("error",r)}n.addEventListener("load",s),n.addEventListener("error",r)})}function decodeFallback(n,e){return e&&(n.src=e),n.src&&IMAGE_DECODE?new Promise((t,i)=>n.decode().then(()=>t(n)).catch(s=>n.complete&&n.width?t(n):i(s))):load(n)}class IconImageCache{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];(e++&3)===0&&!i.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,i){const s=getCacheKey$1(e,t,i);return s in this.cache_?this.cache_[s]:null}getPattern(e,t,i){const s=getCacheKey$1(e,t,i);return s in this.patternCache_?this.patternCache_[s]:null}set(e,t,i,s,r){const o=getCacheKey$1(e,t,i),a=o in this.cache_;this.cache_[o]=s,r&&(s.getImageState()===ImageState.IDLE&&s.load(),s.getImageState()===ImageState.LOADING?s.ready().then(()=>{this.patternCache_[o]=getSharedCanvasContext2D().createPattern(s.getImage(1),"repeat")}):this.patternCache_[o]=getSharedCanvasContext2D().createPattern(s.getImage(1),"repeat")),a||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function getCacheKey$1(n,e,t){const i=t?asArray(t):"null";return e+":"+n+":"+i}const shared=new IconImageCache;let taintedTestContext=null;class IconImage extends Target{constructor(e,t,i,s,r){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i,this.canvas_={},this.color_=r,this.imageState_=s===void 0?ImageState.IDLE:s,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===ImageState.LOADED){taintedTestContext||(taintedTestContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})),taintedTestContext.drawImage(this.image_,0,0);try{taintedTestContext.getImageData(0,0,1,1),this.tainted_=!1}catch{taintedTestContext=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(EventType.CHANGE)}handleImageError_(){this.imageState_=ImageState.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ImageState.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=createCanvasContext2D(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===ImageState.IDLE){this.image_||this.initializeImage_(),this.imageState_=ImageState.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&decodeFallback(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==ImageState.LOADED)return;const t=this.image_,i=createCanvasContext2D(Math.ceil(t.width*e),Math.ceil(t.height*e)),s=i.canvas;i.scale(e,e),i.drawImage(t,0,0),i.globalCompositeOperation="multiply",i.fillStyle=asString(this.color_),i.fillRect(0,0,s.width/e,s.height/e),i.globalCompositeOperation="destination-in",i.drawImage(t,0,0),this.canvas_[e]=s}ready(){return this.ready_||(this.ready_=new Promise(e=>{if(this.imageState_===ImageState.LOADED||this.imageState_===ImageState.ERROR)e();else{const t=()=>{(this.imageState_===ImageState.LOADED||this.imageState_===ImageState.ERROR)&&(this.removeEventListener(EventType.CHANGE,t),e())};this.addEventListener(EventType.CHANGE,t)}})),this.ready_}}function get(n,e,t,i,s,r){let o=e===void 0?void 0:shared.get(e,t,s);return o||(o=new IconImage(n,n&&"src"in n?n.src||void 0:e,t,i,s),shared.set(e,t,s,o,r)),r&&o&&!shared.getPattern(e,t,s)&&shared.set(e,t,s,o,r),o}function asColorLike(n){return n?Array.isArray(n)?toString(n):typeof n=="object"&&"src"in n?asCanvasPattern(n):n:null}function asCanvasPattern(n){if(!n.offset||!n.size)return shared.getPattern(n.src,"anonymous",n.color);const e=n.src+":"+n.offset,t=shared.getPattern(e,void 0,n.color);if(t)return t;const i=shared.get(n.src,"anonymous",null);if(i.getImageState()!==ImageState.LOADED)return null;const s=createCanvasContext2D(n.size[0],n.size[1]);return s.drawImage(i.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),get(s.canvas,e,void 0,ImageState.LOADED,n.color,!0),shared.getPattern(e,void 0,n.color)}const defaultFont="10px sans-serif",defaultFillStyle="#000",defaultLineCap="round",defaultLineDash=[],defaultLineDashOffset=0,defaultLineJoin="round",defaultMiterLimit=10,defaultStrokeStyle="#000",defaultTextAlign="center",defaultTextBaseline="middle",defaultPadding=[0,0,0,0],defaultLineWidth=1,checkedFonts=new BaseObject;let measureContext=null,measureFont;const textHeights={},genericFontFamilies=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function getFontKey(n,e,t){return`${n} ${e} 16px "${t}"`}const registerFont=(function(){let e,t;async function i(r){await t.ready;const o=await t.load(r);if(o.length===0)return!1;const a=getFontParameters(r),h=a.families[0].toLowerCase(),c=a.weight;return o.some(d=>{const f=d.family.replace(/^['"]|['"]$/g,"").toLowerCase(),_=fontWeights[d.weight]||d.weight;return f===h&&d.style===a.style&&_==c})}async function s(){await t.ready;let r=!0;const o=checkedFonts.getProperties(),a=Object.keys(o).filter(h=>o[h]<100);for(let h=a.length-1;h>=0;--h){const c=a[h];let d=o[c];d<100&&(await i(c)?(clear(textHeights),checkedFonts.set(c,100)):(d+=10,checkedFonts.set(c,d,!0),d<100&&(r=!1)))}e=void 0,r||(e=setTimeout(s,100))}return async function(r){t||(t=WORKER_OFFSCREEN_CANVAS?self.fonts:document.fonts);const o=getFontParameters(r);if(!o)return;const a=o.families;let h=!1;for(const c of a){if(genericFontFamilies.has(c))continue;const d=getFontKey(o.style,o.weight,c);checkedFonts.get(d)===void 0&&(checkedFonts.set(d,0,!0),h=!0)}h&&(clearTimeout(e),e=setTimeout(s,100))}})(),measureTextHeight=(function(){let n;return function(e){let t=textHeights[e];if(t==null){if(WORKER_OFFSCREEN_CANVAS){const i=getFontParameters(e),s=measureText(e,"Å½g");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=e,document.body.appendChild(n),t=n.offsetHeight,document.body.removeChild(n);textHeights[e]=t}return t}})();function measureText(n,e){return measureContext||(measureContext=createCanvasContext2D(1,1)),n!=measureFont&&(measureContext.font=n,measureFont=measureContext.font),measureContext.measureText(e)}function measureTextWidth(n,e){return measureText(n,e).width}function measureAndCacheTextWidth(n,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((s,r)=>Math.max(s,measureTextWidth(n,r)),0);return t[e]=i,i}function getTextDimensions(n,e){const t=[],i=[],s=[];let r=0,o=0,a=0,h=0;for(let c=0,d=e.length;c<=d;c+=2){const f=e[c];if(f===`
`||c===d){r=Math.max(r,o),s.push(o),o=0,a+=h,h=0;continue}const _=e[c+1]||n.font,y=measureTextWidth(_,f);t.push(y),o+=y;const S=measureTextHeight(_);i.push(S),h=Math.max(h,S)}return{width:r,height:a,widths:t,heights:i,lineWidths:s}}function drawImageOrLabel(n,e,t,i,s,r,o,a,h,c,d){n.save(),t!==1&&(n.globalAlpha===void 0?n.globalAlpha=f=>f.globalAlpha*=t:n.globalAlpha*=t),e&&n.transform.apply(n,e),i.contextInstructions?(n.translate(h,c),n.scale(d[0],d[1]),executeLabelInstructions(i,n)):d[0]<0||d[1]<0?(n.translate(h,c),n.scale(d[0],d[1]),n.drawImage(i,s,r,o,a,0,0,o,a)):n.drawImage(i,s,r,o,a,h,c,o*d[0],a*d[1]),n.restore()}function executeLabelInstructions(n,e){const t=n.contextInstructions;for(let i=0,s=t.length;i<s;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class ImageStyle{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=toSize(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new ImageStyle({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return abstract()}getImage(e){return abstract()}getHitDetectionImage(){return abstract()}getPixelRatio(e){return 1}getImageState(){return abstract()}getImageSize(){return abstract()}getOrigin(){return abstract()}getSize(){return abstract()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=toSize(e)}listenImageChange(e){abstract()}load(){abstract()}unlistenImageChange(e){abstract()}ready(){return Promise.resolve()}}class RegularShape extends ImageStyle{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?ImageState.LOADING:ImageState.LOADED,this.imageState_===ImageState.LOADING&&this.ready().then(()=>this.imageState_=ImageState.LOADED),this.render()}clone(){const e=this.getScale(),t=new RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){const t=this.fill_?.getKey(),i=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${t}`+Object.values(this.renderOptions_).join(",");let s=shared.get(i,null,null)?.getImage(1);if(!s){const r=this.renderOptions_,o=Math.ceil(r.size*e),a=createCanvasContext2D(o,o);this.draw_(r,a,e),s=a.canvas,shared.set(i,null,null,new IconImage(s,void 0,null,ImageState.LOADED,null))}return s}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let s=this.radius,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const q=s;s=r,r=q}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,h=r*Math.sin(a),c=Math.sqrt(r*r-h*h),d=s-c,f=Math.sqrt(h*h+d*d),_=f/h;if(e==="miter"&&_<=i)return _*t;const y=t/2/_,S=t/2*(d/f),I=Math.sqrt((s+y)*(s+y)+S*S)-s;if(this.radius2_===void 0||e==="bevel")return I*2;const A=s*Math.sin(a),B=Math.sqrt(s*s-A*A),G=r-B,z=Math.sqrt(A*A+G*G)/A;if(z<=i){const q=z*t/2-r-s;return 2*Math.max(I,q)}return I*2}createRenderOptions(){let e=defaultLineCap,t=defaultLineJoin,i=0,s=null,r=0,o,a=0;this.stroke_&&(o=asColorLike(this.stroke_.getColor()??defaultStrokeStyle),a=this.stroke_.getWidth()??defaultLineWidth,s=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??defaultLineJoin,e=this.stroke_.getLineCap()??defaultLineCap,i=this.stroke_.getMiterLimit()??defaultMiterLimit);const h=this.calculateLineJoinSize_(t,a,i),c=Math.max(this.radius,this.radius2_||0),d=Math.ceil(2*c+h);return{strokeStyle:o,strokeWidth:a,size:d,lineCap:e,lineDash:s,lineDashOffset:r,lineJoin:t,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let s=this.fill_.getColor();s===null&&(s=defaultFillStyle),t.fillStyle=asColorLike(s),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let i=this.fill_.getColor(),s=0;typeof i=="string"&&(i=asArray(i)),i===null?s=1:Array.isArray(i)&&(s=i.length===4?i[3]:1),s===0&&(t=createCanvasContext2D(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const i=this.radius;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const s=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const h=r+a*o,c=a%2===0?i:s;e.lineTo(c*Math.cos(h),c*Math.sin(h))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=defaultFillStyle,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class CircleStyle extends RegularShape{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new CircleStyle({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius=e,this.render()}}class Fill{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new Fill({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const t=get(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===ImageState.IDLE&&t.load(),t.getImageState()===ImageState.LOADING&&(this.patternImage_=t)}this.color_=e}getKey(){const e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?getUid(e):typeof e=="object"&&"src"in e?e.src+":"+e.offset:asArray(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function calculateScale(n,e,t,i){return t!==void 0&&i!==void 0?[t/n,i/e]:t!==void 0?t/n:i!==void 0?i/e:1}class Icon extends ImageStyle{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,s=e.scale!==void 0?e.scale:1,r=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:s,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:r,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;let a=e.src;assert(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||getUid(o)),assert(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),assert(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let h;if(e.src!==void 0?h=ImageState.IDLE:o!==void 0&&("complete"in o?o.complete?h=o.src?ImageState.LOADED:ImageState.IDLE:h=ImageState.LOADING:h=ImageState.LOADED),this.color_=e.color!==void 0?asArray(e.color):null,this.iconImage_=get(o,a,this.crossOrigin_,h,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.initialOptions_,e.width!==void 0||e.height!==void 0){let c,d;if(e.size)[c,d]=e.size;else{const f=this.getImage(1);if(f.width&&f.height)c=f.width,d=f.height;else if(f instanceof HTMLImageElement){this.initialOptions_=e;const _=()=>{if(this.unlistenImageChange(_),!this.initialOptions_)return;const y=this.iconImage_.getSize();this.setScale(calculateScale(y[0],y[1],e.width,e.height))};this.listenImageChange(_);return}}c!==void 0&&this.setScale(calculateScale(c,d,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=s[0]),this.anchorYUnits_=="fraction"&&(e[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+s[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==ImageState.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==ImageState.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(EventType.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(EventType.CHANGE,e)}ready(){return this.iconImage_.ready()}}class Stroke{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Stroke({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}class Style{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=defaultGeometryFunction,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new Style({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=defaultGeometryFunction,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function toFunction(n){let e;if(typeof n=="function")e=n;else{let t;Array.isArray(n)?t=n:(assert(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[n]),e=function(){return t}}return e}let defaultStyles=null;function createDefaultStyle(n,e){if(!defaultStyles){const t=new Fill({color:"rgba(255,255,255,0.4)"}),i=new Stroke({color:"#3399CC",width:1.25});defaultStyles=[new Style({image:new CircleStyle({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return defaultStyles}function defaultGeometryFunction(n){return n.getGeometry()}const DEFAULT_FILL_COLOR="#333";class Text{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=toSize(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new Fill({color:DEFAULT_FILL_COLOR}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Text({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=toSize(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}function always(n){return!0}function rulesToStyleFunction(n){const e=newParsingContext(),t=buildRuleSet(n,e),i=newEvaluationContext();return function(s,r){if(i.properties=s.getPropertiesInternal(),i.resolution=r,e.featureId){const o=s.getId();o!==void 0?i.featureId=o:i.featureId=null}return e.geometryType&&(i.geometryType=computeGeometryType(s.getGeometry())),t(i)}}function flatStylesToStyleFunction(n){const e=newParsingContext(),t=n.length,i=new Array(t);for(let o=0;o<t;++o)i[o]=buildStyle(n[o],e);const s=newEvaluationContext(),r=new Array(t);return function(o,a){if(s.properties=o.getPropertiesInternal(),s.resolution=a,e.featureId){const c=o.getId();c!==void 0?s.featureId=c:s.featureId=null}let h=0;for(let c=0;c<t;++c){const d=i[c](s);d&&(r[h]=d,h+=1)}return r.length=h,r}}function buildRuleSet(n,e){const t=n.length,i=new Array(t);for(let s=0;s<t;++s){const r=n[s],o="filter"in r?buildExpression(r.filter,BooleanType,e):always;let a;if(Array.isArray(r.style)){const h=r.style.length;a=new Array(h);for(let c=0;c<h;++c)a[c]=buildStyle(r.style[c],e)}else a=[buildStyle(r.style,e)];i[s]={filter:o,styles:a}}return function(s){const r=[];let o=!1;for(let a=0;a<t;++a){const h=i[a].filter;if(h(s)&&!(n[a].else&&o)){o=!0;for(const c of i[a].styles){const d=c(s);d&&r.push(d)}}}return r}}function buildStyle(n,e){const t=buildFill(n,"",e),i=buildStroke(n,"",e),s=buildText(n,e),r=buildImage(n,e),o=numberEvaluator(n,"z-index",e);if(!t&&!i&&!s&&!r&&!isEmpty(n))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));const a=new Style;return function(h){let c=!0;if(t){const d=t(h);d&&(c=!1),a.setFill(d)}if(i){const d=i(h);d&&(c=!1),a.setStroke(d)}if(s){const d=s(h);d&&(c=!1),a.setText(d)}if(r){const d=r(h);d&&(c=!1),a.setImage(d)}return o&&a.setZIndex(o(h)),c?null:a}}function buildFill(n,e,t){let i;if(e+"fill-pattern-src"in n)i=patternEvaluator(n,e+"fill-",t);else{if(n[e+"fill-color"]==="none")return r=>null;i=colorLikeEvaluator(n,e+"fill-color",t)}if(!i)return null;const s=new Fill;return function(r){const o=i(r);return o===NO_COLOR?null:(s.setColor(o),s)}}function buildStroke(n,e,t){const i=numberEvaluator(n,e+"stroke-width",t),s=colorLikeEvaluator(n,e+"stroke-color",t);if(!i&&!s)return null;const r=stringEvaluator(n,e+"stroke-line-cap",t),o=stringEvaluator(n,e+"stroke-line-join",t),a=numberArrayEvaluator(n,e+"stroke-line-dash",t),h=numberEvaluator(n,e+"stroke-line-dash-offset",t),c=numberEvaluator(n,e+"stroke-miter-limit",t),d=new Stroke;return function(f){if(s){const _=s(f);if(_===NO_COLOR)return null;d.setColor(_)}if(i&&d.setWidth(i(f)),r){const _=r(f);if(_!=="butt"&&_!=="round"&&_!=="square")throw new Error("Expected butt, round, or square line cap");d.setLineCap(_)}if(o){const _=o(f);if(_!=="bevel"&&_!=="round"&&_!=="miter")throw new Error("Expected bevel, round, or miter line join");d.setLineJoin(_)}return a&&d.setLineDash(a(f)),h&&d.setLineDashOffset(h(f)),c&&d.setMiterLimit(c(f)),d}}function buildText(n,e){const t="text-",i=stringEvaluator(n,t+"value",e);if(!i)return null;const s=buildFill(n,t,e),r=buildFill(n,t+"background-",e),o=buildStroke(n,t,e),a=buildStroke(n,t+"background-",e),h=stringEvaluator(n,t+"font",e),c=numberEvaluator(n,t+"max-angle",e),d=numberEvaluator(n,t+"offset-x",e),f=numberEvaluator(n,t+"offset-y",e),_=booleanEvaluator(n,t+"overflow",e),y=stringEvaluator(n,t+"placement",e),S=numberEvaluator(n,t+"repeat",e),v=sizeLikeEvaluator(n,t+"scale",e),I=booleanEvaluator(n,t+"rotate-with-view",e),A=numberEvaluator(n,t+"rotation",e),B=stringEvaluator(n,t+"align",e),G=stringEvaluator(n,t+"justify",e),k=stringEvaluator(n,t+"baseline",e),z=booleanEvaluator(n,t+"keep-upright",e),q=numberArrayEvaluator(n,t+"padding",e),T=optionalDeclutterMode(n,t+"declutter-mode"),j=new Text({declutterMode:T});return function(te){if(j.setText(i(te)),s&&j.setFill(s(te)),r&&j.setBackgroundFill(r(te)),o&&j.setStroke(o(te)),a&&j.setBackgroundStroke(a(te)),h&&j.setFont(h(te)),c&&j.setMaxAngle(c(te)),d&&j.setOffsetX(d(te)),f&&j.setOffsetY(f(te)),_&&j.setOverflow(_(te)),y){const Se=y(te);if(Se!=="point"&&Se!=="line")throw new Error("Expected point or line for text-placement");j.setPlacement(Se)}if(S&&j.setRepeat(S(te)),v&&j.setScale(v(te)),I&&j.setRotateWithView(I(te)),A&&j.setRotation(A(te)),B){const Se=B(te);if(Se!=="left"&&Se!=="center"&&Se!=="right"&&Se!=="end"&&Se!=="start")throw new Error("Expected left, right, center, start, or end for text-align");j.setTextAlign(Se)}if(G){const Se=G(te);if(Se!=="left"&&Se!=="right"&&Se!=="center")throw new Error("Expected left, right, or center for text-justify");j.setJustify(Se)}if(k){const Se=k(te);if(Se!=="bottom"&&Se!=="top"&&Se!=="middle"&&Se!=="alphabetic"&&Se!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");j.setTextBaseline(Se)}return q&&j.setPadding(q(te)),z&&j.setKeepUpright(z(te)),j}}function buildImage(n,e){return"icon-src"in n?buildIcon(n,e):"shape-points"in n?buildShape(n,e):"circle-radius"in n?buildCircle(n,e):null}function buildIcon(n,e){const t="icon-",i=t+"src",s=requireString(n[i],i),r=coordinateEvaluator(n,t+"anchor",e),o=sizeLikeEvaluator(n,t+"scale",e),a=numberEvaluator(n,t+"opacity",e),h=coordinateEvaluator(n,t+"displacement",e),c=numberEvaluator(n,t+"rotation",e),d=booleanEvaluator(n,t+"rotate-with-view",e),f=optionalIconOrigin(n,t+"anchor-origin"),_=optionalIconAnchorUnits(n,t+"anchor-x-units"),y=optionalIconAnchorUnits(n,t+"anchor-y-units"),S=optionalColorLike(n,t+"color"),v=optionalString(n,t+"cross-origin"),I=optionalNumberArray(n,t+"offset"),A=optionalIconOrigin(n,t+"offset-origin"),B=optionalNumber(n,t+"width"),G=optionalNumber(n,t+"height"),k=optionalSize(n,t+"size"),z=optionalDeclutterMode(n,t+"declutter-mode"),q=new Icon({src:s,anchorOrigin:f,anchorXUnits:_,anchorYUnits:y,color:S,crossOrigin:v,offset:I,offsetOrigin:A,height:G,width:B,size:k,declutterMode:z});return function(T){return a&&q.setOpacity(a(T)),h&&q.setDisplacement(h(T)),c&&q.setRotation(c(T)),d&&q.setRotateWithView(d(T)),o&&q.setScale(o(T)),r&&q.setAnchor(r(T)),q}}function buildShape(n,e){const t="shape-",i=t+"points",s=t+"radius",r=requireNumber(n[i],i),o=requireNumber(n[s],s),a=buildFill(n,t,e),h=buildStroke(n,t,e),c=sizeLikeEvaluator(n,t+"scale",e),d=coordinateEvaluator(n,t+"displacement",e),f=numberEvaluator(n,t+"rotation",e),_=booleanEvaluator(n,t+"rotate-with-view",e),y=optionalNumber(n,t+"radius2"),S=optionalNumber(n,t+"angle"),v=optionalDeclutterMode(n,t+"declutter-mode"),I=new RegularShape({points:r,radius:o,radius2:y,angle:S,declutterMode:v});return function(A){return a&&I.setFill(a(A)),h&&I.setStroke(h(A)),d&&I.setDisplacement(d(A)),f&&I.setRotation(f(A)),_&&I.setRotateWithView(_(A)),c&&I.setScale(c(A)),I}}function buildCircle(n,e){const t="circle-",i=buildFill(n,t,e),s=buildStroke(n,t,e),r=numberEvaluator(n,t+"radius",e),o=sizeLikeEvaluator(n,t+"scale",e),a=coordinateEvaluator(n,t+"displacement",e),h=numberEvaluator(n,t+"rotation",e),c=booleanEvaluator(n,t+"rotate-with-view",e),d=optionalDeclutterMode(n,t+"declutter-mode"),f=new CircleStyle({radius:5,declutterMode:d});return function(_){return r&&f.setRadius(r(_)),i&&f.setFill(i(_)),s&&f.setStroke(s(_)),a&&f.setDisplacement(a(_)),h&&f.setRotation(h(_)),c&&f.setRotateWithView(c(_)),o&&f.setScale(o(_)),f}}function numberEvaluator(n,e,t){if(!(e in n))return;const i=buildExpression(n[e],NumberType,t);return function(s){return requireNumber(i(s),e)}}function stringEvaluator(n,e,t){if(!(e in n))return null;const i=buildExpression(n[e],StringType,t);return function(s){return requireString(i(s),e)}}function patternEvaluator(n,e,t){const i=stringEvaluator(n,e+"pattern-src",t),s=sizeEvaluator(n,e+"pattern-offset",t),r=sizeEvaluator(n,e+"pattern-size",t),o=colorLikeEvaluator(n,e+"color",t);return function(a){return{src:i(a),offset:s&&s(a),size:r&&r(a),color:o&&o(a)}}}function booleanEvaluator(n,e,t){if(!(e in n))return null;const i=buildExpression(n[e],BooleanType,t);return function(s){const r=i(s);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${e}`);return r}}function colorLikeEvaluator(n,e,t){if(!(e in n))return null;const i=buildExpression(n[e],ColorType,t);return function(s){return requireColorLike(i(s),e)}}function numberArrayEvaluator(n,e,t){if(!(e in n))return null;const i=buildExpression(n[e],NumberArrayType,t);return function(s){return requireNumberArray(i(s),e)}}function coordinateEvaluator(n,e,t){if(!(e in n))return null;const i=buildExpression(n[e],NumberArrayType,t);return function(s){const r=requireNumberArray(i(s),e);if(r.length!==2)throw new Error(`Expected two numbers for ${e}`);return r}}function sizeEvaluator(n,e,t){if(!(e in n))return null;const i=buildExpression(n[e],NumberArrayType,t);return function(s){return requireSize(i(s),e)}}function sizeLikeEvaluator(n,e,t){if(!(e in n))return null;const i=buildExpression(n[e],NumberArrayType|NumberType,t);return function(s){return requireSizeLike(i(s),e)}}function optionalNumber(n,e){const t=n[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function optionalSize(n,e){const t=n[e];if(t!==void 0){if(typeof t=="number")return toSize(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function optionalString(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function optionalIconOrigin(n,e){const t=n[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function optionalIconAnchorUnits(n,e){const t=n[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function optionalNumberArray(n,e){const t=n[e];if(t!==void 0)return requireNumberArray(t,e)}function optionalDeclutterMode(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function optionalColorLike(n,e){const t=n[e];if(t!==void 0)return requireColorLike(t,e)}function requireNumberArray(n,e){if(!Array.isArray(n))throw new Error(`Expected an array for ${e}`);const t=n.length;for(let i=0;i<t;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${e}`);return n}function requireString(n,e){if(typeof n!="string")throw new Error(`Expected a string for ${e}`);return n}function requireNumber(n,e){if(typeof n!="number")throw new Error(`Expected a number for ${e}`);return n}function requireColorLike(n,e){if(typeof n=="string")return n;const t=requireNumberArray(n,e),i=t.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function requireSize(n,e){const t=requireNumberArray(n,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}function requireSizeLike(n,e){return typeof n=="number"?n:requireSize(n,e)}const Property={RENDER_ORDER:"renderOrder"};class BaseVectorLayer extends Layer{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Property.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const i=this.getDeclutter();i in e.declutter||(e.declutter[i]=new RBush$1(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(Property.RENDER_ORDER,e)}setStyle(e){this.style_=e===void 0?createDefaultStyle:e;const t=toStyleLike(e);this.styleFunction_=e===null?void 0:toFunction(t),this.changed()}setDeclutter(e){this.declutter_=e?String(e):void 0,this.changed()}}function toStyleLike(n){if(n===void 0)return createDefaultStyle;if(!n)return null;if(typeof n=="function"||n instanceof Style)return n;if(!Array.isArray(n))return flatStylesToStyleFunction([n]);if(n.length===0)return[];const e=n.length,t=n[0];if(t instanceof Style){const s=new Array(e);for(let r=0;r<e;++r){const o=n[r];if(!(o instanceof Style))throw new Error("Expected a list of style instances");s[r]=o}return s}if("style"in t){const s=new Array(e);for(let r=0;r<e;++r){const o=n[r];if(!("style"in o))throw new Error("Expected a list of rules with a style property");s[r]=o}return rulesToStyleFunction(s)}return flatStylesToStyleFunction(n)}class RenderEvent extends BaseEvent{constructor(e,t,i,s){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=s}}class MapRenderer extends Disposable{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){abstract()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,s=e.pixelToCoordinateTransform;compose(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),makeInverse(s,i)}forEachFeatureAtCoordinate(e,t,i,s,r,o,a,h){let c;const d=t.viewState;function f(k,z,q,T){return r.call(o,z,k?q:null,T)}const _=d.projection,y=wrapX$1(e.slice(),_),S=[[0,0]];if(_.canWrapX()&&s){const k=_.getExtent(),z=getWidth(k);S.push([-z,0],[z,0])}const v=t.layerStatesArray,I=v.length,A=[],B=[];for(let k=0;k<S.length;k++)for(let z=I-1;z>=0;--z){const q=v[z],T=q.layer;if(T.hasRenderer()&&inView(q,d)&&a.call(h,T)){const j=T.getRenderer(),te=T.getSource();if(j&&te){const Se=te.getWrapX()?y:e,be=f.bind(null,q.managed);B[0]=Se[0]+S[k][0],B[1]=Se[1]+S[k][1],c=j.forEachFeatureAtCoordinate(B,t,i,be,A)}if(c)return c}}if(A.length===0)return;const G=1/A.length;return A.forEach((k,z)=>k.distanceSq+=z*G),A.sort((k,z)=>k.distanceSq-z.distanceSq),A.some(k=>c=k.callback(k.feature,k.layer,k.geometry)),c}hasFeatureAtCoordinate(e,t,i,s,r,o){return this.forEachFeatureAtCoordinate(e,t,i,s,TRUE,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(e){abstract()}scheduleExpireIconCache(e){shared.canExpireCache()&&e.postRenderFunctions.push(expireIconCache)}}function expireIconCache(n,e){shared.expire()}class CompositeMapRenderer extends MapRenderer{constructor(e){super(e),this.fontChangeListenerKey_=listen(checkedFonts,ObjectEventType.PROPERTYCHANGE,e.redrawText,e),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=CLASS_UNSELECTABLE+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const s=new RenderEvent(e,void 0,t);i.dispatchEvent(s)}}disposeInternal(){unlistenByKey(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(RenderEventType.PRECOMPOSE,e);const t=e.layerStatesArray.sort((a,h)=>a.zIndex-h.zIndex);t.some(a=>a.layer instanceof BaseVectorLayer&&a.layer.getDeclutter())&&(e.declutter={});const s=e.viewState;this.children_.length=0;const r=[];let o=null;for(let a=0,h=t.length;a<h;++a){const c=t[a];e.layerIndex=a;const d=c.layer,f=d.getSourceState();if(!inView(c,s)||f!="ready"&&f!="undefined"){d.unrender();continue}const _=d.render(e,o);_&&(_!==o&&(this.children_.push(_),o=_),r.push(c))}this.declutter(e,r),replaceChildren(this.element_,this.children_),this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let i=t.length-1;i>=0;--i){const s=t[i],r=s.layer;r.getDeclutter()&&r.renderDeclutter(e,s)}t.forEach(i=>i.layer.renderDeferred(e))}}}function removeLayerMapProperty(n){if(n instanceof Layer){n.setMapInternal(null);return}n instanceof LayerGroup&&n.getLayers().forEach(removeLayerMapProperty)}function setLayerMapProperty(n,e){if(n instanceof Layer){n.setMapInternal(e);return}if(n instanceof LayerGroup){const t=n.getLayers().getArray();for(let i=0,s=t.length;i<s;++i)setLayerMapProperty(t[i],e)}}let Map$1=class extends BaseObject{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=createOptionsInternal(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:DEVICE_PIXEL_RATIO,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=create(),this.pixelToCoordinateTransform_=create(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||defaults$1(),this.interactions=t.interactions||defaults({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new TileQueue(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(MapProperty.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(MapProperty.VIEW,this.handleViewChanged_),this.addChangeListener(MapProperty.SIZE,this.handleSizeChanged_),this.addChangeListener(MapProperty.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof View)&&e.view.then(function(s){i.setView(new View(s))}),this.controls.addEventListener(CollectionEventType.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(CollectionEventType.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(CollectionEventType.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(CollectionEventType.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(CollectionEventType.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(CollectionEventType.REMOVE,s=>{const r=s.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){setLayerMapProperty(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const r=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:TRUE,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,r,a,t,null,o,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(s){i.push(s)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(s){s instanceof LayerGroup?t(s.getLayers()):e.push(s)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const s=t.layerFilter!==void 0?t.layerFilter:TRUE,r=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,o,s,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),s=this.getSize(),r=i.width/s[0],o=i.height/s[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-i.left)/r,(a.clientY-i.top)/o]}getTarget(){return this.get(MapProperty.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return toUserCoordinate(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?apply(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(MapProperty.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof Collection){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const s=e[t];if(!s.visible)continue;const r=s.layer.getRenderer();if(r&&!r.ready)return!0;const o=s.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=fromUserCoordinate(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?apply(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(MapProperty.SIZE)}getView(){return this.get(MapProperty.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,s){return getTilePriority(this.frameState_,e,t,i,s)}handleBrowserEvent(e,t){t=t||e.type;const i=new MapBrowserEvent(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===PointerEventType.POINTERDOWN||i===EventType.WHEEL||i===EventType.KEYDOWN){const s=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():s,o=t.target,a=r instanceof ShadowRoot?r.host===o?r.host.ownerDocument:r:r===s?s.documentElement:r;if(this.overlayContainerStopEvent_.contains(o)||!a.contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const s=this.getInteractions().getArray().slice();for(let r=s.length-1;r>=0;r--){const o=s[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let s=this.maxTilesLoading_,r=s;if(e){const o=e.viewHints;if(o[ViewHint.ANIMATING]||o[ViewHint.INTERACTING]){const a=Date.now()-e.time>8;s=a?0:8,r=a?0:2}}t.getTilesLoading()<s&&(t.reprioritize(),t.loadMoreTiles(s,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(RenderEventType.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(RenderEventType.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new MapEvent(MapEventType.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new MapEvent(MapEventType.LOADSTART,this,e))));const i=this.postRenderFunctions_;if(e)for(let s=0,r=i.length;s<r;++s)i[s](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,s=this.targetChangeHandlerKeys_.length;i<s;++i)unlistenByKey(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new CompositeMapRenderer(this)),this.mapBrowserEventHandler_=new MapBrowserEventHandler(this,this.moveTolerance_);for(const r in MapBrowserEventType)this.mapBrowserEventHandler_.addEventListener(MapBrowserEventType[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_,PASSIVE_EVENT_LISTENERS?{passive:!1}:!1);let i;if(this.keyboardEventTarget_)i=this.keyboardEventTarget_;else{const r=t.getRootNode();i=r instanceof ShadowRoot?r.host:t}this.targetChangeHandlerKeys_=[listen(i,EventType.KEYDOWN,this.handleBrowserEvent,this),listen(i,EventType.KEYPRESS,this.handleBrowserEvent,this)];const s=t.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=listen(e,ObjectEventType.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=listen(e,EventType.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new GroupEvent("addlayer",e)),this.layerGroupPropertyListenerKeys_=[listen(e,ObjectEventType.PROPERTYCHANGE,this.render,this),listen(e,EventType.CHANGE,this.render,this),listen(e,"addlayer",this.handleLayerAdd_,this),listen(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;const e=this.frameState_.layerStatesArray;for(let t=0,i=e.length;t<i;++t){const s=e[t].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){removeLayerMapProperty(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),s=this.frameState_;let r=null;if(t!==void 0&&hasArea(t)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:getForViewAndSize(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:getUid(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const h=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=getForViewAndSize(a.nextCenter,a.nextResolution,h,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),s&&(!this.previousExtent_||!isEmpty$1(this.previousExtent_)&&!equals$2(r.extent,this.previousExtent_))&&(this.dispatchEvent(new MapEvent(MapEventType.MOVESTART,this,s)),this.previousExtent_=createOrUpdateEmpty(this.previousExtent_)),this.previousExtent_&&!r.viewHints[ViewHint.ANIMATING]&&!r.viewHints[ViewHint.INTERACTING]&&!equals$2(r.extent,this.previousExtent_)&&(this.dispatchEvent(new MapEvent(MapEventType.MOVEEND,this,r)),clone(r.extent,this.previousExtent_))),this.dispatchEvent(new MapEvent(MapEventType.POSTRENDER,this,r)),this.renderComplete_=(this.hasListener(MapEventType.LOADSTART)||this.hasListener(MapEventType.LOADEND)||this.hasListener(RenderEventType.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new GroupEvent("removelayer",t)),this.set(MapProperty.LAYERGROUP,e)}setSize(e){this.set(MapProperty.SIZE,e)}setTarget(e){this.set(MapProperty.TARGET,e)}setView(e){if(!e||e instanceof View){this.set(MapProperty.VIEW,e);return}this.set(MapProperty.VIEW,new View);const t=this;e.then(function(i){t.setView(new View(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){const s=getComputedStyle(e),r=e.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),o=e.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(r)&&!isNaN(o)&&(t=[Math.max(0,r),Math.max(0,o)],!hasArea(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&warn("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!equals$1(t,i))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};function createOptionsInternal(n){let e=null;n.keyboardEventTarget!==void 0&&(e=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const t={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new LayerGroup({layers:n.layers});t[MapProperty.LAYERGROUP]=i,t[MapProperty.TARGET]=n.target,t[MapProperty.VIEW]=n.view instanceof View?n.view:new View;let s;n.controls!==void 0&&(Array.isArray(n.controls)?s=new Collection(n.controls.slice()):(assert(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=n.controls));let r;n.interactions!==void 0&&(Array.isArray(n.interactions)?r=new Collection(n.interactions.slice()):(assert(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=n.interactions));let o;return n.overlays!==void 0?Array.isArray(n.overlays)?o=new Collection(n.overlays.slice()):(assert(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=n.overlays):o=new Collection,{controls:s,interactions:r,keyboardEventTarget:e,overlays:o,values:t}}class TileRange{constructor(e,t,i,s){this.minX=e,this.maxX=t,this.minY=i,this.maxY=s}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function createOrUpdate$1(n,e,t,i,s){return s!==void 0?(s.minX=n,s.maxX=e,s.minY=t,s.maxY=i,s):new TileRange(n,e,t,i)}function createOrUpdate(n,e,t,i){return i!==void 0?(i[0]=n,i[1]=e,i[2]=t,i):[n,e,t]}function getKeyZXY(n,e,t){return n+"/"+e+"/"+t}function hash(n){return hashZXY(n[0],n[1],n[2])}function hashZXY(n,e,t){return(e<<n)+t}function withinExtentAndZ(n,e){const t=n[0],i=n[1],s=n[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const r=e.getFullTileRange(t);return r?r.containsXY(i,s):!0}const tmpTileCoord=[0,0,0],DECIMALS=5;class TileGrid{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,assert(isSorted(this.resolutions_,(s,r)=>r-s),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(!t)t=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,assert(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=getTopLeft(i)),assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,assert(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:DEFAULT_TILE_SIZE,assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((s,r)=>{const o=new TileRange(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const s=this.getTileRangeForExtentAndZ(e,t);for(let r=s.minX,o=s.maxX;r<=o;++r)for(let a=s.minY,h=s.maxY;a<=h;++a)i([t,r,a])}forEachTileCoordParentTileRange(e,t,i,s){let r,o,a,h=null,c=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):h=this.getTileCoordExtent(e,s);c>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),r=createOrUpdate$1(o,o,a,a,i)):r=this.getTileRangeForExtentAndZ(h,c,i),t(c,r))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const r=e[1]*2,o=e[2]*2;return createOrUpdate$1(r,r+1,o,o+1,t)}const s=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const s=e[0],r=e[1],o=e[2];if(t===s)return createOrUpdate$1(r,o,r,o,i);if(this.zoomFactor_){const h=Math.pow(this.zoomFactor_,t-s),c=Math.floor(r*h),d=Math.floor(o*h);if(t<s)return createOrUpdate$1(c,c,d,d,i);const f=Math.floor(h*(r+1))-1,_=Math.floor(h*(o+1))-1;return createOrUpdate$1(c,f,d,_,i)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,tmpTileCoord);const s=tmpTileCoord[1],r=tmpTileCoord[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,tmpTileCoord);const o=tmpTileCoord[1],a=tmpTileCoord[2];return createOrUpdate$1(s,o,r,a,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),s=toSize(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*s[0]*i,t[1]-(e[2]+.5)*s[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),s=this.getResolution(e[0]),r=toSize(this.getTileSize(e[0]),this.tmpSize_),o=i[0]+e[1]*r[0]*s,a=i[1]-(e[2]+1)*r[1]*s,h=o+r[0]*s,c=a+r[1]*s;return createOrUpdate$2(o,a,h,c,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,s,r){const o=this.getZForResolution(i),a=i/this.getResolution(o),h=this.getOrigin(o),c=toSize(this.getTileSize(o),this.tmpSize_);let d=a*(e-h[0])/i/c[0],f=a*(h[1]-t)/i/c[1];return s?(d=ceil(d,DECIMALS)-1,f=ceil(f,DECIMALS)-1):(d=floor(d,DECIMALS),f=floor(f,DECIMALS)),createOrUpdate(o,d,f,r)}getTileCoordForXYAndZ_(e,t,i,s,r){const o=this.getOrigin(i),a=this.getResolution(i),h=toSize(this.getTileSize(i),this.tmpSize_);let c=(e-o[0])/a/h[0],d=(o[1]-t)/a/h[1];return s?(c=ceil(c,DECIMALS)-1,d=ceil(d,DECIMALS)-1):(c=floor(c,DECIMALS),d=floor(d,DECIMALS)),createOrUpdate(i,c,d,r)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=linearFindNearest(this.resolutions_,e,t||0);return clamp(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return intersectsLinearRing(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let s=this.minZoom;s<t;++s)i[s]=this.getTileRangeForExtentAndZ(e,s);this.fullTileRanges_=i}}function getForProjection(n){let e=n.getDefaultTileGrid();return e||(e=createForProjection(n),n.setDefaultTileGrid(e)),e}function wrapX(n,e,t){const i=e[0],s=n.getTileCoordCenter(e),r=extentFromProjection(t);if(!containsCoordinate(r,s)){const o=getWidth(r),a=Math.ceil((r[0]-s[0])/o);return s[0]+=o*a,n.getTileCoordForCoordAndZ(s,i)}return e}function createForExtent(n,e,t,i){i=i!==void 0?i:"top-left";const s=resolutionsFromExtent(n,e,t);return new TileGrid({extent:n,origin:getCorner(n,i),resolutions:s,tileSize:t})}function createXYZ(n){const e=n||{},t=e.extent||get$2("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:resolutionsFromExtent(t,e.maxZoom,e.tileSize,e.maxResolution)};return new TileGrid(i)}function resolutionsFromExtent(n,e,t,i){e=e!==void 0?e:DEFAULT_MAX_ZOOM,t=toSize(t!==void 0?t:DEFAULT_TILE_SIZE);const s=getHeight(n),r=getWidth(n);i=i>0?i:Math.max(r/t[0],s/t[1]);const o=e+1,a=new Array(o);for(let h=0;h<o;++h)a[h]=i/Math.pow(2,h);return a}function createForProjection(n,e,t,i){const s=extentFromProjection(n);return createForExtent(s,e,t,i)}function extentFromProjection(n){n=get$2(n);let e=n.getExtent();if(!e){const t=180*METERS_PER_UNIT$1.degrees/n.getMetersPerUnit();e=createOrUpdate$2(-t,-t,t,t)}return e}class Tile extends Target{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(EventType.CHANGE)}release(){this.setState(TileState.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==TileState.EMPTY){if(this.state!==TileState.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}}load(){abstract()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const s=t-i+1e3/60;return s>=this.transition_?1:easeIn(s/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}class ImageTile extends Tile{constructor(e,t,i,s,r,o){super(e,t,o),this.crossOrigin_=s,this.src_=i,this.key=i,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(e){this.image_=e,this.state=TileState.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=TileState.ERROR,this.unlistenImage_(),this.image_=getBlankImage(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=TileState.LOADED:this.state=TileState.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==TileState.ERROR&&(this.state=TileState.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==TileState.IDLE&&(this.state=TileState.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function getBlankImage(){const n=createCanvasContext2D(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}let brokenDiagonalRendering_;const canvasPool$1=[];function drawTestTriangle(n,e,t,i,s){n.beginPath(),n.moveTo(0,0),n.lineTo(e,t),n.lineTo(i,s),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(e,i)+1,Math.max(t,s)),n.restore()}function verifyBrokenDiagonalRendering(n,e){return Math.abs(n[e*4]-210)>2||Math.abs(n[e*4+3]-.75*255)>2}function isBrokenDiagonalRendering(){if(brokenDiagonalRendering_===void 0){const n=createCanvasContext2D(6,6,canvasPool$1);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",drawTestTriangle(n,4,5,4,0),drawTestTriangle(n,4,5,0,5);const e=n.getImageData(0,0,3,3).data;brokenDiagonalRendering_=verifyBrokenDiagonalRendering(e,0)||verifyBrokenDiagonalRendering(e,4)||verifyBrokenDiagonalRendering(e,8),releaseCanvas(n),canvasPool$1.push(n.canvas)}return brokenDiagonalRendering_}function calculateSourceResolution(n,e,t,i){const s=transform(t,e,n);let r=getPointResolution(e,i,t);const o=e.getMetersPerUnit();o!==void 0&&(r*=o);const a=n.getMetersPerUnit();a!==void 0&&(r/=a);const h=n.getExtent();if(!h||containsCoordinate(h,s)){const c=getPointResolution(n,r,s)/r;isFinite(c)&&c>0&&(r/=c)}return r}function calculateSourceExtentResolution(n,e,t,i){const s=getCenter(t);let r=calculateSourceResolution(n,e,s,i);return(!isFinite(r)||r<=0)&&forEachCorner(t,function(o){return r=calculateSourceResolution(n,e,o,i),isFinite(r)&&r>0}),r}function render(n,e,t,i,s,r,o,a,h,c,d,f,_,y){const S=createCanvasContext2D(Math.round(t*n),Math.round(t*e),canvasPool$1);if(f||(S.imageSmoothingEnabled=!1),h.length===0)return S.canvas;S.scale(t,t);function v(z){return Math.round(z*t)/t}S.globalCompositeOperation="lighter";const I=createEmpty();h.forEach(function(z,q,T){extend$2(I,z.extent)});let A;const B=t/i,G=(f?1:1+Math.pow(2,-24))/B;A=createCanvasContext2D(Math.round(getWidth(I)*B),Math.round(getHeight(I)*B),canvasPool$1),f||(A.imageSmoothingEnabled=!1),h.forEach(function(z,q,T){if(z.image.width>0&&z.image.height>0){if(z.clipExtent){A.save();const Te=(z.clipExtent[0]-I[0])*B,pe=-(z.clipExtent[3]-I[3])*B,ie=getWidth(z.clipExtent)*B,he=getHeight(z.clipExtent)*B;A.rect(f?Te:Math.round(Te),f?pe:Math.round(pe),f?ie:Math.round(Te+ie)-Math.round(Te),f?he:Math.round(pe+he)-Math.round(pe)),A.clip()}const j=(z.extent[0]-I[0])*B,te=-(z.extent[3]-I[3])*B,Se=getWidth(z.extent)*B,be=getHeight(z.extent)*B;A.drawImage(z.image,c,c,z.image.width-2*c,z.image.height-2*c,f?j:Math.round(j),f?te:Math.round(te),f?Se:Math.round(j+Se)-Math.round(j),f?be:Math.round(te+be)-Math.round(te)),z.clipExtent&&A.restore()}});const k=getTopLeft(o);return a.getTriangles().forEach(function(z,q,T){const j=z.source,te=z.target;let Se=j[0][0],be=j[0][1],Te=j[1][0],pe=j[1][1],ie=j[2][0],he=j[2][1];const ge=v((te[0][0]-k[0])/r),ue=v(-(te[0][1]-k[1])/r),de=v((te[1][0]-k[0])/r),se=v(-(te[1][1]-k[1])/r),l=v((te[2][0]-k[0])/r),u=v(-(te[2][1]-k[1])/r),p=Se,g=be;Se=0,be=0,Te-=p,pe-=g,ie-=p,he-=g;const C=[[Te,pe,0,0,de-ge],[ie,he,0,0,l-ge],[0,0,Te,pe,se-ue],[0,0,ie,he,u-ue]],b=solveLinearSystem(C);if(!b)return;if(S.save(),S.beginPath(),isBrokenDiagonalRendering()||!f){S.moveTo(de,se);const O=4,L=ge-de,U=ue-se;for(let H=0;H<O;H++)S.lineTo(de+v((H+1)*L/O),se+v(H*U/(O-1))),H!=O-1&&S.lineTo(de+v((H+1)*L/O),se+v((H+1)*U/(O-1)));S.lineTo(l,u)}else S.moveTo(de,se),S.lineTo(ge,ue),S.lineTo(l,u);S.clip(),S.transform(b[0],b[2],b[1],b[3],ge,ue),S.translate(I[0]-p,I[3]-g);let P;if(A)P=A.canvas,S.scale(G,-G);else{const O=h[0],L=O.extent;P=O.image,S.scale(getWidth(L)/P.width,-getHeight(L)/P.height)}S.drawImage(P,0,0),S.restore()}),A&&(releaseCanvas(A),canvasPool$1.push(A.canvas)),d&&(S.save(),S.globalCompositeOperation="source-over",S.strokeStyle="black",S.lineWidth=1,a.getTriangles().forEach(function(z,q,T){const j=z.target,te=(j[0][0]-k[0])/r,Se=-(j[0][1]-k[1])/r,be=(j[1][0]-k[0])/r,Te=-(j[1][1]-k[1])/r,pe=(j[2][0]-k[0])/r,ie=-(j[2][1]-k[1])/r;S.beginPath(),S.moveTo(be,Te),S.lineTo(te,Se),S.lineTo(pe,ie),S.closePath(),S.stroke()}),S.restore()),S.canvas}const MAX_SUBDIVISION=10,MAX_TRIANGLE_WIDTH=.25;class Triangulation{constructor(e,t,i,s,r,o,a){this.sourceProj_=e,this.targetProj_=t;let h={};const c=a?createTransformFromCoordinateTransform(G=>apply(a,transform(G,this.targetProj_,this.sourceProj_))):getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(G){const k=G[0]+"/"+G[1];return h[k]||(h[k]=c(G)),h[k]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&getWidth(s)>=getWidth(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?getWidth(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?getWidth(this.targetProj_.getExtent()):null;const d=getTopLeft(i),f=getTopRight(i),_=getBottomRight(i),y=getBottomLeft(i),S=this.transformInv_(d),v=this.transformInv_(f),I=this.transformInv_(_),A=this.transformInv_(y),B=MAX_SUBDIVISION+(o?Math.max(0,Math.ceil(Math.log2(getArea(i)/(o*o*256*256)))):0);if(this.addQuad_(d,f,_,y,S,v,I,A,B),this.wrapsXInSource_){let G=1/0;this.triangles_.forEach(function(k,z,q){G=Math.min(G,k.source[0][0],k.source[1][0],k.source[2][0])}),this.triangles_.forEach(k=>{if(Math.max(k.source[0][0],k.source[1][0],k.source[2][0])-G>this.sourceWorldWidth_/2){const z=[[k.source[0][0],k.source[0][1]],[k.source[1][0],k.source[1][1]],[k.source[2][0],k.source[2][1]]];z[0][0]-G>this.sourceWorldWidth_/2&&(z[0][0]-=this.sourceWorldWidth_),z[1][0]-G>this.sourceWorldWidth_/2&&(z[1][0]-=this.sourceWorldWidth_),z[2][0]-G>this.sourceWorldWidth_/2&&(z[2][0]-=this.sourceWorldWidth_);const q=Math.min(z[0][0],z[1][0],z[2][0]);Math.max(z[0][0],z[1][0],z[2][0])-q<this.sourceWorldWidth_/2&&(k.source=z)}})}h={}}addTriangle_(e,t,i,s,r,o){this.triangles_.push({source:[s,r,o],target:[e,t,i]})}addQuad_(e,t,i,s,r,o,a,h,c){const d=boundingExtent([r,o,a,h]),f=this.sourceWorldWidth_?getWidth(d)/this.sourceWorldWidth_:null,_=this.sourceWorldWidth_,y=this.sourceProj_.canWrapX()&&f>.5&&f<1;let S=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const I=boundingExtent([e,t,i,s]);S=getWidth(I)/this.targetWorldWidth_>MAX_TRIANGLE_WIDTH||S}!y&&this.sourceProj_.isGlobal()&&f&&(S=f>MAX_TRIANGLE_WIDTH||S)}if(!S&&this.maxSourceExtent_&&isFinite(d[0])&&isFinite(d[1])&&isFinite(d[2])&&isFinite(d[3])&&!intersects$1(d,this.maxSourceExtent_))return;let v=0;if(!S&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(h[0])||!isFinite(h[1]))){if(c>0)S=!0;else if(v=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(h[0])||!isFinite(h[1])?1:0),v!=1&&v!=2&&v!=4&&v!=8)return}if(c>0){if(!S){const I=[(e[0]+i[0])/2,(e[1]+i[1])/2],A=this.transformInv_(I);let B;y?B=(modulo(r[0],_)+modulo(a[0],_))/2-modulo(A[0],_):B=(r[0]+a[0])/2-A[0];const G=(r[1]+a[1])/2-A[1];S=B*B+G*G>this.errorThresholdSquared_}if(S){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const I=[(t[0]+i[0])/2,(t[1]+i[1])/2],A=this.transformInv_(I),B=[(s[0]+e[0])/2,(s[1]+e[1])/2],G=this.transformInv_(B);this.addQuad_(e,t,I,B,r,o,A,G,c-1),this.addQuad_(B,I,i,s,G,A,a,h,c-1)}else{const I=[(e[0]+t[0])/2,(e[1]+t[1])/2],A=this.transformInv_(I),B=[(i[0]+s[0])/2,(i[1]+s[1])/2],G=this.transformInv_(B);this.addQuad_(e,I,B,s,r,A,G,h,c-1),this.addQuad_(I,t,i,B,A,o,a,G,c-1)}return}}if(y){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(v&11)==0&&this.addTriangle_(e,i,s,r,a,h),(v&14)==0&&this.addTriangle_(e,i,t,r,a,o),v&&((v&13)==0&&this.addTriangle_(t,s,e,o,h,r),(v&7)==0&&this.addTriangle_(t,s,i,o,h,a))}calculateSourceExtent(){const e=createEmpty();return this.triangles_.forEach(function(t,i,s){const r=t.source;extendCoordinate(e,r[0]),extendCoordinate(e,r[1]),extendCoordinate(e,r[2])}),e}getTriangles(){return this.triangles_}}const ERROR_THRESHOLD=.5;class ReprojTile extends Tile{constructor(e,t,i,s,r,o,a,h,c,d,f,_){super(r,TileState.IDLE,_),this.renderEdges_=f!==void 0?f:!1,this.pixelRatio_=a,this.gutter_=h,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=s,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const y=s.getTileCoordExtent(this.wrappedTileCoord_),S=this.targetTileGrid_.getExtent();let v=this.sourceTileGrid_.getExtent();const I=S?getIntersection(y,S):y;if(getArea(I)===0){this.state=TileState.EMPTY;return}const A=e.getExtent();A&&(v?v=getIntersection(v,A):v=A);const B=s.getResolution(this.wrappedTileCoord_[0]),G=calculateSourceExtentResolution(e,i,I,B);if(!isFinite(G)||G<=0){this.state=TileState.EMPTY;return}const k=d!==void 0?d:ERROR_THRESHOLD;if(this.triangulation_=new Triangulation(e,i,I,v,G*k,B),this.triangulation_.getTriangles().length===0){this.state=TileState.EMPTY;return}this.sourceZ_=t.getZForResolution(G);let z=this.triangulation_.calculateSourceExtent();if(v&&(e.canWrapX()?(z[1]=clamp(z[1],v[1],v[3]),z[3]=clamp(z[3],v[1],v[3])):z=getIntersection(z,v)),!getArea(z))this.state=TileState.EMPTY;else{let q=0,T=0;e.canWrapX()&&(q=getWidth(A),T=Math.floor((z[0]-A[0])/q)),wrapAndSliceX(z.slice(),e,!0).forEach(te=>{const Se=t.getTileRangeForExtentAndZ(te,this.sourceZ_);for(let be=Se.minX;be<=Se.maxX;be++)for(let Te=Se.minY;Te<=Se.maxY;Te++){const pe=c(this.sourceZ_,be,Te,a);if(pe){const ie=T*q;this.sourceTiles_.push({tile:pe,offset:ie})}}++T}),this.sourceTiles_.length===0&&(this.state=TileState.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{const i=t.tile;if(i&&i.getState()==TileState.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);s[0]+=t.offset,s[2]+=t.offset;const r=this.clipExtent_?.slice();r&&(r[0]+=t.offset,r[2]+=t.offset),e.push({extent:s,clipExtent:r,image:i.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=TileState.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),s=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=render(s,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,h,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=TileState.LOADED}this.changed()}load(){if(this.state==TileState.IDLE){this.state=TileState.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const i=t.getState();if(i==TileState.IDLE||i==TileState.LOADING){e++;const s=listen(t,EventType.CHANGE,r=>{const o=t.getState();(o==TileState.LOADED||o==TileState.ERROR||o==TileState.EMPTY)&&(unlistenByKey(s),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t},i,s){t.getState()==TileState.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(unlistenByKey),this.sourcesListenerKeys_=null}release(){this.canvas_&&(releaseCanvas(this.canvas_.getContext("2d")),canvasPool$1.push(this.canvas_),this.canvas_=null),super.release()}}function appendParams(n,e){const t=[];Object.keys(e).forEach(function(s){e[s]!==null&&e[s]!==void 0&&t.push(s+"="+encodeURIComponent(e[s]))});const i=t.join("&");return n=n.replace(/[?&]$/,""),n+=n.includes("?")?"&":"?",n+i}const zRegEx=/\{z\}/g,xRegEx=/\{x\}/g,yRegEx=/\{y\}/g,dashYRegEx=/\{-y\}/g;function renderXYZTemplate(n,e,t,i,s){return n.replace(zRegEx,e.toString()).replace(xRegEx,t.toString()).replace(yRegEx,i.toString()).replace(dashYRegEx,function(){if(s===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(s-i).toString()})}function expandUrl(n){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(n);if(t){const i=t[1].charCodeAt(0),s=t[2].charCodeAt(0);let r;for(r=i;r<=s;++r)e.push(n.replace(t[0],String.fromCharCode(r)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(n),t){const i=parseInt(t[2],10);for(let s=parseInt(t[1],10);s<=i;s++)e.push(n.replace(t[0],s.toString()));return e}return e.push(n),e}function createFromTemplate(n,e){return(function(t,i,s){if(!t)return;let r;const o=t[0];if(e){const a=e.getFullTileRange(o);a&&(r=a.getHeight()-1)}return renderXYZTemplate(n,o,t[1],t[2],r)})}function createFromTemplates(n,e){const t=n.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=createFromTemplate(n[s],e);return createFromTileUrlFunctions(i)}function createFromTileUrlFunctions(n){return n.length===1?n[0]:(function(e,t,i){if(!e)return;const s=hash(e),r=modulo(s,n.length);return n[r](e,t,i)})}class Source extends BaseObject{constructor(e){super(),this.projection=get$2(e.projection),this.attributions_=adaptAttributions(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,s){t.viewResolver=i,t.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=adaptAttributions(e),this.changed()}setState(e){this.state_=e,this.changed()}}function adaptAttributions(n){return n?typeof n=="function"?n:(Array.isArray(n)||(n=[n]),e=>n):null}class TileSource extends Source{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&toSize(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||getUid(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,s,r){return abstract()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:getForProjection(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const s=this.getTileGridForProjection(i),r=this.getTilePixelRatio(t),o=toSize(s.getTileSize(e),this.tmpSize);return r==1?o:scale(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){const i=t!==void 0?t:this.getProjection(),s=t!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=wrapX(s,e,i)),withinExtentAndZ(e,s)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class TileSourceEvent extends BaseEvent{constructor(e,t){super(e),this.tile=t}}const TileEventType={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class UrlTile extends TileSource{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===UrlTile.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=getUid(t),s=t.getState();let r;s==TileState.LOADING?(this.tileLoadingKeys_[i]=!0,r=TileEventType.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=s==TileState.ERROR?TileEventType.TILELOADERROR:s==TileState.LOADED?TileEventType.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new TileSourceEvent(r,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=expandUrl(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(createFromTemplates(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}}class TileImage extends UrlTile{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:ImageTile,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!equivalent$1(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||equivalent$1(t,e)))return this.tileGrid;const i=getUid(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=getForProjection(e)),this.tileGridForProjection[i]}createTile_(e,t,i,s,r,o){const a=[e,t,i],h=this.getTileCoordForTileUrlFunction(a,r),c=h?this.tileUrlFunction(h,s,r):void 0,d=new this.tileClass(a,c!==void 0?TileState.IDLE:TileState.EMPTY,c!==void 0?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return d.key=o,d.addEventListener(EventType.CHANGE,this.handleTileChange.bind(this)),d}getTile(e,t,i,s,r){const o=this.getProjection();if(!o||!r||equivalent$1(o,r))return this.getTileInternal(e,t,i,s,o||r);const a=[e,t,i],h=this.getKey(),c=this.getTileGridForProjection(o),d=this.getTileGridForProjection(r),f=this.getTileCoordForTileUrlFunction(a,r),_=new ReprojTile(o,c,r,d,a,f,this.getTilePixelRatio(s),this.getGutter(),(y,S,v,I)=>this.getTileInternal(y,S,v,I,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return _.key=h,_}getTileInternal(e,t,i,s,r){const o=this.getKey();return this.createTile_(e,t,i,s,r,o)}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){const i=get$2(e);if(i){const s=getUid(i);s in this.tileGridForProjection||(this.tileGridForProjection[s]=t)}}}function defaultTileLoadFunction(n,e){n.getImage().src=e}class XYZ extends TileImage{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:createXYZ({extent:extentFromProjection(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const ATTRIBUTION='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class OSM extends XYZ{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[ATTRIBUTION];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",s=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:s,wrapX:e.wrapX,zDirection:e.zDirection})}}function asImageLike(n){return n instanceof Image||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageBitmap?n:null}const disposedError=new Error("disposed"),defaultSize=[256,256];class DataTile extends Tile{constructor(e){const t=TileState.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=asImageLike(this.data_);return e?[e.width,e.height]:defaultSize}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==TileState.IDLE&&this.state!==TileState.ERROR)return;this.state=TileState.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=TileState.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=TileState.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(disposedError),this.controller_=null),super.disposeInternal()}}class LRUCache{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof Disposable&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return assert(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return assert(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){assert(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}class ZIndexContext{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(getSharedCanvasContext2D(),{get:(e,t)=>{if(typeof getSharedCanvasContext2D()[t]=="function")return this.push_(t),this.pushMethodArgs_},set:(e,t,i)=>(this.push_(t,i),!0)})}push_(...e){const t=this.instructions_,i=this.zIndex+this.offset_;t[i]||(t[i]=[]),t[i].push(...e)}pushMethodArgs_=(...e)=>(this.push_(e),this);pushFunction(e){this.push_(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let i=0,s=t.length;i<s;++i){const r=t[i];if(typeof r=="function"){r(e);continue}const o=t[++i];if(typeof e[r]=="function")e[r](...o);else{if(typeof o=="function"){e[r]=o(e);continue}e[r]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const maxStaleKeys=5;class LayerRenderer extends Observable{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=maxStaleKeys}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(e){return abstract()}getData(e){return null}prepareFrame(e){return abstract()}renderFrame(e,t){return abstract()}forEachFeatureAtCoordinate(e,t,i,s,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===ImageState.LOADED||t.getState()===ImageState.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=ImageState.LOADED&&t!=ImageState.ERROR&&e.addEventListener(EventType.CHANGE,this.boundHandleImageChange_),t==ImageState.IDLE&&(e.load(),t=e.getState()),t==ImageState.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const canvasPool=[];let pixelContext=null;function createPixelContext(){pixelContext=createCanvasContext2D(1,1,void 0,{willReadFrequently:!0})}class CanvasLayerRenderer extends LayerRenderer{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=create(),this.pixelTransform=create(),this.inversePixelTransform=create(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,i){pixelContext||createPixelContext(),pixelContext.clearRect(0,0,1,1);let s;try{pixelContext.drawImage(e,t,i,1,1,0,0,1,1),s=pixelContext.getImageData(0,0,1,1).data}catch{return pixelContext=null,null}return s}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const s=this.getLayer().getClassName();let r,o;if(e&&e.className===s&&(!i||e&&e.style.backgroundColor&&equals$1(asArray(e.style.backgroundColor),asArray(i)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&equivalent(o.canvas.style.transform,t)?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=s;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=createCanvasContext2D();const h=o.canvas;r.appendChild(h),a=h.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const s=getTopLeft(i),r=getTopRight(i),o=getBottomRight(i),a=getBottomLeft(i);apply(t.coordinateToPixelTransform,s),apply(t.coordinateToPixelTransform,r),apply(t.coordinateToPixelTransform,o),apply(t.coordinateToPixelTransform,a);const h=this.inversePixelTransform;apply(h,s),apply(h,r),apply(h,o),apply(h,a),e.save(),e.beginPath(),e.moveTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}prepareContainer(e,t){const i=e.extent,s=e.viewState.resolution,r=e.viewState.rotation,o=e.pixelRatio,a=Math.round(getWidth(i)/s*o),h=Math.round(getHeight(i)/s*o);compose(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/o,1/o,r,-a/2,-h/2),makeInverse(this.inversePixelTransform,this.pixelTransform);const c=toString$1(this.pixelTransform);if(this.useContainer(t,c,this.getBackground(e)),!this.containerReused){const d=this.context.canvas;d.width!=a||d.height!=h?(d.width=a,d.height=h):this.context.clearRect(0,0,a,h),c!==d.style.transform&&(d.style.transform=c)}}dispatchRenderEvent_(e,t,i){const s=this.getLayer();if(s.hasListener(e)){const r=new RenderEvent(e,this.inversePixelTransform,i,t);s.dispatchEvent(r)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(RenderEventType.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(RenderEventType.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new ZIndexContext),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(RenderEventType.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(RenderEventType.POSTRENDER,this.context,e))}getRenderTransform(e,t,i,s,r,o,a){const h=r/2,c=o/2,d=s/t,f=-d,_=-e[0]+a,y=-e[1];return compose(this.tempTransform,h,c,d,f,-i,_,y)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function getCacheKey(n,e,t,i,s){return`${getUid(n)},${e},${getKeyZXY(t,i,s)}`}function addTileToLookup(n,e,t){if(!(t in n))return n[t]=new Set([e]),!0;const i=n[t],s=i.has(e);return s||i.add(e),!s}function removeTileFromLookup(n,e,t){const i=n[t];return i?i.delete(e):!1}function getRenderExtent(n,e){const t=n.layerStatesArray[n.layerIndex];t.extent&&(e=getIntersection(e,fromUserExtent(t.extent,n.viewState.projection)));const i=t.layer.getRenderSource();if(!i.getWrapX()){const s=i.getTileGridForProjection(n.viewState.projection).getExtent();s&&(e=getIntersection(e,s))}return e}class CanvasTileLayerRenderer extends CanvasLayerRenderer{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=createEmpty(),this.tempTileRange_=new TileRange(0,0,0,0),this.tempTileCoord_=createOrUpdate(0,0,0);const i=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new LRUCache(i),this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getOrCreateTile(e,t,i,s){const r=this.tileCache_,a=this.getLayer().getSource(),h=getCacheKey(a,a.getKey(),e,t,i);let c;if(r.containsKey(h))c=r.get(h);else{if(c=a.getTile(e,t,i,s.pixelRatio,s.viewState.projection),!c)return null;r.set(h,c)}return c}getTile(e,t,i,s){const r=this.getOrCreateTile(e,t,i,s);return r||null}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),s=apply(t.pixelToCoordinateTransform,e.slice()),r=i.getExtent();if(r&&!containsCoordinate(r,s))return null;const o=t.viewState,a=i.getRenderSource(),h=a.getTileGridForProjection(o.projection),c=a.getTilePixelRatio(t.pixelRatio);for(let d=h.getZForResolution(o.resolution);d>=h.getMinZoom();--d){const f=h.getTileCoordForCoordAndZ(s,d),_=this.getTile(d,f[1],f[2],t);if(!_||_.getState()!==TileState.LOADED)continue;const y=h.getOrigin(d),S=toSize(h.getTileSize(d)),v=h.getResolution(d);let I;if(_ instanceof ImageTile||_ instanceof ReprojTile)I=_.getImage();else if(_ instanceof DataTile){if(I=asImageLike(_.getData()),!I)continue}else continue;const A=Math.floor(c*((s[0]-y[0])/v-f[1]*S[0])),B=Math.floor(c*((y[1]-s[1])/v-f[2]*S[1])),G=Math.round(c*a.getGutterForProjection(o.projection));return this.getImageData(I,A+G,B+G)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const i=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==i&&(this.renderedSourceRevision_=i,this.renderedSourceKey_===t.getKey()&&this.tileCache_.clear()):this.renderedSourceRevision_=i,!0}enqueueTiles(e,t,i,s,r){const o=e.viewState,a=this.getLayer(),h=a.getRenderSource(),c=h.getTileGridForProjection(o.projection),d=getUid(h);d in e.wantedTiles||(e.wantedTiles[d]={});const f=e.wantedTiles[d],_=a.getMapInternal(),y=Math.max(i-r,c.getMinZoom(),c.getZForResolution(Math.min(a.getMaxResolution(),_?_.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):c.getResolution(0)),h.zDirection)),S=o.rotation,v=S?getRotatedViewport(o.center,o.resolution,S,e.size):void 0;for(let I=i;I>=y;--I){const A=c.getTileRangeForExtentAndZ(t,I,this.tempTileRange_),B=c.getResolution(I);for(let G=A.minX;G<=A.maxX;++G)for(let k=A.minY;k<=A.maxY;++k){if(S&&!c.tileCoordIntersectsViewport([I,G,k],v))continue;const z=this.getTile(I,G,k,e);if(!z||!addTileToLookup(s,z,I))continue;const T=z.getKey();if(f[T]=!0,z.getState()===TileState.IDLE&&!e.tileQueue.isKeyQueued(T)){const j=createOrUpdate(I,G,k,this.tempTileCoord_);e.tileQueue.enqueue([z,d,c.getTileCoordCenter(j),B])}}}}findStaleTile_(e,t){const i=this.tileCache_,s=e[0],r=e[1],o=e[2],a=this.getStaleKeys();for(let h=0;h<a.length;++h){const c=getCacheKey(this.getLayer().getSource(),a[h],s,r,o);if(i.containsKey(c)){const d=i.peek(c);if(d.getState()===TileState.LOADED)return d.endTransition(getUid(this)),addTileToLookup(t,d,s),!0}}return!1}findAltTiles_(e,t,i,s){const r=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!r)return!1;let o=!0;const a=this.tileCache_,h=this.getLayer().getRenderSource(),c=h.getKey();for(let d=r.minX;d<=r.maxX;++d)for(let f=r.minY;f<=r.maxY;++f){const _=getCacheKey(h,c,i,d,f);let y=!1;if(a.containsKey(_)){const S=a.peek(_);S.getState()===TileState.LOADED&&(addTileToLookup(s,S,i),y=!0)}y||(o=!1)}return o}renderFrame(e,t){this.renderComplete=!0;const i=e.layerStatesArray[e.layerIndex],s=e.viewState,r=s.projection,o=s.resolution,a=s.center,h=e.pixelRatio,c=this.getLayer(),d=c.getSource(),f=d.getTileGridForProjection(r),_=f.getZForResolution(o,d.zDirection),y=f.getResolution(_),S=d.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==S&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=S):this.renderedSourceKey_=S;let v=e.extent;const I=d.getTilePixelRatio(h);this.prepareContainer(e,t);const A=this.context.canvas.width,B=this.context.canvas.height,G=i.extent&&fromUserExtent(i.extent);G&&(v=getIntersection(v,fromUserExtent(i.extent)));const k=y*A/2/I,z=y*B/2/I,q=[a[0]-k,a[1]-z,a[0]+k,a[1]+z],T={};this.renderedTiles.length=0;const j=c.getPreload();if(e.nextExtent){const de=f.getZForResolution(s.nextResolution,d.zDirection),se=getRenderExtent(e,e.nextExtent);this.enqueueTiles(e,se,de,T,j)}const te=getRenderExtent(e,v);if(this.enqueueTiles(e,te,_,T,0),j>0&&setTimeout(()=>{this.enqueueTiles(e,te,_-1,T,j-1)},0),!(_ in T))return this.container;const Se=getUid(this),be=e.time;for(const de of T[_]){const se=de.getState();if(se===TileState.EMPTY)continue;const l=de.tileCoord;if(se===TileState.LOADED&&de.getAlpha(Se,be)===1){de.endTransition(Se);continue}if(se!==TileState.ERROR&&(this.renderComplete=!1),this.findStaleTile_(l,T)){removeTileFromLookup(T,de,_),e.animate=!0;continue}if(this.findAltTiles_(f,l,_+1,T))continue;const g=f.getMinZoom();for(let C=_-1;C>=g&&!this.findAltTiles_(f,l,C,T);--C);}const Te=y/o*h/I,pe=this.getRenderContext(e);compose(this.tempTransform,A/2,B/2,Te,Te,0,-A/2,-B/2),i.extent&&this.clipUnrotated(pe,e,G),d.getInterpolate()||(pe.imageSmoothingEnabled=!1),this.preRender(pe,e);const ie=Object.keys(T).map(Number);ie.sort(ascending);let he;const ge=[],ue=[];for(let de=ie.length-1;de>=0;--de){const se=ie[de],l=d.getTilePixelSize(se,h,r),p=f.getResolution(se)/y,g=l[0]*p*Te,C=l[1]*p*Te,b=f.getTileCoordForCoordAndZ(getTopLeft(q),se),P=f.getTileCoordExtent(b),O=apply(this.tempTransform,[I*(P[0]-q[0])/y,I*(q[3]-P[3])/y]),L=I*d.getGutterForProjection(r);for(const U of T[se]){if(U.getState()!==TileState.LOADED)continue;const H=U.tileCoord,ee=b[1]-H[1],ae=Math.round(O[0]-(ee-1)*g),Y=b[2]-H[2],Z=Math.round(O[1]-(Y-1)*C),ce=Math.round(O[0]-ee*g),ye=Math.round(O[1]-Y*C),ve=ae-ce,Ee=Z-ye,Re=ie.length===1;let Ne=!1;he=[ce,ye,ce+ve,ye,ce+ve,ye+Ee,ce,ye+Ee];for(let Fe=0,De=ge.length;Fe<De;++Fe)if(!Re&&se<ue[Fe]){const Ae=ge[Fe];intersects$1([ce,ye,ce+ve,ye+Ee],[Ae[0],Ae[3],Ae[4],Ae[7]])&&(Ne||(pe.save(),Ne=!0),pe.beginPath(),pe.moveTo(he[0],he[1]),pe.lineTo(he[2],he[3]),pe.lineTo(he[4],he[5]),pe.lineTo(he[6],he[7]),pe.moveTo(Ae[6],Ae[7]),pe.lineTo(Ae[4],Ae[5]),pe.lineTo(Ae[2],Ae[3]),pe.lineTo(Ae[0],Ae[1]),pe.clip())}ge.push(he),ue.push(se),this.drawTile(U,e,ce,ye,ve,Ee,L,Re),Ne&&pe.restore(),this.renderedTiles.unshift(U),this.updateUsedTiles(e.usedTiles,d,U)}}if(this.renderedResolution=y,this.extentChanged=!this.renderedExtent_||!equals$2(this.renderedExtent_,q),this.renderedExtent_=q,this.renderedPixelRatio=h,this.postRender(this.context,e),i.extent&&pe.restore(),pe.imageSmoothingEnabled=!0,this.renderComplete){const de=(se,l)=>{const u=getUid(d),p=l.wantedTiles[u],g=p?Object.keys(p).length:0;this.updateCacheSize(g),this.tileCache_.expireCache()};e.postRenderFunctions.push(de)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,i,s,r,o,a,h){let c;if(e instanceof DataTile){if(c=asImageLike(e.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(e);if(!c)return;const d=this.getRenderContext(t),f=getUid(this),_=t.layerStatesArray[t.layerIndex],y=_.opacity*(h?e.getAlpha(f,t.time):1),S=y!==d.globalAlpha;S&&(d.save(),d.globalAlpha=y),d.drawImage(c,a,a,c.width-2*a,c.height-2*a,i,s,r,o),S&&d.restore(),y!==_.opacity?t.animate=!0:h&&e.endTransition(f)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){const s=getUid(t);s in e||(e[s]={}),e[s][i.getKey()]=!0}}const TileProperty={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class BaseTileLayer extends Layer{constructor(e){e=e||{};const t=Object.assign({},e),i=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(TileProperty.PRELOAD)}setPreload(e){this.set(TileProperty.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}class TileLayer extends BaseTileLayer{constructor(e){super(e)}createRenderer(){return new CanvasTileLayerRenderer(this,{cacheSize:this.getCacheSize()})}}class Feature extends BaseObject{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new Feature(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(unlistenByKey(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=listen(e,EventType.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?createStyleFunction(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function createStyleFunction(n){if(typeof n=="function")return n;let e;return Array.isArray(n)?e=n:(assert(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[n]),function(){return e}}let withCredentials=!1;function loadFeaturesXhr(n,e,t,i,s,r,o){const a=new XMLHttpRequest;a.open("GET",typeof n=="function"?n(t,i,s):n,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=withCredentials,a.onload=function(h){if(!a.status||a.status>=200&&a.status<300){const c=e.getType();try{let d;c=="text"||c=="json"?d=a.responseText:c=="xml"?d=a.responseXML||a.responseText:c=="arraybuffer"&&(d=a.response),d?r(e.readFeatures(d,{extent:t,featureProjection:s}),e.readProjection(d)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function xhr(n,e){return function(t,i,s,r,o){loadFeaturesXhr(n,e,t,i,s,(a,h)=>{this.addFeatures(a),r!==void 0&&r(a)},()=>{this.changed(),o!==void 0&&o()})}}function all(n,e){return[[-1/0,-1/0,1/0,1/0]]}const tmpTransform=create();class RenderFeature{constructor(e,t,i,s,r,o){this.styleFunction,this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=r,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?createOrUpdateFromCoordinate(this.flatCoordinates_):createOrUpdateFromFlatCoordinates(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=getCenter(this.getExtent());this.flatInteriorPoints_=getInteriorPointOfArray(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=inflateEnds(this.flatCoordinates_,this.ends_),t=linearRingss(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=getInteriorPointsOfMultiArray(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=interpolatePoint(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let s=0,r=i.length;s<r;++s){const o=i[s],a=interpolatePoint(e,t,o,2,.5);extend$1(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=get$2(e);const t=e.getExtent(),i=e.getWorldExtent();if(t&&i){const s=getHeight(i)/getHeight(t);compose(tmpTransform,i[0],i[3],s,-s,0,0,0),transform2D(this.flatCoordinates_,0,this.flatCoordinates_.length,2,tmpTransform,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new RenderFeature(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=memoizeOne((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const i=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":i.length=douglasPeucker(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,i,0),s=[i.length];break;case"MultiLineString":s=[],i.length=douglasPeuckerArray(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,i,0,s);break;case"Polygon":s=[],i.length=quantizeArray(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),i,0,s);break}return s&&(this.simplifiedGeometry_=new RenderFeature(this.type_,i,s,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}RenderFeature.prototype.getFlatCoordinates=RenderFeature.prototype.getOrientedFlatCoordinates;class RBush{constructor(e){this.rbush_=new RBush$1(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[getUid(t)]=i}load(e,t){const i=new Array(t.length);for(let s=0,r=t.length;s<r;s++){const o=e[s],a=t[s],h={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[s]=h,this.items_[getUid(a)]=h}this.rbush_.load(i)}remove(e){const t=getUid(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[getUid(t)],s=[i.minX,i.minY,i.maxX,i.maxY];equals$2(s,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(s){return s.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let s=0,r=e.length;s<r;s++)if(i=t(e[s]),i)return i;return i}isEmpty(){return isEmpty(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return createOrUpdate$2(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const VectorEventType={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class VectorSourceEvent extends BaseEvent{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class VectorSource extends Source{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=VOID,this.format_=e.format||null,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(assert(this.format_,"`format` must be set when `url` is set"),this.loader_=xhr(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:all;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new RBush:null,this.loadedExtentsRtree_=new RBush,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,s;Array.isArray(e.features)?s=e.features:e.features&&(i=e.features,s=i.getArray()),!t&&i===void 0&&(i=new Collection(s)),s!==void 0&&this.addFeaturesInternal(s),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=getUid(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const s=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof RenderFeature||(this.featureChangeKeys_[e]=[listen(t,EventType.CHANGE,this.handleFeatureChange_,this),listen(t,ObjectEventType.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let i=!0;if(t.getId()!==void 0){const s=String(t.getId());if(!(s in this.idIndex_))this.idIndex_[s]=t;else if(t instanceof RenderFeature){const r=this.idIndex_[s];r instanceof RenderFeature?Array.isArray(r)?r.push(t):this.idIndex_[s]=[r,t]:i=!1}else i=!1}return i&&(assert(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],s=[];for(let r=0,o=e.length;r<o;r++){const a=e[r],h=getUid(a);this.addToIndex_(h,a)&&i.push(a)}for(let r=0,o=i.length;r<o;r++){const a=i[r],h=getUid(a);this.setupChangeEvents_(h,a);const c=a.getGeometry();if(c){const d=c.getExtent();t.push(d),s.push(a)}else this.nullGeometryFeatures_[h]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,s),this.hasListener(VectorEventType.ADDFEATURE))for(let r=0,o=i.length;r<o;r++)this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,i[r]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(VectorEventType.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(VectorEventType.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(CollectionEventType.ADD,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(CollectionEventType.REMOVE,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(unlistenByKey);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new VectorSourceEvent(VectorEventType.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(s){const r=s.getGeometry();if(r instanceof RenderFeature||r.intersectsCoordinate(e))return t(s)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){const s=i.getGeometry();if(s instanceof RenderFeature||s.intersectsExtent(e)){const r=t(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),isEmpty(this.nullGeometryFeatures_)||extend$1(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const s=wrapAndSliceX(e,t);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],s=e[1];let r=null;const o=[NaN,NaN];let a=1/0;const h=[-1/0,-1/0,1/0,1/0];return t=t||TRUE,this.featuresRtree_.forEachInExtent(h,function(c){if(t(c)){const d=c.getGeometry(),f=a;if(a=d instanceof RenderFeature?0:d.closestPointXY(i,s,o,a),a<f){r=c;const _=Math.sqrt(a);h[0]=i-_,h[1]=s-_,h[2]=i+_,h[3]=s+_}}}),r}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=getUid(t),s=t.getGeometry();if(!s)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const o=s.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const r=t.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new VectorSourceEvent(VectorEventType.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:getUid(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&isEmpty(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const s=this.loadedExtentsRtree_,r=this.strategy_(e,t,i);for(let o=0,a=r.length;o<a;++o){const h=r[o];s.forEachInExtent(h,function(d){return containsExtent(d.extent,h)})||(++this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADSTART)),this.loader_.call(this,h,t,i,d=>{--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADEND,void 0,d))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType.FEATURESLOADERROR))}),s.insert(h,{extent:h.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_,i=t.forEachInExtent(e,function(s){if(equals$2(s.extent,e))return s});i&&t.remove(i)}removeFeatures(e){let t=!1;for(let i=0,s=e.length;i<s;++i)t=this.removeFeatureInternal(e[i])||t;t&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=getUid(e);if(!(t in this.uidIndex_))return!1;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.featureChangeKeys_[t]?.forEach(unlistenByKey),delete this.featureChangeKeys_[t];const s=e.getId();if(s!==void 0){const r=s.toString(),o=this.idIndex_[r];o===e?delete this.idIndex_[r]:Array.isArray(o)&&(o.splice(o.indexOf(e),1),o.length===1&&(this.idIndex_[r]=o[0]))}return delete this.uidIndex_[t],this.hasListener(VectorEventType.REMOVEFEATURE)&&this.dispatchEvent(new VectorSourceEvent(VectorEventType.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(const t in this.idIndex_)if(this.idIndex_[t]===e){delete this.idIndex_[t];break}}setLoader(e){this.loader_=e}setUrl(e){assert(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(xhr(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}}class VectorContext{drawCustom(e,t,i,s,r){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,i){}drawFeature(e,t,i){}drawGeometryCollection(e,t,i){}drawLineString(e,t,i){}drawMultiLineString(e,t,i){}drawMultiPoint(e,t,i){}drawMultiPolygon(e,t,i){}drawPoint(e,t,i){}drawPolygon(e,t,i){}drawText(e,t,i){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},fillInstruction=[Instruction.FILL],strokeInstruction=[Instruction.STROKE],beginPathInstruction=[Instruction.BEGIN_PATH],closePathInstruction=[Instruction.CLOSE_PATH];class CanvasBuilder extends VectorContext{constructor(e,t,i,s){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,h=e.length;a<h;a+=t)s[0]=e[a],s[1]=e[a+1],containsCoordinate(i,s)&&(r[o++]=s[0],r[o++]=s[1]);return o}appendFlatLineCoordinates(e,t,i,s,r,o){const a=this.coordinates;let h=a.length;const c=this.getBufferedMaxExtent();o&&(t+=s);let d=e[t],f=e[t+1];const _=this.tmpCoordinate_;let y=!0,S,v,I;for(S=t+s;S<i;S+=s)_[0]=e[S],_[1]=e[S+1],I=coordinateRelationship(c,_),I!==v?(y&&(a[h++]=d,a[h++]=f,y=!1),a[h++]=_[0],a[h++]=_[1]):I===Relationship.INTERSECTING?(a[h++]=_[0],a[h++]=_[1],y=!1):y=!0,d=_[0],f=_[1],v=I;return(r&&y||S===t+s)&&(a[h++]=d,a[h++]=f),h}drawCustomCoordinates_(e,t,i,s,r){for(let o=0,a=i.length;o<a;++o){const h=i[o],c=this.appendFlatLineCoordinates(e,t,h,s,!1,!1);r.push(c),t=h}return t}drawCustom(e,t,i,s,r){this.beginGeometry(e,t,r);const o=e.getType(),a=e.getStride(),h=this.coordinates.length;let c,d,f,_,y;switch(o){case"MultiPolygon":c=e.getOrientedFlatCoordinates(),_=[];const S=e.getEndss();y=0;for(let v=0,I=S.length;v<I;++v){const A=[];y=this.drawCustomCoordinates_(c,y,S[v],a,A),_.push(A)}this.instructions.push([Instruction.CUSTOM,h,_,e,i,inflateMultiCoordinatesArray,r]),this.hitDetectionInstructions.push([Instruction.CUSTOM,h,_,e,s||i,inflateMultiCoordinatesArray,r]);break;case"Polygon":case"MultiLineString":f=[],c=o=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),y=this.drawCustomCoordinates_(c,0,e.getEnds(),a,f),this.instructions.push([Instruction.CUSTOM,h,f,e,i,inflateCoordinatesArray,r]),this.hitDetectionInstructions.push([Instruction.CUSTOM,h,f,e,s||i,inflateCoordinatesArray,r]);break;case"LineString":case"Circle":c=e.getFlatCoordinates(),d=this.appendFlatLineCoordinates(c,0,c.length,a,!1,!1),this.instructions.push([Instruction.CUSTOM,h,d,e,i,inflateCoordinates,r]),this.hitDetectionInstructions.push([Instruction.CUSTOM,h,d,e,s||i,inflateCoordinates,r]);break;case"MultiPoint":c=e.getFlatCoordinates(),d=this.appendFlatPointCoordinates(c,a),d>h&&(this.instructions.push([Instruction.CUSTOM,h,d,e,i,inflateCoordinates,r]),this.hitDetectionInstructions.push([Instruction.CUSTOM,h,d,e,s||i,inflateCoordinates,r]));break;case"Point":c=e.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),d=this.coordinates.length,this.instructions.push([Instruction.CUSTOM,h,d,e,i,void 0,r]),this.hitDetectionInstructions.push([Instruction.CUSTOM,h,d,e,s||i,void 0,r]);break}this.endGeometry(t)}beginGeometry(e,t,i){this.beginGeometryInstruction1_=[Instruction.BEGIN_GEOMETRY,t,0,e,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Instruction.BEGIN_GEOMETRY,t,0,e,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let s,r,o=-1;for(t=0;t<i;++t)s=e[t],r=s[0],r==Instruction.END_GEOMETRY?o=t:r==Instruction.BEGIN_GEOMETRY&&(s[2]=t,reverseSubArray(this.hitDetectionInstructions,o,t),o=-1)}fillStyleToState(e,t={}){if(e){const i=e.getColor();t.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,t.fillStyle=asColorLike(i||defaultFillStyle)}else t.fillStyle=void 0;return t}strokeStyleToState(e,t={}){if(e){const i=e.getColor();t.strokeStyle=asColorLike(i||defaultStrokeStyle);const s=e.getLineCap();t.lineCap=s!==void 0?s:defaultLineCap;const r=e.getLineDash();t.lineDash=r?r.slice():defaultLineDash;const o=e.getLineDashOffset();t.lineDashOffset=o||defaultLineDashOffset;const a=e.getLineJoin();t.lineJoin=a!==void 0?a:defaultLineJoin;const h=e.getWidth();t.lineWidth=h!==void 0?h:defaultLineWidth;const c=e.getMiterLimit();t.miterLimit=c!==void 0?c:defaultMiterLimit,t.lineWidth>this.maxLineWidth&&(this.maxLineWidth=t.lineWidth,this.bufferedMaxExtent_=null)}else t.strokeStyle=void 0,t.lineCap=void 0,t.lineDash=null,t.lineDashOffset=void 0,t.lineJoin=void 0,t.lineWidth=void 0,t.miterLimit=void 0;return t}setFillStrokeStyle(e,t){const i=this.state;this.fillStyleToState(e,i),this.strokeStyleToState(t,i)}createFill(e){const t=e.fillStyle,i=[Instruction.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(e.fillPatternScale),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[Instruction.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash?this.applyPixelRatio(e.lineDash):null,e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,s=e.lineCap,r=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,h=e.lineWidth,c=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=s||r!=e.currentLineDash&&!equals$1(e.currentLineDash,r)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=h||e.currentMiterLimit!=c)&&(t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=s,e.currentLineDash=r,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=h,e.currentMiterLimit=c)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[Instruction.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=clone(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;buffer(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class CanvasImageBuilder extends CanvasBuilder{constructor(e,t,i,s){super(e,t,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,i){if(!this.image_||this.maxExtent&&!containsCoordinate(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,i);const s=e.getFlatCoordinates(),r=e.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,r);this.instructions.push([Instruction.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,i){if(!this.image_)return;this.beginGeometry(e,t,i);const s=e.getFlatCoordinates(),r=[];for(let h=0,c=s.length;h<c;h+=e.getStride())(!this.maxExtent||containsCoordinate(this.maxExtent,s.slice(h,h+2)))&&r.push(s[h],s[h+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,2);this.instructions.push([Instruction.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),s=e.getSize(),r=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=e.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=s[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}class CanvasLineStringBuilder extends CanvasBuilder{constructor(e,t,i,s){super(e,t,i,s)}drawFlatCoordinates_(e,t,i,s){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,i,s,!1,!1),a=[Instruction.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(e,t,i){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction);const a=e.getFlatCoordinates(),h=e.getStride();this.drawFlatCoordinates_(a,0,a.length,h),this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(t)}drawMultiLineString(e,t,i){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,defaultLineDash,defaultLineDashOffset],beginPathInstruction);const a=e.getEnds(),h=e.getFlatCoordinates(),c=e.getStride();let d=0;for(let f=0,_=a.length;f<_;++f)d=this.drawFlatCoordinates_(h,d,a[f],c);this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(strokeInstruction),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(strokeInstruction),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(beginPathInstruction)}}class CanvasPolygonBuilder extends CanvasBuilder{constructor(e,t,i,s){super(e,t,i,s)}drawFlatCoordinatess_(e,t,i,s){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,h=i.length;this.instructions.push(beginPathInstruction),this.hitDetectionInstructions.push(beginPathInstruction);for(let c=0;c<h;++c){const d=i[c],f=this.coordinates.length,_=this.appendFlatLineCoordinates(e,t,d,s,!0,!a),y=[Instruction.MOVE_TO_LINE_TO,f,_];this.instructions.push(y),this.hitDetectionInstructions.push(y),a&&(this.instructions.push(closePathInstruction),this.hitDetectionInstructions.push(closePathInstruction)),t=d}return o&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),a&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),t}drawCircle(e,t,i){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,defaultLineDash,defaultLineDashOffset]);const a=e.getFlatCoordinates(),h=e.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,h,!1,!1);const d=[Instruction.CIRCLE,c];this.instructions.push(beginPathInstruction,d),this.hitDetectionInstructions.push(beginPathInstruction,d),s.fillStyle!==void 0&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),s.strokeStyle!==void 0&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),this.endGeometry(t)}drawPolygon(e,t,i){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,defaultLineDash,defaultLineDashOffset]);const a=e.getEnds(),h=e.getOrientedFlatCoordinates(),c=e.getStride();this.drawFlatCoordinatess_(h,0,a,c),this.endGeometry(t)}drawMultiPolygon(e,t,i){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,defaultLineDash,defaultLineDashOffset]);const a=e.getEndss(),h=e.getOrientedFlatCoordinates(),c=e.getStride();let d=0;for(let f=0,_=a.length;f<_;++f)d=this.drawFlatCoordinatess_(h,d,a[f],c);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,s=t.length;i<s;++i)t[i]=snap(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;this.updateFillStyle(e,this.createFill),this.updateStrokeStyle(e,this.applyStroke)}}function lineChunk(n,e,t,i,s){const r=[];let o=t,a=0,h=e.slice(t,2);for(;a<n&&o+s<i;){const[c,d]=h.slice(-2),f=e[o+s],_=e[o+s+1],y=Math.sqrt((f-c)*(f-c)+(_-d)*(_-d));if(a+=y,a>=n){const S=(n-a+y)/y,v=lerp(c,f,S),I=lerp(d,_,S);h.push(v,I),r.push(h),h=[v,I],a==n&&(o+=s),a=0}else if(a<n)h.push(e[o+s],e[o+s+1]),o+=s;else{const S=y-a,v=lerp(c,f,S/y),I=lerp(d,_,S/y);h.push(v,I),r.push(h),h=[v,I],a=0,o+=s}}return a>0&&r.push(h),r}function matchingChunk(n,e,t,i,s){let r=t,o=t,a=0,h=0,c=t,d,f,_,y,S,v,I,A,B,G;for(f=t;f<i;f+=s){const k=e[f],z=e[f+1];S!==void 0&&(B=k-S,G=z-v,y=Math.sqrt(B*B+G*G),I!==void 0&&(h+=_,d=Math.acos((I*B+A*G)/(_*y)),d>n&&(h>a&&(a=h,r=c,o=f),h=0,c=f-s)),_=y,I=B,A=G),S=k,v=z}return h+=y,h>a?[c,f]:[r,o]}const TEXT_ALIGN={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class CanvasTextBuilder extends CanvasBuilder{constructor(e,t,i,s){super(e,t,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[defaultFillStyle]={fillStyle:defaultFillStyle},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,i){const s=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!s&&!r)return;const a=this.coordinates;let h=a.length;const c=e.getType();let d=null,f=e.getStride();if(o.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!intersects$1(this.maxExtent,e.getExtent()))return;let _;if(d=e.getFlatCoordinates(),c=="LineString")_=[d.length];else if(c=="MultiLineString")_=e.getEnds();else if(c=="Polygon")_=e.getEnds().slice(0,1);else if(c=="MultiPolygon"){const I=e.getEndss();_=[];for(let A=0,B=I.length;A<B;++A)_.push(I[A][0])}this.beginGeometry(e,t,i);const y=o.repeat,S=y?void 0:o.textAlign;let v=0;for(let I=0,A=_.length;I<A;++I){let B;y?B=lineChunk(y*this.resolution,d,v,_[I],f):B=[d.slice(v,_[I])];for(let G=0,k=B.length;G<k;++G){const z=B[G];let q=0,T=z.length;if(S==null){const te=matchingChunk(o.maxAngle,z,0,z.length,2);q=te[0],T=te[1]}for(let te=q;te<T;te+=f)a.push(z[te],z[te+1]);const j=a.length;v=_[I],this.drawChars_(h,j),h=j}}this.endGeometry(t)}else{let _=o.overflow?null:[];switch(c){case"Point":case"MultiPoint":d=e.getFlatCoordinates();break;case"LineString":d=e.getFlatMidpoint();break;case"Circle":d=e.getCenter();break;case"MultiLineString":d=e.getFlatMidpoints(),f=2;break;case"Polygon":d=e.getFlatInteriorPoint(),o.overflow||_.push(d[2]/this.resolution),f=3;break;case"MultiPolygon":const k=e.getFlatInteriorPoints();d=[];for(let z=0,q=k.length;z<q;z+=3)o.overflow||_.push(k[z+2]/this.resolution),d.push(k[z],k[z+1]);if(d.length===0)return;f=2;break}const y=this.appendFlatPointCoordinates(d,f);if(y===h)return;if(_&&(y-h)/2!==d.length/f){let k=h/2;_=_.filter((z,q)=>{const T=a[(k+q)*2]===d[q*f]&&a[(k+q)*2+1]===d[q*f+1];return T||--k,T})}this.saveTextStates_();const S=o.backgroundFill?this.createFill(this.fillStyleToState(o.backgroundFill)):null,v=o.backgroundStroke?this.createStroke(this.strokeStyleToState(o.backgroundStroke)):null;this.beginGeometry(e,t,i);let I=o.padding;if(I!=defaultPadding&&(o.scale[0]<0||o.scale[1]<0)){let k=o.padding[0],z=o.padding[1],q=o.padding[2],T=o.padding[3];o.scale[0]<0&&(z=-z,T=-T),o.scale[1]<0&&(k=-k,q=-q),I=[k,z,q,T]}const A=this.pixelRatio;this.instructions.push([Instruction.DRAW_IMAGE,h,y,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,I==defaultPadding?defaultPadding:I.map(function(k){return k*A}),S,v,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,_]);const B=1/A,G=S?S.slice(0):null;G&&(G[1]=defaultFillStyle),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,h,y,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[B,B],NaN,this.declutterMode_,this.declutterImageWithText_,I,G,v,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?defaultFillStyle:this.fillKey_,this.textOffsetX_,this.textOffsetY_,_]),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,s=this.strokeKey_;e&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:t.font,textAlign:t.textAlign||defaultTextAlign,justify:t.justify,textBaseline:t.textBaseline||defaultTextBaseline,scale:t.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const h=this.pixelRatio,c=TEXT_ALIGN[s.textBaseline],d=this.textOffsetY_*h,f=this.text_,_=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([Instruction.DRAW_CHARS,e,t,c,s.overflow,a,s.maxAngle,h,d,r,_*h,f,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([Instruction.DRAW_CHARS,e,t,c,s.overflow,a&&defaultFillStyle,s.maxAngle,h,d,r,_*h,f,o,1/h,this.declutterMode_,this.textKeepUpright_])}setTextStyle(e,t){let i,s,r;if(!e)this.text_="";else{const o=e.getFill();o?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=asColorLike(o.getColor()||defaultFillStyle)):(s=null,this.textFillState_=s);const a=e.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const v=a.getLineDash(),I=a.getLineDashOffset(),A=a.getWidth(),B=a.getMiterLimit();r.lineCap=a.getLineCap()||defaultLineCap,r.lineDash=v?v.slice():defaultLineDash,r.lineDashOffset=I===void 0?defaultLineDashOffset:I,r.lineJoin=a.getLineJoin()||defaultLineJoin,r.lineWidth=A===void 0?defaultLineWidth:A,r.miterLimit=B===void 0?defaultMiterLimit:B,r.strokeStyle=asColorLike(a.getColor()||defaultStrokeStyle)}i=this.textState_;const h=e.getFont()||defaultFont;registerFont(h);const c=e.getScaleArray();i.overflow=e.getOverflow(),i.font=h,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.repeat=e.getRepeat(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||defaultTextBaseline,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||defaultPadding,i.scale=c===void 0?[1,1]:c;const d=e.getOffsetX(),f=e.getOffsetY(),_=e.getRotateWithView(),y=e.getKeepUpright(),S=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=d===void 0?0:d,this.textOffsetY_=f===void 0?0:f,this.textRotateWithView_=_===void 0?!1:_,this.textKeepUpright_=y===void 0?!0:y,this.textRotation_=S===void 0?0:S,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:getUid(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?typeof s.fillStyle=="string"?s.fillStyle:"|"+getUid(s.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const BATCH_CONSTRUCTORS={Circle:CanvasPolygonBuilder,Default:CanvasBuilder,Image:CanvasImageBuilder,LineString:CanvasLineStringBuilder,Polygon:CanvasPolygonBuilder,Text:CanvasTextBuilder};class BuilderGroup{constructor(e,t,i,s){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const s in i){const r=i[s].finish();e[t][s]=r}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let s=this.buildersByZIndex_[i];s===void 0&&(s={},this.buildersByZIndex_[i]=s);let r=s[t];if(r===void 0){const o=BATCH_CONSTRUCTORS[t];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[t]=r}return r}}function drawTextOnPath(n,e,t,i,s,r,o,a,h,c,d,f,_=!0){let y=n[e],S=n[e+1],v=0,I=0,A=0,B=0;function G(){v=y,I=S,e+=i,y=n[e],S=n[e+1],B+=A,A=Math.sqrt((y-v)*(y-v)+(S-I)*(S-I))}do G();while(e<t-i&&B+A<r);let k=A===0?0:(r-B)/A;const z=lerp(v,y,k),q=lerp(I,S,k),T=e-i,j=B,te=r+a*h(c,s,d);for(;e<t-i&&B+A<te;)G();k=A===0?0:(te-B)/A;const Se=lerp(v,y,k),be=lerp(I,S,k);let Te=!1;if(_)if(f){const ue=[z,q,Se,be];rotate(ue,0,4,2,f,ue,ue),Te=ue[0]>ue[2]}else Te=z>Se;const pe=Math.PI,ie=[],he=T+i===e;e=T,A=0,B=j,y=n[e],S=n[e+1];let ge;if(he){G(),ge=Math.atan2(S-I,y-v),Te&&(ge+=ge>0?-pe:pe);const ue=(Se+z)/2,de=(be+q)/2;return ie[0]=[ue,de,(te-r)/2,ge,s],ie}s=s.replace(/\n/g," ");for(let ue=0,de=s.length;ue<de;){G();let se=Math.atan2(S-I,y-v);if(Te&&(se+=se>0?-pe:pe),ge!==void 0){let b=se-ge;if(b+=b>pe?-2*pe:b<-pe?2*pe:0,Math.abs(b)>o)return null}ge=se;const l=ue;let u=0;for(;ue<de;++ue){const b=Te?de-ue-1:ue,P=a*h(c,s[b],d);if(e+i<t&&B+A<r+u+P/2)break;u+=P}if(ue===l)continue;const p=Te?s.substring(de-l,de-ue):s.substring(l,ue);k=A===0?0:(r+u/2-B)/A;const g=lerp(v,y,k),C=lerp(I,S,k);ie.push([g,C,u/2,se,p]),r+=u}return ie}const tmpExtent=createEmpty(),p1=[],p2=[],p3=[],p4=[];function getDeclutterBox(n){return n[3].declutterBox}const rtlRegEx=new RegExp("[Ö-à£¿ï¬-ï·¿ï¹°-ï»¼à -à¿¿î -î¿¿]");function horizontalTextAlign(n,e){return e==="start"?e=rtlRegEx.test(n)?"right":"left":e==="end"&&(e=rtlRegEx.test(n)?"left":"right"),TEXT_ALIGN[e]}function createTextChunks(n,e,t){return t>0&&n.push(`
`,""),n.push(e,""),n}function richTextToPlainText(n,e,t){return t%2===0&&(n+=e),n}class Executor{constructor(e,t,i,s,r){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=create(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new ZIndexContext:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,i,s){const r=e+t+i+s;if(this.labels_[r])return this.labels_[r];const o=s?this.strokeStates[s]:null,a=i?this.fillStates[i]:null,h=this.textStates[t],c=this.pixelRatio,d=[h.scale[0]*c,h.scale[1]*c],f=h.justify?TEXT_ALIGN[h.justify]:horizontalTextAlign(Array.isArray(e)?e[0]:e,h.textAlign||defaultTextAlign),_=s&&o.lineWidth?o.lineWidth:0,y=Array.isArray(e)?e:String(e).split(`
`).reduce(createTextChunks,[]),{width:S,height:v,widths:I,heights:A,lineWidths:B}=getTextDimensions(h,y),G=S+_,k=[],z=(G+2)*d[0],q=(v+_)*d[1],T={width:z<0?Math.floor(z):Math.ceil(z),height:q<0?Math.floor(q):Math.ceil(q),contextInstructions:k};(d[0]!=1||d[1]!=1)&&k.push("scale",d),s&&(k.push("strokeStyle",o.strokeStyle),k.push("lineWidth",_),k.push("lineCap",o.lineCap),k.push("lineJoin",o.lineJoin),k.push("miterLimit",o.miterLimit),k.push("setLineDash",[o.lineDash]),k.push("lineDashOffset",o.lineDashOffset)),i&&k.push("fillStyle",a.fillStyle),k.push("textBaseline","middle"),k.push("textAlign","center");const j=.5-f;let te=f*G+j*_;const Se=[],be=[];let Te=0,pe=0,ie=0,he=0,ge;for(let ue=0,de=y.length;ue<de;ue+=2){const se=y[ue];if(se===`
`){pe+=Te,Te=0,te=f*G+j*_,++he;continue}const l=y[ue+1]||h.font;l!==ge&&(s&&Se.push("font",l),i&&be.push("font",l),ge=l),Te=Math.max(Te,A[ie]);const u=[se,te+j*I[ie]+f*(I[ie]-B[he]),.5*(_+Te)+pe];te+=I[ie],s&&Se.push("strokeText",u),i&&be.push("fillText",u),++ie}return Array.prototype.push.apply(k,Se),Array.prototype.push.apply(k,be),this.labels_[r]=T,T}replayTextBackground_(e,t,i,s,r,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,s),e.lineTo.apply(e,r),e.lineTo.apply(e,t),o&&(this.alignAndScaleFill_=o[2],e.fillStyle=o[1],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,s,r,o,a,h,c,d,f,_,y,S,v,I){a*=_[0],h*=_[1];let A=i-a,B=s-h;const G=r+c>e?e-c:r,k=o+d>t?t-d:o,z=S[3]+G*_[0]+S[1],q=S[0]+k*_[1]+S[2],T=A-S[3],j=B-S[0];(v||f!==0)&&(p1[0]=T,p4[0]=T,p1[1]=j,p2[1]=j,p2[0]=T+z,p3[0]=p2[0],p3[1]=j+q,p4[1]=p3[1]);let te;return f!==0?(te=compose(create(),i,s,1,1,f,-i,-s),apply(te,p1),apply(te,p2),apply(te,p3),apply(te,p4),createOrUpdate$2(Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1]),tmpExtent)):createOrUpdate$2(Math.min(T,T+z),Math.min(j,j+q),Math.max(T,T+z),Math.max(j,j+q),tmpExtent),y&&(A=Math.round(A),B=Math.round(B)),{drawImageX:A,drawImageY:B,drawImageW:G,drawImageH:k,originX:c,originY:d,declutterBox:{minX:tmpExtent[0],minY:tmpExtent[1],maxX:tmpExtent[2],maxY:tmpExtent[3],value:I},canvasTransform:te,scale:_}}replayImageOrLabel_(e,t,i,s,r,o,a){const h=!!(o||a),c=s.declutterBox,d=a?a[2]*s.scale[0]/2:0;return c.minX-d<=t[0]&&c.maxX+d>=0&&c.minY-d<=t[1]&&c.maxY+d>=0&&(h&&this.replayTextBackground_(e,p1,p2,p3,p4,o,a),drawImageOrLabel(e,s.canvasTransform,r,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const i=apply(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;e.save(),e.translate(i[0]%s,i[1]%s),t!==1&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],t[1]&&(e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6]))}drawLabelWithPointPlacement_(e,t,i,s){const r=this.textStates[t],o=this.createLabel(e,t,s,i),a=this.strokeStates[i],h=this.pixelRatio,c=horizontalTextAlign(Array.isArray(e)?e[0]:e,r.textAlign||defaultTextAlign),d=TEXT_ALIGN[r.textBaseline||defaultTextBaseline],f=a&&a.lineWidth?a.lineWidth:0,_=o.width/h-2*r.scale[0],y=c*_+2*(.5-c)*f,S=d*o.height/h+2*(.5-d)*f;return{label:o,anchorX:y,anchorY:S}}execute_(e,t,i,s,r,o,a,h){const c=this.zIndexContext_;let d;this.pixelCoordinates_&&equals$1(i,this.renderedTransform_)?d=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),d=transform2D(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),setFromArray(this.renderedTransform_,i));let f=0;const _=s.length;let y=0,S,v,I,A,B,G,k,z,q,T,j,te,Se,be=0,Te=0;const pe=this.coordinateCache_,ie=this.viewRotation_,he=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,ge={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:ie},ue=this.instructions!=s||this.overlaps?0:200;let de,se,l,u;for(;f<_;){const p=s[f];switch(p[0]){case Instruction.BEGIN_GEOMETRY:de=p[1],u=p[3],de.getGeometry()?a!==void 0&&!intersects$1(a,u.getExtent())?f=p[2]+1:++f:f=p[2],c&&(c.zIndex=p[4]);break;case Instruction.BEGIN_PATH:be>ue&&(this.fill_(e),be=0),Te>ue&&(e.stroke(),Te=0),!be&&!Te&&(e.beginPath(),B=NaN,G=NaN),++f;break;case Instruction.CIRCLE:y=p[1];const C=d[y],b=d[y+1],P=d[y+2],O=d[y+3],L=P-C,U=O-b,H=Math.sqrt(L*L+U*U);e.moveTo(C+H,b),e.arc(C,b,H,0,2*Math.PI,!0),++f;break;case Instruction.CLOSE_PATH:e.closePath(),++f;break;case Instruction.CUSTOM:y=p[1],S=p[2];const ee=p[3],ae=p[4],Y=p[5];ge.geometry=ee,ge.feature=de,f in pe||(pe[f]=[]);const Z=pe[f];Y?Y(d,y,S,2,Z):(Z[0]=d[y],Z[1]=d[y+1],Z.length=2),c&&(c.zIndex=p[6]),ae(Z,ge),++f;break;case Instruction.DRAW_IMAGE:y=p[1],S=p[2],q=p[3],v=p[4],I=p[5];let ce=p[6];const ye=p[7],ve=p[8],Ee=p[9],Re=p[10];let Ne=p[11];const Fe=p[12];let De=p[13];A=p[14]||"declutter";const Ae=p[15];if(!q&&p.length>=20){T=p[19],j=p[20],te=p[21],Se=p[22];const Qe=this.drawLabelWithPointPlacement_(T,j,te,Se);q=Qe.label,p[3]=q;const Ke=p[23];v=(Qe.anchorX-Ke)*this.pixelRatio,p[4]=v;const gt=p[24];I=(Qe.anchorY-gt)*this.pixelRatio,p[5]=I,ce=q.height,p[6]=ce,De=q.width,p[13]=De}let Ue;p.length>25&&(Ue=p[25]);let Ce,Oe,Ve;p.length>17?(Ce=p[16],Oe=p[17],Ve=p[18]):(Ce=defaultPadding,Oe=null,Ve=null),Re&&he?Ne+=ie:!Re&&!he&&(Ne-=ie);let tt=0;for(;y<S;y+=2){if(Ue&&Ue[tt++]<De/this.pixelRatio)continue;const Qe=this.calculateImageOrLabelDimensions_(q.width,q.height,d[y],d[y+1],De,ce,v,I,ve,Ee,Ne,Fe,r,Ce,!!Oe||!!Ve,de),Ke=[e,t,q,Qe,ye,Oe,Ve];if(h){let gt,bt,dt;if(Ae){const $e=S-y;if(!Ae[$e]){Ae[$e]={args:Ke,declutterMode:A};continue}const He=Ae[$e];gt=He.args,bt=He.declutterMode,delete Ae[$e],dt=getDeclutterBox(gt)}let _t,rt;if(gt&&(bt!=="declutter"||!h.collides(dt))&&(_t=!0),(A!=="declutter"||!h.collides(Qe.declutterBox))&&(rt=!0),bt==="declutter"&&A==="declutter"){const $e=_t&&rt;_t=$e,rt=$e}_t&&(bt!=="none"&&h.insert(dt),this.replayImageOrLabel_.apply(this,gt)),rt&&(A!=="none"&&h.insert(Qe.declutterBox),this.replayImageOrLabel_.apply(this,Ke))}else this.replayImageOrLabel_.apply(this,Ke)}++f;break;case Instruction.DRAW_CHARS:const it=p[1],ct=p[2],mt=p[3],st=p[4];Se=p[5];const ut=p[6],J=p[7],ze=p[8];te=p[9];const pt=p[10];T=p[11],Array.isArray(T)&&(T=T.reduce(richTextToPlainText,"")),j=p[12];const ot=[p[13],p[13]];A=p[14]||"declutter";const Ct=p[15],St=this.textStates[j],vt=St.font,at=[St.scale[0]*J,St.scale[1]*J];let lt;vt in this.widths_?lt=this.widths_[vt]:(lt={},this.widths_[vt]=lt);const Vt=lineStringLength(d,it,ct,2),kt=Math.abs(at[0])*measureAndCacheTextWidth(vt,T,lt);if(st||kt<=Vt){const Qe=this.textStates[j].textAlign,Ke=(Vt-kt)*horizontalTextAlign(T,Qe),gt=drawTextOnPath(d,it,ct,2,T,Ke,ut,Math.abs(at[0]),measureAndCacheTextWidth,vt,lt,he?0:this.viewRotation_,Ct);e:if(gt){const bt=[];let dt,_t,rt,$e,He;if(te)for(dt=0,_t=gt.length;dt<_t;++dt){He=gt[dt],rt=He[4],$e=this.createLabel(rt,j,"",te),v=He[2]+(at[0]<0?-pt:pt),I=mt*$e.height+(.5-mt)*2*pt*at[1]/at[0]-ze;const Je=this.calculateImageOrLabelDimensions_($e.width,$e.height,He[0],He[1],$e.width,$e.height,v,I,0,0,He[3],ot,!1,defaultPadding,!1,de);if(h&&A==="declutter"&&h.collides(Je.declutterBox))break e;bt.push([e,t,$e,Je,1,null,null])}if(Se)for(dt=0,_t=gt.length;dt<_t;++dt){He=gt[dt],rt=He[4],$e=this.createLabel(rt,j,Se,""),v=He[2],I=mt*$e.height-ze;const Je=this.calculateImageOrLabelDimensions_($e.width,$e.height,He[0],He[1],$e.width,$e.height,v,I,0,0,He[3],ot,!1,defaultPadding,!1,de);if(h&&A==="declutter"&&h.collides(Je.declutterBox))break e;bt.push([e,t,$e,Je,1,null,null])}h&&A!=="none"&&h.load(bt.map(getDeclutterBox));for(let Je=0,ui=bt.length;Je<ui;++Je)this.replayImageOrLabel_.apply(this,bt[Je])}}++f;break;case Instruction.END_GEOMETRY:if(o!==void 0){de=p[1];const Qe=o(de,u,A);if(Qe)return Qe}++f;break;case Instruction.FILL:ue?be++:this.fill_(e),++f;break;case Instruction.MOVE_TO_LINE_TO:for(y=p[1],S=p[2],se=d[y],l=d[y+1],e.moveTo(se,l),B=se+.5|0,G=l+.5|0,y+=2;y<S;y+=2)se=d[y],l=d[y+1],k=se+.5|0,z=l+.5|0,(y==S-2||k!==B||z!==G)&&(e.lineTo(se,l),B=k,G=z);++f;break;case Instruction.SET_FILL_STYLE:this.alignAndScaleFill_=p[2],be&&(this.fill_(e),be=0,Te&&(e.stroke(),Te=0)),e.fillStyle=p[1],++f;break;case Instruction.SET_STROKE_STYLE:Te&&(e.stroke(),Te=0),this.setStrokeStyle_(e,p),++f;break;case Instruction.STROKE:ue?Te++:e.stroke(),++f;break;default:++f;break}}be&&this.fill_(e),Te&&e.stroke()}execute(e,t,i,s,r,o){this.viewRotation_=s,this.execute_(e,t,i,this.instructions,r,void 0,void 0,o)}executeHitDetection(e,t,i,s,r){return this.viewRotation_=i,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,s,r)}}const ALL=["Polygon","Circle","LineString","Image","Text","Default"],DECLUTTER=["Image","Text"],NON_DECLUTTER=ALL.filter(n=>!DECLUTTER.includes(n));class ExecutorGroup{constructor(e,t,i,s,r,o,a){this.maxExtent_=e,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=create(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(r,a)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e,t){for(const i in e){let s=this.executorsByZIndex_[i];s===void 0&&(s={},this.executorsByZIndex_[i]=s);const r=e[i];for(const o in r){const a=r[o];s[o]=new Executor(this.resolution_,this.pixelRatio_,this.overlaps_,a,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let s=0,r=e.length;s<r;++s)if(e[s]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,s,r,o){s=Math.round(s);const a=s*2+1,h=compose(this.hitDetectionTransform_,s+.5,s+.5,1/t,-1/t,-i,-e[0],-e[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=createCanvasContext2D(a,a));const d=this.hitDetectionContext_;d.canvas.width!==a||d.canvas.height!==a?(d.canvas.width=a,d.canvas.height=a):c||d.clearRect(0,0,a,a);let f;this.renderBuffer_!==void 0&&(f=createEmpty(),extendCoordinate(f,e),buffer(f,t*(this.renderBuffer_+s),f));const _=getPixelIndexArray(s);let y;function S(z,q,T){const j=d.getImageData(0,0,a,a).data;for(let te=0,Se=_.length;te<Se;te++)if(j[_[te]]>0){if(!o||T==="none"||y!=="Image"&&y!=="Text"||o.includes(z)){const be=(_[te]-3)/4,Te=s-be%a,pe=s-(be/a|0),ie=r(z,q,Te*Te+pe*pe);if(ie)return ie}d.clearRect(0,0,a,a);break}}const v=Object.keys(this.executorsByZIndex_).map(Number);v.sort(ascending);let I,A,B,G,k;for(I=v.length-1;I>=0;--I){const z=v[I].toString();for(B=this.executorsByZIndex_[z],A=ALL.length-1;A>=0;--A)if(y=ALL[A],G=B[y],G!==void 0&&(k=G.executeHitDetection(d,h,i,S,f),k))return k}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],s=t[1],r=t[2],o=t[3],a=[i,s,i,o,r,o,r,s];return transform2D(a,0,8,2,e,a),a}isEmpty(){return isEmpty(this.executorsByZIndex_)}execute(e,t,i,s,r,o,a){const h=Object.keys(this.executorsByZIndex_).map(Number);h.sort(a?descending:ascending),o=o||ALL;const c=ALL.length;for(let d=0,f=h.length;d<f;++d){const _=h[d].toString(),y=this.executorsByZIndex_[_];for(let S=0,v=o.length;S<v;++S){const I=o[S],A=y[I];if(A!==void 0){const B=a===null?void 0:A.getZIndexContext(),G=B?B.getContext():e,k=this.maxExtent_&&I!=="Image"&&I!=="Text";if(k&&(G.save(),this.clip(G,i)),!B||I==="Text"||I==="Image"?A.execute(G,t,i,s,r,a):B.pushFunction(z=>A.execute(z,t,i,s,r,a)),k&&G.restore(),B){B.offset();const z=h[d]*c+ALL.indexOf(I);this.deferredZIndexContexts_[z]||(this.deferredZIndexContexts_[z]=[]),this.deferredZIndexContexts_[z].push(B)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(ascending);for(let i=0,s=t.length;i<s;++i)e[t[i]].forEach(r=>{r.draw(this.renderedContext_),r.clear()}),e[t[i]].length=0}}const circlePixelIndexArrayCache={};function getPixelIndexArray(n){if(circlePixelIndexArrayCache[n]!==void 0)return circlePixelIndexArrayCache[n];const e=n*2+1,t=n*n,i=new Array(t+1);for(let r=0;r<=n;++r)for(let o=0;o<=n;++o){const a=r*r+o*o;if(a>t)break;let h=i[a];h||(h=[],i[a]=h),h.push(((n+r)*e+(n+o))*4+3),r>0&&h.push(((n-r)*e+(n+o))*4+3),o>0&&(h.push(((n+r)*e+(n-o))*4+3),r>0&&h.push(((n-r)*e+(n-o))*4+3))}const s=[];for(let r=0,o=i.length;r<o;++r)i[r]&&s.push(...i[r]);return circlePixelIndexArrayCache[n]=s,s}class CanvasImmediateRenderer extends VectorContext{constructor(e,t,i,s,r,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=s,this.transformRotation_=s?toFixed(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=create()}drawImages_(e,t,i,s){if(!this.image_)return;const r=transform2D(e,t,i,s,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,h=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=h*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let d=0,f=r.length;d<f;d+=2){const _=r[d]-this.imageAnchorX_,y=r[d+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const S=_+this.imageAnchorX_,v=y+this.imageAnchorY_;compose(a,S,v,1,1,c,-S,-v),o.save(),o.transform.apply(o,a),o.translate(S,v),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,_,y,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=h)}drawText_(e,t,i,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=transform2D(e,t,i,s,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<i;t+=s){const h=r[t]+this.textOffsetX_,c=r[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(h-this.textOffsetX_,c-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,h,c),this.textFillState_&&o.fillText(this.text_,h,c))}}moveToLineTo_(e,t,i,s,r){const o=this.context_,a=transform2D(e,t,i,s,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let h=a.length;r&&(h-=2);for(let c=2;c<h;c+=2)o.lineTo(a[c],a[c+1]);return r&&o.closePath(),i}drawRings_(e,t,i,s){for(let r=0,o=i.length;r<o;++r)t=this.moveToLineTo_(e,t,i[r],s,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=transformGeom2D(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],s=t[3]-t[1],r=Math.sqrt(i*i+s*s),o=this.context_;o.beginPath(),o.arc(t[0],t[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,s=t.length;i<s;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(intersects$1(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=e.getFlatCoordinates();let r=0;const o=e.getEnds(),a=e.getStride();i.beginPath();for(let h=0,c=o.length;h<c;++h)r=this.moveToLineTo_(s,r,o[h],a,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!intersects$1(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let s=0;const r=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,h=r.length;a<h;++a){const c=r[a];s=this.drawRings_(i,s,c,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),equals$1(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,s=e.textAlign?e.textAlign:defaultTextAlign;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=s&&(i.textAlign=s,t.textAlign=s),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=s,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:s,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:asColorLike(i||defaultFillStyle)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),s=t.getLineCap(),r=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),h=t.getWidth(),c=t.getMiterLimit(),d=r||defaultLineDash;this.strokeState_={lineCap:s!==void 0?s:defaultLineCap,lineDash:this.pixelRatio_===1?d:d.map(f=>f*this.pixelRatio_),lineDashOffset:(o||defaultLineDashOffset)*this.pixelRatio_,lineJoin:a!==void 0?a:defaultLineJoin,lineWidth:(h!==void 0?h:defaultLineWidth)*this.pixelRatio_,miterLimit:c!==void 0?c:defaultMiterLimit,strokeStyle:asColorLike(i||defaultStrokeStyle)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),s=e.getAnchor(),r=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const y=t.getColor();this.textFillState_={fillStyle:asColorLike(y||defaultFillStyle)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const y=i.getColor(),S=i.getLineCap(),v=i.getLineDash(),I=i.getLineDashOffset(),A=i.getLineJoin(),B=i.getWidth(),G=i.getMiterLimit();this.textStrokeState_={lineCap:S!==void 0?S:defaultLineCap,lineDash:v||defaultLineDash,lineDashOffset:I||defaultLineDashOffset,lineJoin:A!==void 0?A:defaultLineJoin,lineWidth:B!==void 0?B:defaultLineWidth,miterLimit:G!==void 0?G:defaultMiterLimit,strokeStyle:asColorLike(y||defaultStrokeStyle)}}const s=e.getFont(),r=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),h=e.getRotation(),c=e.getScaleArray(),d=e.getText(),f=e.getTextAlign(),_=e.getTextBaseline();this.textState_={font:s!==void 0?s:defaultFont,textAlign:f!==void 0?f:defaultTextAlign,textBaseline:_!==void 0?_:defaultTextBaseline},this.text_=d!==void 0?Array.isArray(d)?d.reduce((y,S,v)=>y+=v%2?" ":S,""):d:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=h!==void 0?h:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}}const HIT_DETECT_RESOLUTION=.5;function createHitDetectionImageData(n,e,t,i,s,r,o,a,h){const c=s,d=n[0]*HIT_DETECT_RESOLUTION,f=n[1]*HIT_DETECT_RESOLUTION,_=createCanvasContext2D(d,f);_.imageSmoothingEnabled=!1;const y=_.canvas,S=new CanvasImmediateRenderer(_,HIT_DETECT_RESOLUTION,s,null,o,a,null),v=t.length,I=Math.floor((256*256*256-1)/v),A={};for(let G=1;G<=v;++G){const k=t[G-1],z=k.getStyleFunction()||i;if(!z)continue;let q=z(k,r);if(!q)continue;Array.isArray(q)||(q=[q]);const j=(G*I).toString(16).padStart(7,"#00000");for(let te=0,Se=q.length;te<Se;++te){const be=q[te],Te=be.getGeometryFunction()(k);if(!Te||!intersects$1(c,Te.getExtent()))continue;const pe=be.clone(),ie=pe.getFill();ie&&ie.setColor(j);const he=pe.getStroke();he&&(he.setColor(j),he.setLineDash(null)),pe.setText(void 0);const ge=be.getImage();if(ge){const l=ge.getImageSize();if(!l)continue;const u=createCanvasContext2D(l[0],l[1],void 0,{alpha:!1}),p=u.canvas;u.fillStyle=j,u.fillRect(0,0,p.width,p.height),pe.setImage(new Icon({img:p,anchor:ge.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:ge.getOrigin(),opacity:1,size:ge.getSize(),scale:ge.getScale(),rotation:ge.getRotation(),rotateWithView:ge.getRotateWithView()}))}const ue=pe.getZIndex()||0;let de=A[ue];de||(de={},A[ue]=de,de.Polygon=[],de.Circle=[],de.LineString=[],de.Point=[]);const se=Te.getType();if(se==="GeometryCollection"){const l=Te.getGeometriesArrayRecursive();for(let u=0,p=l.length;u<p;++u){const g=l[u];de[g.getType().replace("Multi","")].push(g,pe)}}else de[se.replace("Multi","")].push(Te,pe)}}const B=Object.keys(A).map(Number).sort(ascending);for(let G=0,k=B.length;G<k;++G){const z=A[B[G]];for(const q in z){const T=z[q];for(let j=0,te=T.length;j<te;j+=2){S.setStyle(T[j+1]);for(let Se=0,be=e.length;Se<be;++Se)S.setTransform(e[Se]),S.drawGeometry(T[j])}}}return _.getImageData(0,0,y.width,y.height)}function hitDetect(n,e,t){const i=[];if(t){const s=Math.floor(Math.round(n[0])*HIT_DETECT_RESOLUTION),r=Math.floor(Math.round(n[1])*HIT_DETECT_RESOLUTION),o=(clamp(s,0,t.width-1)+clamp(r,0,t.height-1)*t.width)*4,a=t.data[o],h=t.data[o+1],d=t.data[o+2]+256*(h+256*a),f=Math.floor((256*256*256-1)/e.length);d&&d%f===0&&i.push(e[d/f-1])}return i}const SIMPLIFY_TOLERANCE=.5,GEOMETRY_RENDERERS={Point:renderPointGeometry,LineString:renderLineStringGeometry,Polygon:renderPolygonGeometry,MultiPoint:renderMultiPointGeometry,MultiLineString:renderMultiLineStringGeometry,MultiPolygon:renderMultiPolygonGeometry,GeometryCollection:renderGeometryCollectionGeometry,Circle:renderCircleGeometry};function defaultOrder(n,e){return parseInt(getUid(n),10)-parseInt(getUid(e),10)}function getSquaredTolerance(n,e){const t=getTolerance(n,e);return t*t}function getTolerance(n,e){return SIMPLIFY_TOLERANCE*n/e}function renderCircleGeometry(n,e,t,i,s){const r=t.getFill(),o=t.getStroke();if(r||o){const h=n.getBuilder(t.getZIndex(),"Circle");h.setFillStrokeStyle(r,o),h.drawCircle(e,i,s)}const a=t.getText();if(a&&a.getText()){const h=n.getBuilder(t.getZIndex(),"Text");h.setTextStyle(a),h.drawText(e,i)}}function renderFeature(n,e,t,i,s,r,o,a){const h=[],c=t.getImage();if(c){let _=!0;const y=c.getImageState();y==ImageState.LOADED||y==ImageState.ERROR?_=!1:y==ImageState.IDLE&&c.load(),_&&h.push(c.ready())}const d=t.getFill();d&&d.loading()&&h.push(d.ready());const f=h.length>0;return f&&Promise.all(h).then(()=>s(null)),renderFeatureInternal(n,e,t,i,r,o,a),f}function renderFeatureInternal(n,e,t,i,s,r,o){const a=t.getGeometryFunction()(e);if(!a)return;const h=a.simplifyTransformed(i,s);if(t.getRenderer())renderGeometry(n,h,t,e,o);else{const d=GEOMETRY_RENDERERS[h.getType()];d(n,h,t,e,o,r)}}function renderGeometry(n,e,t,i,s){if(e.getType()=="GeometryCollection"){const o=e.getGeometries();for(let a=0,h=o.length;a<h;++a)renderGeometry(n,o[a],t,i,s);return}n.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer(),s)}function renderGeometryCollectionGeometry(n,e,t,i,s,r){const o=e.getGeometriesArray();let a,h;for(a=0,h=o.length;a<h;++a){const c=GEOMETRY_RENDERERS[o[a].getType()];c(n,o[a],t,i,s,r)}}function renderLineStringGeometry(n,e,t,i,s){const r=t.getStroke();if(r){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(e,i,s)}const o=t.getText();if(o&&o.getText()){const a=n.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,s)}}function renderMultiLineStringGeometry(n,e,t,i,s){const r=t.getStroke();if(r){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(e,i,s)}const o=t.getText();if(o&&o.getText()){const a=n.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,s)}}function renderMultiPolygonGeometry(n,e,t,i,s){const r=t.getFill(),o=t.getStroke();if(o||r){const h=n.getBuilder(t.getZIndex(),"Polygon");h.setFillStrokeStyle(r,o),h.drawMultiPolygon(e,i,s)}const a=t.getText();if(a&&a.getText()){const h=n.getBuilder(t.getZIndex(),"Text");h.setTextStyle(a),h.drawText(e,i,s)}}function renderPointGeometry(n,e,t,i,s,r){const o=t.getImage(),a=t.getText(),h=a&&a.getText(),c=r&&o&&h?{}:void 0;if(o){if(o.getImageState()!=ImageState.LOADED)return;const d=n.getBuilder(t.getZIndex(),"Image");d.setImageStyle(o,c),d.drawPoint(e,i,s)}if(h){const d=n.getBuilder(t.getZIndex(),"Text");d.setTextStyle(a,c),d.drawText(e,i,s)}}function renderMultiPointGeometry(n,e,t,i,s,r){const o=t.getImage(),a=o&&o.getOpacity()!==0,h=t.getText(),c=h&&h.getText(),d=r&&a&&c?{}:void 0;if(a){if(o.getImageState()!=ImageState.LOADED)return;const f=n.getBuilder(t.getZIndex(),"Image");f.setImageStyle(o,d),f.drawMultiPoint(e,i,s)}if(c){const f=n.getBuilder(t.getZIndex(),"Text");f.setTextStyle(h,d),f.drawText(e,i,s)}}function renderPolygonGeometry(n,e,t,i,s){const r=t.getFill(),o=t.getStroke();if(r||o){const h=n.getBuilder(t.getZIndex(),"Polygon");h.setFillStrokeStyle(r,o),h.drawPolygon(e,i,s)}const a=t.getText();if(a&&a.getText()){const h=n.getBuilder(t.getZIndex(),"Text");h.setTextStyle(a),h.drawText(e,i,s)}}class CanvasVectorLayerRenderer extends CanvasLayerRenderer{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=createEmpty(),this.wrappedRenderedExtent_=createEmpty(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,i){const s=t.extent,r=t.viewState,o=r.center,a=r.resolution,h=r.projection,c=r.rotation,d=h.getExtent(),f=this.getLayer().getSource(),_=this.getLayer().getDeclutter(),y=t.pixelRatio,S=t.viewHints,v=!(S[ViewHint.ANIMATING]||S[ViewHint.INTERACTING]),I=this.context,A=Math.round(getWidth(s)/a*y),B=Math.round(getHeight(s)/a*y),G=f.getWrapX()&&h.canWrapX(),k=G?getWidth(d):null,z=G?Math.ceil((s[2]-d[2])/k)+1:1;let q=G?Math.floor((s[0]-d[0])/k):0;do{let T=this.getRenderTransform(o,a,0,y,A,B,q*k);t.declutter&&(T=T.slice(0)),e.execute(I,[I.canvas.width,I.canvas.height],T,c,v,i===void 0?ALL:i?DECLUTTER:NON_DECLUTTER,i?_&&t.declutter[_]:void 0)}while(++q<z)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=createCanvasContext2D(this.context.canvas.width,this.context.canvas.height,canvasPool))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,releaseCanvas(this.context),canvasPool.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex];this.opacity_=i.opacity;const s=e.viewState;this.prepareContainer(e,t);const r=this.context,o=this.replayGroup_;let a=o&&!o.isEmpty();if(!a&&!(this.getLayer().hasListener(RenderEventType.PRERENDER)||this.getLayer().hasListener(RenderEventType.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(r,e),s.projection,this.clipped_=!1,a&&i.extent&&this.clipping){const h=fromUserExtent(i.extent);a=intersects$1(h,e.extent),this.clipped_=a&&!containsExtent(h,e.extent),this.clipped_&&this.clipUnrotated(r,e,h)}return a&&this.renderWorlds(o,e,this.getLayer().getDeclutter()?!1:void 0),!e.declutter&&this.clipped_&&r.restore(),this.postRender(r,e),this.renderedRotation_!==s.rotation&&(this.renderedRotation_=s.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),s=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,h=this.wrappedRenderedExtent_,c=this.getLayer(),d=[],f=i[0]*HIT_DETECT_RESOLUTION,_=i[1]*HIT_DETECT_RESOLUTION;d.push(this.getRenderTransform(s,r,o,HIT_DETECT_RESOLUTION,f,_,0).slice());const y=c.getSource(),S=a.getExtent();if(y.getWrapX()&&a.canWrapX()&&!containsExtent(S,h)){let v=h[0];const I=getWidth(S);let A=0,B;for(;v<S[0];)--A,B=I*A,d.push(this.getRenderTransform(s,r,o,HIT_DETECT_RESOLUTION,f,_,B).slice()),v+=I;for(A=0,v=h[2];v>S[2];)++A,B=I*A,d.push(this.getRenderTransform(s,r,o,HIT_DETECT_RESOLUTION,f,_,B).slice()),v-=I}this.hitDetectionImageData_=createHitDetectionImageData(i,d,this.renderedFeatures_,c.getStyleFunction(),h,r,o,getSquaredTolerance(r,this.renderedPixelRatio_))}t(hitDetect(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,i,s,r){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,h=this.getLayer(),c={},d=function(_,y,S){const v=getUid(_),I=c[v];if(I){if(I!==!0&&S<I.distanceSq){if(S===0)return c[v]=!0,r.splice(r.lastIndexOf(I),1),s(_,h,y);I.geometry=y,I.distanceSq=S}}else{if(S===0)return c[v]=!0,s(_,h,y);r.push(c[v]={feature:_,layer:h,geometry:y,distanceSq:S,callback:s})}},f=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,o,a,i,d,f?t.declutter?.[f]?.all().map(_=>_.value):null)}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const s=e.viewHints[ViewHint.ANIMATING],r=e.viewHints[ViewHint.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&s||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const h=e.extent,c=e.viewState,d=c.projection,f=c.resolution,_=e.pixelRatio,y=t.getRevision(),S=t.getRenderBuffer();let v=t.getRenderOrder();v===void 0&&(v=defaultOrder);const I=c.center.slice(),A=buffer(h,S*f),B=A.slice(),G=[A.slice()],k=d.getExtent();if(i.getWrapX()&&d.canWrapX()&&!containsExtent(k,e.extent)){const ie=getWidth(k),he=Math.max(getWidth(A)/2,ie);A[0]=k[0]-he,A[2]=k[2]+he,wrapX$1(I,d);const ge=wrapX$2(G[0],d);ge[0]<k[0]&&ge[2]<k[2]?G.push([ge[0]+ie,ge[1],ge[2]+ie,ge[3]]):ge[0]>k[0]&&ge[2]>k[2]&&G.push([ge[0]-ie,ge[1],ge[2]-ie,ge[3]])}if(this.ready&&this.renderedResolution_==f&&this.renderedRevision_==y&&this.renderedRenderOrder_==v&&this.renderedFrameDeclutter_===!!e.declutter&&containsExtent(this.wrappedRenderedExtent_,A))return equals$1(this.renderedExtent_,B)||(this.hitDetectionImageData_=null,this.renderedExtent_=B),this.renderedCenter_=I,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const z=new BuilderGroup(getTolerance(f,_),A,f,_);let q;for(let ie=0,he=G.length;ie<he;++ie)i.loadFeatures(G[ie],f,d);const T=getSquaredTolerance(f,_);let j=!0;const te=(ie,he)=>{let ge;const ue=ie.getStyleFunction()||t.getStyleFunction();if(ue&&(ge=ue(ie,f)),ge){const de=this.renderFeature(ie,T,ge,z,q,this.getLayer().getDeclutter(),he);j=j&&!de}},Se=toUserExtent(A),be=i.getFeaturesInExtent(Se);v&&be.sort(v);for(let ie=0,he=be.length;ie<he;++ie)te(be[ie],ie);this.renderedFeatures_=be,this.ready=j;const Te=z.finish(),pe=new ExecutorGroup(A,f,_,i.getOverlaps(),Te,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=f,this.renderedRevision_=y,this.renderedRenderOrder_=v,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=B,this.wrappedRenderedExtent_=A,this.renderedCenter_=I,this.renderedProjection_=d,this.renderedPixelRatio_=_,this.replayGroup_=pe,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,s,r,o,a){if(!i)return!1;let h=!1;if(Array.isArray(i))for(let c=0,d=i.length;c<d;++c)h=renderFeature(s,e,i[c],t,this.boundHandleStyleImageChange_,r,o,a)||h;else h=renderFeature(s,e,i,t,this.boundHandleStyleImageChange_,r,o,a);return h}}class VectorLayer extends BaseVectorLayer{constructor(e){super(e)}createRenderer(){return new CanvasVectorLayerRenderer(this)}}const ltmDecoder=(function(){let n={pitch:null,roll:null,heading:null,voltage:null,currectDrawn:null,rssi:null,airspeed:null,flightmode:null,flightmodeName:null,armed:null,failsafe:null,latitude:null,longitude:null,altitude:null,groundSpeed:null,gpsFix:null,gpsSats:null,hdop:null,sensorStatus:null,frameCounter:null,disarmReason:null,disarmReasonName:null},e={},t={};const i=5e3,s=700,r="$",o="T",a={G:18,A:10,S:11,O:18,N:10,X:10},h=["MANUAL","RATE","ANGLE","HORIZON","ACRO","STABALIZED1","STABALIZED2","STABILIZED3","ALTHOLD","GPSHOLD","WAYPOINTS","HEADHOLD","CIRCLE","RTH","FOLLOWME","LAND","FLYBYWIRE1","FLYBYWIRE2","CRUISE","UNKNOWN","LAUNCH","AUTOTUNE"],c=["NONE","TIMEOUT","STICKS","SWITCH_3D","SWITCH","KILLSWITCH","FAILSAFE","NAVIGATION","LANDING"],d=0,f=1,_=2,y=3;return t.protocolState=d,t.lastFrameReceivedMs=null,t.frameType=null,t.frameLength=null,t.receiverIndex=0,t.serialBuffer=[],t.frameProcessingStartedAtMs=0,t.readByte=function(S){return t.serialBuffer[S]},t.readInt=function(S){return t.serialBuffer[S]+(t.serialBuffer[S+1]<<8)},t.readInt32=function(S){return t.serialBuffer[S]+(t.serialBuffer[S+1]<<8)+(t.serialBuffer[S+2]<<16)+(t.serialBuffer[S+3]<<24)},t.push=function(S){let v=String.fromCharCode(S);if(t.protocolState!=d&&new Date().getTime()-t.frameProcessingStartedAtMs>s&&(t.protocolState=d,t.frameProcessingStartedAtMs=new Date().getTime(),console.log("LTM privateScope.protocolState: TIMEOUT, forcing into IDLE, processed frame: "+t.frameType)),t.protocolState==d){v==r&&(t.protocolState=f,t.frameProcessingStartedAtMs=new Date().getTime());return}else if(t.protocolState==f){v==o?t.protocolState=_:t.protocolState=d;return}else if(t.protocolState==_){a[v]==null?(t.protocolState=d,console.log("Unknown frame type, reset protocol state")):(t.frameType=v,t.frameLength=a[v],t.receiverIndex=0,t.serialBuffer=[],t.protocolState=y,console.log("protocolState: LTM_STATE_MSGTYPE","will expext frame "+t.frameType,"expected length: "+t.frameLength));return}else if(t.protocolState==y)if(t.receiverIndex==t.frameLength-4){let I=0;for(let A=0;A<t.serialBuffer.length;A++)I^=t.serialBuffer[A];if(I!=S){console.log("LTM checksum error, frame type: "+t.frameType+" rejected"),t.protocolState=d,t.serialBuffer=[],t.receiverIndex=0;return}if(t.frameType=="A"&&(n.pitch=t.readInt(0),n.roll=t.readInt(2),n.heading=t.readInt(4)),t.frameType=="S"){n.voltage=t.readInt(0),n.currectDrawn=t.readInt(2),n.rssi=t.readByte(4),n.airspeed=t.readByte(5);let A=t.readByte(6);n.flightmode=A>>2,n.flightmodeName=h[n.flightmode],n.armed=(A&2)>>1,n.failsafe=A&1}if(t.frameType=="G"){n.latitude=t.readInt32(0),n.longitude=t.readInt32(4),n.groundSpeed=t.readByte(8),n.altitude=t.readInt32(9);let A=t.readByte(13);n.gpsSats=A>>2,n.gpsFix=A&3}t.frameType=="X"&&(n.hdop=t.readInt(0),n.sensorStatus=t.readByte(2),n.frameCounter=t.readByte(3),n.disarmReason=t.readByte(4),n.disarmReasonName=c[n.disarmReason]),t.protocolState=d,t.serialBuffer=[],t.lastFrameReceivedMs=new Date().getTime(),t.receiverIndex=0}else t.serialBuffer.push(S),t.receiverIndex++},e.read=function(S){for(var v=new Uint8Array(S.data),I=0;I<v.length;I++)t.push(v[I])},e.isReceiving=function(){return t.lastFrameReceivedMs!==null&&new Date().getTime()-t.lastFrameReceivedMs<i},e.wasEverReceiving=function(){return t.lastFrameReceivedMs!==null},e.get=function(){return n},e})(),groundstation=(function(){let n={},e={};return e.activated=!1,e.$viewport=null,e.$gsViewport=null,e.mapHandler=null,e.mapLayers=[],e.mapView=null,e.cursorStyle=null,e.cursorPosition=null,e.cursorFeature=null,e.cursorVector=null,e.cursorLayer=null,e.textGeometry=null,e.textFeature=null,e.textVector=null,e.textSource=null,e.mapInitiated=!1,n.isActivated=function(){return e.activated},n.activate=function(t){e.activated||(interval.add("gsUpdateGui",e.updateGui,200),e.$viewport=t,e.$viewport.find(".tab_container").hide(),e.$viewport.find("#content").hide(),e.$viewport.find("#status-bar").hide(),e.$viewport.find("#connectbutton a.connect_state").text(i18n.getMessage("disconnect")),e.$viewport.find("#connectbutton a.connect").addClass("active"),e.$gsViewport=t.find("#view-groundstation"),e.$gsViewport.show(),e.mapInitiated=!1,setTimeout(e.initMap,100),e.activated=!0,GUI.log(i18n.getMessage("gsActivated")))},e.initMap=function(){globalSettings.mapProviderType=="esri"?(e.mapLayers.push(new TileLayer({source:new XYZ({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attributions:"Source: Esri, Maxar, Earthstar Geographics, and the GIS User Community",maxZoom:19})})),e.mapLayers.push(new TileLayer({source:new XYZ({url:"https://services.arcgisonline.com/arcgis/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",maxZoom:19})})),e.mapLayers.push(new TileLayer({source:new XYZ({url:"https://services.arcgisonline.com/arcgis/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",maxZoom:19})}))):globalSettings.mapProviderType=="mapproxy"?e.mapLayers.push(new TileLayer({source:new oTileWMS({url:globalSettings.proxyURL,params:{LAYERS:globalSettings.proxyLayer}})})):e.mapLayers.push(new TileLayer({source:new OSM})),e.mapView=new View({center:fromLonLat([0,0]),zoom:3}),e.mapHandler=new Map$1({target:"groundstation-map",layers:e.mapLayers,view:e.mapView})},n.deactivate=function(){e.activated&&(interval.remove("gsUpdateGui"),e.$viewport!==null&&(e.$viewport.find(".tab_container").show(),e.$viewport.find("#content").show(),e.$viewport.find("#status-bar").show()),e.$gsViewport!==null&&e.$gsViewport.hide(),e.activated=!1,GUI.log(i18n.getMessage("gsDeactivated")))},e.updateGui=function(){let t=ltmDecoder.get();if(t.gpsFix&&t.gpsFix>1){let s=t.latitude/1e7,r=t.longitude/1e7;e.mapInitiated||(e.cursorStyle=new Style({image:new Icon({anchor:[.5,.5],opacity:1,scale:.6,src:path.join(__dirname,"./../images/icons/icon_mission_airplane.png")})}),e.cursorPosition=new Point(fromLonLat([r,s])),e.cursorFeature=new Feature({geometry:e.cursorPosition}),e.cursorFeature.setStyle(e.cursorStyle),e.cursorVector=new VectorSource({features:[e.cursorFeature]}),e.cursorLayer=new VectorLayer({source:e.cursorVector}),e.mapHandler.addLayer(e.cursorLayer),e.mapView.setZoom(17),e.mapInitiated=!0);let o=fromLonLat([r,s]);e.mapView.setCenter(o),e.cursorPosition.setCoordinates(o),e.cursorStyle.getImage().setRotation(t.heading/360*6.28318),e.$viewport.find("#gs-telemetry-latitude").html(s),e.$viewport.find("#gs-telemetry-longitude").html(r)}e.$viewport.find("#gs-telemetry-altitude").html((t.altitude/100).toFixed(2)+"m"),e.$viewport.find("#gs-telemetry-voltage").html((t.voltage/1e3).toFixed(2)+"V"),e.$viewport.find("#gs-telemetry-sats").html(t.gpsSats),e.$viewport.find("#gs-telemetry-speed").html(t.groundSpeed.toFixed(0)+"m/s");let i="";t.gpsFix==3?i="3D":t.gpsFix==2?i="2D":i="No fix",e.$viewport.find("#gs-telemetry-fix").html(i)},n})(),resquestDfuPermission=async function(){const n=bridge.bootloaderIds.map(e=>({vendorId:e.vendorId,productId:e.productId}));try{await navigator.usb.requestDevice({filters:n})}catch(e){console.log(e)}};var SerialBackend=(function(){var n={},e={};return e.isDemoRunning=!1,e.isWirelessMode=!1,n.init=function(){e.$port=$("#port"),e.$baud=$("#baud"),n.$portOverride=$("#port-override"),mspHelper$1.setSensorStatusEx(e.sensor_status_ex),$("#wireless-mode").on("change",function(){var t=$(this);t.is(":checked")?mspQueue.setLockMethod("hard"):mspQueue.setLockMethod("soft")}),GUI.handleReconnect=function(t){let i;BOARD.hasVcp(FC.CONFIG.boardIdentifier)?(i=new jBox("Modal",{width:400,height:120,animation:!1,closeOnClick:!1,closeOnEsc:!1,content:$("#modal-reconnect")}).open(),setTimeout(function(){$("a.connect").trigger("click")},100),setTimeout(function(){i.close(),$("a.connect").trigger("click"),t!=null&&setTimeout(function(){t.trigger("click")},500)},7e3)):timeout.add("waiting_for_bootup",function(){MSP.send_message(MSPCodes.MSPV2_INAV_STATUS,!1,!1,function(){GUI.log(i18n.getMessage("deviceReady")),TABS.configuration.initialize(!1,$("#content").scrollTop())})},1500)},GUI.updateManualPortVisibility=function(){var t=e.$port.find("option:selected");const i=t.data()||{};i.isManual||i.isTcp||i.isUdp?$("#port-override-option").show():$("#port-override-option").hide(),i.isTcp||i.isUdp?$("#port-override-label").text("IP:Port"):$("#port-override-label").text("Port"),i.isDFU||i.isBle||i.isTcp||i.isUdp||i.isSitl?e.$baud.hide():e.$baud.show(),i.isBle||i.isTcp||i.isUdp||i.isSitl?$(".tab_firmware_flasher").hide():$(".tab_firmware_flasher").show();var s=ConnectionType.Serial;i.isBle?s=ConnectionType.BLE:i.isTcp||i.isSitl?s=ConnectionType.TCP:i.isUdp&&(s=ConnectionType.UDP),CONFIGURATOR.connection=connectionFactory(s,CONFIGURATOR.connection)},GUI.updateManualPortVisibility(),n.$portOverride.on("change",function(){bridge.storeSet("portOverride",n.$portOverride.val())}),n.$portOverride.val(bridge.storeGet("portOverride","")),e.$port.on("change",function(t){if(bridge.isElectron)GUI.updateManualPortVisibility();else{const i=e.$port.find("option:selected");i.data().isWebPermission&&bridge.requestWebSerialPermission().then(()=>GUI.updateManualPortVisibility()),i.data().isDfuPermission&&resquestDfuPermission().then(()=>GUI.updateManualPortVisibility())}}),$("div.connect_controls a.connect").on("click",function(){if(groundstation.isActivated()&&groundstation.deactivate(),GUI.connect_lock!=!0){var t=$(this).data("clicks"),i=parseInt(e.$baud.val()),s=e.$port.find("option:selected").data().isManual?n.$portOverride.val():String(e.$port.val());if(s==="DFU")GUI.log(i18n.getMessage("dfu_connect_message"));else if(s!="0"){if(!t)console.log("Connecting to: "+s),GUI.connecting_to=s,$("#port, #baud, #delay").prop("disabled",!0),$("div.connect_controls a.connect_state").text(i18n.getMessage("connecting")),s=="tcp"||s=="udp"?CONFIGURATOR.connection.connect(n.$portOverride.val(),{},e.onOpen):s=="sitl"?CONFIGURATOR.connection.connect("127.0.0.1:5760",{},e.onOpen):s=="sitl-demo"?(SITLProcess.stop(),SITLProcess.start("demo.bin"),this.isDemoRunning=!0,setTimeout(()=>{CONFIGURATOR.connection.connect("127.0.0.1:5760",{},e.onOpen)},1e3)):CONFIGURATOR.connection.connect(s,{bitrate:i},e.onOpen);else{let o=function(){GUI.tab_switch_in_progress=!1,CONFIGURATOR.connectionValid=!1,GUI.connected_to=!1,GUI.allowedTabs=GUI.defaultAllowedTabsWhenDisconnected.slice(),mspQueue.flush(),mspQueue.freeHardLock(),mspQueue.freeSoftLock(),mspDeduplicationQueue.flush(),CONFIGURATOR.connection.disconnect(e.onClosed),MSP.disconnect_cleanup(),$("span.i2c-error").text(0),$("span.cycle-time").text(0),$("span.cpu-load").text(""),e.$port.prop("disabled",!1),e.$baud.prop("disabled",!1),$("div.connect_controls a.connect").removeClass("active"),$("div.connect_controls a.connect_state").text(i18n.getMessage("connect")),e.sensor_status(0),r&&$("#content").empty(),$("#tabs .tab_landing a").trigger("click")};this.isDemoRunning&&(SITLProcess.stop(),this.isDemoRunning=!1);var r=CONFIGURATOR.connectionValid;timeout.killAll(),interval.killAll(["global_data_refresh","msp-load-update"]),CONFIGURATOR.cliActive?GUI.tab_switch_cleanup(o):(GUI.tab_switch_cleanup(),o())}$(this).data("clicks",!t)}}}),PortHandler.initialize()},e.onValidFirmware=function(){MSP.send_message(MSPCodes.MSP_BUILD_INFO,!1,!1,function(){GUI.log(i18n.getMessage("buildInfoReceived",[FC.CONFIG.buildInfo])),MSP.send_message(MSPCodes.MSP_BOARD_INFO,!1,!1,function(){GUI.log(i18n.getMessage("boardInfoReceived",[FC.CONFIG.boardIdentifier,FC.CONFIG.boardVersion])),MSP.send_message(MSPCodes.MSP_UID,!1,!1,function(){GUI.log(i18n.getMessage("uniqueDeviceIdReceived",[FC.CONFIG.uid[0].toString(16)+FC.CONFIG.uid[1].toString(16)+FC.CONFIG.uid[2].toString(16)])),CONFIGURATOR.connectionValid=!0,GUI.allowedTabs=GUI.defaultAllowedTabsWhenConnected.slice(),e.onConnect(),defaultsDialog.init(),$("#tabs ul.mode-connected .tab_setup a").trigger("click"),GUI.updateEzTuneTabVisibility(!0),update.firmwareVersion()})})})},e.onInvalidFirmwareVariant=function(){GUI.log(i18n.getMessage("firmwareVariantNotSupported")),CONFIGURATOR.connectionValid=!0,GUI.allowedTabs=["cli"],e.onConnect(),$("#tabs .tab_cli a").trigger("click")},e.onInvalidFirmwareVersion=function(){GUI.log(i18n.getMessage("firmwareVersionNotSupported",[CONFIGURATOR.minfirmwareVersionAccepted,CONFIGURATOR.maxFirmwareVersionAccepted])),CONFIGURATOR.connectionValid=!0,GUI.allowedTabs=["cli"],e.onConnect(),$("#tabs .tab_cli a").trigger("click")},e.onBleNotSupported=function(){GUI.log(i18n.getMessage("connectionBleNotSupported")),CONFIGURATOR.connection.abort()},e.onOpen=function(t){if(FC.restartRequired){GUI_control.prototype.log("<span style='color: red; font-weight: bolder'><strong>"+i18n.getMessage("illegalStateRestartRequired")+"</strong></span>"),$("div.connect_controls a").trigger("click");return}if(t){GUI.connected_to=GUI.connecting_to,GUI.connecting_to=!1,GUI.log(i18n.getMessage("serialPortOpened",[t.connectionId]));var i=bridge.storeGet("last_used_port",!1);i?i!=GUI.connected_to&&bridge.storeSet("last_used_port",GUI.connected_to):bridge.storeSet("last_used_port",GUI.connected_to),bridge.storeSet("last_used_bps",CONFIGURATOR.connection.bitrate),bridge.storeSet("wireless_mode_enabled",$("#wireless-mode").is(":checked")),CONFIGURATOR.connection.addOnReceiveListener(n.read_serial),CONFIGURATOR.connection.addOnReceiveListener(ltmDecoder.read),timeout.add("connecting",function(){!CONFIGURATOR.connectionValid&&!ltmDecoder.isReceiving()&&(GUI.log(i18n.getMessage("noConfigurationReceived")),mspQueue.flush(),mspQueue.freeHardLock(),mspQueue.freeSoftLock(),mspDeduplicationQueue.flush(),CONFIGURATOR.connection.emptyOutputBuffer(),$("div.connect_controls a").click())},1e4),interval.add("ltm-connection-check",function(){ltmDecoder.isReceiving()&&groundstation.activate($("#main-wrapper"))},1e3),FC.resetState(),MSP.protocolVersion=MSP.constants.PROTOCOL_V2,MSP.send_message(MSPCodes.MSP_API_VERSION,!1,!1,function(){if(FC.CONFIG.apiVersion==="0.0.0"){GUI_control.prototype.log("<span style='color: red; font-weight: bolder'><strong>"+i18n.getMessage("illegalStateRestartRequired")+"</strong></span>"),FC.restartRequired=!0;return}GUI.log(i18n.getMessage("apiVersionReceived",[FC.CONFIG.apiVersion])),MSP.send_message(MSPCodes.MSP_FC_VARIANT,!1,!1,function(){FC.CONFIG.flightControllerIdentifier=="INAV"?MSP.send_message(MSPCodes.MSP_FC_VERSION,!1,!1,function(){GUI.log(i18n.getMessage("fcInfoReceived",[FC.CONFIG.flightControllerIdentifier,FC.CONFIG.flightControllerVersion])),semver.gte(FC.CONFIG.flightControllerVersion,CONFIGURATOR.minfirmwareVersionAccepted)&&semver.lt(FC.CONFIG.flightControllerVersion,CONFIGURATOR.maxFirmwareVersionAccepted)?CONFIGURATOR.connection.type==ConnectionType.BLE&&semver.lt(FC.CONFIG.flightControllerVersion,"5.0.0")?e.onBleNotSupported():mspHelper$1.getCraftName(function(r){r&&(FC.CONFIG.name=r),e.onValidFirmware()}):e.onInvalidFirmwareVersion()}):e.onInvalidFirmwareVariant()})})}else{console.log("Failed to open serial port"),GUI.log(i18n.getMessage("serialPortOpenFail"));var s=$("#connectbutton");s.find(".connect_state").text(i18n.getMessage("connect")),s.find(".connect").removeClass("active"),$("#port, #baud, #delay").prop("disabled",!1),s.find(".connect").data("clicks",!1)}},e.onConnect=function(){timeout.remove("connecting"),$("#connectbutton a.connect_state").text(i18n.getMessage("disconnect")).addClass("active"),$("#connectbutton a.connect").addClass("active"),$(".mode-disconnected").hide(),$(".mode-connected").show(),MSP.send_message(MSPCodes.MSP_BOXIDS,!1,!1,function(){FC.generateAuxConfig()}),MSP.send_message(MSPCodes.MSP_DATAFLASH_SUMMARY,!1,!1,function(){$("#sensor-status").show(),$("#portsinput").hide(),$("#dataflash_wrapper_global").show(),$("#profiles_wrapper_global").show();let t=11;for(let i=0;i<t;i++)FC.PIDs.push(new Array(4));interval.add("msp-load-update",function(){$("#msp-version").text("MSP version: "+MSP.protocolVersion.toFixed(0)),$("#msp-load").text("MSP load: "+mspQueue.getLoad().toFixed(1)),$("#msp-roundtrip").text("MSP round trip: "+mspQueue.getRoundtrip().toFixed(0)),$("#hardware-roundtrip").text("HW round trip: "+mspQueue.getHardwareRoundtrip().toFixed(0))},100),interval.add("global_data_refresh",periodicStatusUpdater.run,periodicStatusUpdater.getUpdateInterval(CONFIGURATOR.connection.bitrate),!1)})},e.onClosed=function(t){t?GUI.log(i18n.getMessage("serialPortClosedOk")):GUI.log(i18n.getMessage("serialPortClosedFail")),$(".mode-connected").hide(),$(".mode-disconnected").show(),$("#sensor-status").hide(),$("#portsinput").show(),$("#dataflash_wrapper_global").hide(),$("#profiles_wrapper_global").hide(),$("#quad-status_wrapper").hide()},n.read_serial=function(t){CONFIGURATOR.cliActive?CONFIGURATOR.cliActive&&TABS.cli.read(t):MSP.read(t)},e.sensor_status_ex=function(t){var i=e.sensor_status_hash(t);e.sensor_status_ex.previousHash!=i&&(e.sensor_status_ex.previousHash=i,e.sensor_status_update_icon(".gyro",".gyroicon",t.gyroHwStatus),e.sensor_status_update_icon(".accel",".accicon",t.accHwStatus),e.sensor_status_update_icon(".mag",".magicon",t.magHwStatus),e.sensor_status_update_icon(".baro",".baroicon",t.baroHwStatus),e.sensor_status_update_icon(".gps",".gpsicon",t.gpsHwStatus),e.sensor_status_update_icon(".sonar",".sonaricon",t.rangeHwStatus),e.sensor_status_update_icon(".airspeed",".airspeedicon",t.speedHwStatus),e.sensor_status_update_icon(".opflow",".opflowicon",t.flowHwStatus))},e.sensor_status_update_icon=function(t,i,s){var r=$("#sensor-status");s==0?($(t,r).removeClass("on"),$(i,r).removeClass("active"),$(i,r).removeClass("error")):s==1?($(t,r).addClass("on"),$(i,r).addClass("active"),$(i,r).removeClass("error")):($(t,r).removeClass("on"),$(i,r).removeClass("active"),$(i,r).addClass("error"))},e.sensor_status_hash=function(t){return"S"+t.isHardwareHealthy+t.gyroHwStatus+t.accHwStatus+t.magHwStatus+t.baroHwStatus+t.gpsHwStatus+t.rangeHwStatus+t.speedHwStatus+t.flowHwStatus},e.sensor_status=function(t){typeof SENSOR_STATUS>"u"||(SENSOR_STATUS.isHardwareHealthy=1,SENSOR_STATUS.gyroHwStatus=n.have_sensor(t,"gyro")?1:0,SENSOR_STATUS.accHwStatus=n.have_sensor(t,"acc")?1:0,SENSOR_STATUS.magHwStatus=n.have_sensor(t,"mag")?1:0,SENSOR_STATUS.baroHwStatus=n.have_sensor(t,"baro")?1:0,SENSOR_STATUS.gpsHwStatus=n.have_sensor(t,"gps")?1:0,SENSOR_STATUS.rangeHwStatus=n.have_sensor(t,"sonar")?1:0,SENSOR_STATUS.speedHwStatus=n.have_sensor(t,"airspeed")?1:0,SENSOR_STATUS.flowHwStatus=n.have_sensor(t,"opflow")?1:0,e.sensor_status_ex(SENSOR_STATUS))},n.have_sensor=function(t,i){switch(i){case"acc":case"gyro":return BitHelper.bit_check(t,0);case"baro":return BitHelper.bit_check(t,1);case"mag":return BitHelper.bit_check(t,2);case"gps":return BitHelper.bit_check(t,3);case"sonar":return BitHelper.bit_check(t,4);case"opflow":return BitHelper.bit_check(t,5);case"airspeed":return BitHelper.bit_check(t,6)}return!1},n})(),appUpdater=appUpdater||{};appUpdater.checkRelease=function(n){var e;$.get("https://api.github.com/repos/iNavFlight/inav-configurator/releases/latest",function(t){GUI.log(i18n.getMessage("loadedReleaseInfo"));let i=t.tag_name;t.prerelease==!1&&semver.gt(i,n)&&window.electronAPI.appGetVersion().then(r=>{GUI.log(i,r),GUI.log(n),GUI.log(i18n.getMessage("newVersionAvailable")),e=new jBox("Modal",{width:400,height:200,animation:!1,closeOnClick:!1,closeOnEsc:!0,content:$("#appUpdateNotification")}).open()})}),$("#update-notification-close").on("click",function(){e.close()}),$("#update-notification-download").on("click",function(){e.close()})};(function(n){if(typeof define=="function"&&define.amd)define(["jquery"],n);else if(typeof module=="object"&&module.exports){var e=require("jquery");module.exports=n(e)}else n($)})(function(n){/*!
 * jQuery.textcomplete
 *
 * Repository: https://github.com/yuku-t/jquery-textcomplete
 * License:    MIT (https://github.com/yuku-t/jquery-textcomplete/blob/master/LICENSE)
 * Author:     Yuku Takahashi
 */if(typeof n>"u")throw new Error("jQuery.textcomplete requires jQuery");return+(function(e){var t=function(s){console.warn&&console.warn(s)},i=1;e.fn.textcomplete=function(s,r){var o=Array.prototype.slice.call(arguments);return this.each(function(){var a=this,h=e(this),c=h.data("textComplete");if(c||(r||(r={}),r._oid=i++,c=new e.fn.textcomplete.Completer(this,r),h.data("textComplete",c)),typeof s=="string"){if(!c)return;o.shift(),c[s].apply(c,o),s==="destroy"&&h.removeData("textComplete")}else e.each(s,function(d){e.each(["header","footer","placement","maxCount"],function(f){d[f]&&(c.option[f]=d[f],t(f+"as a strategy param is deprecated. Use option."),delete d[f])})}),c.register(e.fn.textcomplete.Strategy.parse(s,{el:a,$el:h}))})}})(n),+(function(e){var t=function(a){var h,c;return function(){var d=Array.prototype.slice.call(arguments);if(h){c=d;return}h=!0;var f=this;d.unshift(function _(){if(c){var y=c;c=void 0,y.unshift(_),a.apply(f,y)}else h=!1}),a.apply(this,d)}},i=function(a){return Object.prototype.toString.call(a)==="[object String]"},s=0,r=[];function o(a,h){if(this.$el=e(a),this.id="textcomplete"+s++,this.strategies=[],this.views=[],this.option=e.extend({},o.defaults,h),!this.$el.is("input[type=text]")&&!this.$el.is("input[type=search]")&&!this.$el.is("textarea")&&!a.isContentEditable&&a.contentEditable!="true")throw new Error("textcomplete must be called on a Textarea or a ContentEditable.");if(a===a.ownerDocument.activeElement)this.initialize();else{var c=this;this.$el.one("focus."+this.id,function(){c.initialize()}),(!this.option.adapter||this.option.adapter=="CKEditor")&&typeof CKEDITOR<"u"&&this.$el.is("textarea")&&CKEDITOR.on("instanceReady",function(d){e.inArray(d.editor.id,r)==-1&&(r.push(d.editor.id),d.editor.on("focus",function(f){c.$el=e(d.editor.editable().$),c.option.adapter||(c.option.adapter=e.fn.textcomplete.CKEditor),c.option.ckeditor_instance=d.editor,c.initialize()}))})}}o.defaults={appendTo:"body",className:"",dropdownClassName:"dropdown-menu textcomplete-dropdown",maxCount:10,zIndex:"100",rightEdgeOffset:30},e.extend(o.prototype,{id:null,option:null,strategies:null,adapter:null,dropdown:null,$el:null,$iframe:null,initialize:function(){var a=this.$el.get(0);if(this.$el.prop("ownerDocument")!==document&&window.frames.length){for(var h=0;h<window.frames.length;h++)if(this.$el.prop("ownerDocument")===window.frames[h].document){this.$iframe=e(window.frames[h].frameElement);break}}this.dropdown=new e.fn.textcomplete.Dropdown(a,this,this.option);var c,d;this.option.adapter?c=this.option.adapter:(this.$el.is("textarea")||this.$el.is("input[type=text]")||this.$el.is("input[type=search]")?d=typeof a.selectionEnd=="number"?"Textarea":"IETextarea":d="ContentEditable",c=e.fn.textcomplete[d]),this.adapter=new c(a,this,this.option)},destroy:function(){this.$el.off("."+this.id),this.adapter&&this.adapter.destroy(),this.dropdown&&this.dropdown.destroy(),this.$el=this.adapter=this.dropdown=null},deactivate:function(){this.dropdown&&this.dropdown.deactivate()},trigger:function(a,h){this.dropdown||this.initialize(),a!=null||(a=this.adapter.getTextFromHeadToCaret());var c=this._extractSearchQuery(a);if(c.length){var d=c[1];if(h&&this._term===d&&d!=="")return;this._term=d,this._search.apply(this,c)}else this._term=null,this.dropdown.deactivate()},fire:function(a){var h=Array.prototype.slice.call(arguments,1);return this.$el.trigger(a,h),this},register:function(a){Array.prototype.push.apply(this.strategies,a)},select:function(a,h,c){this._term=null,this.adapter.select(a,h,c),this.fire("change").fire("textComplete:select",a,h),this.adapter.focus()},_clearAtNext:!0,_term:null,_extractSearchQuery:function(a){for(var h=0;h<this.strategies.length;h++){var c=this.strategies[h],d=c.context(a);if(d||d===""){var f=e.isFunction(c.match)?c.match(a):c.match;i(d)&&(a=d);var _=a.match(f);if(_)return[c,_[c.index],_]}}return[]},_search:t(function(a,h,c,d){var f=this;h.search(c,function(_,y){f.dropdown.shown||f.dropdown.activate(),f._clearAtNext&&(f.dropdown.clear(),f._clearAtNext=!1),f.dropdown.setPosition(f.adapter.getCaretPosition()),f.dropdown.render(f._zip(_,h,c)),y||(a(),f._clearAtNext=!0)},d)}),_zip:function(a,h,c){return e.map(a,function(d){return{value:d,strategy:h,term:c}})}}),e.fn.textcomplete.Completer=o})(n),+(function(e){var t=e(window),i=function(a,h){var c,d,f=h.strategy.idProperty;for(c=0;c<a.length;c++)if(d=a[c],d.strategy===h.strategy){if(f){if(d.value[f]===h.value[f])return!0}else if(d.value===h.value)return!0}return!1},s={};e(document).on("click",function(a){var h=a.originalEvent&&a.originalEvent.keepTextCompleteDropdown;e.each(s,function(c,d){c!==h&&d.deactivate()})});var r={SKIP_DEFAULT:0,KEY_UP:1,KEY_DOWN:2,KEY_ENTER:3,KEY_PAGEUP:4,KEY_PAGEDOWN:5,KEY_ESCAPE:6};function o(a,h,c){this.$el=o.createElement(c),this.completer=h,this.id=h.id+"dropdown",this._data=[],this.$inputEl=e(a),this.option=c,c.listPosition&&(this.setPosition=c.listPosition),c.height&&this.$el.height(c.height);var d=this;e.each(["maxCount","placement","footer","header","noResultsMessage","className"],function(f,_){c[_]!=null&&(d[_]=c[_])}),this._bindEvents(a),s[this.id]=this}e.extend(o,{createElement:function(a){var h=a.appendTo;h instanceof e||(h=e(h));var c=e("<ul></ul>").addClass(a.dropdownClassName).attr("id","textcomplete-dropdown-"+a._oid).css({display:"none",left:0,position:"absolute",zIndex:a.zIndex}).appendTo(h);return c}}),e.extend(o.prototype,{$el:null,$inputEl:null,completer:null,footer:null,header:null,id:null,maxCount:null,placement:"",shown:!1,data:[],className:"",destroy:function(){this.deactivate(),this.$el.off("."+this.id),this.$inputEl.off("."+this.id),this.clear(),this.$el.remove(),this.$el=this.$inputEl=this.completer=null,delete s[this.id]},render:function(a){var h=this._buildContents(a),c=e.map(a,function(f){return f.value});if(a.length){var d=a[0].strategy;d.id?this.$el.attr("data-strategy",d.id):this.$el.removeAttr("data-strategy"),this._renderHeader(c),this._renderFooter(c),h&&(this._renderContents(h),this._fitToBottom(),this._fitToRight(),this._activateIndexedItem()),this._setScroll()}else this.noResultsMessage?this._renderNoResultsMessage(c):this.shown&&this.deactivate()},setPosition:function(a){var h="absolute";return this.$inputEl.add(this.$inputEl.parents()).each(function(){if(e(this).css("position")==="absolute")return!1;if(e(this).css("position")==="fixed")return a.top-=t.scrollTop(),a.left-=t.scrollLeft(),h="fixed",!1}),this.$el.css(this._applyPlacement(a)),this.$el.css({position:h}),this},clear:function(){this.$el.html(""),this.data=[],this._index=0,this._$header=this._$footer=this._$noResultsMessage=null},activate:function(){return this.shown||(this.clear(),this.$el.show(),this.className&&this.$el.addClass(this.className),this.completer.fire("textComplete:show"),this.shown=!0),this},deactivate:function(){return this.shown&&(this.$el.hide(),this.className&&this.$el.removeClass(this.className),this.completer.fire("textComplete:hide"),this.shown=!1),this},isUp:function(a){return a.keyCode===38||a.ctrlKey&&a.keyCode===80},isDown:function(a){return a.keyCode===40||a.ctrlKey&&a.keyCode===78},isEnter:function(a){var h=a.ctrlKey||a.altKey||a.metaKey||a.shiftKey;return!h&&(a.keyCode===13||a.keyCode===9||this.option.completeOnSpace===!0&&a.keyCode===32)},isPageup:function(a){return a.keyCode===33},isPagedown:function(a){return a.keyCode===34},isEscape:function(a){return a.keyCode===27},_data:null,_index:null,_$header:null,_$noResultsMessage:null,_$footer:null,_bindEvents:function(){this.$el.on("mousedown."+this.id,".textcomplete-item",e.proxy(this._onClick,this)),this.$el.on("touchstart."+this.id,".textcomplete-item",e.proxy(this._onClick,this)),this.$el.on("mouseover."+this.id,".textcomplete-item",e.proxy(this._onMouseover,this)),this.$inputEl.on("keydown."+this.id,e.proxy(this._onKeydown,this))},_onClick:function(a){var h=e(a.target);a.preventDefault(),a.originalEvent.keepTextCompleteDropdown=this.id,h.hasClass("textcomplete-item")||(h=h.closest(".textcomplete-item"));var c=this.data[parseInt(h.data("index"),10)];this.completer.select(c.value,c.strategy,a);var d=this;setTimeout(function(){d.deactivate(),a.type==="touchstart"&&d.$inputEl.focus()},0)},_onMouseover:function(a){var h=e(a.target);a.preventDefault(),h.hasClass("textcomplete-item")||(h=h.closest(".textcomplete-item")),this._index=parseInt(h.data("index"),10),this._activateIndexedItem()},_onKeydown:function(a){if(this.shown){var h;switch(e.isFunction(this.option.onKeydown)&&(h=this.option.onKeydown(a,r)),h==null&&(h=this._defaultKeydown(a)),h){case r.KEY_UP:a.preventDefault(),this._up();break;case r.KEY_DOWN:a.preventDefault(),this._down();break;case r.KEY_ENTER:a.preventDefault(),this._enter(a);break;case r.KEY_PAGEUP:a.preventDefault(),this._pageup();break;case r.KEY_PAGEDOWN:a.preventDefault(),this._pagedown();break;case r.KEY_ESCAPE:a.preventDefault(),this.deactivate();break}}},_defaultKeydown:function(a){if(this.isUp(a))return r.KEY_UP;if(this.isDown(a))return r.KEY_DOWN;if(this.isEnter(a))return r.KEY_ENTER;if(this.isPageup(a))return r.KEY_PAGEUP;if(this.isPagedown(a))return r.KEY_PAGEDOWN;if(this.isEscape(a))return r.KEY_ESCAPE},_up:function(){this._index===0?this._index=this.data.length-1:this._index-=1,this._activateIndexedItem(),this._setScroll()},_down:function(){this._index===this.data.length-1?this._index=0:this._index+=1,this._activateIndexedItem(),this._setScroll()},_enter:function(a){var h=this.data[parseInt(this._getActiveElement().data("index"),10)];this.completer.select(h.value,h.strategy,a),this.deactivate()},_pageup:function(){var a=0,h=this._getActiveElement().position().top-this.$el.innerHeight();this.$el.children().each(function(c){if(e(this).position().top+e(this).outerHeight()>h)return a=c,!1}),this._index=a,this._activateIndexedItem(),this._setScroll()},_pagedown:function(){var a=this.data.length-1,h=this._getActiveElement().position().top+this.$el.innerHeight();this.$el.children().each(function(c){if(e(this).position().top>h)return a=c,!1}),this._index=a,this._activateIndexedItem(),this._setScroll()},_activateIndexedItem:function(){this.$el.find(".textcomplete-item.active").removeClass("active"),this._getActiveElement().addClass("active")},_getActiveElement:function(){return this.$el.children(".textcomplete-item:nth("+this._index+")")},_setScroll:function(){var a=this._getActiveElement(),h=a.position().top,c=a.outerHeight(),d=this.$el.innerHeight(),f=this.$el.scrollTop();this._index===0||this._index==this.data.length-1||h<0?this.$el.scrollTop(h+f):h+c>d&&this.$el.scrollTop(h+c+f-d)},_buildContents:function(a){var h,c,d,f="";for(c=0;c<a.length&&this.data.length!==this.maxCount;c++)h=a[c],!i(this.data,h)&&(d=this.data.length,this.data.push(h),f+='<li class="textcomplete-item" data-index="'+d+'"><a>',f+=h.strategy.template(h.value,h.term),f+="</a></li>");return f},_renderHeader:function(a){if(this.header){this._$header||(this._$header=e('<li class="textcomplete-header"></li>').prependTo(this.$el));var h=e.isFunction(this.header)?this.header(a):this.header;this._$header.html(h)}},_renderFooter:function(a){if(this.footer){this._$footer||(this._$footer=e('<li class="textcomplete-footer"></li>').appendTo(this.$el));var h=e.isFunction(this.footer)?this.footer(a):this.footer;this._$footer.html(h)}},_renderNoResultsMessage:function(a){if(this.noResultsMessage){this._$noResultsMessage||(this._$noResultsMessage=e('<li class="textcomplete-no-results-message"></li>').appendTo(this.$el));var h=e.isFunction(this.noResultsMessage)?this.noResultsMessage(a):this.noResultsMessage;this._$noResultsMessage.html(h)}},_renderContents:function(a){this._$footer?this._$footer.before(a):this.$el.append(a)},_fitToBottom:function(){var a=t.scrollTop()+t.height(),h=this.$el.height();this.$el.position().top+h>a&&(this.completer.$iframe||this.$el.offset({top:a-h}))},_fitToRight:function(){for(var a=this.option.rightEdgeOffset,h=this.$el.offset().left,c,d=this.$el.width(),f=t.width()-a;h+d>f&&(this.$el.offset({left:h-a}),c=this.$el.offset().left,!(c>=h));)h=c},_applyPlacement:function(a){return this.placement.indexOf("top")!==-1?a={top:"auto",bottom:this.$el.parent().height()-a.top+a.lineHeight,left:a.left}:(a.bottom="auto",delete a.lineHeight),this.placement.indexOf("absleft")!==-1?a.left=0:this.placement.indexOf("absright")!==-1&&(a.right=0,a.left="auto"),a}}),e.fn.textcomplete.Dropdown=o,e.extend(e.fn.textcomplete,r)})(n),+(function(e){var t=function(s){var r={};return function(o,a){r[o]?a(r[o]):s.call(this,o,function(h){r[o]=(r[o]||[]).concat(h),a.apply(null,arguments)})}};function i(s){e.extend(this,s),this.cache&&(this.search=t(this.search))}i.parse=function(s,r){return e.map(s,function(o){var a=new i(o);return a.el=r.el,a.$el=r.$el,a})},e.extend(i.prototype,{match:null,replace:null,search:null,id:null,cache:!1,context:function(){return!0},index:2,template:function(s){return s},idProperty:null}),e.fn.textcomplete.Strategy=i})(n),+(function(e){var t=Date.now||function(){return new Date().getTime()},i=function(r,o){var a,h,c,d,f,_=function(){var y=t()-d;y<o?a=setTimeout(_,o-y):(a=null,f=r.apply(c,h),c=h=null)};return function(){return c=this,h=arguments,d=t(),a||(a=setTimeout(_,o)),f}};function s(){}e.extend(s.prototype,{id:null,completer:null,el:null,$el:null,option:null,initialize:function(r,o,a){this.el=r,this.$el=e(r),this.id=o.id+this.constructor.name,this.completer=o,this.option=a,this.option.debounce&&(this._onKeyup=i(this._onKeyup,this.option.debounce)),this._bindEvents()},destroy:function(){this.$el.off("."+this.id),this.$el=this.el=this.completer=null},select:function(){throw new Error("Not implemented")},getCaretPosition:function(){var r=this._getCaretRelativePosition(),o=this.$el.offset(),a=this.option.appendTo;if(a){a instanceof e||(a=e(a));var h=a.offsetParent().offset();o.top-=h.top,o.left-=h.left}return r.top+=o.top,r.left+=o.left,r},focus:function(){this.$el.focus()},_bindEvents:function(){this.$el.on("keyup."+this.id,e.proxy(this._onKeyup,this))},_onKeyup:function(r){this._skipSearch(r)||this.completer.trigger(this.getTextFromHeadToCaret(),!0)},_skipSearch:function(r){switch(r.keyCode){case 9:case 13:case 16:case 17:case 18:case 33:case 34:case 40:case 38:case 27:return!0}if(r.ctrlKey)switch(r.keyCode){case 78:case 80:return!0}}}),e.fn.textcomplete.Adapter=s})(n),+(function(e){function t(i,s,r){this.initialize(i,s,r)}e.extend(t.prototype,e.fn.textcomplete.Adapter.prototype,{select:function(i,s,r){var o=this.getTextFromHeadToCaret(),a=this.el.value.substring(this.el.selectionEnd),h=s.replace(i,r),c;typeof h<"u"&&(e.isArray(h)&&(a=h[1]+a,h=h[0]),c=e.isFunction(s.match)?s.match(o):s.match,o=o.replace(c,h),this.$el.val(o+a),this.el.selectionStart=this.el.selectionEnd=o.length)},getTextFromHeadToCaret:function(){return this.el.value.substring(0,this.el.selectionEnd)},_getCaretRelativePosition:function(){var i=e.fn.textcomplete.getCaretCoordinates(this.el,this.el.selectionStart);return{top:i.top+this._calculateLineHeight()-this.$el.scrollTop(),left:i.left-this.$el.scrollLeft(),lineHeight:this._calculateLineHeight()}},_calculateLineHeight:function(){var i=parseInt(this.$el.css("line-height"),10);if(isNaN(i)){var s=this.el.parentNode,r=document.createElement(this.el.nodeName),o=this.el.style;r.setAttribute("style","margin:0px;padding:0px;font-family:"+o.fontFamily+";font-size:"+o.fontSize),r.innerHTML="test",s.appendChild(r),i=r.clientHeight,s.removeChild(r)}return i}}),e.fn.textcomplete.Textarea=t})(n),+(function(e){var t="å¶";function i(s,r,o){this.initialize(s,r,o),e("<span>"+t+"</span>").css({position:"absolute",top:-9999,left:-9999}).insertBefore(s)}e.extend(i.prototype,e.fn.textcomplete.Textarea.prototype,{select:function(s,r,o){var a=this.getTextFromHeadToCaret(),h=this.el.value.substring(a.length),c=r.replace(s,o),d;if(typeof c<"u"){e.isArray(c)&&(h=c[1]+h,c=c[0]),d=e.isFunction(r.match)?r.match(a):r.match,a=a.replace(d,c),this.$el.val(a+h),this.el.focus();var f=this.el.createTextRange();f.collapse(!0),f.moveEnd("character",a.length),f.moveStart("character",a.length),f.select()}},getTextFromHeadToCaret:function(){this.el.focus();var s=document.selection.createRange();s.moveStart("character",-this.el.value.length);var r=s.text.split(t);return r.length===1?r[0]:r[1]}}),e.fn.textcomplete.IETextarea=i})(n),+(function(e){function t(i,s,r){this.initialize(i,s,r)}e.extend(t.prototype,e.fn.textcomplete.Adapter.prototype,{select:function(i,s,r){var o=this.getTextFromHeadToCaret(),a=this.el.ownerDocument.getSelection(),h=a.getRangeAt(0),c=h.cloneRange();c.selectNodeContents(h.startContainer);var d=c.toString(),f=d.substring(h.startOffset),_=s.replace(i,r),y;if(typeof _<"u"){e.isArray(_)&&(f=_[1]+f,_=_[0]),y=e.isFunction(s.match)?s.match(o):s.match,o=o.replace(y,_).replace(/ $/,"&nbsp"),h.selectNodeContents(h.startContainer),h.deleteContents();var S=this.el.ownerDocument.createElement("div");S.innerHTML=o;var v=this.el.ownerDocument.createElement("div");v.innerHTML=f;for(var I=this.el.ownerDocument.createDocumentFragment(),A,B;A=S.firstChild;)B=I.appendChild(A);for(;A=v.firstChild;)I.appendChild(A);h.insertNode(I),h.setStartAfter(B),h.collapse(!0),a.removeAllRanges(),a.addRange(h)}},_getCaretRelativePosition:function(){var i=this.el.ownerDocument.getSelection().getRangeAt(0).cloneRange(),s=i.endContainer.parentNode,r=this.el.ownerDocument.createElement("span");i.insertNode(r),i.selectNodeContents(r),i.deleteContents(),setTimeout(function(){s.normalize()},0);var o=e(r),a=o.offset();if(a.left-=this.$el.offset().left,a.top+=o.height()-this.$el.offset().top,a.lineHeight=o.height(),this.completer.$iframe){var h=this.completer.$iframe.offset();a.top+=h.top,a.left+=h.left,a.top-=e(this.completer.$iframe[0].contentWindow.document).scrollTop()}return o.remove(),a},getTextFromHeadToCaret:function(){var i=this.el.ownerDocument.getSelection().getRangeAt(0),s=i.cloneRange();return s.selectNodeContents(i.startContainer),s.toString().substring(0,i.startOffset)}}),e.fn.textcomplete.ContentEditable=t})(n),+(function(e){function t(i,s,r){this.initialize(i,s,r)}e.extend(t.prototype,e.fn.textcomplete.ContentEditable.prototype,{_bindEvents:function(){var i=this;this.option.ckeditor_instance.on("key",function(s){var r=s.data;if(i._onKeyup(r),i.completer.dropdown.shown&&i._skipSearch(r))return!1},null,null,1),this.$el.on("keyup."+this.id,e.proxy(this._onKeyup,this))}}),e.fn.textcomplete.CKEditor=t})(n),(function(e){var t=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],i=typeof window<"u",s=i&&window.mozInnerScreenX!=null;function r(o,a,h){if(!i)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var c=h&&h.debug||!1;if(c){var d=document.querySelector("#input-textarea-caret-position-mirror-div");d&&d.parentNode.removeChild(d)}var f=document.createElement("div");f.id="input-textarea-caret-position-mirror-div",document.body.appendChild(f);var _=f.style,y=window.getComputedStyle?getComputedStyle(o):o.currentStyle;_.whiteSpace="pre-wrap",o.nodeName!=="INPUT"&&(_.wordWrap="break-word"),_.position="absolute",c||(_.visibility="hidden"),t.forEach(function(I){_[I]=y[I]}),s?o.scrollHeight>parseInt(y.height)&&(_.overflowY="scroll"):_.overflow="hidden",f.textContent=o.value.substring(0,a),o.nodeName==="INPUT"&&(f.textContent=f.textContent.replace(/\s/g,"Â "));var S=document.createElement("span");S.textContent=o.value.substring(a)||".",f.appendChild(S);var v={top:S.offsetTop+parseInt(y.borderTopWidth),left:S.offsetLeft+parseInt(y.borderLeftWidth)};return c?S.style.backgroundColor="#aaa":document.body.removeChild(f),v}e.fn.textcomplete.getCaretCoordinates=r})(n),n});const CliAutoComplete={configEnabled:!1,builder:{state:"reset",numFails:0}};CliAutoComplete.isEnabled=function(){return this.isBuilding()||this.configEnabled&&FC.CONFIG.flightControllerIdentifier==="INAV"&&this.builder.state!=="fail"};CliAutoComplete.isBuilding=function(){return this.builder.state!=="reset"&&this.builder.state!=="done"&&this.builder.state!=="fail"};CliAutoComplete.isOpen=function(){return $(".cli-textcomplete-dropdown").is(":visible")};CliAutoComplete.openLater=function(n){const e=this;setTimeout(function(){e.forceOpen=!!n,e.$textarea.textcomplete("trigger"),e.forceOpen=!1},0)};CliAutoComplete.setEnabled=function(n){this.configEnabled!==n&&(this.configEnabled=n,CONFIGURATOR.cliActive&&CONFIGURATOR.cliValid&&(this.isEnabled()?this.builderStart():!this.isEnabled()&&!this.isBuilding()&&this.cleanup()))};CliAutoComplete.initialize=function(n,e,t){this.$textarea=n,this.forceOpen=!1,this.sendLine=e,this.writeToOutput=t,this.cleanup()};CliAutoComplete.cleanup=function(){this.$textarea.textcomplete("destroy"),this.builder.state="reset",this.builder.numFails=0};CliAutoComplete._builderWatchdogTouch=function(){const n=this;this._builderWatchdogStop(),timeout.add("autocomplete_builder_watchdog",function(){n.builder.numFails?(n.builder.numFails++,n.builder.state="fail",n.writeToOutput("Failed!<br># "),$(n).trigger("build:stop")):(n.builder.state="reset",n.builderStart())},3e3)};CliAutoComplete._builderWatchdogStop=function(){timeout.remove("autocomplete_builder_watchdog")};CliAutoComplete.builderStart=function(){this.builder.state==="reset"&&(this.cache={commands:[],resources:[],resourcesCount:{},settings:[],settingsAcceptedValues:{},feature:[],beeper:["ALL"]},this.builder.commandSequence=["help","dump","get"],this.builder.currentSetting=null,this.builder.sentinel=`# ${Math.random()}`,this.builder.state="init",this.writeToOutput("<br># Building AutoComplete Cache ... "),this.sendLine(this.builder.sentinel),$(this).trigger("build:start"))};CliAutoComplete.builderParseLine=function(n){const e=this.cache,t=this.builder;if(this._builderWatchdogTouch(),n.indexOf(t.sentinel)!==-1){const i=t.commandSequence.shift();i&&this.configEnabled?(t.state=`parse-${i}`,this.sendLine(i),this.sendLine(t.sentinel)):(this._builderWatchdogStop(),this.configEnabled?(e.settings.sort(),e.commands.sort(),e.feature.sort(),e.beeper.sort(),e.resources=Object.keys(e.resourcesCount).sort(),this._initTextcomplete(),this.writeToOutput("Done!<br># "),t.state="done"):(this.writeToOutput("Cancelled!<br># "),this.cleanup()),$(this).trigger("build:stop"))}else switch(t.state){case"parse-help":const i=n.match(/^(\w+)/);i&&e.commands.push(i[1]);break;case"parse-dump":const s=n.match(/^resource\s+(\w+)/i);if(s){const o=s[1].toUpperCase();e.resourcesCount[o]=(e.resourcesCount[o]||0)+1}else{const o=n.match(/^(feature|beeper)\s+-?(\w+)/i);o&&e[o[1].toLowerCase()].push(o[2])}break;case"parse-get":const r=n.match(/^(\w+)\s*=/);if(r)e.settings.push(r[1]),t.currentSetting=r[1].toLowerCase();else{const o=n.match(/^(.*): (.*)/);o!==null&&t.currentSetting&&(o[1].match(/values/i)?e.settingsAcceptedValues[t.currentSetting]=o[2].split(/\s*,\s*/).sort():o[1].match(/range|length/i)&&(e.settingsAcceptedValues[t.currentSetting]=o[0]))}break}};CliAutoComplete._initTextcomplete=function(){let n=!1;const e=this,t=this.$textarea,i=e.cache;let s=null;const r=function(S){return function(v,I){const A=S?"":"^",B=v.replace(new RegExp(`${A}(${I})`,"gi"),"<b>$1</b>");return I?B:v}},o=r(!0),a=r(!1),h=function(S,v,I,A,B){const G=[];if(A!==!1&&S.length>=A||e.forceOpen||e.isOpen()){S=S.toLowerCase();for(let k=0;k<I.length;k++){const z=I[k].toLowerCase();(B&&z.startsWith(S)||!B&&z.indexOf(S)!==-1)&&G.push(I[k])}}v(G),e.forceOpen&&G.length===1&&t.trigger($.Event("keydown",{keyCode:9}))},c=function(S){const v=t.val();return!!(v.length===S.length||v[S.length].match(/\s/))},d=function(S){return`$1${S} `};t.textcomplete([],{maxCount:1e4,debounce:0,className:"cli-textcomplete-dropdown",placement:"top",onKeydown:function(S){S.which===13&&setTimeout(function(){n&&t.trigger($.Event("keypress",{which:13}))},0)}}).on("textComplete:show",function(){const S=$(".textcomplete-dropdown");if(!s){try{s=$._data(S[0],"events").mouseover[0].handler}catch(v){console.log(v)}s&&S.off("mouseover").off("mousemove").on("mousemove",".textcomplete-item",function(v){$(this).parent().off("mousemove").on("mouseover",".textcomplete-item",s),s(v)})}});const f=function(S){return $.extend({template:o,replace:d,context:c,index:2},S)};t.textcomplete("register",[f({match:/^(\s*)(\w*)$/,search:function(S,v){n=!1,h(S,v,i.commands,!1,!0)},template:a}),f({match:/^(\s*get\s+)(\w*)$/i,search:function(S,v){n=!0,h(S,function(I){S.length>0&&I.length>1&&(I=[S].concat(I)),v(I)},i.settings,3)}}),f({match:/^(\s*set\s+)(\w*)$/i,search:function(S,v){n=!1,h(S,v,i.settings,3)}}),f({match:/^(\s*set\s+\w*\s*)$/i,search:function(S,v){n=!1,h("",v,["="],!1)},replace:function(S){return e.openLater(),d(S)}}),f({match:/^(\s*set\s+(\w+))\s*=\s*(.*)$/i,search:function(S,v,I){const A=[],B=I[2].toLowerCase();if(this.isSettingValueArray=!1,this.value=I[3],n=!!S,B in i.settingsAcceptedValues){const G=i.settingsAcceptedValues[B];if(Array.isArray(G)){this.isSettingValueArray=!0,n=!0,h(S,v,G,0);return}A.push(G)}v(A)},replace:function(S){return this.isSettingValueArray||(S=this.value),`$1 = ${S}`},index:3,isSettingValueArray:!1}),f({match:/^(\s*resource\s+)(\w*)$/i,search:function(S,v){n=!1;let I=i.resources;I=["show"].concat(I),h(S,v,I,1)},replace:function(S){return S in i.resourcesCount?e.openLater():(S==="list"||S==="show")&&(n=!0),d(S)}}),f({match:/^(\s*resource\s+(\w+)\s+)(\d*)$/i,search:function(S,v,I){n=!1,this.savedTerm=S,v([`&lt;1-${i.resourcesCount[I[2].toUpperCase()]}&gt;`])},replace:function(){if(this.savedTerm)return e.openLater(),"$1$3 "},context:function(S){const v=S.match(/^\s*resource\s+(\w+)\s/i);return v&&(i.resourcesCount[v[1].toUpperCase()]||0)>1?c(S):!1},index:3,savedTerm:null}),f({match:/^(\s*resource\s+\w+\s+(\d*\s+)?)(\w*)$/i,search:function(S,v){n=!!S,S?"none".startsWith(S)?v(["none"]):v(["&lt;pin&gt;"]):v(["&lt;pin&gt","none"])},template:function(S,v){return S==="none"?a(S,v):S},replace:function(S){if(S==="none")return n=!0,"$1none "},context:function(S){const v=S.match(/^\s*resource\s+(\w+)\s+(\d+\s)?/i);if(v){const I=i.resourcesCount[v[1].toUpperCase()]||0;if(I&&(v[2]||I===1))return c(S)}return!1},index:3}),f({match:/^(\s*(feature|beeper)\s+(-?))(\w*)$/i,search:function(S,v,I){n=!!S;let A=i[I[2].toLowerCase()];I[3]||(A=["-","list"].concat(A)),h(S,v,A,1)},replace:function(S){return S==="-"?(e.openLater(!0),"$1-"):d(S)},index:4})]),t.textcomplete("register",[f({match:/^(\s*resource\s+show\s+)(\w*)$/i,search:function(S,v){n=!0,h(S,v,["all"],1,!0)},template:a})]);const _=["master","profile","rates","all"],y=[];y.push("defaults"),_.push("hardware"),y.push("bare"),_.sort(),y.sort(),t.textcomplete("register",[f({match:/^(\s*diff\s+)(\w*)$/i,search:function(S,v){n=!0,h(S,v,_,1,!0)},template:a}),f({match:/^(\s*diff\s+\w+\s+)(\w*)$/i,search:function(S,v){n=!0,h(S,v,y,1,!0)},template:a})])};window.$=$;$(function(){i18n.init(()=>{i18n.localize(),bridge.init(),MSP.init(),mspHelper$1.init(),SerialBackend.init(),GUI.updateEzTuneTabVisibility=function(h){let c=!0;return CONFIGURATOR.connectionValid&&(h?mspHelper$1.loadMixerConfig(function(){FC.MIXER_CONFIG.platformType==PLATFORM.MULTIROTOR||FC.MIXER_CONFIG.platformType==PLATFORM.TRICOPTER?$(".tab_ez_tune").removeClass("is-hidden"):($(".tab_ez_tune").addClass("is-hidden"),c=!1)}):FC.MIXER_CONFIG.platformType==PLATFORM.MULTIROTOR||FC.MIXER_CONFIG.platformType==PLATFORM.TRICOPTER?$(".tab_ez_tune").removeClass("is-hidden"):($(".tab_ez_tune").addClass("is-hidden"),c=!1)),c},GUI.updateActivatedTab=function(){var h=$("#tabs > ul li.active");h.removeClass("active"),$("a",h).trigger("click")},globalSettings.unitType=bridge.storeGet("unit_type",UnitType.none),globalSettings.mapProviderType=bridge.storeGet("map_provider_type","osm"),globalSettings.assistnowApiKey=bridge.storeGet("assistnow_api_key",""),globalSettings.proxyURL=bridge.storeGet("proxyurl","http://192.168.1.222/mapproxy/service?"),globalSettings.proxyLayer=bridge.storeGet("proxylayer","your_proxy_layer_name"),globalSettings.showProfileParameters=bridge.storeGet("show_profile_parameters",1),globalSettings.assistnowOfflineData=bridge.storeGet("assistnow_offline_data",[]),globalSettings.assistnowOfflineDate=bridge.storeGet("assistnow_offline_date",0),updateProfilesHighlightColours();var n=bridge.storeGet("cli_autocomplete",!0);globalSettings.cliAutocomplete=n,CliAutoComplete.setEnabled(n),CONFIGURATOR.connectionValid||(globalSettings.osdUnits=null);const e=bridge.getAppVersion(),t=bridge.isElectron?"Electron: <strong>"+navigator.userAgent.match(/Electron\/([\d\.]+\d+)/)[1]+"</strong>, ":"Chrome: <strong>"+navigator.userAgent.match(/Chrome\/([0-9.]*)/)[1]+"</strong>, ";GUI.log(i18n.getMessage("getRunningOS")+GUI.operating_system+"</strong>, "+t+i18n.getMessage("getConfiguratorVersion")+e+"</strong>"),$("#status-bar .version").text(e),$("#logo .version").text(e),update.firmwareVersion(),bridge.storeGet("logopen",!1)&&$("#showlog").trigger("click"),bridge.storeGet("update_notify",!0)&&appUpdater.checkRelease(e),bridge.isElectron||$(".tab_sitl").hide(),console.log("Libraries: jQuery - "+$.fn.jquery+", three.js - "+REVISION);var i=$("#tabs > ul");$("a",i).on("click",function(){if(!$(this).parent().hasClass("tab_help")&&$(this).parent().hasClass("active")==!1&&!GUI.tab_switch_in_progress){var h=this,c=$(h).parent().prop("class"),d=$(h).parent().hasClass("mode-connected"),f=c.substring(4),_=$(h).text();if(d&&!CONFIGURATOR.connectionValid){GUI.log(i18n.getMessage("tabSwitchConnectionRequired"));return}if(GUI.connect_lock){GUI.log(i18n.getMessage("tabSwitchWaitForOperation"));return}if(GUI.allowedTabs.indexOf(f)<0){GUI.log(i18n.getMessage("tabSwitchUpgradeRequired",[_]));return}GUI.tab_switch_in_progress=!0,GUI.tab_switch_cleanup(function(){$("li",i).removeClass("active"),$(h).parent().addClass("active");var y=$("#content");y.data("empty",!!y.is(":empty")),y.empty(),$("#cache .data-loading").clone().appendTo(y);function S(){GUI.tab_switch_in_progress=!1,updateProfilesHighlightColours()}switch(f){case"landing":__vitePreload(()=>import("./landing-Bdc5MRDT.js"),[],import.meta.url).then(()=>TABS.landing.initialize(S));break;case"firmware_flasher":__vitePreload(()=>import("./firmware_flasher-DpJR31Vt.js"),__vite__mapDeps([0,1]),import.meta.url).then(()=>TABS.firmware_flasher.initialize(S));break;case"sitl":__vitePreload(()=>import("./sitl-B0iKDKwy.js"),__vite__mapDeps([2,1,3]),import.meta.url).then(()=>TABS.sitl.initialize(S));break;case"auxiliary":__vitePreload(()=>import("./auxiliary-D5bZf6Sm.js"),__vite__mapDeps([4,5,6]),import.meta.url).then(()=>TABS.auxiliary.initialize(S));break;case"adjustments":__vitePreload(()=>import("./adjustments-C_IpigJL.js"),__vite__mapDeps([7,5,6]),import.meta.url).then(()=>TABS.adjustments.initialize(S));break;case"ports":__vitePreload(()=>import("./ports-BCvM6Y27.js"),[],import.meta.url).then(()=>TABS.ports.initialize(S));break;case"led_strip":__vitePreload(()=>import("./led_strip-C_TZC1eX.js"),[],import.meta.url).then(()=>TABS.led_strip.initialize(S));break;case"failsafe":__vitePreload(()=>import("./failsafe-C2zY5veH.js"),[],import.meta.url).then(()=>TABS.failsafe.initialize(S));break;case"setup":__vitePreload(()=>import("./setup-BmKLen32.js"),__vite__mapDeps([8,9,1]),import.meta.url).then(()=>TABS.setup.initialize(S));break;case"calibration":__vitePreload(()=>import("./calibration-DYHP_ROc.js"),[],import.meta.url).then(()=>TABS.calibration.initialize(S));break;case"configuration":__vitePreload(()=>import("./configuration-Cab0Ho4x.js"),[],import.meta.url).then(()=>TABS.configuration.initialize(S));break;case"pid_tuning":__vitePreload(()=>import("./pid_tuning-4BX57_Ar.js"),__vite__mapDeps([10,11,1]),import.meta.url).then(()=>TABS.pid_tuning.initialize(S));break;case"receiver":__vitePreload(()=>import("./receiver-BrHJepIG.js"),[],import.meta.url).then(()=>TABS.receiver.initialize(S));break;case"gps":__vitePreload(()=>import("./gps-fNy5jIKg.js"),__vite__mapDeps([12,13,1]),import.meta.url).then(()=>TABS.gps.initialize(S));break;case"magnetometer":__vitePreload(()=>import("./magnetometer-CB5SfWPU.js"),__vite__mapDeps([14,9,6]),import.meta.url).then(()=>TABS.magnetometer.initialize(S));break;case"mission_control":__vitePreload(()=>import("./mission_control-BRxfrk6N.js"),__vite__mapDeps([15,13,1]),import.meta.url).then(()=>TABS.mission_control.initialize(S));break;case"mixer":__vitePreload(()=>import("./mixer-QoMR9wb_.js"),[],import.meta.url).then(()=>TABS.mixer.initialize(S));break;case"outputs":__vitePreload(()=>import("./outputs-B-_PEgUr.js"),[],import.meta.url).then(()=>TABS.outputs.initialize(S));break;case"osd":__vitePreload(()=>import("./osd-CknEX7tZ.js"),__vite__mapDeps([16,1]),import.meta.url).then(()=>TABS.osd.initialize(S));break;case"sensors":__vitePreload(()=>import("./sensors-CL39U9Xk.js"),[],import.meta.url).then(()=>TABS.sensors.initialize(S));break;case"logging":__vitePreload(()=>import("./logging-qU-GVW9R.js"),__vite__mapDeps([17,1]),import.meta.url).then(()=>TABS.logging.initialize(S));break;case"onboard_logging":__vitePreload(()=>import("./onboard_logging-OsoR550g.js"),[],import.meta.url).then(()=>TABS.onboard_logging.initialize(S));break;case"advanced_tuning":__vitePreload(()=>import("./advanced_tuning-sluEtsPe.js"),[],import.meta.url).then(()=>TABS.advanced_tuning.initialize(S));break;case"programming":__vitePreload(()=>import("./programming-BhXGSUCc.js"),__vite__mapDeps([18,11]),import.meta.url).then(()=>TABS.programming.initialize(S));break;case"cli":__vitePreload(()=>import("./cli-BfhwZP_O.js"),__vite__mapDeps([19,1]),import.meta.url).then(()=>TABS.cli.initialize(S));break;case"search":require("./../tabs/search"),TABS.search.initialize(S);break;default:console.log("Tab not found:"+f)}})}}),$("#tabs ul.mode-disconnected li a:first").trigger("click"),$("#options").on("click",function(){var h=$(this);function c(){$("div#options-window").slideUp(250,function(){h.removeClass("active"),$(this).empty().remove()})}h.hasClass("active")?c():(h.addClass("active"),h.after('<div id="options-window"></div>'),__vitePreload(async()=>{const{default:d}=await import("./options-BkBdk79a.js");return{default:d}},[],import.meta.url).then(({default:d})=>{$("div#options-window").html(d),i18n.localize(),bridge.isElectron||$("#resetSitl").hide(),bridge.storeGet("update_notify",!0)&&$("div.notifications input").prop("checked",!0),$("div.notifications input").on("change",function(){var f=$(this).is(":checked");bridge.storeSet("update_notify",f)}),$("div.statistics input").on("change",function(){$(this).is(":checked")}),$("div.show_profile_parameters input").on("change",function(){globalSettings.showProfileParameters=$(this).is(":checked"),bridge.storeSet("show_profile_parameters",globalSettings.showProfileParameters),updateProfilesHighlightColours();const f=$("#tabs li.active");f.removeClass("active"),f.find("a").trigger("click")}),$("div.cli_autocomplete input").on("change",function(){globalSettings.cliAutocomplete=$(this).is(":checked"),bridge.storeSet("cli_autocomplete",globalSettings.cliAutocomplete),CliAutoComplete.setEnabled($(this).is(":checked"))}),$("#ui-unit-type").val(globalSettings.unitType),$("#map-provider-type").val(globalSettings.mapProviderType),$("#proxyurl").val(globalSettings.proxyURL),$("#proxylayer").val(globalSettings.proxyLayer),$("#showProfileParameters").prop("checked",globalSettings.showProfileParameters),$("#cliAutocomplete").prop("checked",globalSettings.cliAutocomplete),$("#assistnow-api-key").val(globalSettings.assistnowApiKey),i18n.getLanguages().forEach(f=>{$("#languageOption").append("<option value='{0}'>{1}</option>".format(f,i18n.getMessage("language_"+f)))}),$("#languageOption").val(i18n.getCurrentLanguage()),$("#languageOption").on("change",()=>{i18n.changeLanguage($("#languageOption").val())}),$("#ui-unit-type").on("change",function(){bridge.storeSet("unit_type",$(this).val()),globalSettings.unitType=$(this).val(),globalSettings.unitType===UnitType.OSD&&get_osd_settings();const f=$("#tabs li.active");f.removeClass("active"),f.find("a").trigger("click")}),$("#map-provider-type").on("change",function(){bridge.storeSet("map_provider_type",$(this).val()),globalSettings.mapProviderType=$(this).val()}),$("#proxyurl").on("change",function(){bridge.storeSet("proxyurl",$(this).val()),globalSettings.proxyURL=$(this).val()}),$("#proxylayer").on("change",function(){bridge.storeSet("proxylayer",$(this).val()),globalSettings.proxyLayer=$(this).val()}),$("#assistnow-api-key").on("change",function(){bridge.storeSet("assistnow_api_key",$(this).val()),globalSettings.assistnowApiKey=$(this).val()}),$("#demoModeReset").on("click",function(){SITLProcess.deleteEepromFile("demo.bin")}),$("#maintenanceFlushSettingsCache").on("click",function(){settingsCache.flush()}),$("#optionsClose").on("click",()=>{$("#options").hasClass("active")&&c()}),$("div#options-window").slideDown(250)}))});var s=$("#content");s.on("focus",'input[type="number"]',function(){var h=$(this),c=h.val();isNaN(c)||h.data("previousValue",parseFloat(c))}),s.on("keydown",'input[type="number"]',function(h){var c=[96,97,98,99,100,101,102,103,104,105,48,49,50,51,52,53,54,55,56,57,109,189,8,46,9,190,110,37,38,39,40,13];c.indexOf(h.keyCode)==-1&&h.preventDefault()}),s.on("change",'input[type="number"]',function(){var h=$(this),c=parseFloat(h.prop("min")),d=parseFloat(h.prop("max")),f=parseFloat(h.prop("step")),_=parseFloat(h.val()),y;h.prop("min")&&_<c&&(h.val(c),_=c),h.prop("max")&&_>d&&(h.val(d),_=d),isNaN(_)&&(h.val(h.data("previousValue")),_=h.data("previousValue")),(isNaN(f)||f%1===0)&&_%1!==0&&(h.val(h.data("previousValue")),_=h.data("previousValue")),!isNaN(f)&&f%1!==0&&(y=String(f).split(".")[1].length,(_%1===0||String(_).split(".")[1].length!=y)&&h.val(_.toFixed(y)))}),$("#showlog").on("click",function(){var h=$(this).data("state"),c=$("#log");h?(c.animate({height:27},200,function(){var d=$("div#log");d.scrollTop($("div.wrapper",d).height())}),c.removeClass("active"),$("#content").removeClass("logopen"),$(".tab_container").removeClass("logopen"),$("#scrollicon").removeClass("active"),bridge.storeSet("logopen",!1),h=!1):(c.animate({height:111},200),c.addClass("active"),$("#content").addClass("logopen"),$(".tab_container").addClass("logopen"),$("#scrollicon").addClass("active"),bridge.storeSet("logopen",!0),h=!0),$(this).html(h?i18n.getMessage("mainHideLog"):i18n.getMessage("mainShowLog")),$(this).data("state",h)});var r=$("#mixerprofilechange");r.on("change",function(){var h=parseInt($(this).val());MSP.send_message(MSPCodes.MSP2_INAV_SELECT_MIXER_PROFILE,[h],!1,function(){GUI.log(i18n.getMessage("setMixerProfile",[h+1])),MSP.send_message(MSPCodes.MSP_SET_REBOOT,!1,!1,function(){GUI.log(i18n.getMessage("deviceRebooting")),GUI.handleReconnect()})})});var o=$("#profilechange");o.on("change",function(){var h=parseInt($(this).val());MSP.send_message(MSPCodes.MSP_SELECT_SETTING,[h],!1,function(){GUI.log(i18n.getMessage("setControlProfile",[h+1]))})});var a=$("#batteryprofilechange");a.on("change",function(){var h=parseInt($(this).val());MSP.send_message(MSPCodes.MSP2_INAV_SELECT_BATTERY_PROFILE,[h],!1,function(){GUI.log(i18n.getMessage("setBatteryProfile",[h+1]))})})})});function get_osd_settings(){globalSettings.osdUnits!==void 0&&globalSettings.osdUnits!==null||MSP.promise(MSPCodes.MSP2_INAV_OSD_PREFERENCES).then(function(n){var e=n.data;e.readU8(),e.readU8(),e.readU8(),e.readU8(),e.readU8(),e.readU8(),e.readU8(),globalSettings.osdUnits=e.readU8()})}function updateProfilesHighlightColours(){globalSettings.showProfileParameters?($(".dropdown-dark #profilechange").addClass("showProfileParams"),$(".dropdown-dark #batteryprofilechange").addClass("showProfileParams"),$(".batteryProfileHighlight").each(function(){$(this).addClass("batteryProfileHighlightActive"),$(this).removeClass("batteryProfileHighlight")}),$(".controlProfileHighlight").each(function(){$(this).addClass("controlProfileHighlightActive"),$(this).removeClass("controlProfileHighlight")})):($(".dropdown-dark #profilechange").removeClass("showProfileParams"),$(".dropdown-dark #batteryprofilechange").removeClass("showProfileParams"),$(".batteryProfileHighlightActive").each(function(){$(this).addClass("batteryProfileHighlight"),$(this).removeClass("batteryProfileHighlightActive")}),$(".controlProfileHighlightActive").each(function(){$(this).addClass("controlProfileHighlight"),$(this).removeClass("controlProfileHighlightActive")}))}Number.prototype.clamp=function(n,e){return Math.min(Math.max(this,n),e)};String.prototype.format=function(){var n=arguments;return this.replace(/\{(\d+)\}/g,function(e,t){return n[t]!==void 0?n[t]:"{"+(t-n.length)+"}"})};export{$,AmbientLight as A,BitHelper as B,CONFIGURATOR as C,DirectionalLight as D,View as E,FC as F,GUI as G,TileLayer as H,OSM as I,fromLonLat as J,Map$1 as K,LoadingManager as L,MSP as M,Style as N,Object3D as O,PortHandler as P,Icon as Q,Point as R,SerialBackend as S,TABS as T,Feature as U,VTX as V,VectorSource as W,XYZ as X,VectorLayer as Y,Text as Z,__vitePreload as _,ConnectionSerial as a,RepeatWrapping as a$,Fill as a0,Controls as a1,Vector3$1 as a2,MOUSE as a3,TOUCH as a4,Quaternion$1 as a5,Spherical as a6,Vector2$1 as a7,Ray as a8,Plane as a9,DepthFormat as aA,UnsignedInt248Type as aB,UnsignedIntType as aC,DepthTexture as aD,RAD2DEG$1 as aE,NoColorSpace$1 as aF,LessEqualDepth as aG,ReverseSubtractEquation as aH,SubtractEquation as aI,AddEquation as aJ,OneMinusConstantAlphaFactor as aK,ConstantAlphaFactor as aL,OneMinusConstantColorFactor as aM,ConstantColorFactor as aN,OneMinusDstAlphaFactor as aO,OneMinusDstColorFactor as aP,OneMinusSrcAlphaFactor as aQ,OneMinusSrcColorFactor as aR,DstAlphaFactor as aS,DstColorFactor as aT,SrcAlphaSaturateFactor as aU,SrcAlphaFactor as aV,SrcColorFactor as aW,OneFactor as aX,ZeroFactor as aY,MirroredRepeatWrapping as aZ,ClampToEdgeWrapping as a_,MathUtils$1 as aa,Euler as ab,Matrix4$1 as ac,createCanvasElement as ad,NoToneMapping$1 as ae,SRGBColorSpace$1 as af,REVISION as ag,Vector4$1 as ah,warnOnce$1 as ai,Frustum as aj,WebGLCoordinateSystem$1 as ak,WebGLRenderTarget as al,ColorManagement$1 as am,LinearMipmapLinearFilter as an,HalfFloatType as ao,UnsignedByteType as ap,DoubleSide as aq,BackSide as ar,FrontSide as as,LinearSRGBColorSpace$1 as at,probeAsync as au,EventDispatcher$1 as av,ArrayCamera as aw,WebXRController as ax,RGBAFormat as ay,DepthStencilFormat as az,interval as b,RGBA_ASTC_10x6_Format as b$,LinearMipmapNearestFilter as b0,LinearFilter as b1,NearestMipmapLinearFilter as b2,NearestMipmapNearestFilter as b3,NearestFilter as b4,NotEqualCompare as b5,GreaterCompare as b6,GreaterEqualCompare as b7,EqualCompare as b8,LessEqualCompare as b9,RGBFormat as bA,RedFormat as bB,RedIntegerFormat as bC,RGFormat as bD,RGIntegerFormat as bE,RGBAIntegerFormat as bF,RGB_S3TC_DXT1_Format as bG,RGBA_S3TC_DXT1_Format as bH,RGBA_S3TC_DXT3_Format as bI,RGBA_S3TC_DXT5_Format as bJ,SRGBTransfer$1 as bK,RGB_PVRTC_4BPPV1_Format as bL,RGB_PVRTC_2BPPV1_Format as bM,RGBA_PVRTC_4BPPV1_Format as bN,RGBA_PVRTC_2BPPV1_Format as bO,RGB_ETC1_Format as bP,RGB_ETC2_Format as bQ,RGBA_ETC2_EAC_Format as bR,RGBA_ASTC_4x4_Format as bS,RGBA_ASTC_5x4_Format as bT,RGBA_ASTC_5x5_Format as bU,RGBA_ASTC_6x5_Format as bV,RGBA_ASTC_6x6_Format as bW,RGBA_ASTC_8x5_Format as bX,RGBA_ASTC_8x6_Format as bY,RGBA_ASTC_8x8_Format as bZ,RGBA_ASTC_10x5_Format as b_,LessCompare as ba,AlwaysCompare as bb,NeverCompare as bc,Matrix3$1 as bd,MeshDepthMaterial as be,RGBADepthPacking as bf,MeshDistanceMaterial as bg,ShaderMaterial as bh,BufferGeometry as bi,BufferAttribute$1 as bj,Mesh as bk,PCFShadowMap as bl,NoBlending as bm,VSMShadowMap as bn,UnsignedShortType as bo,UnsignedShort4444Type as bp,UnsignedShort5551Type as bq,ExternalTexture as br,PlaneGeometry as bs,UnsignedInt5999Type as bt,UnsignedInt101111Type as bu,ByteType as bv,ShortType as bw,IntType as bx,FloatType$1 as by,AlphaFormat as bz,bridge as c,MultiplyOperation as c$,RGBA_ASTC_10x8_Format as c0,RGBA_ASTC_10x10_Format as c1,RGBA_ASTC_12x10_Format as c2,RGBA_ASTC_12x12_Format as c3,RGBA_BPTC_Format as c4,RGB_BPTC_SIGNED_Format as c5,RGB_BPTC_UNSIGNED_Format as c6,RED_RGTC1_Format as c7,SIGNED_RED_RGTC1_Format as c8,RED_GREEN_RGTC2_Format as c9,BoxGeometry as cA,cloneUniforms as cB,getByteLength as cC,LinearTransfer$1 as cD,CubeReflectionMapping as cE,CubeRefractionMapping as cF,OrthographicCamera as cG,MeshBasicMaterial as cH,Uint32BufferAttribute as cI,Uint16BufferAttribute as cJ,arrayNeedsUint32 as cK,GLSL3 as cL,Layers as cM,PCFSoftShadowMap as cN,CustomToneMapping as cO,NeutralToneMapping as cP,AgXToneMapping as cQ,ACESFilmicToneMapping as cR,CineonToneMapping as cS,ReinhardToneMapping as cT,LinearToneMapping as cU,CubeTexture as cV,Data3DTexture as cW,Texture as cX,createElementNS as cY,AddOperation as cZ,MixOperation as c_,SIGNED_RED_GREEN_RGTC2_Format as ca,NotEqualDepth as cb,GreaterDepth as cc,GreaterEqualDepth as cd,EqualDepth as ce,LessDepth as cf,AlwaysDepth as cg,NeverDepth as ch,CullFaceNone as ci,CullFaceBack as cj,CullFaceFront as ck,NormalBlending as cl,CustomBlending as cm,MultiplyBlending as cn,SubtractiveBlending as co,AdditiveBlending as cp,EquirectangularReflectionMapping as cq,EquirectangularRefractionMapping as cr,WebGLCubeRenderTarget as cs,DataArrayTexture as ct,UniformsUtils as cu,mergeUniforms as cv,CubeUVReflectionMapping as cw,TangentSpaceNormalMap as cx,ObjectSpaceNormalMap as cy,getUnlitUniformColorSpace as cz,MSPCodes as d,LineString as d$,MinEquation as d0,MaxEquation as d1,TrianglesDrawMode as d2,TriangleFanDrawMode as d3,TriangleStripDrawMode as d4,Loader as d5,LoaderUtils as d6,FileLoader as d7,MeshPhysicalMaterial as d8,SpotLight as d9,QuaternionKeyframeTrack as dA,Interpolant as dB,Box3 as dC,Sphere as dD,SimpleGeometry as dE,createOrUpdate$2 as dF,intersects$1 as dG,forEachCorner as dH,deflateCoordinate as dI,rotate as dJ,getAugmentedNamespace as dK,FwApproachCollection as dL,SafehomeCollection as dM,FwApproach as dN,WaypointCollection as dO,Waypoint as dP,wrap_360 as dQ,ApproachDirection as dR,Stroke as dS,getPointResolution as dT,defaults as dU,defaults$1 as dV,toLonLat as dW,MWNP as dX,GeozoneVertex as dY,Safehome as dZ,GeozoneShapes as d_,PointLight as da,InstancedMesh as db,InstancedBufferAttribute as dc,TextureLoader as dd,ImageBitmapLoader as de,InterleavedBuffer$1 as df,PointsMaterial as dg,Material as dh,LineBasicMaterial as di,MeshStandardMaterial as dj,PropertyBinding as dk,SkinnedMesh as dl,LineSegments as dm,Line as dn,LineLoop as dp,Points as dq,Group as dr,Skeleton as ds,AnimationClip as dt,Bone as du,InterpolateDiscrete as dv,InterpolateLinear as dw,InterleavedBufferAttribute$1 as dx,VectorKeyframeTrack as dy,NumberKeyframeTrack as dz,mspQueue as e,PointerInteraction as e0,Control as e1,calculate_new_cooridatnes as e2,METERS_PER_UNIT$1 as e3,GeozoneType as e4,Geozone as e5,GeozoneFenceAction as e6,RegularShape as e7,distanceOnLine as e8,round as e9,getWidth as ea,getHeight as eb,appendParams as ec,TileImage as ed,createEmpty as ee,get$2 as ef,transform as eg,calculateSourceResolution as eh,buffer as ei,modulo as ej,hash as ek,platform as el,MotorMixRule as em,PLATFORM as en,ServoMixRule as eo,INPUT as ep,STABILIZED as eq,mapSeries as er,zeroPad as es,CliAutoComplete as et,generateFilename as eu,ConnectionType as ev,mspDeduplicationQueue as f,getDefaultExportFromCjs as g,SITLProcess as h,i18n as i,SitlSerialPortUtils as j,jBox as k,serialPortHelper as l,mspHelper$1 as m,Settings as n,__variableDynamicImportRuntimeHelper as o,MSPChainerClass$1 as p,mixer as q,Scene as r,semver as s,timeout as t,usbDevices as u,PerspectiveCamera as v,Color$1 as w,features as x,scaleRangeInt as y,globalSettings as z};
