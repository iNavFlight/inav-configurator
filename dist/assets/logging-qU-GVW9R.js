import{T,G as i,C as b,M as p,d as m,_ as G,i as g,$ as s,es as c,b as u,F as a}from"./index--BqaKNiR.js";import{d as E}from"./dialog-CY10jn-b.js";T.logging={};T.logging.initialize=function(_){let d=null,A=!1;i.active_tab!="logging"&&(i.active_tab="logging");var n=[],M=0,S=0,o=[];if(b.connectionValid){var h=function(){p.send_message(m.MSP_MOTOR,!1,!1,P)},P=function(){G(async()=>{const{default:e}=await import("./logging-CQjfJx1o.js");return{default:e}},[],import.meta.url).then(({default:e})=>i.load(e,D))};p.send_message(m.MSP_RC,!1,!1,h)}function D(){g.localize(),s("a.log_file").on("click",k),s("a.logging").on("click",function(){if(i.connected_to)if(A){var e=s(this).data("clicks");if(e)u.killAll(["global_data_refresh","msp-load-update","ltm-connection-check"]),s(".speed").prop("disabled",!1),s(this).text(g.getMessage("loggingStart")),s(this).data("clicks",!e);else if(M=0,S=0,o=[],n=[],s(".properties input:checked").each(function(){n.push(s(this).prop("name"))}),n.length){O();var r=function(){S&&R();for(var t=0;t<n.length;t++,S++)p.send_message(m[n[t]])};u.add("log_data_poll",r,parseInt(s("select.speed").val()),!0),u.add("write_data",function(){o.length&&A&&(fs.writeFileSync(d,o.join(`
`)+`
`,{flag:"a"}),s(".samples").text(M+=o.length),o=[])},1e3),s(".speed").prop("disabled",!0),s(this).text(g.getMessage("loggingStop")),s(this).data("clicks",!e)}else i.log(g.getMessage("loggingErrorOneProperty"))}else i.log(g.getMessage("loggingErrorLogFile"));else i.log(g.getMessage("loggingErrorNotConnected"))}),i.content_ready(_)}function O(){for(var e="timestamp",r=0;r<n.length;r++)switch(n[r]){case"MSP_RAW_IMU":e+=",gyroscopeX",e+=",gyroscopeY",e+=",gyroscopeZ",e+=",accelerometerX",e+=",accelerometerY",e+=",accelerometerZ",e+=",magnetometerX",e+=",magnetometerY",e+=",magnetometerZ";break;case"MSP_ATTITUDE":e+=",kinematicsX",e+=",kinematicsY",e+=",kinematicsZ";break;case"MSP_ALTITUDE":e+=",altitude";break;case"MSP_RAW_GPS":e+=",gpsFix",e+=",gpsNumSat",e+=",gpsLat",e+=",gpsLon",e+=",gpsAlt",e+=",gpsSpeed",e+=",gpsGroundCourse";break;case"MSP_ANALOG":e+=",voltage",e+=",amperage",e+=",mAhdrawn",e+=",rssi";break;case"MSP_RC":for(var t=0;t<a.RC.active_channels;t++)e+=",RC"+t;break;case"MSP_MOTOR":for(var l=0;l<a.MOTOR_DATA.length;l++)e+=",Motor"+l;break;case"MSP_DEBUG":for(var f=0;f<a.SENSOR_DATA.debug.length;f++)e+=",Debug"+f;break}o.push(e)}function R(){for(var e=v(),r=0;r<n.length;r++)switch(n[r]){case"MSP_RAW_IMU":e+=","+a.SENSOR_DATA.gyroscope,e+=","+a.SENSOR_DATA.accelerometer,e+=","+a.SENSOR_DATA.magnetometer;break;case"MSP_ATTITUDE":e+=","+a.SENSOR_DATA.kinematics[0],e+=","+a.SENSOR_DATA.kinematics[1],e+=","+a.SENSOR_DATA.kinematics[2];break;case"MSP_ALTITUDE":e+=","+a.SENSOR_DATA.altitude;break;case"MSP_RAW_GPS":e+=","+a.GPS_DATA.fix,e+=","+a.GPS_DATA.numSat,e+=","+a.GPS_DATA.lat/1e7,e+=","+a.GPS_DATA.lon/1e7,e+=","+a.GPS_DATA.alt,e+=","+a.GPS_DATA.speed,e+=","+a.GPS_DATA.ground_course;break;case"MSP_ANALOG":e+=","+a.ANALOG.voltage,e+=","+a.ANALOG.amperage,e+=","+a.ANALOG.mAhdrawn,e+=","+a.ANALOG.rssi;break;case"MSP_RC":for(var t=0;t<a.RC.active_channels;t++)e+=","+a.RC.channels[t];break;case"MSP_MOTOR":e+=","+a.MOTOR_DATA;break;case"MSP_DEBUG":e+=","+a.SENSOR_DATA.debug;break}o.push(e)}function k(){const e=new Date;var t={defaultPath:"inav_data_log_"+e.getFullYear()+"-"+c(e.getMonth()+1,2)+"-"+c(e.getDate(),2)+"_"+c(e.getHours(),2)+c(e.getMinutes(),2)+c(e.getSeconds(),2),filters:[{name:"TXT file",extensions:["txt"]}]};E.showSaveDialog(t).then(l=>{l.canceled||(d=l.filePath,A=!0,bridge.storeSet("logging_file_name",d),bridge.storeSet("logging_file_ready",A))})}function v(){return new Date().getTime()}};T.logging.cleanup=function(_){_&&_()};
