import{T as y,G as v,p as A,m as l,n as x,i as s,M as z,d as $,$ as a,_ as K,F as e,x as f,V as r,b as Z}from"./index--BqaKNiR.js";y.configuration={};y.configuration.initialize=function(p,h){v.active_tab!="configuration"&&(v.active_tab="configuration");var u=new A,V=[l.loadFeatures,l.loadSensorAlignment,l.loadAdvancedConfig,l.loadVTXConfig,l.loadBoardAlignment,l.loadCurrentMeterConfig,l.loadMiscV2];u.setChain(V),u.setExitPoint(P),u.execute();var d=new A,G=[l.saveAccTrim,l.saveAdvancedConfig,l.saveVTXConfig,l.saveCurrentMeterConfig,l.saveMiscV2,R,l.saveToEeprom];function R(o){x.saveInputs(o)}d.setChain(G),d.setExitPoint(X);function X(){v.log(s.getMessage("configurationEepromSaved")),v.tab_switch_cleanup(function(){z.send_message($.MSP_SET_REBOOT,!1,!1,D)})}function D(){v.log(s.getMessage("deviceRebooting")),v.handleReconnect(a(".tab_configuration a"))}function P(){K(async()=>{const{default:o}=await import("./configuration-CY4H0RHX.js");return{default:o}},[],import.meta.url).then(({default:o})=>v.load(o,x.processHtml(B)))}function B(){var o=e.getFeatures(),L=a(".features");for(let n=0;n<o.length;n++){var m,g=[],S="";o[n].showNameInTip&&g.push(s.getMessage("manualEnablingTemplate").replace("{name}",o[n].name)),o[n].haveTip&&g.push(s.getMessage("feature"+o[n].name+"Tip")),g.length>0&&(S='<div class="helpicon cf_tip" title="'+g.join("<br><br>")+'"></div>'),m=a('<div class="checkbox"><input type="checkbox" data-bit="'+o[n].bit+'" class="feature toggle" name="'+o[n].name+'" title="'+o[n].name+'" id="feature-'+o[n].bit+'" ><label for="feature-'+o[n].bit+'"><span data-i18n="feature'+o[n].name+'"></span></label>'+S+"</div>"),L.each(function(){a(this).hasClass(o[n].group)&&a(this).after(m)})}f.updateUI(a(".tab-configuration"),e.FEATURES),s.localize();var N=a(".config-vtx");if(e.VTX_CONFIG.device_type!=r.DEV_UNKNOWN){var _=a("#vtx_band");_.empty();var T=a("#vtx_no_band");if(e.VTX_CONFIG.band<r.BAND_MIN||e.VTX_CONFIG.band>r.BAND_MAX){var U=s.getMessage("configurationNoBand");a('<option value="0">'+U+"</option>").appendTo(_),T.show()}else T.hide();for(var t=0;t<r.BANDS.length;t++){var W=r.BANDS[t].name,c=a('<option value="'+r.BANDS[t].code+'">'+W+"</option>");r.BANDS[t].code==e.VTX_CONFIG.band&&c.prop("selected",!0),c.appendTo(_)}_.on("change",function(){e.VTX_CONFIG.band=parseInt(a(this).val())});var C=a("#vtx_channel");C.empty();for(var t=r.CHANNEL_MIN;t<=r.CHANNEL_MAX;t++){var c=a('<option value="'+t+'">'+t+"</option>");t==e.VTX_CONFIG.channel&&c.prop("selected",!0),c.appendTo(C)}C.on("change",function(){e.VTX_CONFIG.channel=parseInt(a(this).val())});var b=a("#vtx_power");b.empty();for(var k=r.getMinPower(e.VTX_CONFIG.device_type),H=r.getMaxPower(e.VTX_CONFIG.device_type),t=k;t<=H;t++){var c=a('<option value="'+t+'">'+t+"</option>");t==e.VTX_CONFIG.power&&c.prop("selected",!0),c.appendTo(b)}b.on("change",function(){e.VTX_CONFIG.power=parseInt(a(this).val())});var I=a("#vtx_low_power_disarm");I.empty();for(var t=r.LOW_POWER_DISARM_MIN;t<=r.LOW_POWER_DISARM_MAX;t++){var M=s.getMessage("configurationVTXLowPowerDisarmValue_"+t);M||(M=t);var c=a('<option value="'+t+'">'+M+"</option>");t==e.VTX_CONFIG.low_power_disarm&&c.prop("selected",!0),c.appendTo(I)}I.on("change",function(){e.VTX_CONFIG.low_power_disarm=parseInt(a(this).val())}),N.show()}else N.hide();a("#content").scrollTop(h||0),a('input[name="board_align_yaw"]').val((e.BOARD_ALIGNMENT.yaw/10).toFixed(1)),a("#voltagesource").val(e.MISC.voltage_source),a("#cells").val(e.MISC.battery_cells),a("#celldetectvoltage").val(e.MISC.vbatdetectcellvoltage),a("#mincellvoltage").val(e.MISC.vbatmincellvoltage),a("#maxcellvoltage").val(e.MISC.vbatmaxcellvoltage),a("#warningcellvoltage").val(e.MISC.vbatwarningcellvoltage),a("#voltagescale").val(e.MISC.vbatscale),a("#currentscale").val(e.CURRENT_METER_CONFIG.scale),a("#currentoffset").val(e.CURRENT_METER_CONFIG.offset/10),a("#battery_capacity").val(e.MISC.battery_capacity);let F=Math.round(e.MISC.battery_capacity_warning*100/e.MISC.battery_capacity);a("#battery_capacity_warning").val(isNaN(F)?"":F);let w=Math.round(e.MISC.battery_capacity_critical*100/e.MISC.battery_capacity);a("#battery_capacity_critical").val(isNaN(w)?"":w),a("#battery_capacity_unit").val(e.MISC.battery_capacity_unit);let E=a("#i2c_speed"),i=a("#i2c_speed-info");E.on("change",function(){let n=a(this),O=n.children("option:selected").text();O=="400KHZ"?(i.removeClass("ok-box"),i.addClass("info-box"),i.removeClass("warning-box"),i.html(s.getMessage("i2cSpeedSuggested800khz")),i.show()):O=="800KHZ"?(i.removeClass("ok-box"),i.removeClass("info-box"),i.removeClass("warning-box"),i.hide()):(i.removeClass("ok-box"),i.removeClass("info-box"),i.addClass("warning-box"),i.html(s.getMessage("i2cSpeedTooLow")),i.show())}),E.trigger("change"),a("a.save").on("click",function(){e.MISC.battery_cells=parseInt(a("#cells").val()),e.MISC.voltage_source=parseInt(a("#voltagesource").val()),e.MISC.vbatdetectcellvoltage=parseFloat(a("#celldetectvoltage").val()),e.MISC.vbatmincellvoltage=parseFloat(a("#mincellvoltage").val()),e.MISC.vbatmaxcellvoltage=parseFloat(a("#maxcellvoltage").val()),e.MISC.vbatwarningcellvoltage=parseFloat(a("#warningcellvoltage").val()),e.MISC.vbatscale=parseInt(a("#voltagescale").val()),e.MISC.battery_capacity=parseInt(a("#battery_capacity").val()),e.MISC.battery_capacity_warning=parseInt(a("#battery_capacity_warning").val()*e.MISC.battery_capacity/100),e.MISC.battery_capacity_critical=parseInt(a("#battery_capacity_critical").val()*e.MISC.battery_capacity/100),e.MISC.battery_capacity_unit=a("#battery_capacity_unit").val(),f.reset(),f.fromUI(a(".tab-configuration")),f.execute(function(){e.CURRENT_METER_CONFIG.scale=parseInt(a("#currentscale").val()),e.CURRENT_METER_CONFIG.offset=Math.round(parseFloat(a("#currentoffset").val())*10),d.execute()})}),Z.add("config_load_analog",function(){a("#batteryvoltage").val([e.ANALOG.voltage.toFixed(2)]),a("#batterycurrent").val([e.ANALOG.amperage.toFixed(2)])},100,!0),v.content_ready(p)}};y.configuration.cleanup=function(p){p&&p()};
