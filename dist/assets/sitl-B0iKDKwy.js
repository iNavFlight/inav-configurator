import{g as oe,T as Z,G as z,_ as ie,i as O,$ as i,h as G,c as K,j as Y}from"./index--BqaKNiR.js";import{d as V}from"./dialog-CY10jn-b.js";var q={},J,ee;function ne(){if(ee)return J;ee=1;const E=e=>[function(p){return e(...arguments)},function(p,P){return e(...arguments)},function(p,P,k){return e(...arguments)},function(p,P,k,d){return e(...arguments)},function(p,P,k,d,m){return e(...arguments)}],C=(e,...p)=>{if(b(e),p.length>=e.length)return e(...p);const P=(...m)=>C(e,...p,...m),k=e.length-p.length-1;return E(P)[k]||P};J=C;function b(e){if(typeof e!="function")throw Error("fn should be function!")}return J}var Q,te;function ce(){return te||(te=1,Q=E=>{const C={value:E};return(...b)=>{const[e]=b;return b.length?(C.value=e,e):C.value}}),Q}var H={exports:{}},ae;function ue(){if(ae)return H.exports;ae=1;const E=ne(),C=d=>document.querySelector(`[data-name="${d}"]`),b=E((d,m,h)=>d.setAttribute(h,m[h])),e=E((d,m,h)=>d[h]=m[h]),p=E((d,m)=>!d(m)),P=d=>d!=d.toLowerCase();H.exports=(d,m={})=>{const{dataName:h,notAppend:I,parent:T=document.body,uniq:y=!0,...U}=m,A=k(h);if(y&&A)return A;const F=document.createElement(d);return h&&(F.dataset.name=h),Object.keys(U).filter(P).map(e(F,m)),Object.keys(U).filter(p(P)).map(b(F,m)),I||T.appendChild(F),F},H.exports.isElementPresent=k;function k(d){if(d)return C(d)}return H.exports}var re;function de(){if(re)return q;re=1;const E=ne(),C=ce(),b=ue(),e=r=>typeof r=="boolean",p=E(U),P={ok:"OK"},k={ok:"OK",cancel:"Cancel"},d=C(100);q.alert=(r,s,c)=>{const l=m(c)||P;return y(r,s,"",l,c)},q.prompt=(r,s,c="",l)=>{const u=h(l),f=String(c).replace(/"/g,"&quot;"),S=`<input type="${u}" value="${f}" data-name="js-input">`,g=m(l)||k;return y(r,s,S,g,l)},q.confirm=(r,s,c)=>{const l=m(c)||k;return y(r,s,"",l,c)},q.progress=(r,s,c)=>{const f=y(r,s,`
        <progress value="0" data-name="js-progress" class="progress" max="100"></progress>
        <span data-name="js-counter">0%</span>
    `,{cancel:"Abort"},c),{ok:S,dialog:g}=f,t=S();for(const a of v(g,["cancel"]))a.focus();return Object.assign(f,{setProgress(a){const[n]=v(g,["progress"]),[o]=v(g,["counter"]);n.value=a,o.textContent=`${a}%`,a===100&&(x(g),t())},remove(){x(g)}}),f};function m(r={}){const{buttons:s}=r;return s||null}function h(r={}){const{type:s}=r;return s==="password"?"password":"text"}function I(r,s,c,l){const u=s.replace(/\n/g,"<br>");return`<div class="page">
        <div data-name="js-close" class="close-button"></div>
        <header>${r}</header>
        <div class="content-area">${u}${c}</div>
        <div class="action-area">
            <div class="button-strip">
                ${T(l)}
            </div>
        </div>
    </div>`}function T(r){const s=Object.keys(r),c=E((l,u,f)=>`<button
            tabindex=${f}
            data-name="js-${u.toLowerCase()}">
            ${l[u]}
        </button>`);return s.map(c(r)).join("")}function y(r,s,c,l,u){const f=C(),S=C(),g=["cancel","close","ok"],t=new Promise((o,R)=>{const w=u&&e(u.cancel)&&!u.cancel,D=()=>{},X=()=>R(Error());f(o),S(w?D:X)}),a=I(r,s,c,l),n=b("div",{innerHTML:a,className:"smalltalk",style:`z-index: ${d(d()+1)}`});for(const o of v(n,["ok","input"]))o.focus();for(const o of v(n,["input"]))o.setSelectionRange(0,c.length);N("click",n,g,o=>{L(o.target,n,f(),S())});for(const o of["click","contextmenu"])n.addEventListener(o,R=>{R.stopPropagation();for(const w of v(n,["ok","input"]))w.focus()});return n.addEventListener("keydown",p(n,f(),S())),Object.assign(t,{dialog:n,ok:f})}function U(r,s,c,l){const u={ENTER:13,ESC:27,TAB:9,LEFT:37,UP:38,RIGHT:39,DOWN:40},{keyCode:f}=l,S=l.target,t=v(r,["ok","cancel","input"]).map(A);switch(f){case u.ENTER:L(S,r,s,c),l.preventDefault();break;case u.ESC:x(r),c();break;case u.TAB:l.shiftKey&&B(r,t),B(r,t),l.preventDefault();break;default:["left","right","up","down"].filter(a=>f===u[a.toUpperCase()]).forEach(()=>{$(r,t)});break}l.stopPropagation()}function A(r){return r.getAttribute("data-name").replace("js-","")}const F=r=>r==="cancel"?"ok":"cancel";function $(r,s){const c=document.activeElement,l=A(c),u=/ok|cancel/.test(l),f=s.length-1;if(l==="input"||!f||!u)return;const S=F(l);for(const g of v(r,[S]))g.focus()}const j=(r,s)=>s===r?0:s+1;function B(r,s){const c=document.activeElement,l=A(c),u=s.length-1,f=s.indexOf(l),S=j(u,f),g=s[S];for(const t of v(r,[g]))t.focus()}function L(r,s,c,l){const u=r.getAttribute("data-name").replace("js-","");if(/close|cancel/.test(u)){l(),x(s);return}let f=null;for(const S of v(s,["input"]))f=S.value;c(f),x(s)}const _=E((r,s)=>r.querySelector(`[data-name="js-${s}"]`));function v(r,s){return s.map(_(r)).filter(Boolean)}function N(r,s,c,l){for(const u of v(s,c))u.addEventListener(r,l)}function x(r){const{parentElement:s}=r;s&&s.removeChild(r)}return q}var pe=de();const fe=oe(pe),se=[{name:"X-Plane",port:49001,isPortFixed:!1,inputChannels:4,fixedChanMap:["Throttle","Roll","Pitch","Yaw"]},{name:"RealFlight",port:18083,isPortFixed:!0,inputChannels:12,fixedChanMap:!1}],ve=[{name:"[Standard] Configurator",sim:"X-Plane",eepromFileName:"standard-configurator.bin",isStdProfile:!0,simEnabled:!1,port:49001,ip:"127.0.0.1",useImu:!1,channelMap:[1,15,13,16],useSerialReceiver:!0,serialPort:"",serialUart:3,serialProtocol:"SBus",baudRate:!1,stopBits:!1,parity:!1},{name:"[Standard] X-Plane",sim:"X-Plane",eepromFileName:"standard-x-plane.bin",isStdProfile:!0,simEnabled:!0,port:49001,ip:"127.0.0.1",useImu:!1,channelMap:[1,15,13,16],useSerialReceiver:!0,serialPort:"",serialUart:3,serialProtocol:"SBus",baudRate:!1,stopBits:!1,parity:!1},{name:"[Standard] RealFlight Flying Wing",sim:"RealFlight",eepromFileName:"standard-realflight.bin",isStdProfile:!0,simEnabled:!0,port:49001,ip:"127.0.0.1",useImu:!1,channelMap:[1,13,14,0,0,0,0,0,0,0,0,0],useSerialReceiver:!0,serialPort:"",serialUart:3,serialProtocol:"SBus",baudRate:!1,stopBits:!1,parity:!1}];var W="";Z.sitl={};Z.sitl.initialize=E=>{z.active_tab!="sitl"&&(z.active_tab="sitl"),ie(async()=>{const{default:C}=await import("./sitl-_pVPVpbM.js");return{default:C}},[],import.meta.url).then(({default:C})=>z.load(C,function(){O.localize();var b,e,p,P=new Array(28).fill(0),k=Y.getProtocolls(),d=i("#simulator"),m=i("#sitlEnableSim"),h=i("#simPort"),I=i("#simIP"),T=i("#sitlUseImu"),y=i("#sitlProfile"),U=i("#sitlProfileSave"),A=i("#sitlProfileNew"),F=i("#sitlProfileDelete"),$=i("#sitlSerialPort"),j=i("#serialReceiverEnable"),B=i("#sitlSerialUART"),L=i("#serialProtocoll"),_=i("#sitlBaud"),v=i("#serialStopbits"),N=i("#serialParity");G.isRunning?(i(".sitlStart").addClass("disabled"),i(".sitlStop").removeClass("disabled")):(i(".sitlStop").addClass("disabled"),i(".sitlStart").removeClass("disabled"));var x=i("#sitlLog");x.val(W),x&&x.length==1&&(x.val(W),x.animate({scrollTop:x[0].scrollHeight-x.height()},1)),p=structuredClone(ve);const r=K.storeGet("sitlProfiles",!1);r&&p.push(...r),s(!0),Y.resetPortsList(),Y.pollSerialPorts(t=>{$.find("*").remove(),t.forEach(a=>{$.append(`<option value="${a}">${a}</option>`)})}),m.on("change",()=>{e.simEnabled=m.is(":checked"),l()}),d.on("change",()=>{l()}),y.on("change",()=>{u()}),h.on("change",()=>{if(!b.isPortFixed){var t=parseInt(h.val());t!=NaN&&(e.port=parseInt(h.val()))}}),I.on("change",()=>{e.ip=I.val()}),T.on("change",()=>{e.useImu=T.is(":checked")}),i(".sitlStart").on("click",()=>{i(".sitlStart").addClass("disabled"),i(".sitlStop").removeClass("disabled");var t,a,n,o="";if(m.is(":checked"))switch(b.name){case"X-Plane":t="xp";break;case"RealFlight":t="rf";break}h.val()!==""&&(a=h.val()),I.val()!==""&&(n=I.val());const R=(M,le)=>String(M).padStart(le,"0");for(let M=0;M<b.inputChannels;M++){var w=P[M];w!=0&&(w<13?o+=`M${R(w,2)}-${R(M+1,2)},`:o+=`S${R(w-12,2)}-${R(M+1,2)},`)}o=o.substring(0,o.length-1);var D=null;if(j.is(":checked")&&$.val()){var X=L.find(":selected").val();X=="manual"?D={protocollName:"manual",baudRate:_.val()||e.baudRate||"115200",stopBits:v.val()||e.stopBits||"One",parity:N.val()||e.parity||"None",serialPort:$.val()||e.serialPort||"",serialUart:B.val()||e.serialUart||-1}:D={protocollName:X||"SBus",serialPort:$.val()||e.serialPort||"",serialUart:B.val()||e.serialUart||-1}}g(`
`),G.start(e.eepromFileName,t,T.is(":checked"),n,a,o,D,M=>{g(M)})}),i(".sitlStop").on("click",()=>{i(".sitlStop").addClass("disabled"),i(".sitlStart").removeClass("disabled"),G.stop(),g(O.getMessage("sitlStopped"))}),U.on("click",function(){c()}),A.on("click",function(){fe.prompt(O.getMessage("sitlNewProfile"),O.getMessage("sitlEnterName")).then(t=>{const a=(t||"").trim();if(!a)return;if(p.find(w=>w.name==a)){V.alert(O.getMessage("sitlProfileExists"));return}const n=i("<div>").text(a).html(),o=a.replace(/[^a-z0-9]/gi,"_").toLowerCase()+".bin";var R={name:a,sim:"RealFlight",isStdProfile:!1,simEnabled:!1,eepromFileName:o,port:49001,ip:"127.0.0.1",useImu:!1,channelMap:[1,13,14,0,0,0,0,0,0,0,0,0],useSerialReceiver:!0,serialPort:$.val(),serialUart:3,serialProtocol:"SBus",baudRate:!1,stopBits:!1,parity:!1};p.push(R),y.append(`<option value="${n}">${n}</option>`),y.val(a),u(),c()}).catch(()=>{})}),F.on("click",function(){if(e.isStdProfile){V.alert(O.getMessage("sitlStdProfileCantDeleted"));return}var t=y.find(":selected").val();p=p.filter(a=>a.name!=t),G.deleteEepromFile(e.eepromFileName),y.find("*").remove(),s(!1)}),j.on("change",()=>{e.useSerialReceiver=j.is(":checked")}),L.on("change",()=>{var t=L.find(":selected").val(),a=k.find(n=>n.name==t);t!="manual"?(_.prop("disabled",!0),_.val(a.baudRate),v.prop("disabled",!0),v.val(a.stopBits),N.prop("disabled",!0),N.val(a.parity),B.prop("disabled",t=="Flight Controller Proxy")):(_.prop("disabled",!1),v.prop("disabled",!1),N.prop("disabled",!1),B.prop("disabled",!1)),e.serialProtocol=t}),$.on("change",()=>{e.serialPort=$.val()}),B.on("change",()=>{e.serialUart=parseInt(B.val())}),_.on("change",()=>{var t=parseInt(_.val());t!=NaN&&(e.baudRate=t)}),v.on("change",()=>{e.stopBits=v.val()}),N.on("change",()=>{e.parity=N.val()}),window.electronAPI.onChildProcessStdout(t=>{g(t)}),window.electronAPI.onChildProcessStderr(t=>{g(t)}),window.electronAPI.onChildProcessError(t=>{G.stop(),g(t)});function s(t){if(p.forEach(n=>{y.append(`<option value="${n.name}">${n.name}</option>`)}),t){se.forEach(o=>{d.append(`<option value="${o.name}">${o.name}</option>`)}),L.append('<option value="manual">Manual</option>'),k.forEach(o=>{L.append(`<option value="${o.name}">${o.name}</option>`)});const n=K.storeGet("sitlLastProfile",!1);if(n){var a=p.find(o=>o.name==n);a&&y.val(a.name).trigger("change")}}u()}function c(){if(e.isStdProfile){V.alert(O.getMessage("sitlStdProfileCantOverwritten"));return}var t=[];p.forEach(a=>{a.isStdProfile||t.push(a)}),K.storeSet("sitlProfiles",t)}function l(){se.forEach(t=>{if(t.name==d.find(":selected").text()){b=t,b.isPortFixed?h.val(b.port).trigger("change"):h.val(e.port),d.prop("disabled",!e.simEnabled),I.prop("disabled",!e.simEnabled),h.prop("disabled",t.isPortFixed||!e.simEnabled),T.prop("disabled",!e.simEnabled),f();return}})}function u(){var t=y.find(":selected").val(),a=p.findIndex(o=>o.name==t);if(e=p[a],L.val(e.serialProtocol),e.serialProtocol=="manual")_.val(e.baudRate),_.prop("disabled",!1),v.val(e.stopBits),v.prop("disabled",!1),N.val(e.parity),N.prop("disabled",!1),B.prop("disabled",!1);else{var n=k.find(o=>o.name==e.serialProtocol);_.prop("disabled",!0),_.val(n.baudRate),v.prop("disabled",!0),v.val(n.stopBits),N.prop("disabled",!0),N.val(n.parity),B.prop("disabled",e.serialProtocol=="Flight Controller Proxy")}e.serialPort!=""&&$.val(e.serialPort),m.prop("checked",e.simEnabled).trigger("change"),j.prop("checked",e.useSerialReceiver).trigger("change"),B.val(e.serialUart),P=e.channelMap,d.val(e.sim),l(),I.val(e.ip).trigger("change"),T.prop("checked",e.useImu).trigger("change"),K.storeSet("sitlLastProfile",t)}function f(){var t=i(".mapTableBody");t.find("*").remove();for(let n=0;n<b.inputChannels;n++){var a;b.fixedChanMap?a=b.fixedChanMap[n]:a=n+1,t.append("<tr><td>"+a+'</td><td><select data-out="'+n+'" class="inavChannel""></select></td></td>');const o=t.find("tr:last");z.fillSelect(o.find(".inavChannel"),S(),P[n]),o.find(".inavChannel").val(P[n]).on("change",R=>{P[i(R.target).data("out")]=parseInt(i(R.target).val()),K.storeSet("sitlMapping",P)})}}function S(){for(var t=[],a=0;a<=12;a++)a==0?t.push("None"):t.push("Motor "+a);for(var a=1;a<=16;a++)a==0?t.push("None"):t.push("Servo "+a);return t}function g(t){W+=t;var a=i("#sitlLog");a&&a.length==1&&(a.val(W),a.animate({scrollTop:a[0].scrollHeight-a.height()},1))}z.content_ready(E)}))};Z.sitl.cleanup=E=>{Y.stopPollSerialPorts(),E&&E()};
