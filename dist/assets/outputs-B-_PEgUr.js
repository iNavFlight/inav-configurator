import{T as X,G as I,p as K,m as p,i as P,F as e,_ as o,n as Q,B as H,$ as t,x as D,t as pe,M as N,d as w,b as B,en as x,o as ce,q as Y}from"./index--BqaKNiR.js";X.outputs={allowTestMode:!1,feature3DEnabled:!1,feature3DSupported:!1};X.outputs.initialize=function(F){var n=this;n.armed=!1,n.feature3DSupported=!1,n.allowTestMode=!0;var h;I.active_tab!=="outputs"&&(I.active_tab="outputs");var k=new K;k.setChain([p.loadMiscV2,p.loadFeatures,p.load3dConfig,p.loadMotors,p.loadMotorMixRules,p.loadServoMixRules,p.loadMixerConfig,p.loadServoConfiguration,p.loadOutputMappingExt,p.loadRcData,p.loadAdvancedConfig,function(r){p.getSetting("motor_direction_inverted").then(a=>{n.motorDirectionInverted=a.value}).then(r)}]),k.setExitPoint(Z),k.execute(),z();var y=new K;y.setChain([j,p.sendServoConfigurations,p.saveAdvancedConfig,p.saveMiscV2,p.save3dConfig,p.saveToEeprom]),y.setExitPoint(function(){I.log(P.getMessage("eeprom_saved_ok")),e.MOTOR_RULES.cleanup()});function Z(){o(async()=>{const{default:r}=await import("./outputs-CoC-00Yu.js");return{default:r}},[],import.meta.url).then(({default:r})=>I.load(r,Q.processHtml(ee)))}function j(r){Q.saveInputs(r)}function ee(){n.feature3DEnabled=H.bit_check(e.FEATURES,12),le(),se(),te(),ne()}function U(r){if(n.feature3DEnabled)return r;{let a=r-e.MISC.mincommand,d=e.MISC.maxthrottle-e.MISC.mincommand;return Math.round(100*a/d)+"%"}}function te(){let r=e.getEscProtocols(),a=e.getServoRates(),d=t("#throttle_idle"),i=t("#throttle_idle-info"),c=t("#motor-stop-warning"),v=t(".for-reversible-motors");function T(){i.hide(),e.ADVANCED_CONFIG.motorPwmProtocol>=5?(t(".hide-for-shot").hide(),d.val()>7&&(i.html(P.getMessage("throttleIdleDigitalInfo")),i.addClass("ok-box"),i.show())):(t(".hide-for-shot").show(),d.val()>10&&(i.html(P.getMessage("throttleIdleAnalogInfo")),i.addClass("ok-box"),i.show()))}let m=t("#esc-protocol");for(let _ in r)if(r.hasOwnProperty(_)){var b=r[_];m.append('<option value="'+_+'">'+b.name+"</option>")}m.val(e.ADVANCED_CONFIG.motorPwmProtocol),m.on("change",function(){e.ADVANCED_CONFIG.motorPwmProtocol=t(this).val()}),d.on("change",T),T(),t("#esc-protocols").show();let u=t("#servo-rate");for(let _ in a)a.hasOwnProperty(_)&&u.append('<option value="'+_+'">'+a[_]+"</option>");u.find('[value="'+e.ADVANCED_CONFIG.servoPwmRate+'"]').length==0&&u.append('<option value="'+e.ADVANCED_CONFIG.servoPwmRate+'">'+e.ADVANCED_CONFIG.servoPwmRate+"Hz</option>"),u.val(e.ADVANCED_CONFIG.servoPwmRate),u.on("change",function(){e.ADVANCED_CONFIG.servoPwmRate=t(this).val()}),t("#servo-rate-container").show(),D.updateUI(t(".tab-motors"),e.FEATURES),I.simpleBind();let O=t("#feature-12");function S(){const _=O.is(":checked");console.log(_),_?v.show():v.hide()}O.on("change",S),S();let M=t("#feature-4");function L(){const _=[x.AIRPLANE,x.ROVER,x.BOAT].includes(e.MIXER_CONFIG.platformType),C=M.is(":checked");_&&C||!_&&!C?c.hide():c.show()}M.on("change",L),L(),t("#3ddeadbandlow").val(e.REVERSIBLE_MOTORS.deadband_low),t("#3ddeadbandhigh").val(e.REVERSIBLE_MOTORS.deadband_high),t("#3dneutral").val(e.REVERSIBLE_MOTORS.neutral)}function z(){n.armed=e.isModeEnabled("ARM")}function re(){for(var r=0;r<3;r++)e.SENSOR_DATA.accelerometer[r]=0}function oe(r){for(var a=new Array(r),d=0;d<r;d++)a[d]=[],a[d].min=-1,a[d].max=1;return a}function ae(r,a,d){for(var i=0;i<r.length;i++){var c=d[i];r[i].push([a,c]),c<r[i].min&&(r[i].min=c),c>r[i].max&&(r[i].max=c)}for(;r[0].length>40;)for(let v=0;v<r.length;v++)r[v].shift();return a+1}function ie(r){if(e.MIXER_CONFIG.appliedMixerPreset==-1)return;const d=n.motorDirectionInverted&&(e.MIXER_CONFIG.platformType==x.MULTIROTOR||e.MIXER_CONFIG.platformType==x.TRICOPTER);ce(Object.assign({"../resources/motor_order/airplane.svg":()=>o(()=>import("./airplane-C-DS9K0B.js"),[],import.meta.url),"../resources/motor_order/airplane_norudder.svg":()=>o(()=>import("./airplane_norudder-CNbGDGKy.js"),[],import.meta.url),"../resources/motor_order/airplane_vtail.svg":()=>o(()=>import("./airplane_vtail-mhX3kLAh.js"),[],import.meta.url),"../resources/motor_order/airplane_vtail_single.svg":()=>o(()=>import("./airplane_vtail_single-CuqaTccF.js"),[],import.meta.url),"../resources/motor_order/atail_quad.svg":()=>o(()=>import("./atail_quad-Ddo7xPy6.js"),[],import.meta.url),"../resources/motor_order/atail_quad_reverse.svg":()=>o(()=>import("./atail_quad_reverse-Cq8q7MI2.js"),[],import.meta.url),"../resources/motor_order/bicopter.svg":()=>o(()=>import("./bicopter-D5HN33O8.js"),[],import.meta.url),"../resources/motor_order/bicopter_reverse.svg":()=>o(()=>import("./bicopter_reverse-BdoETzjQ.js"),[],import.meta.url),"../resources/motor_order/custom.svg":()=>o(()=>import("./custom-DnhRHfBL.js"),[],import.meta.url),"../resources/motor_order/flying_wing.svg":()=>o(()=>import("./flying_wing-SBU5JtwR.js"),[],import.meta.url),"../resources/motor_order/hex_p.svg":()=>o(()=>import("./hex_p-CptrH0bt.js"),[],import.meta.url),"../resources/motor_order/hex_p_reverse.svg":()=>o(()=>import("./hex_p_reverse-C2R3cyjD.js"),[],import.meta.url),"../resources/motor_order/hex_x.svg":()=>o(()=>import("./hex_x-DdJQHm55.js"),[],import.meta.url),"../resources/motor_order/hex_x_reverse.svg":()=>o(()=>import("./hex_x_reverse-CYvWai7o.js"),[],import.meta.url),"../resources/motor_order/octo_flat_p.svg":()=>o(()=>import("./octo_flat_p-CBS5TeBW.js"),[],import.meta.url),"../resources/motor_order/octo_flat_p_reverse.svg":()=>o(()=>import("./octo_flat_p_reverse-VNSfRGof.js"),[],import.meta.url),"../resources/motor_order/octo_flat_x.svg":()=>o(()=>import("./octo_flat_x-BwWO9ndd.js"),[],import.meta.url),"../resources/motor_order/octo_flat_x_reverse.svg":()=>o(()=>import("./octo_flat_x_reverse-D-WrOX7b.js"),[],import.meta.url),"../resources/motor_order/octo_x8.svg":()=>o(()=>import("./octo_x8-CuEeRRoQ.js"),[],import.meta.url),"../resources/motor_order/octo_x8_reverse.svg":()=>o(()=>import("./octo_x8_reverse-BtHubiKp.js"),[],import.meta.url),"../resources/motor_order/quad_p.svg":()=>o(()=>import("./quad_p-gOsh_DpQ.js"),[],import.meta.url),"../resources/motor_order/quad_p_reverse.svg":()=>o(()=>import("./quad_p_reverse-CdMqPcZw.js"),[],import.meta.url),"../resources/motor_order/quad_x.svg":()=>o(()=>import("./quad_x-p5_Jv4uX.js"),[],import.meta.url),"../resources/motor_order/quad_x_reverse.svg":()=>o(()=>import("./quad_x_reverse-Dtn7A2Eb.js"),[],import.meta.url),"../resources/motor_order/tri.svg":()=>o(()=>import("./tri-BrQHbqv6.js"),[],import.meta.url),"../resources/motor_order/tri_reverse.svg":()=>o(()=>import("./tri_reverse-CYImZFs2.js"),[],import.meta.url),"../resources/motor_order/vtail_quad.svg":()=>o(()=>import("./vtail_quad-5VCz9GeW.js"),[],import.meta.url),"../resources/motor_order/vtail_quad_reverse.svg":()=>o(()=>import("./vtail_quad_reverse-COoKWac3.js"),[],import.meta.url),"../resources/motor_order/y4.svg":()=>o(()=>import("./y4-D6SJU9OJ.js"),[],import.meta.url),"../resources/motor_order/y4_reverse.svg":()=>o(()=>import("./y4_reverse-KI2Mf8tm.js"),[],import.meta.url),"../resources/motor_order/y6.svg":()=>o(()=>import("./y6-BZNtYC2h.js"),[],import.meta.url),"../resources/motor_order/y6_reverse.svg":()=>o(()=>import("./y6_reverse-BfU3ynxS.js"),[],import.meta.url)}),`../resources/motor_order/${Y.getById(r).image}${d?"_reverse":""}.svg`,4).then(({default:i})=>{t(".mixerPreview img").attr("src",i)}),de()}function se(){let r=t(".tab-servos"),a=t("#servoEmptyTableInfo"),d=t("#servo-config-table-container"),i=t("#servo-config-table");if(e.SERVO_CONFIG.length==0){r.addClass("is-hidden");return}function c(m,b,u){i.append('                <tr>                     <td class="text-center">'+m+'</td>                    <td class="middle"><input type="number" min="500" max="2500" value="'+e.SERVO_CONFIG[u].middle+'" /></td>                    <td class="min"><input type="number" min="500" max="2500" value="'+e.SERVO_CONFIG[u].min+'" /></td>                    <td class="max"><input type="number" min="500" max="2500" value="'+e.SERVO_CONFIG[u].max+'" /></td>                    <td class="text-center rate">                    <td class="text-center reverse">                    </td>                </tr>             ');let O=i.find("tr:last");O.find("td.rate").append('<input class="rate-input" type="number" min="'+e.MIN_SERVO_RATE+'" max="'+e.MAX_SERVO_RATE+'" value="'+Math.abs(e.SERVO_CONFIG[u].rate)+'" />'),O.find("td.reverse").append('<input type="checkbox" class="reverse-input togglemedium" '+(e.SERVO_CONFIG[u].rate<0?" checked ":"")+"/>"),O.data("info",{obj:u}),O.append('<td class="text-center output"></td>');let S,M;e.MIXER_CONFIG.platformType==x.MULTIROTOR||e.MIXER_CONFIG.platformType==x.TRICOPTER?S=e.OUTPUT_MAPPING.getMrServoOutput(T):S=e.OUTPUT_MAPPING.getFwServoOutput(T),S===null?M="-":M="S"+S,O.find(".output").html(M),e.SERVO_RULES.isServoConfigured(u)?T++:O.hide()}function v(){i.find('tr:not(".main")').each(function(){var m=t(this).data("info"),b=t(".channel input",this);parseInt(b.index(b.filter(":checked"))),e.SERVO_CONFIG[m.obj].middle=parseInt(t(".middle input",this).val()),e.SERVO_CONFIG[m.obj].min=parseInt(t(".min input",this).val()),e.SERVO_CONFIG[m.obj].max=parseInt(t(".max input",this).val());var u=parseInt(t(".rate-input",this).val());t(".reverse-input",this).is(":checked")&&(u=-u),e.SERVO_CONFIG[m.obj].rate=u}),e.REVERSIBLE_MOTORS.deadband_low=parseInt(t("#3ddeadbandlow").val()),e.REVERSIBLE_MOTORS.deadband_high=parseInt(t("#3ddeadbandhigh").val()),e.REVERSIBLE_MOTORS.neutral=parseInt(t("#3dneutral").val()),y.execute()}i.find("tr:not(:first)").remove();let T=0;for(let m=0;m<e.SERVO_RULES.getServoCount();m++)c("Servo "+m,"",m);T==0?(a.show(),d.hide()):(a.hide(),d.show()),t("table.directions select, table.directions input, #servo-config-table select, #servo-config-table input").on("change",function(){t("div.live input").is(":checked")&&pe.add("servos_update",v,10)}),t("a.update").on("click",function(){D.reset(),D.fromUI(t(".tab-motors")),D.execute(v)}),t("a.save").on("click",function(){y.setExitPoint(function(){I.log(P.getMessage("configurationEepromSaved")),I.tab_switch_cleanup(function(){N.send_message(w.MSP_SET_REBOOT,!1,!1,function(){I.log(P.getMessage("deviceRebooting")),I.handleReconnect(t(".tab_outputs a"))})})}),D.reset(),D.fromUI(t(".tab-motors")),D.execute(v)})}function le(){h=t("#motorsEnableTestMode"),n.feature3DEnabled&&!n.feature3DSupported&&(n.allowTestMode=!1),h.prop("checked",!1),h.prop("disabled",!0),ie(e.MIXER_CONFIG.appliedMixerPreset),re();var r=0,a=oe(3),d=[0,0,0],i=[0,0,0],c=!1;let v=t(".acc-rms"),T=t(".current-current"),m=t(".current-voltage");B.killAll(["motor_and_status_pull","global_data_refresh","msp-load-update","ltm-connection-check"]),B.add("IMU_pull",function(){N.send_message(w.MSP_RAW_IMU,!1,!1,b)},25,!0),B.add("ANALOG_pull",function(){T.html(e.ANALOG.amperage.toFixed(2)),m.html(e.ANALOG.voltage.toFixed(2))},100,!0);function b(){if(!c){for(var s=0;s<3;s++)i[s]=e.SENSOR_DATA.accelerometer[s]*-1;c=!0}var l=[i[0]+e.SENSOR_DATA.accelerometer[0],i[1]+e.SENSOR_DATA.accelerometer[1],i[2]+e.SENSOR_DATA.accelerometer[2]];r=ae(a,r,l);for(var f=0,E=0;E<a.length;E++)for(var A=0;A<a[E].length;A++)f+=a[E][A][1]*a[E][A][1];let V=Math.sqrt(f/(a[0].length+a[1].length+a[2].length));v.text(V.toFixed(4));for(var s=0;s<3;s++)Math.abs(l[s])>Math.abs(d[s])&&(d[s]=l[s])}let u=t(".motors .bar-wrapper"),O=t(".servos .bar-wrapper"),S=t(".motor-titles"),M=t(".motor-sliders"),L=t(".motor-values");for(let s=0;s<e.MOTOR_RULES.getNumberOfConfiguredMotors();s++){const l=s+1;u.append('                <div class="m-block motor-'+s+'">                    <div class="meter-bar">                        <div class="label"></div>                        <div class="indicator">                            <div class="label">                                <div class="label"></div>                            </div>                        </div>                    </div>                </div>            '),S.append('<li title="Motor - '+l+'">'+l+"</li>"),M.append('<div class="motor-slider-container"><input type="range" min="1000" max="2000" value="1000" disabled="disabled"/></div>'),L.append("<li>0%</li>")}M.append('<div class="motor-slider-container"><input type="range" min="1000" max="2000" value="1000" disabled="disabled" class="master"/></div>'),L.append('<li style="font-weight: bold" data-i18n="motorsMaster"></li>');for(let s=0;s<e.SERVO_RULES.getServoCount();s++){let l="";e.SERVO_RULES.isServoConfigured(15-s)||(l=' style="opacity: 0.2"'),O.append('                <div class="m-block servo-'+(15-s)+'" '+l+'>                    <div class="meter-bar">                        <div class="label"></div>                        <div class="indicator">                            <div class="label">                                <div class="label"></div>                            </div>                        </div>                    </div>                </div>            ')}var _=t("div.sliders input");if(_.prop("min",e.MISC.mincommand),_.prop("max",e.MISC.maxthrottle),t("div.values li:not(:last)").text(e.MISC.mincommand),n.feature3DEnabled&&n.feature3DSupported?((e.REVERSIBLE_MOTORS.neutral>1575||e.EVERSIBLE_MOTORS.neutral<1425)&&(e.REVERSIBLE_MOTORS.neutral=1500),_.val(e.REVERSIBLE_MOTORS.neutral)):_.val(e.MISC.mincommand),n.allowTestMode){var C=[],$=!1;t("div.sliders input:not(.master)").on("input",function(){var s=t("div.sliders input:not(.master)").index(this),l=[];t("div.values li").eq(s).text(U(t(this).val()));for(let E=0;E<8;E++){var f=parseInt(t("div.sliders input").eq(E).val());l.push(H.lowByte(f)),l.push(H.highByte(f))}C.push(l),$||($=setTimeout(function(){l=C.pop(),N.send_message(w.MSP_SET_MOTOR,l),C=[],$=!1},100))})}t("div.sliders input.master").on("input",function(){var s=t(this).val();t("div.sliders input:not(:disabled, :last)").val(s),t("div.values li:not(:last)").slice(0,e.MOTOR_RULES.getNumberOfConfiguredMotors()).text(U(s)),t("div.sliders input:not(:last):first").trigger("input")}),h.on("change",function(){t(this).is(":checked")?(_.slice(0,e.MOTOR_RULES.getNumberOfConfiguredMotors()).prop("disabled",!1),t("div.sliders input:last").prop("disabled",!1)):(_.prop("disabled",!0),n.feature3DEnabled&&n.feature3DSupported?_.val(e.REVERSIBLE_MOTORS.neutral):_.val(e.MISC.mincommand),_.trigger("input"))});for(var q=!1,R=0;R<e.MOTOR_RULES.getNumberOfConfiguredMotors();R++)if(n.feature3DEnabled){if(e.MOTOR_DATA[R]<e.REVERSIBLE_MOTORS.deadband_low||e.MOTOR_DATA[R]>e.REVERSIBLE_MOTORS.deadband_high){q=!0;break}}else if(e.MOTOR_DATA[R]>e.MISC.mincommand){q=!0;break}if(q){!n.armed&&n.allowTestMode&&h.prop("checked",!0);for(var W=t("div.sliders input:not(.master)"),G=e.MOTOR_DATA[0],R=0;R<e.MOTOR_DATA.length;R++)e.MOTOR_DATA[R]>0&&(W.eq(R).val(e.MOTOR_DATA[R]),G!=e.MOTOR_DATA[R]&&(G=!1));W.trigger("input"),G&&(t("div.sliders input.master").val(G),t("div.sliders input.master").trigger("input"))}h.trigger("change");function _e(){N.send_message(w.MSP_MOTOR,!1,!1,ue)}function ue(){N.send_message(w.MSP_SERVO,!1,!1,me)}var J=e.MISC.maxthrottle-e.MISC.mincommand;function me(){var s=n.armed,l=t("div.m-block:first").height(),f,E,A,V;for(let g=0;g<e.MOTOR_DATA.length;g++)f=e.MOTOR_DATA[g]-e.MISC.mincommand,E=l-(f*(l/J)).clamp(0,l),A=(f*(l/J)).clamp(0,l),V=parseInt(f*.009),t(".motor-"+g+" .label",u).text(U(e.MOTOR_DATA[g])),t(".motor-"+g+" .indicator",u).css({"margin-top":E+"px",height:A+"px","background-color":"#37a8db"+V+")"});for(let g=0;g<e.SERVO_DATA.length;g++)f=e.SERVO_DATA[g]-1e3,E=l-(f*(l/1e3)).clamp(0,l),A=(f*(l/1e3)).clamp(0,l),V=parseInt(f*.009),t(".servo-"+g+" .label",O).text(e.SERVO_DATA[g]),t(".servo-"+g+" .indicator",O).css({"margin-top":E+"px",height:A+"px","background-color":"#37a8db"+V+")"});z(),n.allowTestMode&&(n.armed?(h.prop("disabled",!0),h.prop("checked",!1)):n.allowTestMode&&h.prop("disabled",!1),s!=n.armed&&(console.log("arm state change detected"),h.trigger("change")))}B.add("motor_and_status_pull",_e,100,!0)}function ne(){P.localize(),I.content_ready(F)}function de(){if(Y.getById(e.MIXER_CONFIG.appliedMixerPreset).image!="quad_x")return;let r=0;var a=e.MOTOR_RULES.get();for(const d in a)if(a.hasOwnProperty(d)){const i=a[d];r++;let c=30,v=28;i.getRoll()<-.5&&(v=t("#motor-mixer-preview-img").width()-20),i.getPitch()>.5&&(c=t("#motor-mixer-preview-img").height()-20),t("#motorNumber"+r).css("left",v+"px"),t("#motorNumber"+r).css("top",c+"px"),t("#motorNumber"+r).css("visibility","visible")}}};X.outputs.cleanup=function(F){F&&F()};
