import{T as u,p as A,m as o,G as a,_ as D,n as w,i as h,$ as e,F as t,M as R,d as v,b as S,y as z}from"./index--BqaKNiR.js";import{t as U}from"./tabs-DhSV9wpC.js";import{d as y}from"./dialog-CY10jn-b.js";u.pid_tuning={rateChartHeight:117};u.pid_tuning.initialize=function(m){var C=new A;let d=[40,75,23,100],g=[45,80,0,100];var M=[o.loadPidData,o.loadRateDynamics,o.loadRateProfileData,o.loadEzTune,o.loadMixerConfig];C.setChain(M),C.setExitPoint(x),C.execute(),a.active_tab!="pid_tuning"&&(a.active_tab="pid_tuning");function x(){D(async()=>{const{default:n}=await import("./pid_tuning-CbG6rXlV.js");return{default:n}},[],import.meta.url).then(({default:n})=>a.load(n,w.processHtml(N)))}function f(n,i,r,_,s,p){let l=i.getContext("2d");n<0||n>1||(p===!0&&l.clearRect(0,0,_,s),l.beginPath(),l.moveTo(0,s),l.quadraticCurveTo(_/2,s-s/2*(1-n),_,0),l.lineWidth=2,l.strokeStyle=r,l.stroke())}function P(){let n=e(".pitch_roll_curve canvas").get(0),i=e(".manual_expo_curve canvas").get(0);f(parseFloat(e("#rate_rollpitch_expo").val())/100,n,"#a00000",200,u.pid_tuning.rateChartHeight,!0),f(parseFloat(e("#rate_yaw_expo").val())/100,n,"#00a000",200,u.pid_tuning.rateChartHeight,!1),f(parseFloat(e("#manual_rollpitch_expo").val())/100,i,"#a00000",200,u.pid_tuning.rateChartHeight,!0),f(parseFloat(e("#manual_yaw_expo").val())/100,i,"#00a000",200,u.pid_tuning.rateChartHeight,!1),f(Math.floor(c(e("#ez_tune_expo").val(),0,200,40,100))/100,e("#ez_tune_expo_curve canvas").get(0),"#a00000",250,200,!0)}function b(){var n=t.getPidNames();e("[data-pid-bank-position]").each(function(){var i=e(this),r=i.data("pid-bank-position");n[r]&&(i.find("td:first").text(n[r]),i.find("input").each(function(_){e(this).val(t.PIDs[r][_])}))}),e("#tpa").val(t.RC_tuning.dynamic_THR_PID),e("#tpa-breakpoint").val(t.RC_tuning.dynamic_THR_breakpoint)}function I(){e("[data-pid-bank-position]").each(function(){var n=e(this),i=n.data("pid-bank-position");n.hasClass("is-hidden")||t.PIDs[i]&&n.find("input").each(function(r){t.PIDs[i][r]=parseFloat(e(this).val())})}),t.RC_tuning.roll_rate=parseFloat(e("#rate_roll_rate").val()),t.RC_tuning.pitch_rate=parseFloat(e("#rate_pitch_rate").val()),t.RC_tuning.yaw_rate=parseFloat(e("#rate_yaw_rate").val()),t.RC_tuning.RC_EXPO=parseFloat(e("#rate_rollpitch_expo").val())/100,t.RC_tuning.RC_YAW_EXPO=parseFloat(e("#rate_yaw_expo").val())/100,t.RC_tuning.dynamic_THR_PID=parseInt(e("#tpaRate").val()),t.RC_tuning.dynamic_THR_breakpoint=parseInt(e("#tpaBreakpoint").val()),t.RC_tuning.manual_roll_rate=e("#rate_manual_roll").val(),t.RC_tuning.manual_pitch_rate=e("#rate_manual_pitch").val(),t.RC_tuning.manual_yaw_rate=e("#rate_manual_yaw").val(),t.RC_tuning.manual_RC_EXPO=e("#manual_rollpitch_expo").val()/100,t.RC_tuning.manual_RC_YAW_EXPO=e("#manual_yaw_expo").val()/100,t.RATE_DYNAMICS.sensitivityCenter=parseInt(e("#rate_dynamics_center_sensitivity").val()),t.RATE_DYNAMICS.sensitivityEnd=parseInt(e("#rate_dynamics_end_sensitivity").val()),t.RATE_DYNAMICS.correctionCenter=parseInt(e("#rate_dynamics_center_correction").val()),t.RATE_DYNAMICS.correctionEnd=parseInt(e("#rate_dynamics_end_correction").val()),t.RATE_DYNAMICS.weightCenter=parseInt(e("#rate_dynamics_center_weight").val()),t.RATE_DYNAMICS.weightEnd=parseInt(e("#rate_dynamics_end_weight").val())}function E(n){return 1+(n-100)*.01*.5}function c(n,i,r,_,s){let p=(s-_)*(n-i),l=r-i;return p/l+_}function T(){let n=e("#ez_tune_axis_ratio").val()/100,i=e("#ez_tune_response").val(),r=e("#ez_tune_damping").val(),_=e("#ez_tune_stability").val(),s=e("#ez_tune_aggressiveness").val(),p=e("#ez_tune_rate").val(),l=e("#ez_tune_expo").val();e("#preview-roll-p").html(Math.floor(d[0]*i/100)),e("#preview-roll-i").html(Math.floor(d[1]*_/100)),e("#preview-roll-d").html(Math.floor(d[2]*r/100)),e("#preview-roll-ff").html(Math.floor(d[3]*s/100)),e("#preview-pitch-p").html(Math.floor(n*d[0]*i/100)),e("#preview-pitch-i").html(Math.floor(n*d[1]*_/100)),e("#preview-pitch-d").html(Math.floor(n*d[2]*r/100)),e("#preview-pitch-ff").html(Math.floor(n*d[3]*s/100)),e("#preview-yaw-p").html(Math.floor(g[0]*E(i))),e("#preview-yaw-i").html(Math.floor(g[1]*E(_))),e("#preview-yaw-d").html(Math.floor(g[2]*E(r))),e("#preview-yaw-ff").html(Math.floor(g[3]*E(s))),e("#preview-roll-rate").html(Math.floor(c(p,0,200,30,90))*10+" dps"),e("#preview-pitch-rate").html(Math.floor(c(p,0,200,30,90))*10+" dps"),e("#preview-yaw-rate").html((Math.floor(c(p,0,200,30,90))-10)*10+" dps"),e("#preview-roll-expo").html(Math.floor(c(l,0,200,40,100))+"%"),e("#preview-pitch-expo").html(Math.floor(c(l,0,200,40,100))+"%"),e("#preview-yaw-expo").html(Math.floor(c(l,0,200,40,100))+"%")}function N(){h.localize(),e("#ez_tune_enabled").on("change",function(){e(this).is(":checked")?t.EZ_TUNE.enabled=1:t.EZ_TUNE.enabled=0,t.EZ_TUNE.enabled?(e(".for-ez-tune").show(),e(".not-for-ez-tune").hide()):(e(".for-ez-tune").hide(),e(".not-for-ez-tune").show())}),t.isMultirotor()||(e("#ez-tune-switch").hide(),e(".only-for-multirotor").hide()),t.isMultirotor()&&e(".not-for-multirotor").hide(),e("#ez_tune_enabled").prop("checked",t.EZ_TUNE.enabled).trigger("change"),a.sliderize(e("#ez_tune_filter_hz"),t.EZ_TUNE.filterHz,20,300),a.sliderize(e("#ez_tune_axis_ratio"),t.EZ_TUNE.axisRatio,25,175),a.sliderize(e("#ez_tune_response"),t.EZ_TUNE.response,0,200),a.sliderize(e("#ez_tune_damping"),t.EZ_TUNE.damping,0,200),a.sliderize(e("#ez_tune_stability"),t.EZ_TUNE.stability,0,200),a.sliderize(e("#ez_tune_aggressiveness"),t.EZ_TUNE.aggressiveness,0,200),a.sliderize(e("#ez_tune_rate"),t.EZ_TUNE.rate,0,200),a.sliderize(e("#ez_tune_expo"),t.EZ_TUNE.expo,0,200),a.sliderize(e("#ez_tune_snappiness"),t.EZ_TUNE.snappiness,0,100),e(".ez-element").on("updated",function(){T()}),a.sliderize(e("#rate_roll_rate"),t.RC_tuning.roll_rate,40,1e3),a.sliderize(e("#rate_pitch_rate"),t.RC_tuning.pitch_rate,40,1e3),a.sliderize(e("#rate_yaw_rate"),t.RC_tuning.yaw_rate,40,1e3),a.sliderize(e("#rate_rollpitch_expo"),t.RC_tuning.RC_EXPO*100,0,100),a.sliderize(e("#rate_yaw_expo"),t.RC_tuning.RC_YAW_EXPO*100,0,100),a.sliderize(e("#rate_manual_roll"),t.RC_tuning.manual_roll_rate,0,100),a.sliderize(e("#rate_manual_pitch"),t.RC_tuning.manual_pitch_rate,0,100),a.sliderize(e("#rate_manual_yaw"),t.RC_tuning.manual_yaw_rate,0,100),a.sliderize(e("#manual_rollpitch_expo"),t.RC_tuning.manual_RC_EXPO*100,0,100),a.sliderize(e("#manual_yaw_expo"),t.RC_tuning.manual_RC_YAW_EXPO*100,0,100),T(),U.init(e(".tab-pid_tuning")),e(".action-resetPIDs").on("click",function(){y.confirm(h.getMessage("confirm_reset_pid"))&&(R.send_message(v.MSP_SET_RESET_CURR_PID,!1,!1,!1),a.updateActivatedTab())}),e(".action-resetDefaults").on("click",function(){y.confirm(h.getMessage("confirm_select_defaults"))&&o.setSetting("applied_defaults",0,function(){o.saveToEeprom(function(){a.log(h.getMessage("configurationEepromSaved")),a.tab_switch_cleanup(function(){R.send_message(v.MSP_SET_REBOOT,!1,!1,function(){a.log(h.getMessage("deviceRebooting")),a.handleReconnect()})})})})}),b(),e(".pid-slider-row [name='value-slider']").on("input",function(){let i=e(this).val(),r=parseInt(e(this).data("normal-max"));i<=800?i=z(i,0,800,0,r):i=z(i,801,1e3,r+1,255),e(this).parent().find('input[name="value-input"]').val(i),t.PIDs[e(this).parent().data("axis")][e(this).parent().data("bank")]=i}),e(".pid-slider-row [name='value-input']").on("change",function(){let i=e(this).val(),r,_=parseInt(e(this).parent().find('input[name="value-slider"]').data("normal-max"));i<=110?r=z(i,0,_,0,800):r=z(i,_+1,255,801,1e3),e(this).parent().find('input[name="value-slider"]').val(r),t.PIDs[e(this).parent().data("axis")][e(this).parent().data("bank")]=e(this).val()});let n=0;e("#pid-sliders").find(".pid-sliders-axis").each(function(){let i=e(this),r=0;i.find(".pid-slider-row").each(function(){let _=e(this);_.data("axis",n),_.data("bank",r),_.find('input[name="value-input"]').val(t.PIDs[n][r]).trigger("change"),r++}),n++}),a.sliderize(e("#rate_dynamics_center_sensitivity"),t.RATE_DYNAMICS.sensitivityCenter,25,175),a.sliderize(e("#rate_dynamics_end_sensitivity"),t.RATE_DYNAMICS.sensitivityEnd,25,175),a.sliderize(e("#rate_dynamics_center_correction"),t.RATE_DYNAMICS.correctionCenter,10,95),a.sliderize(e("#rate_dynamics_end_correction"),t.RATE_DYNAMICS.correctionEnd,10,95),a.sliderize(e("#rate_dynamics_center_weight"),t.RATE_DYNAMICS.weightCenter,0,95),a.sliderize(e("#rate_dynamics_end_weight"),t.RATE_DYNAMICS.weightEnd,0,95),t.isRpyFfComponentUsed()||e(".rpy_ff").prop("disabled","disabled"),t.isRpyDComponentUsed()||e(".rpy_d").prop("disabled","disabled"),S.add("drawRollPitchYawExpo",function(){P()},100),a.simpleBind(),e("a.refresh").on("click",function(){e("#content-watermark").remove(),e(".tab-pid_tuning").remove(),a.tab_switch_cleanup(function(){a.log(h.getMessage("pidTuningDataRefreshed")),u.pid_tuning.initialize()})}),e("a.update").on("click",function(){I(),e("#ez_tune_enabled").is(":checked")?t.EZ_TUNE.enabled=1:t.EZ_TUNE.enabled=0,t.EZ_TUNE.filterHz=e("#ez_tune_filter_hz").val(),t.EZ_TUNE.axisRatio=e("#ez_tune_axis_ratio").val(),t.EZ_TUNE.response=e("#ez_tune_response").val(),t.EZ_TUNE.damping=e("#ez_tune_damping").val(),t.EZ_TUNE.stability=e("#ez_tune_stability").val(),t.EZ_TUNE.aggressiveness=e("#ez_tune_aggressiveness").val(),t.EZ_TUNE.rate=e("#ez_tune_rate").val(),t.EZ_TUNE.expo=e("#ez_tune_expo").val(),t.EZ_TUNE.snappiness=e("#ez_tune_snappiness").val();function i(){R.send_message(v.MSPV2_INAV_SET_RATE_PROFILE,o.crunch(v.MSPV2_INAV_SET_RATE_PROFILE),!1,r)}function r(){o.saveRateDynamics(_)}function _(){o.saveEzTune(s)}function s(){w.saveInputs(p)}function p(){R.send_message(v.MSP_EEPROM_WRITE,!1,!1,function(){a.log(h.getMessage("pidTuningEepromSaved"))})}o.savePidData(i)}),a.content_ready(m)}};u.pid_tuning.cleanup=function(m){m&&m()};
