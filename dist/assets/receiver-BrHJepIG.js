import{T as S,G as _,p as Y,m as r,_ as J,n as z,i as p,$ as e,F as a,M as u,d as l,C as K,b as Q}from"./index--BqaKNiR.js";S.receiver={rateChartHeight:117};S.receiver.initialize=function(R){var T=this;_.active_tab!="receiver"&&(_.active_tab="receiver");var C=new Y,A=[r.loadMiscV2,r.loadRcData,r.loadRcMap,r.loadRxConfig,r.loadRcDeadband];A.push(r.loadRateProfileData),C.setChain(A),C.setExitPoint(B),C.execute();function B(){J(async()=>{const{default:o}=await import("./receiver-oOWuaj9Y.js");return{default:o}},[],import.meta.url).then(({default:o})=>_.load(o,z.processHtml(N)))}function L(o){z.saveInputs(o)}function N(){p.localize();let o=e("#receiver_type"),I=e("#serialrx_provider-wrapper"),y=e("#serialrx_provider option"),H=e("#serialrx_provider").val();y.sort(function(t,i){return t.text>i.text?1:t.text<i.text?-1:0});let f=e("#serialrx_provider");f.empty().append(y),f.val(H),f.on("change",function(){["SBUS","FPORT","FPORT2","FBUS"].includes(e(this).find("option:selected").text())?e("#frSkyOptions").show():e("#frSkyOptions").hide()}),f.trigger("change"),o.on("change",function(){e(this).find("option:selected").text()=="SERIAL"?(I.show(),f.trigger("change"),o.parent().removeClass("no-bottom-border")):(I.hide(),e("#frSkyOptions").hide(),o.parent().addClass("no-bottom-border"))}),o.trigger("change"),e('.tunings .throttle input[name="mid"]').val(a.RC_tuning.throttle_MID.toFixed(2)),e('.tunings .throttle input[name="expo"]').val(a.RC_tuning.throttle_EXPO.toFixed(2)),e('.deadband input[name="yaw_deadband"]').val(a.RC_deadband.yaw_deadband),e('.deadband input[name="deadband"]').val(a.RC_deadband.deadband);for(var F=[p.getMessage("controlAxisRoll"),p.getMessage("controlAxisPitch"),p.getMessage("controlAxisYaw"),p.getMessage("controlAxisThrottle")],m=e(".tab-receiver .bars"),n=0;n<a.RC.active_channels;n++){var x;n<F.length?x=F[n]:x=p.getMessage("radioChannelShort")+(n+1),m.append('                <ul>                    <li class="name">'+x+'</li>                    <li class="meter">                        <div class="meter-bar">                            <div class="label"></div>                            <div class="fill">                                <div class="label"></div>                            </div>                        </div>                    </li>                </ul>            ')}var P={min:800,max:2200},O=[];e(".meter .fill",m).each(function(){O.push(e(this))});var b=[];e(".meter",m).each(function(){b.push(e(".label",this))}),T.resize=function(){for(var t=e(".meter:first",m).width(),i=e(".meter .label:first",m).width(),c=t/2-i/2,d=0;d<b.length;d++)b[d].css("margin-left",c)},e(window).on("resize",T.resize).resize();for(var V=[],W=a.getRcMapLetters(),n=0;n<a.RC_MAP.length;n++)V[a.RC_MAP[n]]=W[n];var D=V.join(""),g=e('input[name="rcmap"]');g.val(D);var X=D;g.on("input",function(){var t=e(this).val();t.length>8&&(t=t.substr(0,8),e(this).val(t))}),g.focusout(function(){a.isRcMapValid(e(this).val())||e(this).val(X)}),g.on("input change",function(){e(this).css("color",a.isRcMapValid(e(this).val())?"":"#FF0000")}),e('select[name="rcmap_helper"]').val(0),e('select[name="rcmap_helper"]').on("change",function(){g.val(e(this).val())});var k=e('select[name="rssi_channel"]');k.append('<option value="0">Disabled</option>');for(var n=5;n<a.RC.active_channels+1;n++)k.append('<option value="'+n+'">CH'+n+"</option>");e('select[name="rssi_channel"]').val(a.MISC.rssi_channel);var h=S.receiver.rateChartHeight;e(".tunings .throttle input").on("input change",function(){setTimeout(function(){var t=e('.tunings .throttle input[name="mid"]'),i=e('.tunings .throttle input[name="expo"]'),c=parseFloat(t.val()),d=parseFloat(i.val()),E=e(".throttle_curve canvas").get(0),s=E.getContext("2d");if(c>=parseFloat(t.prop("min"))&&c<=parseFloat(t.prop("max"))&&d>=parseFloat(i.prop("min"))&&d<=parseFloat(i.prop("max"))){var v=200*c,w=v*.5,G=(200-v)*.5+v,M=h-v*(h/200),q=h-(h-M)*.5*(d+1),j=M/2*(d+1);s.clearRect(0,0,200,h),s.beginPath(),s.moveTo(0,h),s.quadraticCurveTo(w,q,v,M),s.moveTo(v,M),s.quadraticCurveTo(G,j,200,0),s.lineWidth=2,s.strokeStyle="#37a8db",s.stroke()}},0)}).trigger("input"),e("a.update").on("click",function(){a.RC_tuning.throttle_MID=parseFloat(e('.tunings .throttle input[name="mid"]').val()),a.RC_tuning.throttle_EXPO=parseFloat(e('.tunings .throttle input[name="expo"]').val()),a.RC_deadband.yaw_deadband=parseInt(e('.deadband input[name="yaw_deadband"]').val()),a.RC_deadband.deadband=parseInt(e('.deadband input[name="deadband"]').val());for(var t=e('input[name="rcmap"]').val(),i=t.split(""),c=0;c<a.RC_MAP.length;c++)a.RC_MAP[c]=i.indexOf(a.getRcMapLetters()[c]);a.MISC.rssi_channel=parseInt(e('select[name="rssi_channel"]').val());function d(){u.send_message(l.MSP_SET_RX_MAP,r.crunch(l.MSP_SET_RX_MAP),!1,E)}function E(){u.send_message(l.MSPV2_INAV_SET_MISC,r.crunch(l.MSPV2_INAV_SET_MISC),!1,s)}function s(){u.send_message(l.MSP_SET_RC_DEADBAND,r.crunch(l.MSP_SET_RC_DEADBAND),!1,v)}function v(){L(w)}function w(){u.send_message(l.MSP_EEPROM_WRITE,!1,!1,function(){_.log(p.getMessage("receiverEepromSaved")),_.tab_switch_cleanup(function(){u.send_message(l.MSP_SET_REBOOT,!1,!1,function(){_.log(p.getMessage("deviceRebooting")),_.handleReconnect(e(".tab_receiver a"))})})})}u.send_message(l.MSPV2_INAV_SET_RATE_PROFILE,r.crunch(l.MSPV2_INAV_SET_RATE_PROFILE),!1,d)}),e("a.sticks").on("click",function(){var t=window.open("tabs/receiver_msp.html","receiver_msp","width=420,height=760,menubar=no,contextIsolation=no,nodeIntegration=yes");t.window.setRawRx=function(i){return K.connectionValid&&_.active_tab!="cli"?(r.setRawRx(i),!0):!1}}),r.getSetting("receiver_type").then(function(t){t&&t.setting.table&&t.setting.table.values&&e(".sticks_btn").toggle(t.setting.table.values[t.value]=="MSP")});function $(){u.send_message(l.MSP_RC,!1,!1,U)}function U(){for(let t=0;t<a.RC.active_channels;t++)O[t].css("width",((a.RC.channels[t]-P.min)/(P.max-P.min)*100).clamp(0,100)+"%"),b[t].text(a.RC.channels[t])}Q.add("receiver_pull",$,25),_.content_ready(R)}};S.receiver.cleanup=function(R){e(window).off("resize",this.resize),R&&R()};
